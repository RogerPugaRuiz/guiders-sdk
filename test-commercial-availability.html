<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Commercial Availability Endpoint</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }
        .log {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #00ff00;
        }
        .error {
            color: #ff6b6b;
            border-left-color: #ff6b6b;
        }
        .success {
            color: #00ff00;
            border-left-color: #00ff00;
        }
        .info {
            color: #4ecdc4;
            border-left-color: #4ecdc4;
        }
        button {
            background: #00ff00;
            color: #1e1e1e;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00cc00;
        }
        input {
            padding: 8px;
            margin: 5px;
            width: 300px;
            background: #2e2e2e;
            border: 1px solid #00ff00;
            color: #00ff00;
        }
    </style>
</head>
<body>
    <h1>üß™ Test: Commercial Availability Endpoint</h1>

    <div>
        <label>API URL:</label><br>
        <input type="text" id="apiUrl" value="http://localhost:3000/api/v2/commercials/availability" style="width: 500px;">
    </div>

    <div>
        <label>Domain:</label><br>
        <input type="text" id="domain" value="127.0.0.1">
    </div>

    <div>
        <label>API Key:</label><br>
        <input type="text" id="apiKey" value="12ca17b49af2289436f303e0166030a21e525d266e209267433801a8fd4071a0" style="width: 500px;">
    </div>

    <div>
        <button onclick="testEndpoint()">üîç Test Endpoint</button>
        <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
    </div>

    <hr>

    <div id="logs"></div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            log('Logs cleared', 'info');
        }

        async function testEndpoint() {
            const apiUrl = document.getElementById('apiUrl').value;
            const domain = document.getElementById('domain').value;
            const apiKey = document.getElementById('apiKey').value;

            log('üöÄ Iniciando test...', 'info');
            log(`üì° URL: ${apiUrl}`, 'info');
            log(`üåê Domain: ${domain}`, 'info');
            log(`üîë API Key: ${apiKey.substring(0, 20)}...`, 'info');

            const payload = {
                domain: domain,
                apiKey: apiKey
            };

            log(`üì§ Enviando payload: ${JSON.stringify(payload, null, 2)}`, 'info');

            try {
                const startTime = Date.now();

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const duration = Date.now() - startTime;
                log(`‚è±Ô∏è Respuesta recibida en ${duration}ms`, 'info');
                log(`üìä Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

                const contentType = response.headers.get('content-type');
                log(`üìã Content-Type: ${contentType}`, 'info');

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ √âXITO: ${JSON.stringify(data, null, 2)}`, 'success');
                    log(`üìä Comerciales disponibles: ${data.available ? 'S√ç' : 'NO'}`, data.available ? 'success' : 'error');
                    log(`üë• Comerciales online: ${data.onlineCount}`, 'info');
                    log(`üïê Timestamp: ${data.timestamp}`, 'info');
                    log(`üÜî Site ID: ${data.siteId}`, 'info');
                } else {
                    const errorText = await response.text();
                    log(`‚ùå ERROR: ${response.status} - ${errorText}`, 'error');

                    // Intentar parsear como JSON si es posible
                    try {
                        const errorJson = JSON.parse(errorText);
                        log(`üìã Error detallado: ${JSON.stringify(errorJson, null, 2)}`, 'error');
                    } catch (e) {
                        // No es JSON, ya mostramos el texto
                    }
                }

            } catch (error) {
                log(`‚ùå EXCEPCI√ìN: ${error.message}`, 'error');
                log(`üîç Stack: ${error.stack}`, 'error');

                if (error.message.includes('fetch')) {
                    log(`‚ö†Ô∏è Posibles causas:`, 'error');
                    log(`   - El servidor no est√° corriendo`, 'error');
                    log(`   - CORS bloqueado`, 'error');
                    log(`   - URL incorrecta`, 'error');
                    log(`   - Timeout de red`, 'error');
                }
            }
        }

        // Auto-test al cargar
        window.addEventListener('DOMContentLoaded', () => {
            log('‚úÖ P√°gina cargada - Lista para probar', 'success');
            log('üí° Presiona "Test Endpoint" para verificar el endpoint', 'info');
        });
    </script>
</body>
</html>
