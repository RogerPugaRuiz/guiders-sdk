!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GuidersPixel=e():t.GuidersPixel=e()}(this,(()=>(()=>{var t={421:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenInjectionStage=void 0;const i=n(1921);e.TokenInjectionStage=class{process(t){return i.TokenManager.attachTokenToEvent(t)}}},528:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Polling=void 0;const s=n(4689),o=n(5374),a=n(6376),r=(0,i(n(7833)).default)("engine.io-client:polling");class c extends s.Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{r("paused"),this.readyState="paused",t()};if(this._polling||!this.writable){let t=0;this._polling&&(r("we are currently polling - waiting to pause"),t++,this.once("pollComplete",(function(){r("pre-pause polling complete"),--t||e()}))),this.writable||(r("we are currently writing - waiting to pause"),t++,this.once("drain",(function(){r("pre-pause writing complete"),--t||e()})))}else e()}_poll(){r("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){r("polling got data %s",t),(0,a.decodePayload)(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this._poll():r('ignoring poll - transport state "%s"',this.readyState))}doClose(){const t=()=>{r("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(r("transport open - closing"),t()):(r("transport not open - deferring close"),this.once("open",t))}write(t){this.writable=!1,(0,a.encodePayload)(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,o.randomString)()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}}e.Polling=c},611:(t,e,n)=>{"use strict";var i;n.r(e),n.d(e,{NIL:()=>D,parse:()=>m,stringify:()=>d,v1:()=>f,v3:()=>_,v4:()=>S,v5:()=>I,validate:()=>r,version:()=>A});var s=new Uint8Array(16);function o(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(s)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(t){return"string"==typeof t&&a.test(t)};for(var c=[],l=0;l<256;++l)c.push((l+256).toString(16).substr(1));const d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[t[e+0]]+c[t[e+1]]+c[t[e+2]]+c[t[e+3]]+"-"+c[t[e+4]]+c[t[e+5]]+"-"+c[t[e+6]]+c[t[e+7]]+"-"+c[t[e+8]]+c[t[e+9]]+"-"+c[t[e+10]]+c[t[e+11]]+c[t[e+12]]+c[t[e+13]]+c[t[e+14]]+c[t[e+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n};var h,u,p=0,g=0;const f=function(t,e,n){var i=e&&n||0,s=e||new Array(16),a=(t=t||{}).node||h,r=void 0!==t.clockseq?t.clockseq:u;if(null==a||null==r){var c=t.random||(t.rng||o)();null==a&&(a=h=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==r&&(r=u=16383&(c[6]<<8|c[7]))}var l=void 0!==t.msecs?t.msecs:Date.now(),f=void 0!==t.nsecs?t.nsecs:g+1,m=l-p+(f-g)/1e4;if(m<0&&void 0===t.clockseq&&(r=r+1&16383),(m<0||l>p)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=l,g=f,u=r;var b=(1e4*(268435455&(l+=122192928e5))+f)%4294967296;s[i++]=b>>>24&255,s[i++]=b>>>16&255,s[i++]=b>>>8&255,s[i++]=255&b;var v=l/4294967296*1e4&268435455;s[i++]=v>>>8&255,s[i++]=255&v,s[i++]=v>>>24&15|16,s[i++]=v>>>16&255,s[i++]=r>>>8|128,s[i++]=255&r;for(var y=0;y<6;++y)s[i+y]=a[y];return e||d(s)},m=function(t){if(!r(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=255&e,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=255&e,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=255&e,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=255&e,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=255&e,n};function b(t,e,n){function i(t,i,s,o){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}(t)),"string"==typeof i&&(i=m(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+t.length);if(a.set(i),a.set(t,i.length),(a=n(a))[6]=15&a[6]|e,a[8]=63&a[8]|128,s){o=o||0;for(var r=0;r<16;++r)s[o+r]=a[r];return s}return d(a)}try{i.name=t}catch(t){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}function v(t){return 14+(t+64>>>9<<4)+1}function y(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function w(t,e,n,i,s,o){return y((a=y(y(e,t),y(i,o)))<<(r=s)|a>>>32-r,n);var a,r}function k(t,e,n,i,s,o,a){return w(e&n|~e&i,t,e,s,o,a)}function T(t,e,n,i,s,o,a){return w(e&i|n&~i,t,e,s,o,a)}function C(t,e,n,i,s,o,a){return w(e^n^i,t,e,s,o,a)}function x(t,e,n,i,s,o,a){return w(n^(e|~i),t,e,s,o,a)}const _=b("v3",48,(function(t){if("string"==typeof t){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return function(t){for(var e=[],n=32*t.length,i="0123456789abcdef",s=0;s<n;s+=8){var o=t[s>>5]>>>s%32&255,a=parseInt(i.charAt(o>>>4&15)+i.charAt(15&o),16);e.push(a)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[v(e)-1]=e;for(var n=1732584193,i=-271733879,s=-1732584194,o=271733878,a=0;a<t.length;a+=16){var r=n,c=i,l=s,d=o;n=k(n,i,s,o,t[a],7,-680876936),o=k(o,n,i,s,t[a+1],12,-389564586),s=k(s,o,n,i,t[a+2],17,606105819),i=k(i,s,o,n,t[a+3],22,-1044525330),n=k(n,i,s,o,t[a+4],7,-176418897),o=k(o,n,i,s,t[a+5],12,1200080426),s=k(s,o,n,i,t[a+6],17,-1473231341),i=k(i,s,o,n,t[a+7],22,-45705983),n=k(n,i,s,o,t[a+8],7,1770035416),o=k(o,n,i,s,t[a+9],12,-1958414417),s=k(s,o,n,i,t[a+10],17,-42063),i=k(i,s,o,n,t[a+11],22,-1990404162),n=k(n,i,s,o,t[a+12],7,1804603682),o=k(o,n,i,s,t[a+13],12,-40341101),s=k(s,o,n,i,t[a+14],17,-1502002290),n=T(n,i=k(i,s,o,n,t[a+15],22,1236535329),s,o,t[a+1],5,-165796510),o=T(o,n,i,s,t[a+6],9,-1069501632),s=T(s,o,n,i,t[a+11],14,643717713),i=T(i,s,o,n,t[a],20,-373897302),n=T(n,i,s,o,t[a+5],5,-701558691),o=T(o,n,i,s,t[a+10],9,38016083),s=T(s,o,n,i,t[a+15],14,-660478335),i=T(i,s,o,n,t[a+4],20,-405537848),n=T(n,i,s,o,t[a+9],5,568446438),o=T(o,n,i,s,t[a+14],9,-1019803690),s=T(s,o,n,i,t[a+3],14,-187363961),i=T(i,s,o,n,t[a+8],20,1163531501),n=T(n,i,s,o,t[a+13],5,-1444681467),o=T(o,n,i,s,t[a+2],9,-51403784),s=T(s,o,n,i,t[a+7],14,1735328473),n=C(n,i=T(i,s,o,n,t[a+12],20,-1926607734),s,o,t[a+5],4,-378558),o=C(o,n,i,s,t[a+8],11,-2022574463),s=C(s,o,n,i,t[a+11],16,1839030562),i=C(i,s,o,n,t[a+14],23,-35309556),n=C(n,i,s,o,t[a+1],4,-1530992060),o=C(o,n,i,s,t[a+4],11,1272893353),s=C(s,o,n,i,t[a+7],16,-155497632),i=C(i,s,o,n,t[a+10],23,-1094730640),n=C(n,i,s,o,t[a+13],4,681279174),o=C(o,n,i,s,t[a],11,-358537222),s=C(s,o,n,i,t[a+3],16,-722521979),i=C(i,s,o,n,t[a+6],23,76029189),n=C(n,i,s,o,t[a+9],4,-640364487),o=C(o,n,i,s,t[a+12],11,-421815835),s=C(s,o,n,i,t[a+15],16,530742520),n=x(n,i=C(i,s,o,n,t[a+2],23,-995338651),s,o,t[a],6,-198630844),o=x(o,n,i,s,t[a+7],10,1126891415),s=x(s,o,n,i,t[a+14],15,-1416354905),i=x(i,s,o,n,t[a+5],21,-57434055),n=x(n,i,s,o,t[a+12],6,1700485571),o=x(o,n,i,s,t[a+3],10,-1894986606),s=x(s,o,n,i,t[a+10],15,-1051523),i=x(i,s,o,n,t[a+1],21,-2054922799),n=x(n,i,s,o,t[a+8],6,1873313359),o=x(o,n,i,s,t[a+15],10,-30611744),s=x(s,o,n,i,t[a+6],15,-1560198380),i=x(i,s,o,n,t[a+13],21,1309151649),n=x(n,i,s,o,t[a+4],6,-145523070),o=x(o,n,i,s,t[a+11],10,-1120210379),s=x(s,o,n,i,t[a+2],15,718787259),i=x(i,s,o,n,t[a+9],21,-343485551),n=y(n,r),i=y(i,c),s=y(s,l),o=y(o,d)}return[n,i,s,o]}(function(t){if(0===t.length)return[];for(var e=8*t.length,n=new Uint32Array(v(e)),i=0;i<e;i+=8)n[i>>5]|=(255&t[i/8])<<i%32;return n}(t),8*t.length))})),S=function(t,e,n){var i=(t=t||{}).random||(t.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){n=n||0;for(var s=0;s<16;++s)e[n+s]=i[s];return e}return d(i)};function E(t,e,n,i){switch(t){case 0:return e&n^~e&i;case 1:case 3:return e^n^i;case 2:return e&n^e&i^n&i}}function M(t,e){return t<<e|t>>>32-e}const I=b("v5",80,(function(t){var e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var i=unescape(encodeURIComponent(t));t=[];for(var s=0;s<i.length;++s)t.push(i.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,a=Math.ceil(o/16),r=new Array(a),c=0;c<a;++c){for(var l=new Uint32Array(16),d=0;d<16;++d)l[d]=t[64*c+4*d]<<24|t[64*c+4*d+1]<<16|t[64*c+4*d+2]<<8|t[64*c+4*d+3];r[c]=l}r[a-1][14]=8*(t.length-1)/Math.pow(2,32),r[a-1][14]=Math.floor(r[a-1][14]),r[a-1][15]=8*(t.length-1)&4294967295;for(var h=0;h<a;++h){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=r[h][p];for(var g=16;g<80;++g)u[g]=M(u[g-3]^u[g-8]^u[g-14]^u[g-16],1);for(var f=n[0],m=n[1],b=n[2],v=n[3],y=n[4],w=0;w<80;++w){var k=Math.floor(w/20),T=M(f,5)+E(k,m,b,v)+y+e[k]+u[w]>>>0;y=v,v=b,b=M(m,30)>>>0,m=f,f=T}n[0]=n[0]+f>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+b>>>0,n[3]=n[3]+v>>>0,n[4]=n[4]+y>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),D="00000000-0000-0000-0000-000000000000",A=function(t){if(!r(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}},736:(t,e,n)=>{t.exports=function(t){function e(t){let n,s,o,a=null;function r(...t){if(!r.enabled)return;const i=r,s=Number(new Date),o=s-(n||s);i.diff=o,i.prev=n,i.curr=s,n=s,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";a++;const o=e.formatters[s];if("function"==typeof o){const e=t[a];n=o.call(i,e),t.splice(a,1),a--}return n})),e.formatArgs.call(i,t),(i.log||e.log).apply(i,t)}return r.namespace=t,r.useColors=e.useColors(),r.color=e.selectColor(t),r.extend=i,r.destroy=e.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==e.namespaces&&(s=e.namespaces,o=e.enabled(t)),o),set:t=>{a=t}}),"function"==typeof e.init&&e.init(r),r}function i(t,n){const i=e(this.namespace+(void 0===n?":":n)+t);return i.log=this.log,i}function s(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){const t=[...e.names.map(s),...e.skips.map(s).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const i=("string"==typeof t?t:"").split(/[\s,]+/),s=i.length;for(n=0;n<s;n++)i[n]&&("-"===(t=i[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(6585),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}},969:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UnreadMessagesService=void 0;class n{constructor(){this.unreadCount=0,this.listeners=[],this.isActive=!1;const t=localStorage.getItem("guiders-unread-count");this.unreadCount=t&&parseInt(t,10)||0,console.log("Servicio UnreadMessages inicializado")}static getInstance(){return this.instance||(this.instance=new n),this.instance}incrementUnreadCount(){this.isActive||(this.unreadCount++,localStorage.setItem("guiders-unread-count",this.unreadCount.toString()),this.notifyListeners(),console.log("Unread count incremented:",this.unreadCount))}resetUnreadCount(){this.unreadCount=0,localStorage.setItem("guiders-unread-count","0"),this.notifyListeners(),console.log("Unread count reset")}getUnreadCount(){return this.unreadCount}setActive(t){console.log("Chat estado activo cambiado:",t),this.isActive=t,t?this.resetUnreadCount():localStorage.setItem("guiders-unread-count",this.unreadCount.toString())}isChatActive(){return this.isActive}onCountChange(t){console.log("Nuevo listener añadido para cambios de contador"),this.listeners.push(t),t(this.unreadCount)}forceUpdate(){console.log("Forzando actualización del contador:",this.unreadCount),this.notifyListeners()}notifyListeners(){console.log("Notificando a",this.listeners.length,"listeners sobre cambio en contador:",this.unreadCount),this.listeners.forEach((t=>{try{t(this.unreadCount)}catch(t){console.error("Error al notificar listener:",t)}}))}}e.UnreadMessagesService=n,n.instance=null},1015:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=function(t){if(t.length>8e3)throw"URI too long";const e=t,s=t.indexOf("["),o=t.indexOf("]");-1!=s&&-1!=o&&(t=t.substring(0,s)+t.substring(s,o).replace(/:/g,";")+t.substring(o,t.length));let a=n.exec(t||""),r={},c=14;for(;c--;)r[i[c]]=a[c]||"";return-1!=s&&-1!=o&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(t,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||n.splice(0,1),"/"==e.slice(-1)&&n.splice(n.length-1,1),n}(0,r.path),r.queryKey=function(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(n[e]=i)})),n}(0,r.query),r};const n=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]},1034:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HeuristicElementDetector=void 0;const i=n(6932);e.HeuristicElementDetector=class{constructor(t={}){this.heuristicRules={add_to_cart:[{selector:'button, input[type="submit"], a',confidence:i.ConfidenceLevel.HIGH,textPatterns:["añadir","agregar","add to cart","add cart","comprar","buy"],attributePatterns:{class:"cart",id:"cart"},contextSelectors:['[class*="product"]','[class*="item"]','[class*="cart"]']},{selector:'input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,attributePatterns:{value:"carrito"}},{selector:'a[href*="cart"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["add","añadir"]}],contact_dealer:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["contactar","contact","concesionario","dealer"],contextSelectors:['[class*="dealer"]','[class*="contact"]','form[class*="contact"]']},{selector:'form input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['form[class*="contact"]','form[id*="contact"]']}],search_submit:[{selector:'button[type="submit"], input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,contextSelectors:['form[class*="search"]','[class*="filter"]','[class*="search"]']},{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["buscar","search","filtrar","filter"]}],schedule_test_drive:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["test drive","prueba","conducir","probar","cita"],contextSelectors:['[class*="vehicle"]','[class*="car"]','[class*="auto"]']}],request_quote:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["cotizar","quote","presupuesto","precio","solicitar"],contextSelectors:['[class*="vehicle"]','[class*="product"]','[class*="price"]']}],view_product:[{selector:"a, div, article",confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['[class*="product"]','[class*="item"]','[class*="card"]'],attributePatterns:{href:"product"}}],purchase:[{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["comprar","buy","purchase","pagar","pay","checkout"],contextSelectors:['[class*="checkout"]','[class*="payment"]','[class*="buy"]']}],view_cart:[{selector:"a, button, div",confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["carrito","cart","basket"],attributePatterns:{href:"cart",class:"cart"}}],download_brochure:[{selector:"a, button",confidence:i.ConfidenceLevel.HIGH,textPatterns:["descargar","download","brochure","folleto","catálogo","pdf"],attributePatterns:{href:".pdf"}}]},this.config=Object.assign({enabled:!0,confidenceThreshold:i.ConfidenceLevel.MEDIUM,fallbackToManual:!0},t),t.customRules&&(this.heuristicRules=Object.assign(Object.assign({},this.heuristicRules),t.customRules))}detectElements(t){if(!this.config.enabled)return[];const e=this.heuristicRules[t];if(!e||0===e.length)return[];const n=[];for(const i of e){const e=this.findElementsByRule(i);for(const s of e){const e=this.calculateConfidence(s,i);e>=this.config.confidenceThreshold&&n.push({element:s,eventType:t,confidence:e,matchedRule:i})}}return this.deduplicateResults(n).sort(((t,e)=>e.confidence-t.confidence))}findElementsByRule(t){return Array.from(document.querySelectorAll(t.selector)).filter((e=>this.elementMatchesRule(e,t)))}elementMatchesRule(t,e){var n,i;if(e.textPatterns){const i=(null===(n=t.textContent)||void 0===n?void 0:n.toLowerCase())||"";if(!e.textPatterns.some((t=>i.includes(t.toLowerCase()))))return!1}if(e.attributePatterns)for(const[n,s]of Object.entries(e.attributePatterns))if(!((null===(i=t.getAttribute(n))||void 0===i?void 0:i.toLowerCase())||"").includes(s.toLowerCase()))return!1;return!(e.contextSelectors&&!e.contextSelectors.some((e=>null!==t.closest(e)||null!==t.querySelector(e))))}calculateConfidence(t,e){var n;let i=e.confidence;if(e.textPatterns){const s=(null===(n=t.textContent)||void 0===n?void 0:n.toLowerCase())||"";i+=.1*e.textPatterns.filter((t=>s===t.toLowerCase())).length}if(e.attributePatterns){const n=Object.entries(e.attributePatterns).filter((([e,n])=>{var i;return((null===(i=t.getAttribute(e))||void 0===i?void 0:i.toLowerCase())||"").includes(n.toLowerCase())})).length;i+=.05*n}return Math.min(i,1)}deduplicateResults(t){const e=new Set;return t.filter((t=>!e.has(t.element)&&(e.add(t.element),!0)))}getConfig(){return Object.assign({},this.config)}updateConfig(t){this.config=Object.assign(Object.assign({},this.config),t)}addCustomRules(t,e){this.heuristicRules[t]||(this.heuristicRules[t]=[]),this.heuristicRules[t].push(...e)}}},1122:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchMessages=function(t,e){return n(this,arguments,void 0,(function*(t,e,n=10){const i=new URLSearchParams;e&&i.append("cursor",e),i.append("limit",String(n));const s=`${localStorage.getItem("pixelEndpoint")}/chats/${t}/messages?${i.toString()}`,o=yield fetch(s,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Error al obtener mensajes (${o.status})`);return o.json()}))}},1750:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},1921:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TokenManager=void 0;const s=n(9550),o=n(9126);class a{static subscribeToTokenChanges(t){this.tokenChangeSubscribers.push(t)}static unsubscribeFromTokenChanges(t){const e=this.tokenChangeSubscribers.indexOf(t);e>=0&&this.tokenChangeSubscribers.splice(e,1)}static notifyTokenChange(t){this.tokenChangeSubscribers.forEach((e=>e(t)))}static setTokens(t){this.accessToken=t.access_token,this.refreshToken=t.refresh_token,localStorage.setItem("accessToken",t.access_token),localStorage.setItem("refreshToken",t.refresh_token),this.setExpirationTime(t.access_token)}static setAccessToken(t){this.accessToken=t,localStorage.setItem("accessToken",t),this.setExpirationTime(t)}static isTokenExpiring(t=60){if(!this.expirationTime)return!0;const e=Math.floor(Date.now()/1e3);return this.expirationTime-e<t}static getValidAccessToken(){return i(this,void 0,void 0,(function*(){if(this.isTokenExpiring()){if(console.log("Access token está a punto de expirar, intentando refrescar..."),!this.refreshToken)return console.error("No hay refresh token disponible."),null;try{const t=yield(0,s.refreshToken)(this.refreshToken);this.setTokens({access_token:t.access_token,refresh_token:this.refreshToken}),console.log("Token refrescado exitosamente.")}catch(t){console.error(t);const e=new o.ClientJS,n=localStorage.getItem("fingerprint")||e.getFingerprint().toString(),i=yield(0,s.fetchTokens)(n);return this.setTokens(i),i.access_token}}return this.accessToken}))}static loadTokensFromStorage(){try{const t=localStorage.getItem("accessToken"),e=localStorage.getItem("refreshToken"),n=localStorage.getItem("tokenExpiration");if(!t||!e||!n)return!1;const i=parseInt(n,10);return!(isNaN(i)||i<=0||(this.accessToken=t,this.refreshToken=e,this.expirationTime=i,0))}catch(t){return console.error("Error al cargar tokens desde almacenamiento:",t),!1}}static hasValidTokens(){return!!this.accessToken&&!!this.refreshToken}static attachTokenToEvent(t){return this.accessToken?(console.log("🔒 Adjuntando token al evento."),Object.assign(Object.assign({},t),{token:this.accessToken})):(console.error("No hay access token disponible."),t)}static startTokenMonitor(){this.tokenMonitorInterval?console.warn("Token monitor ya está corriendo."):(this.tokenMonitorInterval=setInterval((()=>i(this,void 0,void 0,(function*(){if(console.log("⏳ Verificando el estado del token..."),this.isTokenExpiring()){console.log("⚠️ Token a punto de expirar, intentando refrescar...");const t=yield this.getValidAccessToken();t?(this.notifyTokenChange(t),console.log("✅ Token refrescado automáticamente.")):console.error("❌ No se pudo refrescar el token.")}}))),1e4),console.log("🟢 Token monitor iniciado."))}static stopTokenMonitor(){this.tokenMonitorInterval&&(clearInterval(this.tokenMonitorInterval),this.tokenMonitorInterval=null,console.log("🛑 Token monitor detenido."))}static setExpirationTime(t){try{const e=t.split(".")[1],n=atob(e),i=JSON.parse(n);this.expirationTime=i.exp,localStorage.setItem("tokenExpiration",i.exp.toString())}catch(t){console.error("Error al decodificar el token:",t),this.expirationTime=null}}}e.TokenManager=a,a.accessToken=null,a.refreshToken=null,a.expirationTime=null,a.tokenMonitorInterval=null,a.tokenChangeSubscribers=[]},1999:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ValidationStage=void 0,e.ValidationStage=class{process(t){if(!t.type)throw new Error("El evento debe tener un tipo");if(!t.data)throw new Error("El evento debe tener datos");if(!t.timestamp)throw new Error("El evento debe tener una marca de tiempo");if(!t.token)throw new Error("El evento debe tener un token");return t}}},2046:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ERROR_PACKET=e.PACKET_TYPES_REVERSE=e.PACKET_TYPES=void 0;const n=Object.create(null);e.PACKET_TYPES=n,n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const i=Object.create(null);e.PACKET_TYPES_REVERSE=i,Object.keys(n).forEach((t=>{i[n[t]]=t})),e.ERROR_PACKET={type:"error",data:"parser error"}},2071:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.XHR=e.Request=e.BaseXHR=void 0;const s=n(528),o=n(4454),a=n(5374),r=n(4624),c=n(4110),l=(0,i(n(7833)).default)("engine.io-client:polling");function d(){}class h extends s.Polling{constructor(t){if(super(t),"undefined"!=typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){l("xhr poll");const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}e.BaseXHR=h;class u extends o.Emitter{constructor(t,e,n){super(),this.createRequest=t,(0,a.installTimerFunctions)(this,n),this._opts=n,this._method=n.method||"GET",this._uri=e,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var t;const e=(0,a.pick)(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(e);try{l("xhr open %s: %s",this._method,this._uri),n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let t in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(t)&&n.setRequestHeader(t,this._opts.extraHeaders[t])}}catch(t){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this._opts.cookieJar)||void 0===t||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var t;3===n.readyState&&(null===(t=this._opts.cookieJar)||void 0===t||t.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof n.status?n.status:0)}),0))},l("xhr data %s",this._data),n.send(this._data)}catch(t){return void this.setTimeoutFn((()=>{this._onError(t)}),0)}"undefined"!=typeof document&&(this._index=u.requestsCount++,u.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=d,t)try{this._xhr.abort()}catch(t){}"undefined"!=typeof document&&delete u.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(e.Request=u,u.requestsCount=0,u.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",p);else if("function"==typeof addEventListener){const t="onpagehide"in r.globalThisShim?"pagehide":"unload";addEventListener(t,p,!1)}function p(){for(let t in u.requests)u.requests.hasOwnProperty(t)&&u.requests[t].abort()}const g=function(){const t=f({xdomain:!1});return t&&null!==t.responseType}();function f(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||c.hasCORS))return new XMLHttpRequest}catch(t){}if(!e)try{return new(r.globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}e.XHR=class extends h{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=g&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new u(f,this.uri(),t)}}},2588:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PipelineProcessorBuilder=e.PipelineProcessor=void 0;class n{constructor(t=[]){this.stages=t}process(t){let e;for(const n of this.stages)try{e=n.process(t),t=e,console.log(`Procesando evento con ${n.constructor.name}`)}catch(t){console.error(`Error en el pipeline: ${t}`);break}if(!e)throw new Error("No se pudo procesar el evento");return console.log("Evento procesado:",e),e}}e.PipelineProcessor=n,e.PipelineProcessorBuilder=class{constructor(){this.stages=[]}addStage(t){return this.stages.push(t),this}build(){return new n(this.stages)}}},2597:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))},s=this&&this.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.TrackingPixelSDK=e.EndpointManager=void 0;const o=n(9126),a=n(2588),r=n(1921),c=n(9550),l=n(5476),d=n(3104),h=n(4815),u=n(421),p=n(1999),g=n(5861),f=n(9329),m=n(2919),b=n(5558),v=n(2969),y=n(611),w=n(6808),k=n(2895),T=n(969),C=n(6420);class x{constructor(t,e){this.endpoint=t,this.webSocketEndpoint=e}static getInstance(t="http://localhost:3000",e="ws://localhost:3000"){return x.instance||(x.instance=new x(t,e)),x.instance}static setInstance(t,e){x.instance?(x.instance.endpoint=t,x.instance.webSocketEndpoint=e):x.instance=new x(t,e)}getEndpoint(){return this.endpoint}getWebSocketEndpoint(){return this.webSocketEndpoint}setEndpoint(t){this.endpoint=t}setWebSocketEndpoint(t){this.webSocketEndpoint=t}}e.EndpointManager=x,e.TrackingPixelSDK=class{constructor(t){var e,n,i,s,o,r,c,l,m,b,v,y,T,_,S,E,M,I,D,A;this.pipelineBuilder=new a.PipelineProcessorBuilder,this.eventQueue=[],this.fingerprint=null,this.webSocket=null,this.chatUI=null,this.autoFlush=!1,this.flushInterval=1e4,this.flushTimer=null,this.maxRetries=3,this.listeners=new Map,this.sessionTrackingManager=null;const P=t.endpoint||"http://localhost:3000",L=t.webSocketEndpoint||"ws://localhost:3000";if(x.setInstance(P,L),this.endpoint=P,this.webSocketEndpoint=L,this.apiKey=t.apiKey,this.autoFlush=null!==(e=t.autoFlush)&&void 0!==e&&e,this.flushInterval=null!==(n=t.flushInterval)&&void 0!==n?n:1e4,this.maxRetries=null!==(i=t.maxRetries)&&void 0!==i?i:3,localStorage.setItem("pixelEndpoint",this.endpoint),this.eventPipeline=this.pipelineBuilder.addStage(new h.TimeStampStage).addStage(new u.TokenInjectionStage).addStage(new f.URLInjectionStage).addStage(new g.MetadataInjectionStage).addStage(new p.ValidationStage).build(),this.webSocket=d.WebSocketClient.getInstance(this.webSocketEndpoint),this.heuristicEnabled=null===(o=null===(s=t.heuristicDetection)||void 0===s?void 0:s.enabled)||void 0===o||o,this.heuristicEnabled?(console.log("[TrackingPixelSDK] 🚀 Initializing with heuristic detection enabled"),this.domTrackingManager=new k.EnhancedDomTrackingManager((t=>this.track(t)),new w.DefaultTrackDataExtractor,(null===(r=t.heuristicDetection)||void 0===r?void 0:r.config)||{})):(console.log("[TrackingPixelSDK] Initializing with legacy DOM tracking"),this.domTrackingManager=new w.DomTrackingManager((t=>this.track(t)))),null===(l=null===(c=t.sessionTracking)||void 0===c?void 0:c.enabled)||void 0===l||l){console.log("[TrackingPixelSDK] 📊 Initializing advanced session tracking with Intercom-like features");const e=(null===(m=t.sessionTracking)||void 0===m?void 0:m.config)||{},n=(null===(b=t.sessionTracking)||void 0===b?void 0:b.activityDetection)||{},i=(null===(v=t.sessionTracking)||void 0===v?void 0:v.multiTabSupport)||{},s=Object.assign(Object.assign({},e),{enableRealActivityDetection:null===(y=n.enabled)||void 0===y||y,maxInactivityTime:null!==(T=n.inactivityThreshold)&&void 0!==T?T:6e4,activityDebounceTime:null!==(_=n.debounceDelay)&&void 0!==_?_:1e3,enableCrossTabSync:null===(S=i.enabled)||void 0===S||S,heartbeatInterval:null!==(E=e.heartbeatInterval)&&void 0!==E?E:1e4,heartbeatActivityWindow:null!==(M=e.heartbeatActivityWindow)&&void 0!==M?M:12e4,enableAutoTimeout:null===(I=e.enableAutoTimeout)||void 0===I||I,beaconEndpoint:null!==(D=e.beaconEndpoint)&&void 0!==D?D:"/api/session-tracking",debugMode:null!==(A=e.debugMode)&&void 0!==A&&A});this.sessionTrackingManager=new C.SessionTrackingManager((t=>this.track(t)),s),console.log("[TrackingPixelSDK] Session tracking configured with enhanced features:",{realActivityDetection:s.enableRealActivityDetection,crossTabSync:s.enableCrossTabSync,heartbeatInterval:s.heartbeatInterval,inactivityThreshold:s.maxInactivityTime,activityDebounce:s.activityDebounceTime})}}init(){return i(this,void 0,void 0,(function*(){const t=(0,l.checkServerConnection)(this.endpoint),e=new o.ClientJS;this.fingerprint=localStorage.getItem("fingerprint")||e.getFingerprint().toString(),localStorage.setItem("fingerprint",this.fingerprint),r.TokenManager.loadTokensFromStorage(),yield t,console.log("✅ Conexión con el servidor establecida."),console.log("Registrando cliente para asegurar tokens válidos...");try{const t=yield(0,c.ensureTokens)(this.fingerprint,this.apiKey);r.TokenManager.setTokens(t),console.log("Cliente registrado exitosamente.")}catch(t){if(console.error("Error al registrar cliente:",t),!r.TokenManager.hasValidTokens())throw new Error("No se pudo registrar el cliente y no hay tokens válidos.");console.warn("Continuando con tokens existentes...")}const n=yield r.TokenManager.getValidAccessToken();n&&this.webSocket?this.webSocket.connect(n):console.warn("WebSocket no conectado por falta de token."),r.TokenManager.startTokenMonitor(),this.autoFlush&&this.startAutoFlush(),this.webSocket?(console.log("Esperando conexión WebSocket..."),yield this.webSocket.waitForConnection(),console.log("Conexión WebSocket establecida."),this.webSocket.onChatMessage((t=>{const e=this.eventPipeline.process(t);console.log("Mensaje recibido:",e),this.dispatchMessage(e)})),this.webSocket.healthCheck()):console.error("WebSocket no disponible."),console.log("Esperando mensajes del servidor..."),this.chatUI=new m.ChatUI({widget:!0});const i=this.chatUI,s=new b.ChatInputUI(i),a=new v.ChatToggleButtonUI(i),d=()=>{console.log("Inicializando componentes del chat rápidamente..."),i.init(),i.hide(),s.init(),a.init(),document.querySelectorAll(".chat-widget, .chat-widget-fixed").forEach((t=>{t.addEventListener("system-message",(t=>{const e=t;i.addSystemMessage(e.detail.message)}))})),console.log("Componentes del chat inicializados. Chat oculto por defecto."),i.onOpen((()=>{this.captureEvent("visitor:open-chat",{timestamp:(new Date).getTime(),chatId:i.getChatId()});try{const t=T.UnreadMessagesService.getInstance();console.log("Chat abierto: Marcando chat como activo"),t.setActive(!0)}catch(t){console.error("Error al marcar chat como activo:",t)}})),i.onClose((()=>{this.captureEvent("visitor:close-chat",{timestamp:(new Date).getTime(),chatId:i.getChatId()});try{const t=T.UnreadMessagesService.getInstance();console.log("Chat cerrado: Marcando chat como inactivo"),t.setActive(!1)}catch(t){console.error("Error al marcar chat como inactivo:",t)}})),i.onActiveInterval((()=>{console.log("Intervalo activo"),this.captureEvent("visitor:chat-active",{timestamp:(new Date).getTime(),chatId:i.getChatId()})}),1e4),a.onToggle((t=>{console.log("Toggle event: chat debe estar "+(t?"visible":"oculto")),t?i.show():i.hide()})),s.onSubmit((t=>{t&&(this.captureEvent("visitor:send-message",{id:(0,y.v4)(),message:t,timestamp:(new Date).getTime(),chatId:i.getChatId()}),this.flush())})),this.on("receive-message",(t=>{console.log("Mensaje recibido via WebSocket:",t),t.data.senderId||console.warn("⚠️ Mensaje WebSocket sin senderId:",t),i.renderChatMessage({text:t.data.message,sender:"other",senderId:t.data.senderId,timestamp:t.data.timestamp})}))};"loading"===document.readyState?(console.log("El DOM aún no está completamente cargado. Esperando..."),document.addEventListener("DOMContentLoaded",d),console.log("Esperando a que el DOM esté completamente cargado...")):(console.log("El DOM ya está completamente cargado."),d()),this.sessionTrackingManager&&(console.log("🎯 Starting session tracking..."),this.sessionTrackingManager.startSessionTracking())}))}configureTypingIndicators(t){this.webSocket?(this.webSocket.onTypingStarted((()=>{t.isVisible()&&t.showTypingIndicator()})),this.webSocket.onTypingStopped((()=>{t.hideTypingIndicator()}))):console.warn("WebSocket no está configurado - No se pueden añadir listeners para indicadores de escritura")}on(t,e){var n;this.listeners.has(t)||this.listeners.set(t,new Set),null===(n=this.listeners.get(t))||void 0===n||n.add(e)}off(t,e){var n;null===(n=this.listeners.get(t))||void 0===n||n.delete(e)}once(t,e){const n=i=>{e(i),this.off(t,n)};this.on(t,n)}addPipelineStage(t){this.eventPipeline=this.pipelineBuilder.addStage(t).build()}enableDOMTracking(){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?(console.log("[TrackingPixelSDK] 🎯 Enabling automatic heuristic tracking"),this.domTrackingManager.enableAutomaticTracking()):(console.log("[TrackingPixelSDK] Enabling legacy DOM tracking"),this.domTrackingManager.enableDOMTracking())}enableAutomaticTracking(){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.enableAutomaticTracking():(console.warn("[TrackingPixelSDK] Heuristic detection not available. Use enableDOMTracking() instead."),this.domTrackingManager.enableDOMTracking())}getHeuristicConfig(){return this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.getHeuristicConfig():null}updateHeuristicConfig(t){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.updateHeuristicConfig(t):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}setHeuristicEnabled(t){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.setHeuristicEnabled(t):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}enableSessionTracking(){this.sessionTrackingManager?this.sessionTrackingManager.startSessionTracking():console.warn("[TrackingPixelSDK] Session tracking not initialized.")}disableSessionTracking(){this.sessionTrackingManager&&this.sessionTrackingManager.endSessionTracking()}getCurrentSession(){var t;return(null===(t=this.sessionTrackingManager)||void 0===t?void 0:t.getCurrentSession())||null}updateSessionConfig(t){this.sessionTrackingManager?this.sessionTrackingManager.updateConfig(t):console.warn("[TrackingPixelSDK] Session tracking not initialized.")}getSessionStats(){var t;return(null===(t=this.sessionTrackingManager)||void 0===t?void 0:t.getSessionStats())||null}forceEndSession(t="user_action"){this.sessionTrackingManager?this.sessionTrackingManager.forceSessionEnd(t):console.warn("[TrackingPixelSDK] Session tracking not initialized.")}clearGlobalSession(){this.sessionTrackingManager?this.sessionTrackingManager.clearGlobalSession():console.warn("[TrackingPixelSDK] Session tracking not initialized.")}getGlobalSessionId(){return this.sessionTrackingManager?this.sessionTrackingManager.getGlobalSessionId():(console.warn("[TrackingPixelSDK] Session tracking not initialized."),null)}getEnhancedSessionStats(){var t;return(null===(t=this.sessionTrackingManager)||void 0===t?void 0:t.getSessionStats())||null}isSessionTrackingEnabled(){return null!==this.sessionTrackingManager}restartSessionTracking(t){this.sessionTrackingManager?(this.sessionTrackingManager.endSessionTracking(),t&&this.sessionTrackingManager.updateConfig(t),this.sessionTrackingManager.startSessionTracking()):console.warn("[TrackingPixelSDK] Session tracking not initialized.")}toggleSessionDebugMode(){if(this.sessionTrackingManager){const t=this.sessionTrackingManager.getSessionStats(),e=!(null==t?void 0:t.debugMode);this.sessionTrackingManager.updateConfig({debugMode:e}),console.log("[TrackingPixelSDK] Session debug mode "+(e?"enabled":"disabled"))}else console.warn("[TrackingPixelSDK] Session tracking not initialized.")}setMetadata(t,e){const n=this.eventQueue.findIndex((e=>e.type===t));-1!==n?this.eventQueue[n].metadata=e:console.warn(`Evento '${t}' no encontrado en la cola.`)}flush(){return i(this,void 0,void 0,(function*(){if(0===this.eventQueue.length)return;const t=[...this.eventQueue];this.eventQueue=[],yield Promise.all(t.map((t=>this.trySendEventWithRetry(t,this.maxRetries))))}))}stopAutoFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null)}track(t){return i(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{const{event:i}=t,o=s(t,["event"]);if("string"!=typeof i)return console.error("El evento debe tener un tipo."),void n(new Error("El evento debe tener un tipo."));try{this.captureEvent("tracking:tracking-event",{trackingEventId:(0,y.v4)(),metadata:Object.assign({},o),eventType:i}),e()}catch(t){console.error("Error al capturar el evento:",t),n(t)}}))}))}captureEvent(t,e){const n={type:t,data:e,timestamp:Date.now()},i=this.eventPipeline.process(n);this.eventQueue.push(i)}trySendEventWithRetry(t,e){return i(this,void 0,void 0,(function*(){var n;try{if(!(null===(n=this.webSocket)||void 0===n?void 0:n.isConnected()))throw new Error("WebSocket no conectado");{const e=yield this.webSocket.sendMessage(t);if("visitor:send-message"===t.type&&e&&e.noReceiversError)return void(this.chatUI&&this.chatUI.addSystemMessage(e.message||"En este momento no hay comerciales disponibles. Tu mensaje no será guardado."))}}catch(n){console.error("❌ Error al enviar evento:",n),e>0?(console.warn(`Retrying (${this.maxRetries-e+1})...`),setTimeout((()=>{this.trySendEventWithRetry(t,e-1)}),1e3)):console.error("❌ No se pudo enviar el evento después de varios intentos:",t)}}))}startAutoFlush(){this.flushTimer&&clearInterval(this.flushTimer),this.flushTimer=setInterval((()=>{this.flush()}),this.flushInterval)}dispatchMessage(t){const e=this.listeners.get(t.type);if("receive-message"===t.type)try{const e=T.UnreadMessagesService.getInstance();if(e.isChatActive())console.log("TrackingPixelSDK: Chat activo, no se incrementa contador");else{if(console.log("TrackingPixelSDK: Incrementando contador de mensajes no leídos"),e.incrementUnreadCount(),"undefined"!=typeof window&&"Notification"in window){const e=t.data&&"string"==typeof t.data.message&&t.data.message?t.data.message:"Tienes un nuevo mensaje en el chat";"granted"===Notification.permission?new Notification("Nuevo mensaje",{body:e,icon:"/favicon.ico"}):"denied"!==Notification.permission&&Notification.requestPermission().then((t=>{"granted"===t&&new Notification("Nuevo mensaje",{body:e,icon:"/favicon.ico"})}))}try{const t=document.getElementById("chat-unread-badge");t&&(t.style.animation="none",setTimeout((()=>{t.style.animation="pulse 0.5s 2"}),10))}catch(t){console.error("Error al animar badge:",t)}}}catch(t){console.error("Error al incrementar contador de mensajes no leídos:",t)}e&&0!==e.size&&e.forEach((e=>{try{e(t)}catch(t){console.error("Error al ejecutar listener:",t)}}))}cleanup(){this.sessionTrackingManager&&(this.sessionTrackingManager.cleanup(),this.sessionTrackingManager=null),this.stopAutoFlush(),this.eventQueue=[],this.listeners.clear(),this.webSocket&&this.webSocket.disconnect(),console.log("[TrackingPixelSDK] Cleanup completed")}}},2662:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodePacket=void 0;const i=n(2046),s=n(2745),o="function"==typeof ArrayBuffer;e.decodePacket=(t,e)=>{if("string"!=typeof t)return{type:"message",data:r(t,e)};const n=t.charAt(0);return"b"===n?{type:"message",data:a(t.substring(1),e)}:i.PACKET_TYPES_REVERSE[n]?t.length>1?{type:i.PACKET_TYPES_REVERSE[n],data:t.substring(1)}:{type:i.PACKET_TYPES_REVERSE[n]}:i.ERROR_PACKET};const a=(t,e)=>{if(o){const n=(0,s.decode)(t);return r(n,e)}return{base64:!0,data:t}},r=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer},2686:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encodePacket=void 0,e.encodePacketToBinary=function(t,e){return s&&t.data instanceof Blob?t.data.arrayBuffer().then(l).then(e):o&&(t.data instanceof ArrayBuffer||a(t.data))?e(l(t.data)):void r(t,!1,(t=>{d||(d=new TextEncoder),e(d.encode(t))}))};const i=n(2046),s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),o="function"==typeof ArrayBuffer,a=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,r=({type:t,data:e},n,r)=>s&&e instanceof Blob?n?r(e):c(e,r):o&&(e instanceof ArrayBuffer||a(e))?n?r(e):c(new Blob([e]),r):r(i.PACKET_TYPES[t]+(e||""));e.encodePacket=r;const c=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+(t||""))},n.readAsDataURL(t)};function l(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let d},2745:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.encode=void 0;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)i[n.charCodeAt(t)]=t;e.encode=t=>{let e,i=new Uint8Array(t),s=i.length,o="";for(e=0;e<s;e+=3)o+=n[i[e]>>2],o+=n[(3&i[e])<<4|i[e+1]>>4],o+=n[(15&i[e+1])<<2|i[e+2]>>6],o+=n[63&i[e+2]];return s%3==2?o=o.substring(0,o.length-1)+"=":s%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=t=>{let e,n,s,o,a,r=.75*t.length,c=t.length,l=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);const d=new ArrayBuffer(r),h=new Uint8Array(d);for(e=0;e<c;e+=4)n=i[t.charCodeAt(e)],s=i[t.charCodeAt(e+1)],o=i[t.charCodeAt(e+2)],a=i[t.charCodeAt(e+3)],h[l++]=n<<2|s>>4,h[l++]=(15&s)<<4|o>>2,h[l++]=(3&o)<<6|63&a;return d}},2782:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BotDetector=void 0,e.BotDetector=class{constructor(){this.score=0,this.checks=[]}detect(){return n(this,void 0,void 0,(function*(){this.checkUserAgent(),this.checkBrowserFeatures(),this.checkTiming(),yield this.checkBehavior();const t=this.score/this.checks.length;return{isBot:t>.6,probability:t,details:this.checks}}))}checkUserAgent(){const t=/bot|crawler|spider|scraper/i.test(navigator.userAgent);this.addCheck("userAgent",t,t?1:0)}checkBrowserFeatures(){const t=navigator.webdriver||!navigator.plugins.length||!window.MouseEvent;this.addCheck("browserFeatures",t,t?1:0)}checkTiming(){const t=performance.timing.loadEventEnd-performance.timing.navigationStart<100;this.addCheck("timing",t,t?.8:0)}checkBehavior(){return new Promise((t=>{let e=!1;["click","mousemove","keypress"].forEach((t=>{document.addEventListener(t,(()=>{e=!0}),{once:!0})})),setTimeout((()=>{this.addCheck("behavior",!e,e?0:1),t()}),1e3)}))}addCheck(t,e,n){this.checks.push({name:t,result:e}),this.score+=n}}},2895:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EnhancedDomTrackingManager=void 0;const i=n(6808),s=n(1034),o=n(7690);class a extends i.DomTrackingManager{constructor(t,e=new i.DefaultTrackDataExtractor,n={}){super(t,e),this.heuristicEnabled=!0,this.registeredListeners=new Map,this.heuristicDetector=new s.HeuristicElementDetector(n),this.urlDetector=new o.URLPageDetector}enableAutomaticTracking(){this.heuristicEnabled?(console.log("[EnhancedDomTrackingManager] 🚀 Enabling automatic heuristic tracking"),this.handlePageViewTracking(),this.setupHeuristicEventListeners(),this.observeDOMChanges()):console.log("[EnhancedDomTrackingManager] Heuristic detection is disabled")}handlePageViewTracking(){const t=()=>{const t=this.urlDetector.detectCurrentPage();console.log("[EnhancedDomTrackingManager] 📄 Page detected:",t.pageType,"confidence:",t.confidence);const e=Object.assign({event:"page_view",page_type:t.pageType,page_confidence:t.confidence,page_url:t.url,page_path:t.path},t.metadata);this.trackCallback(e)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}setupHeuristicEventListeners(){Object.keys(this.getDomEventMap()).forEach((t=>{"page_view"!==t&&this.setupEventTypeListeners(t)}))}setupEventTypeListeners(t){const e=this.getDomEventMap()[t];if(!e)return;const n=this.heuristicDetector.detectElements(t);console.log(`[EnhancedDomTrackingManager] 🎯 Found ${n.length} elements for "${t}"`),n.forEach((n=>{this.attachEventListener(n.element,t,e,n)}))}attachEventListener(t,e,n,i){this.registeredListeners.has(t)||this.registeredListeners.set(t,new Map);const s=this.registeredListeners.get(t),o=`${e}_${n}`;if(s.has(o))return;const a=()=>{console.log(`[EnhancedDomTrackingManager] 📊 Tracking "${e}" (confidence: ${i.confidence.toFixed(2)})`);const n=this.createHeuristicEventData(t,e,i);this.trackCallback(n)};t.addEventListener(n,a),s.set(o,a)}createHeuristicEventData(t,e,n){var i;return Object.assign({event:e,detection_method:"heuristic",confidence:n.confidence,matched_selector:n.matchedRule.selector,element_text:(null===(i=t.textContent)||void 0===i?void 0:i.trim())||"",element_tag:t.tagName.toLowerCase(),element_class:t.className||"",element_id:t.id||"",timestamp:Date.now()},this.urlDetector.extractPageMetadata())}addVisualIndicator(t,e,n){const i=document.createElement("div");i.innerHTML=`🎯 ${e} (${Math.round(100*n)}%)`,i.style.cssText="\n            position: absolute;\n            background: rgba(30, 58, 138, 0.9);\n            color: white;\n            padding: 2px 6px;\n            font-size: 10px;\n            border-radius: 3px;\n            z-index: 10000;\n            pointer-events: none;\n            font-family: monospace;\n        ";const s=t.getBoundingClientRect();i.style.top=s.top+window.scrollY-20+"px",i.style.left=s.left+window.scrollX+"px",document.body.appendChild(i),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i)}),3e3)}observeDOMChanges(){new MutationObserver((t=>{let e=!1;t.forEach((t=>{"childList"===t.type&&t.addedNodes.length>0&&t.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&(e=!0)}))})),e&&setTimeout((()=>this.rescanForNewElements()),500)})).observe(document.body,{childList:!0,subtree:!0})}rescanForNewElements(){console.log("[EnhancedDomTrackingManager] 🔄 Rescanning for new elements"),Object.keys(this.getDomEventMap()).forEach((t=>{"page_view"!==t&&this.setupEventTypeListeners(t)}))}setHeuristicEnabled(t){this.heuristicEnabled=t,console.log("[EnhancedDomTrackingManager] Heuristic detection "+(t?"enabled":"disabled"))}getHeuristicConfig(){return this.heuristicDetector.getConfig()}updateHeuristicConfig(t){this.heuristicDetector.updateConfig(t)}getURLDetector(){return this.urlDetector}getHeuristicDetector(){return this.heuristicDetector}getDomEventMap(){return this.domEventMap}enableDOMTracking(){console.warn("[EnhancedDomTrackingManager] enableDOMTracking() is deprecated. Use enableAutomaticTracking() instead."),this.enableAutomaticTracking()}}e.EnhancedDomTrackingManager=a},2919:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatInputUI=e.ChatUI=void 0;const s=n(4349),o=n(1122),a=n(9167),r=n(3104);e.ChatUI=class{constructor(t={}){if(this.container=null,this.containerMessages=null,this.currentIndex=null,this.chatId=null,this.chatDetail=null,this.lastKnownChatStatus=null,this.lastNotificationType=null,this.messagesLoaded=!1,this.openCallbacks=[],this.closeCallbacks=[],this.activeIntervals=[],this.titleElement=null,this.subtitleElement=null,this.typingIndicator=null,this.lastMessageDate=null,this.options=Object.assign({widget:!1,widgetWidth:"300px",widgetHeight:"400px",userBgColor:"#007bff",otherBgColor:"#6c757d",textColor:"#fff",maxWidthMessage:"80%"},t),this.options.containerId){const t=document.getElementById(this.options.containerId);if(!t)throw new Error(`No se encontró el contenedor con ID "${this.options.containerId}"`);this.container=t}}init(){if(!this.container||this.options.widget){const t=document.createElement("div");t.classList.add("chat-widget-host"),document.body.appendChild(t);const e=t.attachShadow({mode:"open"});this.container=document.createElement("div"),this.container.classList.add("chat-widget"),this.options.widget&&this.container.classList.add("chat-widget-fixed"),this.container.style.display="none",this.container.style.opacity="0",this.container.style.transform="translateY(20px)",this.container.setAttribute("data-initial-state","hidden"),console.log("Chat inicializado con estado: oculto"),e.appendChild(this.container);const n=document.createElement("div");n.className="chat-header";const i=document.createElement("div");i.className="chat-header-title",i.textContent="Chat",this.titleElement=i;const s=document.createElement("div");s.className="chat-header-subtitle",s.textContent="Atención personalizada",this.subtitleElement=s,i.appendChild(s),n.appendChild(i);const o=document.createElement("div");o.className="chat-header-actions";const a=document.createElement("button");a.className="chat-close-btn",a.setAttribute("aria-label","Cerrar chat"),a.addEventListener("click",(()=>{this.hide()})),o.appendChild(a),n.appendChild(o),this.container.appendChild(n);const r=document.createElement("style");r.textContent="\n\t\t\t\t@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');\n\t\t\t\t:host { all: initial; font-family: 'Inter', sans-serif; }\n\t\t\t\t\n\t\t\t\t/* Contenedor principal del chat */\n\t\t\t\t.chat-widget { \n\t\t\t\t\tbox-shadow: 0 5px 40px rgba(0,0,0,0.16); \n\t\t\t\t\tborder-radius: 16px; \n\t\t\t\t\toverflow: hidden; \n\t\t\t\t\tbackground: #fff;\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed { \n\t\t\t\t\twidth: 340px; \n\t\t\t\t\theight: 520px; \n\t\t\t\t\tposition: fixed; \n\t\t\t\t\tbottom: 90px; \n\t\t\t\t\tright: 20px; \n\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); \n\t\t\t\t\tz-index: 2147483647; \n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Cabecera del chat */\n\t\t\t\t.chat-header {\n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tpadding: 16px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\tborder-top-left-radius: 16px;\n\t\t\t\t\tborder-top-right-radius: 16px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-title {\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\talign-items: flex-start;\n\t\t\t\t\tgap: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Indicador de estado online del comercial */\n\t\t\t\t.chat-online-indicator {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tgap: 6px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\ttransition: background-color 0.3s ease;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot.online {\n\t\t\t\t\tbackground-color: #00d26a;\n\t\t\t\t\tbox-shadow: 0 0 0 2px rgba(0, 210, 106, 0.3);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot.offline {\n\t\t\t\t\tbackground-color: #8a9aa9;\n\t\t\t\t\tbox-shadow: 0 0 0 2px rgba(138, 154, 169, 0.3);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-subtitle {\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tfont-weight: 400;\n\t\t\t\t\topacity: 0.9;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-actions {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 10px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn {\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t\ttransition: opacity 0.2s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn:hover {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 16px;\n\t\t\t\t\theight: 16px;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de mensajes */\n\t\t\t\t.chat-messages { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\tflex-direction: column; \n\t\t\t\t\tflex: 1; \n\t\t\t\t\toverflow-y: auto; \n\t\t\t\t\tpadding: 16px; \n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tscroll-behavior: smooth;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-messages-bottom { \n\t\t\t\t\tmargin-top: auto; \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Estilos de los mensajes */\n\t\t\t\t.chat-message-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message { \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tborder-radius: 18px; \n\t\t\t\t\twhite-space: pre-wrap; \n\t\t\t\t\tword-break: break-word;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tbox-shadow: 0 1px 2px rgba(0,0,0,0.1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-time {\n\t\t\t\t\tfont-size: 11px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\tmargin-top: 4px;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\talign-self: flex-end;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user { \n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: #fff; \n\t\t\t\t\tborder-bottom-right-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user + .chat-message-time {\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar img {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other { \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-bottom-left-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de input */\n\t\t\t\t.chat-input-container { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\talign-items: center; \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tposition: relative;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field { \n\t\t\t\t\tflex-shrink: 1;\n\t\t\t\t\tpadding: 10px 14px; \n\t\t\t\t\tborder: 1px solid #e1e9f1; \n\t\t\t\t\tborder-radius: 24px; \n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\toutline: none;\n\t\t\t\t\ttransition: border-color 0.2s;\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field:focus {\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 36px;\n\t\t\t\t\theight: 36px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tmargin-left: 8px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\ttransition: transform 0.2s;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\toverflow: visible;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn:hover {\n\t\t\t\t\ttransform: scale(1.05);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t width: 24px;\n\t\t\t\t height: 24px;\n\t\t\t\t background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-send-icon lucide-send'%3E%3Cpath d='M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z'/%3E%3Cpath d='m21.854 2.147-10.94 10.939'/%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Animaciones de entrada */\n\t\t\t\t@keyframes slideInUp {\n\t\t\t\t\tfrom { transform: translateY(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateY(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed {\n\t\t\t\t\tanimation: slideInUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de escritura */\n\t\t\t\t.chat-typing-indicator {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 100px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tmargin-right: 8px;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-bubble {\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder-radius: 18px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tbackground-color: #adb5bd;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tmargin: 0 2px;\n\t\t\t\t\tanimation: typingAnimation 1.2s infinite ease-in-out;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot:nth-child(1) { animation-delay: 0s; }\n\t\t\t\t.chat-typing-dot:nth-child(2) { animation-delay: 0.2s; }\n\t\t\t\tchat-typing-dot:nth-child(3) { animation-delay: 0.4s; }\n\t\t\t\t\n\t\t\t\t@keyframes typingAnimation {\n\t\t\t\t\t0%, 60%, 100% { transform: translateY(0); }\n\t\t\t\t\t30% { transform: translateY(-4px); }\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Animaciones para los mensajes */\n\t\t\t\t@keyframes fadeInRight {\n\t\t\t\t\tfrom { transform: translateX(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t@keyframes fadeInLeft {\n\t\t\t\t\tfrom { transform: translateX(-20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\tanimation: fadeInRight 0.3s ease forwards;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\tanimation: fadeInLeft 0.3s ease forwards;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Footer del chat */\n\t\t\t\t.chat-footer {\n\t\t\t\t\tpadding: 8px 16px;\n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text {\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text strong {\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Botones adicionales para el input */\n\t\t\t\t.chat-input-actions {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-right: 10px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 30px;\n\t\t\t\t\theight: 30px;\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\topacity: 0.6;\n\t\t\t\t\ttransition: opacity 0.2s;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn:hover {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t display: block;\n\t\t\t\t width: 18px;\n\t\t\t\t height: 18px;\n\t\t\t\t background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48'/%3E%3C/svg%3E\");\n\t\t\t\t background-repeat: no-repeat;\n\t\t\t\t background-position: center;\n\t\t\t\t}\n\n\t\t\t\t/* Estilos para mensajes del sistema */\n\t\t\t\t.chat-system-message-wrapper {\n\t\t\t\t\talign-self: center; /* Centrar el mensaje del sistema */\n\t\t\t\t\tmax-width: 90%; /* Un poco más ancho para mensajes informativos */\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 8px;\n\t\t\t\t}\n\n\t\t\t\t.chat-system-message {\n\t\t\t\t\tbackground: #e9ecef; /* Un fondo neutro */\n\t\t\t\t\tcolor: #495057; /* Texto oscuro para legibilidad */\n\t\t\t\t\tborder-radius: 8px; /* Bordes más suaves */\n\t\t\t\t\tfont-size: 13px; /* Ligeramente más pequeño */\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tfont-style: italic;\n\t\t\t\t\tpadding: 8px 12px; /* Añadido padding para que no se vea apretado */\n\t\t\t\t}\n\t\t\t\t/* Fin de estilos para mensajes del sistema */\n\t\t\t\t\n\t\t\t\t/* Contenedor de mensajes */\n\t\t\t\t.chat-messages { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\tflex-direction: column; \n\t\t\t\t\tflex: 1; \n\t\t\t\t\toverflow-y: auto; \n\t\t\t\t\tpadding: 16px; \n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tscroll-behavior: smooth;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-messages-bottom { \n\t\t\t\t\tmargin-top: auto; \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Estilos de los mensajes */\n\t\t\t\t.chat-message-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message { \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tborder-radius: 18px; \n\t\t\t\t\twhite-space: pre-wrap; \n\t\t\t\t\tword-break: break-word;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tbox-shadow: 0 1px 2px rgba(0,0,0,0.1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-time {\n\t\t\t\t\tfont-size: 11px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\tmargin-top: 4px;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\talign-self: flex-end;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user { \n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: #fff; \n\t\t\t\t\tborder-bottom-right-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user + .chat-message-time {\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar img {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other { \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-bottom-left-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de input */\n\t\t\t\t.chat-input-container { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\talign-items: center; \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tposition: relative;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field { \n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: calc(100% - 120px); /* Ajustar el ancho para el botón de enviar */\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder: 1px solid #e1e9f1; \n\t\t\t\t\tborder-radius: 24px; \n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\toutline: none;\n\t\t\t\t\ttransition: border-color 0.2s;\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field:focus {\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tmargin-left: 8px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\ttransition: transform 0.2s;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\toverflow: visible;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn:hover {\n\t\t\t\t\ttransform: scale(1.05);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-send-icon lucide-send'%3E%3Cpath d='M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z'/%3E%3Cpath d='m21.854 2.147-10.94 10.939'/%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Animaciones de entrada */\n\t\t\t\t@keyframes slideInUp {\n\t\t\t\t\tfrom { transform: translateY(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateY(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed {\n\t\t\t\t\tanimation: slideInUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de escritura */\n\t\t\t\t.chat-typing-indicator {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 100px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tmargin-right: 8px;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-bubble {\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder-radius: 18px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tbackground-color: #adb5bd;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tmargin: 0 2px;\n\t\t\t\t\tanimation: typingAnimation 1.2s infinite ease-in-out;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot:nth-child(1) { animation-delay: 0s; }\n\t\t\t\t.chat-typing-dot:nth-child(2) { animation-delay: 0.2s; }\n\t\t\t\tchat-typing-dot:nth-child(3) { animation-delay: 0.4s; }\n\t\t\t\t\n\t\t\t\t@keyframes typingAnimation {\n\t\t\t\t\t0%, 60%, 100% { transform: translateY(0); }\n\t\t\t\t\t30% { transform: translateY(-4px); }\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Animaciones para los mensajes */\n\t\t\t\t@keyframes fadeInRight {\n\t\t\t\t\tfrom { transform: translateX(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t@keyframes fadeInLeft {\n\t\t\t\t\tfrom { transform: translateX(-20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\tanimation: fadeInRight 0.3s ease forwards;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\tanimation: fadeInLeft 0.3s ease forwards;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Footer del chat */\n\t\t\t\t.chat-footer {\n\t\t\t\t\tpadding: 8px 16px;\n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text {\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text strong {\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Botones adicionales para el input */\n\t\t\t\t.chat-input-actions {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn {\n\t\t\t\t\twidth: 30px;\n\t\t\t\t\theight: 30px;\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\topacity: 0.6;\n\t\t\t\t\ttransition: opacity 0.2s;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn:hover {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 18px;\n\t\t\t\t\theight: 18px;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48'/%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de satisfacción */\n\t\t\t\t.chat-satisfaction {\n\t\t\t\t\tmargin-top: 16px;\n\t\t\t\t\tpadding: 12px 16px;\n\t\t\t\t\tbackground-color: #fff;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tgap: 10px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,0,0,0.05);\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-question {\n\t\t\t\t\tcolor: #5a6877;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-options {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-option {\n\t\t\t\t\tpadding: 6px 12px;\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-radius: 16px;\n\t\t\t\t\tcolor: #5a6877;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\ttransition: all 0.2s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-option:hover {\n\t\t\t\t\tbackground-color: #e7f3ff;\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t\tcolor: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Separador de fecha para mensajes */\n\t\t\t\t.chat-date-separator {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tmargin: 16px 0;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-date-separator::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\theight: 1px;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-date-text {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tz-index: 2;\n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tpadding: 0 10px;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t",e.appendChild(r)}else this.container&&!this.options.widget||(this.container=document.createElement("div"),this.container.classList.add("chat-widget"),document.body.appendChild(this.container),this.options.widget&&this.container.classList.add("chat-widget-fixed"));const t=document.createElement("div");t.className="chat-messages",this.container.appendChild(t),this.containerMessages=t;const e=document.createElement("div");e.className="chat-messages-bottom",this.containerMessages.appendChild(e);const n=document.createElement("div");n.className="chat-footer";const i=document.createElement("div");i.className="chat-footer-text",i.innerHTML="Equipo de atención al cliente de <strong>Guiders</strong>",n.appendChild(i),this.container.appendChild(n),this.container.style.display="none",this.container.style.flexDirection="column",this.container.style.gap="0",this.container.setAttribute("data-content-ready","true"),this.containerMessages.addEventListener("scroll",(()=>{this.containerMessages&&0===this.containerMessages.scrollTop&&this.currentIndex&&this.loadOlderMessages()})),this.initializeChatContent()}addWelcomeMessage(){if(!this.containerMessages||!Array.from(this.containerMessages.children).some((t=>t.classList&&(t.classList.contains("chat-message-user-wrapper")||t.classList.contains("chat-message-other-wrapper"))))){const t="👋 ¡Hola! Soy una persona real de nuestro equipo y estoy aquí para ayudarte. Cuéntame, ¿qué necesitas? No dudes en escribir cualquier pregunta o problema que tengas 😊";this.addMessage(t,"other")}}setChatId(t){if(!this.container)throw new Error("No se ha inicializado el chat");this.chatId!==t&&(this.messagesLoaded=!1,this.lastKnownChatStatus=null,this.lastNotificationType=null),this.chatId=t,this.container.setAttribute("data-chat-id",t)}getChatId(){if(!this.container)throw new Error("No se ha inicializado el chat");return this.chatId}renderChatMessage(t){const{text:e,sender:n,timestamp:i,senderId:s}=t;this.addMessage(e,n,i,s),this.rebuildDateSeparators()}loadInitialMessages(){return i(this,arguments,void 0,(function*(t=20){if(!this.containerMessages)return;if(!this.chatId)throw new Error("No se ha establecido un chatId");const e=this.chatId,n=(0,o.fetchMessages)(e,null,t);let i="";try{const t=localStorage.getItem("accessToken")||"";if(t){const e=JSON.parse(atob(t.split(".")[1]));i=e.sub}}catch(t){console.warn("Error al procesar el token de acceso:",t)}try{const t=yield n;if(this.currentIndex=t.cursor||null,t.messages&&t.messages.length>0){[...t.messages].reverse().map((t=>{const e=i&&t.senderId.includes(i)?"user":"other";return{text:t.content,sender:e,timestamp:t.createdAt,senderId:t.senderId}})).forEach((t=>this.renderChatMessage(t))),this.rebuildDateSeparators(),this.containerMessages.scrollTop=this.containerMessages.scrollHeight}}catch(t){console.error("Error cargando mensajes iniciales:",t)}}))}scrollToBottom(t){this.containerMessages&&(this.containerMessages.scrollTop=t?this.containerMessages.scrollHeight:0)}loadOlderMessages(){return i(this,void 0,void 0,(function*(){if(!this.containerMessages||!this.currentIndex)return;const t=this.containerMessages.scrollHeight,e=this.containerMessages.scrollTop;try{const n=this.getChatId();if(!n)throw new Error("No se ha establecido un chatId");const i=yield(0,o.fetchMessages)(n,this.currentIndex,20);this.currentIndex=i.cursor||null;let s="";try{const t=localStorage.getItem("accessToken")||"";t&&(s=JSON.parse(atob(t.split(".")[1])).sub)}catch(t){console.warn("Error al procesar el token de acceso para mensajes antiguos:",t)}for(const t of i.messages){const e=s&&t.senderId.includes(s)?"user":"other";this.prependMessage(t.content,e,t.createdAt,t.senderId)}this.rebuildDateSeparators();const a=this.containerMessages.scrollHeight;this.containerMessages.scrollTop=e+(a-t)}catch(t){console.error("Error cargando mensajes antiguos:",t)}}))}addMessage(t,e,n,i){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");const s=n?new Date(n):new Date;this.addDateSeparatorIfNeeded(s);const o=this.createMessageDiv(t,e,n,i);this.containerMessages.appendChild(o),this.scrollToBottom(!0)}sendOfflineNotificationMessage(t,e=!1){let n;n=e?`${t} no está disponible en este momento. Te responderá tan pronto como esté online.`:`${t} se ha desconectado temporalmente. Te responderá tan pronto como esté disponible nuevamente.`,console.log("Enviando mensaje automático de desconexión:",n),this.addSystemMessage(n)}sendOnlineNotificationMessage(t){const e=`${t} se ha reconectado y está disponible para responder tus preguntas.`;console.log("Enviando mensaje automático de reconexión:",e),this.addSystemMessage(e)}addSystemMessage(t){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");this.addDateSeparatorIfNeeded(new Date);const e=document.createElement("div");e.classList.add("chat-message-wrapper","chat-system-message-wrapper");const n=document.createElement("div");n.classList.add("chat-message","chat-system-message"),n.textContent=t,e.appendChild(n),this.containerMessages.appendChild(e),this.scrollToBottom(!0)}prependMessage(t,e,n,i){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");const s=this.createMessageDiv(t,e,n,i);this.containerMessages.firstChild?this.containerMessages.insertBefore(s,this.containerMessages.firstChild):this.containerMessages.appendChild(s)}createMessageDiv(t,e,n,i){const s=document.createElement("div");if(s.classList.add("chat-message-wrapper"),n&&s.setAttribute("data-timestamp",n.toString()),"user"===e){s.classList.add("chat-message-user-wrapper");const e=document.createElement("div");e.classList.add("chat-message","chat-message-user"),e.textContent=t,s.appendChild(e);const i=document.createElement("div");i.classList.add("chat-message-time"),i.textContent=this.formatTime(n?new Date(n):new Date),s.appendChild(i)}else{s.classList.add("chat-message-other-wrapper");const e=document.createElement("div");e.classList.add("chat-avatar");const o=this.getParticipantInitials(i||"");e.textContent=o,e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.color="#0062cc",e.style.fontWeight="600",e.style.fontSize="10px",s.appendChild(e);const a=document.createElement("div"),r=document.createElement("div");r.classList.add("chat-message-name");const c=this.getParticipantName(i||"");r.textContent=c,r.style.fontSize="11px",r.style.color="#5a6877",r.style.marginBottom="3px",r.style.fontWeight="500",a.appendChild(r);const l=document.createElement("div");l.classList.add("chat-message","chat-message-other"),l.textContent=t,a.appendChild(l);const d=document.createElement("div");d.classList.add("chat-message-time"),d.textContent=this.formatTime(n?new Date(n):new Date),a.appendChild(d),s.appendChild(a)}return s}formatTime(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}hide(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"!==this.container.style.display&&(this.container.style.transform="translateY(20px)",this.container.style.opacity="0",setTimeout((()=>{this.container.style.display="none",this.activeIntervals.forEach((t=>{null!==t.id&&(clearInterval(t.id),t.id=null)})),this.closeCallbacks.forEach((t=>t()))}),300))}show(){if(!this.container)throw new Error("No se ha inicializado el chat");this.container.style.display="flex",this.container.offsetHeight,this.container.style.opacity="1",this.container.style.transform="translateY(0)",this.loadChatContent(),this.refreshChatDetails(),this.scrollToBottom(!0),this.activeIntervals.forEach((t=>{null===t.id&&(t.id=window.setInterval(t.callback,t.intervalMs))})),this.openCallbacks.forEach((t=>t()))}toggle(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"===this.container.style.display?this.show():this.hide()}getOptions(){return this.options}isVisible(){return!!this.container&&"none"!==this.container.style.display}onOpen(t){this.openCallbacks.push(t)}onClose(t){this.closeCallbacks.push(t)}onActiveInterval(t,e=5e3){this.activeIntervals.push({id:null,callback:t,intervalMs:e})}updateParticipant(t,e){if(!this.chatDetail)return;const n=this.chatDetail.participants.find((e=>e.id===t));n&&(Object.assign(n,e),this.updateChatHeader(),console.log(`Participante ${t} actualizado:`,e))}getChatDetail(){return this.chatDetail}refreshChatDetails(){return i(this,void 0,void 0,(function*(){yield this.loadChatDetails()}))}showTypingIndicator(t){if(!this.containerMessages)return;if(this.typingIndicator)return;const e=document.createElement("div");e.className="chat-typing-indicator";const n=document.createElement("div");n.className="chat-typing-avatar";const i=this.getParticipantInitials(t||"");n.textContent=i,n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.color="#0062cc",n.style.fontWeight="600",n.style.fontSize="10px",e.appendChild(n);const s=document.createElement("div");s.className="chat-typing-bubble";for(let t=0;t<3;t++){const t=document.createElement("div");t.className="chat-typing-dot",s.appendChild(t)}e.appendChild(s),this.containerMessages.appendChild(e),this.typingIndicator=e,this.scrollToBottom(!0)}hideTypingIndicator(){this.typingIndicator&&this.typingIndicator.parentNode&&(this.typingIndicator.parentNode.removeChild(this.typingIndicator),this.typingIndicator=null)}updateTypingIndicator(t){if(!this.typingIndicator)return;const e=this.typingIndicator.querySelector(".chat-typing-avatar");if(e){const n=this.getParticipantInitials(t);e.textContent=n}}showSatisfactionIndicator(){if(!this.containerMessages)return;const t=document.createElement("div");t.className="chat-satisfaction";const e=document.createElement("div");e.className="chat-satisfaction-question",e.textContent="¿Te ha sido útil la ayuda de nuestro asesor humano?",t.appendChild(e);const n=document.createElement("div");n.className="chat-satisfaction-options";const i=document.createElement("div");i.className="chat-satisfaction-option",i.textContent="Sí, gracias",i.addEventListener("click",(()=>{t.innerHTML='<div class="chat-satisfaction-question">¡Gracias por tu feedback! Nos alegra haber podido ayudarte.</div>',setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),2e3)}));const s=document.createElement("div");s.className="chat-satisfaction-option",s.textContent="No",s.addEventListener("click",(()=>{t.innerHTML='<div class="chat-satisfaction-question">Lamentamos no haber podido resolver tu consulta. Transmitiremos tu feedback al equipo.</div>',setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),2e3)})),n.appendChild(i),n.appendChild(s),t.appendChild(n),this.containerMessages.appendChild(t),this.scrollToBottom(!0)}initializeChatContent(){return i(this,void 0,void 0,(function*(){var t;try{console.log("Inicializando contenido del chat...");const e=yield(0,s.startChat)();console.log("Chat iniciado:",e),this.setChatId(e.id),yield this.loadChatDetails(),this.registerWebSocketListeners(),null===(t=this.container)||void 0===t||t.setAttribute("data-chat-initialized","true"),this.isVisible()&&this.loadChatContent()}catch(t){console.error("Error iniciando chat:",t)}}))}loadChatDetails(){return i(this,void 0,void 0,(function*(){if(this.chatId)try{console.log("Cargando detalles del chat..."),this.chatDetail=yield(0,a.fetchChatDetail)(this.chatId),console.log("Detalles del chat:",this.chatDetail),this.lastKnownChatStatus=this.chatDetail.status,console.log(`Estado actual del chat: ${this.lastKnownChatStatus}`),this.updateChatHeader()}catch(t){console.warn("Error al cargar detalles del chat:",t)}}))}checkInitialCommercialStatus(){this.chatDetail&&this.chatDetail.participants.filter((t=>t.isCommercial)).forEach((t=>{t.isOnline||"offline"===this.lastNotificationType||(console.log(`Comercial ${t.name} está offline en la carga inicial`),setTimeout((()=>{this.sendOfflineNotificationMessage(t.name,!0),this.lastNotificationType="offline"}),100))}))}updateChatHeader(){if(!this.chatDetail||!this.titleElement||!this.subtitleElement)return;const t=this.chatDetail.participants.filter((t=>t.isCommercial)),e=this.chatDetail.participants.filter((t=>t.isVisitor));if("pending"===this.chatDetail.status&&t.length>1)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con asesor (${t.length} disponibles)...`;else if("pending"===this.chatDetail.status&&1===t.length)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con ${t[0].name}...`;else if(t.length>0){const e=t[0];if("active"===this.chatDetail.status){const t=document.createElement("div");t.className="chat-online-indicator";const n=document.createElement("span");n.className="chat-status-dot "+(e.isOnline?"online":"offline");const i=document.createElement("span");i.textContent=`Chat con ${e.name}`,t.appendChild(n),t.appendChild(i),this.titleElement.innerHTML="",this.titleElement.appendChild(t);const s=e.isOnline?"En línea":"Desconectado",o=e.isTyping?" • Escribiendo...":"";this.subtitleElement.textContent=`${s}${o}`}else{this.titleElement.textContent=`Chat con ${e.name}`;const t="inactive"===this.chatDetail.status?"Inactivo":"closed"===this.chatDetail.status?"Cerrado":"archived"===this.chatDetail.status?"Archivado":"Conectando...";this.subtitleElement.textContent=t}}else this.titleElement.textContent="Chat",this.subtitleElement.textContent="Buscando asesor disponible...";console.log(`Chat ${this.chatDetail.id} - Participantes:`,{comerciales:t.length,visitantes:e.length,total:this.chatDetail.participants.length,estado:this.chatDetail.status,comercialOnline:t.length>0?t[0].isOnline:null})}loadChatContent(){return i(this,void 0,void 0,(function*(){var t;if(null===(t=this.container)||void 0===t?void 0:t.getAttribute("data-chat-initialized"))if(this.messagesLoaded)console.log("Los mensajes ya fueron cargados previamente, omitiendo fetch...");else{console.log("Cargando contenido del chat...");try{yield this.loadInitialMessages(20),this.messagesLoaded=!0,this.addWelcomeMessage(),this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}catch(t){console.error("Error al cargar el contenido del chat:",t),this.addWelcomeMessage(),this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}}else console.log("Chat no inicializado aún, esperando...")}))}forceReloadMessages(){return i(this,arguments,void 0,(function*(t=20){this.messagesLoaded=!1,this.isVisible()&&(yield this.loadChatContent())}))}registerWebSocketListeners(){const t=localStorage.getItem("pixelWebSocketEndpoint")||"wss://guiders.ancoradual.com",e=r.WebSocketClient.getInstance(t);e?(console.log("Registrando listener para evento chat:status-updated"),e.addListener("chat:status-updated",(t=>{console.log("Evento chat:status-updated recibido:",t);const e=t.data;if(this.chatId&&e.chatId===this.chatId){console.log(`Estado del chat actualizado: ${this.lastKnownChatStatus||"desconocido"} → ${e.status}`);const t="pending"===this.lastKnownChatStatus&&"active"===e.status,n=this.lastKnownChatStatus!==e.status;(t||n)&&(console.log("Cambio de estado importante detectado - Recargando detalles del chat"),this.lastKnownChatStatus=e.status,this.loadChatDetails().then((()=>{console.log("Detalles del chat actualizados después del cambio de estado"),t&&this.chatDetail&&"active"===this.chatDetail.status&&(console.log("Chat activado - verificando estado inicial de comerciales"),setTimeout((()=>{this.checkInitialCommercialStatus()}),200))})))}})),e.addListener("chat:participant-joined",(t=>{console.log("Evento chat:participant-joined recibido:",t);const e=t.data;this.chatId&&e.chatId===this.chatId&&(console.log("Nuevo participante unido al chat:",e.newParticipant),this.chatDetail?(this.chatDetail.participants.push(e.newParticipant),this.updateChatHeader(),console.log("Lista de participantes actualizada:",this.chatDetail.participants)):this.loadChatDetails())})),e.addListener("chat:participant-left",(t=>{console.log("Evento chat:participant-left recibido:",t);const e=t.data;this.chatId&&e.chatId===this.chatId&&this.chatDetail&&(console.log("Participante abandonó el chat:",e.participantId),this.chatDetail.participants=this.chatDetail.participants.filter((t=>t.id!==e.participantId)),this.updateChatHeader(),console.log("Lista de participantes actualizada:",this.chatDetail.participants))})),e.addListener("chat:participant-updated",(t=>{console.log("Evento chat:participant-updated recibido:",t);const e=t.data;if(this.chatId&&e.chatId===this.chatId&&this.chatDetail){console.log("Actualización de participante recibida:",e.participant);const t=this.chatDetail.participants.findIndex((t=>t.id===e.participant.id));-1!==t&&(this.chatDetail.participants[t]=Object.assign(Object.assign({},this.chatDetail.participants[t]),e.participant),this.updateChatHeader(),e.participant.isTyping?this.showTypingIndicator(e.participant.id):this.hideTypingIndicator(),console.log("Participante actualizado:",this.chatDetail.participants[t]))}})),e.addListener("participant:online-status-updated",(t=>{console.log("Evento participant:online-status-updated recibido:",t);const e=t.data;if(this.chatDetail){console.log(`Actualizando estado online del participante ${e.participantId}: ${e.isOnline}`);const t=this.chatDetail.participants.find((t=>t.id===e.participantId));if(t){const n=t.isOnline;t.isOnline=e.isOnline,t.isCommercial&&"active"===this.chatDetail.status&&(console.log(`Participante comercial ${t.name} está ahora ${e.isOnline?"online":"offline"}`),n&&!e.isOnline&&"offline"!==this.lastNotificationType?(this.sendOfflineNotificationMessage(t.name,!1),this.lastNotificationType="offline"):!n&&e.isOnline&&"online"!==this.lastNotificationType&&(this.sendOnlineNotificationMessage(t.name),this.lastNotificationType="online"),this.updateChatHeader())}else console.warn(`No se encontró el participante con ID ${e.participantId}`)}}))):console.error("No se pudo obtener la instancia de WebSocketClient")}addDateSeparatorIfNeeded(t){if(!this.containerMessages)return;const e=this.formatDate(t);if(!this.lastMessageDate||this.lastMessageDate!==e){const t=document.createElement("div");t.className="chat-date-separator",t.setAttribute("data-date",e);const n=document.createElement("span");n.className="chat-date-text",n.textContent=e,t.appendChild(n),this.containerMessages.appendChild(t),this.lastMessageDate=e}}formatDate(t){const e=new Date,n=new Date;n.setDate(n.getDate()-1);const i=t.toDateString()===e.toDateString(),s=t.toDateString()===n.toDateString();if(i)return"Hoy";if(s)return"Ayer";{const e={day:"numeric",month:"long",year:"numeric"};return t.toLocaleDateString("es-ES",e)}}rebuildDateSeparators(){if(!this.containerMessages)return;this.lastMessageDate=null,this.containerMessages.querySelectorAll(".chat-date-separator").forEach((t=>{var e;return null===(e=t.parentNode)||void 0===e?void 0:e.removeChild(t)}));const t=Array.from(this.containerMessages.querySelectorAll(".chat-message-wrapper"));if(0===t.length)return;let e=null;t.forEach((t=>{if(!t.querySelector(".chat-message-time"))return;const n=new Date,i=this.formatDate(n);if(i!==e){e=i;const n=document.createElement("div");n.className="chat-date-separator",n.setAttribute("data-date",i);const s=document.createElement("span");s.className="chat-date-text",s.textContent=i,n.appendChild(s),this.containerMessages&&this.containerMessages.insertBefore(n,t)}})),e&&(this.lastMessageDate=e)}getParticipantInitials(t){if(!this.chatDetail||!t)return console.warn("No se ha cargado el chat o no se proporcionó un ID de remitente válido",t),"AH";const e=this.chatDetail.participants.find((e=>e.id===t));if(!e)return console.warn(`No se encontró el participante con ID ${t}`),"AH";const n=e.name.trim().split(" ");return n.length>=2?(n[0][0]+n[1][0]).toUpperCase():1===n.length?n[0].substring(0,2).toUpperCase():"AH"}getParticipantName(t){if(!this.chatDetail||!t)return"Asesor Humano";const e=this.chatDetail.participants.find((e=>e.id===t));return e?e.name:"Asesor Humano"}},e.ChatInputUI=class{constructor(t){this.inputContainer=null,this.submitCallbacks=[],this.chat=t}init(){this.inputContainer=document.createElement("div"),this.inputContainer.style.display="flex",this.inputContainer.style.padding="5px";const t=document.createElement("input");t.type="text",t.style.flex="1",t.placeholder="Escribe un mensaje...";const e=document.createElement("button");e.textContent="Enviar",e.addEventListener("click",(()=>{const e=t.value.trim();e&&(this.submitCallbacks.forEach((t=>t(e))),this.chat.renderChatMessage({text:e,sender:"user"}),t.value="")})),t.addEventListener("keydown",(t=>{"Enter"===t.key&&e.click()})),this.inputContainer.appendChild(t),this.inputContainer.appendChild(e),document.body.appendChild(this.inputContainer)}onSubmit(t){this.submitCallbacks.push(t)}}},2969:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatToggleButtonUI=void 0;const i=n(969);e.ChatToggleButtonUI=class{constructor(t,e={}){this.badgeElement=null,this.isVisible=!1,this.toggleCallback=[],this.chatUI=t;const n=this.chatUI.getOptions().widgetWidth||"300px";parseInt(n.replace("px","")),this.options=Object.assign({label:"Chat",buttonSize:"50px",backgroundColor:"#007bff",textColor:"#ffffff",positionRight:"20px",positionBottom:"20px",borderRadius:"50%"},e),this.button=document.createElement("button"),this.button.className="chat-toggle-btn",this.isVisible=!1,this.unreadMessagesService=i.UnreadMessagesService.getInstance()}init(){this.button||(this.button=document.createElement("button"),this.button.className="chat-toggle-btn"),this.isVisible=!1,this.button.classList.remove("open");const t=document.querySelector(".chat-widget-host");if(t&&t.shadowRoot){t.shadowRoot.insertBefore(this.button,t.shadowRoot.firstChild),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),t.shadowRoot.appendChild(this.badgeElement),console.log("Inicializando badge de mensajes no leídos");const e=this.unreadMessagesService.getUnreadCount();if(console.log("Contador actual de mensajes no leídos:",e),this.updateUnreadBadge(e),!t.shadowRoot.querySelector("style[data-chat-toggle-btn]")){const e=document.createElement("style");e.setAttribute("data-chat-toggle-btn","true"),e.textContent="\n\t\t\t\t\t.chat-toggle-btn {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\tright: 20px;\n\t\t\t\t\t\tbottom: 20px;\n\t\t\t\t\t\twidth: 56px;\n\t\t\t\t\t\theight: 56px;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\t\tcolor: #fff !important;\n\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbox-shadow: 0 4px 10px rgba(0,123,255,0.3), 0 0 0 rgba(0,123,255,0);\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t\tposition: relative; /* Asegurar que el badge se posicione correctamente */\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn::before {\n\t\t\t\t\t\tcontent: '';\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\twidth: 24px;\n\t\t\t\t\t\theight: 24px;\n\t\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 3C6.5 3 2 6.58 2 11C2.05 13.15 3.06 15.17 4.75 16.5C4.75 17.1 4.33 18.67 2 21C4.37 20.89 6.64 20 8.47 18.5C9.61 18.83 10.81 19 12 19C17.5 19 22 15.42 22 11C22 6.58 17.5 3 12 3ZM12 17C7.58 17 4 14.31 4 11C4 7.69 7.58 5 12 5C16.42 5 20 7.69 20 11C20 14.31 16.42 17 12 17Z' fill='white'/%3E%3C/svg%3E\");\n\t\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\t\tbackground-position: center;\n\t\t\t\t\t\ttransition: transform 0.3s ease;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn.open::before {\n\t\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z' fill='white'/%3E%3C/svg%3E\");\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:hover {\n\t\t\t\t\t\ttransform: translateY(-3px);\n\t\t\t\t\t\tbox-shadow: 0 6px 16px rgba(0,123,255,0.4);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0090ff, #0070e0);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:active {\n\t\t\t\t\t\ttransform: translateY(0) scale(0.95);\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,123,255,0.3);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0062cc, #0084ff);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\ttop: calc(100% - 90px); /* Posición calculada basada en la posición del botón */\n\t\t\t\t\t\tright: 13px; /* Posición calculada para alinearse con el botón */\n\t\t\t\t\t\tmin-width: 22px;\n\t\t\t\t\t\theight: 22px;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #ff5146, #e53a30);\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tpadding: 0 5px;\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tborder: 2px solid white;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(255,65,54,0.3);\n\t\t\t\t\t\tpointer-events: none; /* Evitar que el badge interfiera con el botón */\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge.hidden {\n\t\t\t\t\t\ttransform: scale(0);\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\tdisplay: flex !important;\n\t\t\t\t\t}\n\t\t\t\t\t@keyframes pulse {\n\t\t\t\t\t\t0% { transform: scale(0.8); opacity: 0.7; }\n\t\t\t\t\t\t50% { transform: scale(1.3); opacity: 1; }\n\t\t\t\t\t\t80% { transform: scale(0.95); opacity: 1; }\n\t\t\t\t\t\t100% { transform: scale(1); opacity: 1; }\n\t\t\t\t\t}\n\t\t\t\t",t.shadowRoot.appendChild(e)}}else{document.body.appendChild(this.button),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),document.body.appendChild(this.badgeElement),console.log("Inicializando badge de mensajes no leídos (sin shadow DOM)");const t=this.unreadMessagesService.getUnreadCount();console.log("Contador actual de mensajes no leídos:",t),this.updateUnreadBadge(t)}this.applyStyles(),this.addEventListeners(),this.initializeStyles(),this.unreadMessagesService.onCountChange((t=>{this.updateUnreadBadge(t)}))}onToggle(t){this.toggleCallback.push(t)}applyStyles(){Array.from(this.button.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE&&"SPAN"!==t.tagName||this.button.removeChild(t)}));const t=this.options.backgroundColor||"#0084ff";this.button.style.background=`linear-gradient(145deg, ${t}, #0062cc)`,this.button.style.color=this.options.textColor||"#ffffff"}addEventListeners(){this.button.addEventListener("click",(()=>{this.isVisible=!this.isVisible,console.log("Toggle button clicked, new state:",this.isVisible?"visible":"hidden"),this.unreadMessagesService.setActive(this.isVisible),this.isVisible?(this.button.classList.add("open"),this.unreadMessagesService.getUnreadCount()>0&&(this.unreadMessagesService.resetUnreadCount(),this.updateUnreadBadge(0))):this.button.classList.remove("open"),this.toggleCallback.forEach((t=>{t(this.isVisible)}))}))}updateUnreadBadge(t){this.badgeElement?(console.log(`📬 Actualizando badge: ${t} mensajes no leídos`),t<=0?(this.badgeElement.classList.add("hidden"),this.badgeElement.style.opacity="0",this.badgeElement.textContent="",console.log("🚫 Badge oculto - sin mensajes no leídos")):(this.badgeElement.classList.remove("hidden"),this.badgeElement.style.opacity="1",this.badgeElement.textContent=t>99?"99+":t.toString(),console.log(`🔴 Badge visible - ${t} mensajes no leídos`),this.badgeElement.style.display="flex",this.badgeElement.style.opacity="1",this.badgeElement.style.transform="scale(1)",this.badgeElement&&(this.badgeElement.style.animation="none",setTimeout((()=>{this.badgeElement&&(this.badgeElement.style.animation="pulse 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)")}),10)))):console.error("Badge element no encontrado")}initializeStyles(){Object.assign(this.button.style,{position:"fixed",right:"20px",bottom:"20px",width:"56px",height:"56px",borderRadius:"50%",background:`linear-gradient(145deg, ${this.options.backgroundColor||"#0084ff"}, #0062cc)`,color:this.options.textColor||"#ffffff",border:"none",cursor:"pointer",zIndex:"2147483647",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",boxShadow:"0 4px 10px rgba(0,123,255,0.3)",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",overflow:"hidden"}),this.badgeElement&&Object.assign(this.badgeElement.style,{position:"fixed",top:"calc(100% - 90px)",right:"13px",minWidth:"22px",height:"22px",background:"linear-gradient(145deg, #ff5146, #e53a30)",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxSizing:"border-box",border:"2px solid white",zIndex:"2147483647",boxShadow:"0 2px 8px rgba(255,65,54,0.3)",pointerEvents:"none",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)"})}}},3104:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebSocketClient=void 0;const i=n(8007),s=n(1921);class o{constructor(t){this.socket=null,this.token=null,this.endpoint=t,s.TokenManager.subscribeToTokenChanges(this.updateToken.bind(this))}static getInstance(t){return this.instance||(this.instance=new o(t)),this.instance}connect(t){this.token=t||null,this.socket=(0,i.io)(this.endpoint,{transports:["websocket"],auth:this.token?{token:this.token}:void 0,reconnectionAttempts:5,reconnectionDelay:3e3}),this.socket.on("auth_error",(t=>{var e;console.error("❌ Error de autenticación en WebSocket:",t),null===(e=this.socket)||void 0===e||e.disconnect()})),this.socket.onAny(((t,...e)=>{"auth_error"!==t&&console.log(`📩 Mensaje recibido del servidor: ${t}`,e)}))}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}updateToken(t){this.token!==t&&(this.token=t,this.socket&&(console.log("🔄 Actualizando token en WebSocket..."),this.socket.auth={token:t},this.socket.connected&&(console.log("⚡ WebSocket ya conectado, reconectando..."),this.socket.disconnect(),this.socket.connect())))}sendMessage(t){return new Promise(((e,n)=>{if(!this.socket||!this.socket.connected)return console.warn("⚠️ WebSocket no está conectado, mensaje no enviado"),n("WebSocket no conectado");const{type:i}=t;this.socket.emit(i||"event",t,(t=>{if(console.log("📩 Mensaje recibido por el servidor:",t),t&&"object"==typeof t&&"error"in t&&"No receivers"===t.error)return console.warn("⚠️ No hay comerciales disponibles en este momento"),e({error:"No receivers",noReceiversError:!0,timestamp:t.timestamp,message:"En este momento no hay comerciales disponibles. Tu mensaje no será guardado."});e(t)}))}))}healthCheck(){return new Promise(((t,e)=>{if(!this.socket||!this.socket.connected)return console.warn("⚠️ WebSocket no está conectado, mensaje no enviado"),e("WebSocket no conectado");this.socket.emit("health-check",(n=>{if("error"in n)return console.error("❌ Error en el health check:",n.error),e(n.error);console.log("✅ Health check exitoso:",n),t()}))}))}onChatMessage(t){console.log("Agregando listener para mensajes del chat"),this.addListener("receive-message",(e=>{console.log("WebSocket: Mensaje del chat recibido",e),t(e)}))}addListener(t,e){this.socket?this.socket.on(t,e):console.error("❌ WebSocket no conectado")}onConnect(t){this.addListener("connect",t)}onDisconnect(t){this.addListener("disconnect",t)}onTypingStarted(t){this.addListener("typing-started",t)}onTypingStopped(t){this.addListener("typing-stopped",t)}isConnected(){return!!this.socket&&this.socket.connected}waitForConnection(t=3e3){return new Promise((e=>{if(this.isConnected())console.log("✅ WebSocket ya conectado"),e();else{console.log("⏳ Esperando a que el WebSocket se conecte..."),console.log("url",this.endpoint);const n=()=>{clearTimeout(i),e()};this.onConnect(n);const i=setTimeout((()=>{console.warn("⚠️ Timeout esperando conexión WebSocket, continuando de todos modos"),e()}),t)}}))}}e.WebSocketClient=o,o.instance=null},3574:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TrackingType=e.ConfidenceLevel=void 0;var i,s=n(6932);Object.defineProperty(e,"ConfidenceLevel",{enumerable:!0,get:function(){return s.ConfidenceLevel}}),function(t){t.PAGE_VIEW="page_view",t.CLICK="click",t.HOVER="hover"}(i||(e.TrackingType=i={}))},3776:function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Manager=void 0;const r=n(4956),c=n(6214),l=o(n(4627)),d=n(5942),h=n(7743),u=n(4454),p=(0,a(n(7833)).default)("socket.io-client:manager");class g extends u.Emitter{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,(0,r.installTimerFunctions)(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=e.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new h.Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const i=e.parser||l;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(p("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;p("opening %s",this.uri),this.engine=new r.Socket(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=(0,d.on)(e,"open",(function(){n.onopen(),t&&t()})),s=e=>{p("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},o=(0,d.on)(e,"error",s);if(!1!==this._timeout){const t=this._timeout;p("connect attempt will timeout after %d",t);const n=this.setTimeoutFn((()=>{p("connect attempt timed out after %d",t),i(),s(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){p("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push((0,d.on)(t,"ping",this.onping.bind(this)),(0,d.on)(t,"data",this.ondata.bind(this)),(0,d.on)(t,"error",this.onerror.bind(this)),(0,d.on)(t,"close",this.onclose.bind(this)),(0,d.on)(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){(0,r.nextTick)((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){p("error",t),this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new c.Socket(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return void p("socket %s is still active, skipping close",t);this._close()}_packet(t){p("writing packet %j",t);const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){p("cleanup"),this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){p("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var n;p("closed due to %s",t),this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();p("will wait %dms before reconnect attempt",e),this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(p("attempting reconnect"),this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(p("reconnect attempt error"),t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):(p("reconnect success"),t.onreconnect())})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}e.Manager=g},4110:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasCORS=void 0;let n=!1;try{n="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}e.hasCORS=n},4349:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.startChat=function(){return i(this,void 0,void 0,(function*(){const t=localStorage.getItem("accessToken"),e=o.EndpointManager.getInstance(),n=localStorage.getItem("pixelEndpoint")||e.getEndpoint();let i=null,r=[];if(a.length>0)try{const e=a.map((e=>fetch(`${n}/chats/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t||""}`,"Content-Type":"application/json"}}).then((t=>t.ok?e:null)).catch((t=>(console.warn(`Error al recuperar chat ${e}:`,t),null)))));r=(yield Promise.all(e)).filter((t=>null!==t)),r.length>0&&(i=r[0])}catch(t){console.warn("Error al recuperar chats existentes:",t)}if(i)return localStorage.setItem("chats",JSON.stringify(r)),console.log("Chat existente recuperado"),{id:i};try{const e=(0,s.v4)(),i=yield fetch(`${n}/chats/${e}`,{method:"POST",headers:{Authorization:`Bearer ${t||""}`,"Content-Type":"application/json"}});if(!i.ok)throw new Error(`Error al crear chat (${i.status})`);return console.log("Chat creado:",e),r=[e],localStorage.setItem("chats",JSON.stringify(r)),{id:e}}catch(t){throw console.error("Error al iniciar el chat:",t),t}}))};const s=n(611),o=n(2597),a=JSON.parse(localStorage.getItem("chats")||"[]")},4454:(t,e,n)=>{"use strict";function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}n.r(e),n.d(e,{Emitter:()=>i}),i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},i.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;s<i.length;s++)if((n=i[s])===e||n.fn===e){i.splice(s,1);break}return 0===i.length&&delete this._callbacks["$"+t],this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(n){i=0;for(var s=(n=n.slice(0)).length;i<s;++i)n[i].apply(this,e)}return this},i.prototype.emitReserved=i.prototype.emit,i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}},4480:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WT=void 0;const s=n(4689),o=n(4624),a=n(6376),r=(0,i(n(7833)).default)("engine.io-client:webtransport");class c extends s.Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then((()=>{r("transport closed gracefully"),this.onClose()})).catch((t=>{r("transport closed due to %s",t),this.onError("webtransport error",t)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((t=>{const e=(0,a.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),i=(0,a.createPacketEncoderStream)();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const s=()=>{n.read().then((({done:t,value:e})=>{t?r("session is closed"):(r("received chunk: %o",e),this.onPacket(e),s())})).catch((t=>{r("an error occurred while reading: %s",t)}))};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then((()=>this.onOpen()))}))}))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],i=e===t.length-1;this._writer.write(n).then((()=>{i&&(0,o.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null===(t=this._transport)||void 0===t||t.close()}}e.WT=c},4624:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultBinaryType=e.globalThisShim=e.nextTick=void 0,e.createCookieJar=function(){},e.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),e.globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),e.defaultBinaryType="arraybuffer"},4627:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.Encoder=e.PacketType=e.protocol=void 0;const i=n(4454),s=n(4926),o=n(9133),a=(0,n(7833).default)("socket.io-parser"),r=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var c;function l(t){return"[object Object]"===Object.prototype.toString.call(t)}e.protocol=5,function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(c=e.PacketType||(e.PacketType={})),e.Encoder=class{constructor(t){this.replacer=t}encode(t){return a("encoding packet %j",t),t.type!==c.EVENT&&t.type!==c.ACK||!(0,o.hasBinary)(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===c.EVENT?c.BINARY_EVENT:c.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==c.BINARY_EVENT&&t.type!==c.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),a("encoded %j as %s",t,e),e}encodeAsBinary(t){const e=(0,s.deconstructPacket)(t),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}};class d extends i.Emitter{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===c.BINARY_EVENT;n||e.type===c.BINARY_ACK?(e.type=n?c.EVENT:c.ACK,this.reconstructor=new h(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!(0,o.isBinary)(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===c[n.type])throw new Error("unknown packet type "+n.type);if(n.type===c.BINARY_EVENT||n.type===c.BINARY_ACK){const i=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const s=t.substring(i,e);if(s!=Number(s)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"===t.charAt(e+1)){const i=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);n.nsp=t.substring(i,e)}else n.nsp="/";const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const i=e+1;for(;++e;){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(i,e+1))}if(t.charAt(++e)){const i=this.tryParse(t.substr(e));if(!d.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return a("decoded %s as %j",t,n),n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case c.CONNECT:return l(e);case c.DISCONNECT:return void 0===e;case c.CONNECT_ERROR:return"string"==typeof e||l(e);case c.EVENT:case c.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===r.indexOf(e[0]));case c.ACK:case c.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}e.Decoder=d;class h{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=(0,s.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},4689:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=e.TransportError=void 0;const s=n(6376),o=n(4454),a=n(5374),r=n(8661),c=(0,i(n(7833)).default)("engine.io-client:transport");class l extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}e.TransportError=l;class d extends o.Emitter{constructor(t){super(),this.writable=!1,(0,a.installTimerFunctions)(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,n){return super.emitReserved("error",new l(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState?this.write(t):c("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=(0,s.decodePacket)(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=(0,r.encode)(t);return e.length?"?"+e:""}}e.Transport=d},4815:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeStampStage=void 0,e.TimeStampStage=class{process(t){return t.timestamp=(new Date).getTime(),t}}},4926:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.reconstructPacket=e.deconstructPacket=void 0;const i=n(9133);function s(t,e){if(!t)return t;if((0,i.isBinary)(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=s(t[i],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=s(t[i],e));return n}return t}function o(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=o(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=o(t[n],e));return t}e.deconstructPacket=function(t){const e=[],n=t.data,i=t;return i.data=s(n,e),i.attachments=e.length,{packet:i,buffers:e}},e.reconstructPacket=function(t,e){return t.data=o(t.data,e),delete t.attachments,t}},4956:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebTransport=e.WebSocket=e.NodeWebSocket=e.XHR=e.NodeXHR=e.Fetch=e.nextTick=e.parse=e.installTimerFunctions=e.transports=e.TransportError=e.Transport=e.protocol=e.SocketWithUpgrade=e.SocketWithoutUpgrade=e.Socket=void 0;const i=n(8223);Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return i.Socket}});var s=n(8223);Object.defineProperty(e,"SocketWithoutUpgrade",{enumerable:!0,get:function(){return s.SocketWithoutUpgrade}}),Object.defineProperty(e,"SocketWithUpgrade",{enumerable:!0,get:function(){return s.SocketWithUpgrade}}),e.protocol=i.Socket.protocol;var o=n(4689);Object.defineProperty(e,"Transport",{enumerable:!0,get:function(){return o.Transport}}),Object.defineProperty(e,"TransportError",{enumerable:!0,get:function(){return o.TransportError}});var a=n(9419);Object.defineProperty(e,"transports",{enumerable:!0,get:function(){return a.transports}});var r=n(5374);Object.defineProperty(e,"installTimerFunctions",{enumerable:!0,get:function(){return r.installTimerFunctions}});var c=n(1015);Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return c.parse}});var l=n(4624);Object.defineProperty(e,"nextTick",{enumerable:!0,get:function(){return l.nextTick}});var d=n(8209);Object.defineProperty(e,"Fetch",{enumerable:!0,get:function(){return d.Fetch}});var h=n(2071);Object.defineProperty(e,"NodeXHR",{enumerable:!0,get:function(){return h.XHR}});var u=n(2071);Object.defineProperty(e,"XHR",{enumerable:!0,get:function(){return u.XHR}});var p=n(8716);Object.defineProperty(e,"NodeWebSocket",{enumerable:!0,get:function(){return p.WS}});var g=n(8716);Object.defineProperty(e,"WebSocket",{enumerable:!0,get:function(){return g.WS}});var f=n(4480);Object.defineProperty(e,"WebTransport",{enumerable:!0,get:function(){return f.WT}})},5374:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pick=function(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})},e.installTimerFunctions=function(t,e){e.useNativeTimers?(t.setTimeoutFn=s.bind(i.globalThisShim),t.clearTimeoutFn=o.bind(i.globalThisShim)):(t.setTimeoutFn=i.globalThisShim.setTimeout.bind(i.globalThisShim),t.clearTimeoutFn=i.globalThisShim.clearTimeout.bind(i.globalThisShim))},e.byteLength=function(t){return"string"==typeof t?function(t){let e=0,n=0;for(let i=0,s=t.length;i<s;i++)e=t.charCodeAt(i),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(i++,n+=4);return n}(t):Math.ceil((t.byteLength||t.size)*a)},e.randomString=function(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)};const i=n(4624),s=i.globalThisShim.setTimeout,o=i.globalThisShim.clearTimeout,a=1.33},5476:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.checkServerConnection=function(t){return n(this,void 0,void 0,(function*(){try{return(yield fetch(`${t}/health`,{method:"HEAD",cache:"no-cache"})).ok}catch(t){return console.error("Error al conectar con el servidor:",t),!1}}))}},5558:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatInputUI=void 0,e.ChatInputUI=class{constructor(t,e={}){this.listeners={},this.chatUI=t,this.options=Object.assign({placeholder:"Escribe tu mensaje..."},e),this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container",this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.placeholder=this.options.placeholder,this.inputField.className="chat-input-field",this.inputField.addEventListener("keydown",(t=>{"Enter"===t.key&&this.handleSendMessage()}))}init(){const t=this.getChatContainer();this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container";const e=document.createElement("div");e.className="chat-input-actions";const n=document.createElement("button");n.className="chat-attachment-btn",n.setAttribute("aria-label","Adjuntar archivo"),n.addEventListener("click",(()=>{alert("Función de adjuntar archivos no implementada aún")})),e.appendChild(n),this.inputContainer.appendChild(e),this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.className="chat-input-field",this.inputField.placeholder=this.options.placeholder||"Escribe un mensaje...",this.inputField.setAttribute("aria-label","Mensaje");const i=document.createElement("button");i.className="chat-send-btn",i.setAttribute("aria-label","Enviar mensaje"),i.type="button",i.addEventListener("click",(()=>this.handleSendMessage())),this.inputContainer.appendChild(this.inputField),this.inputContainer.appendChild(i),this.inputField.addEventListener("keydown",(t=>{"Enter"===t.key&&(this.handleSendMessage(),t.preventDefault())})),t.appendChild(this.inputContainer)}onSubmit(t){this.listeners.submit=t}handleSendMessage(){const t=this.inputField.value.trim();t&&(this.chatUI.renderChatMessage({text:t,sender:"user"}),this.inputField.value="",this.listeners.submit&&this.listeners.submit(t))}getChatContainer(){const t=this.chatUI.container;if(!t)throw new Error("ChatUI no está inicializado o el contenedor es null");return t}}},5861:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataInjectionStage=void 0,e.MetadataInjectionStage=class{process(t){return t.metadata=Object.assign(Object.assign({},t.metadata),{device:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,screen:{width:screen.width,height:screen.height,pixelRatio:window.devicePixelRatio},hardware:{cores:navigator.hardwareConcurrency},touch:{maxTouchPoints:navigator.maxTouchPoints}}}),t}}},5942:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.on=function(t,e,n){return t.on(e,n),function(){t.off(e,n)}}},6214:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=void 0;const s=n(4627),o=n(5942),a=n(4454),r=(0,i(n(7833)).default)("socket.io-client:socket"),c=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class l extends a.Emitter{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[(0,o.on)(t,"open",this.onopen.bind(this)),(0,o.on)(t,"packet",this.onpacket.bind(this)),(0,o.on)(t,"error",this.onerror.bind(this)),(0,o.on)(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var n,i,o;if(c.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const a={type:s.PacketType.EVENT,data:e,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++;r("emitting packet with ack id %d",t);const n=e.pop();this._registerAckCallback(t,n),a.id=t}const l=null===(i=null===(n=this.io.engine)||void 0===n?void 0:n.transport)||void 0===i?void 0:i.writable,d=this.connected&&!(null===(o=this.io.engine)||void 0===o?void 0:o._hasPingExpired());return this.flags.volatile&&!l?r("discard packet as the transport is not currently writable"):d?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a),this.flags={},this}_registerAckCallback(t,e){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[t]=e);const s=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&(r("removing packet with ack id %d from the buffer",t),this.sendBuffer.splice(e,1));r("event with ack id %d has timed out after %d ms",t,i),e.call(this,new Error("operation has timed out"))}),i),o=(...t)=>{this.io.clearTimeoutFn(s),e.apply(this,t)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise(((n,i)=>{const s=(t,e)=>t?i(t):n(e);s.withError=!0,e.push(s),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...i)=>{if(n===this._queue[0])return null!==t?n.tryCount>this._opts.retries&&(r("packet [%d] is discarded after %d tries",n.id,n.tryCount),this._queue.shift(),e&&e(t)):(r("packet [%d] was successfully sent",n.id),this._queue.shift(),e&&e(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(r("draining queue"),!this.connected||0===this._queue.length)return;const e=this._queue[0];!e.pending||t?(e.pending=!0,e.tryCount++,r("sending packet [%d] (try n°%d)",e.id,e.tryCount),this.flags=e.flags,this.emit.apply(this,e.args)):r("packet [%d] has already been sent and is waiting for an ack",e.id)}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){r("transport is open - connecting"),"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:s.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){r("close (%s)",t),this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{if(!this.sendBuffer.some((e=>String(e.id)===t))){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}}))}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case s.PacketType.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case s.PacketType.EVENT:case s.PacketType.BINARY_EVENT:this.onevent(t);break;case s.PacketType.ACK:case s.PacketType.BINARY_ACK:this.onack(t);break;case s.PacketType.DISCONNECT:this.ondisconnect();break;case s.PacketType.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];r("emitting event %j",e),null!=t.id&&(r("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...i){n||(n=!0,r("sending ack %j",i),e.packet({type:s.PacketType.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];"function"==typeof e?(delete this.acks[t.id],r("calling ack %s with %j",t.id,t.data),e.withError&&t.data.unshift(null),e.apply(this,t.data)):r("bad ack %s",t.id)}onconnect(t,e){r("socket connected with id %s",t),this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:s.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}e.Socket=l},6376:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodePayload=e.decodePacket=e.encodePayload=e.encodePacket=e.protocol=void 0,e.createPacketEncoderStream=function(){return new TransformStream({transform(t,e){(0,i.encodePacketToBinary)(t,(n=>{const i=n.length;let s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);const t=new DataView(s.buffer);t.setUint8(0,126),t.setUint16(1,i)}else{s=new Uint8Array(9);const t=new DataView(s.buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(i))}t.data&&"string"!=typeof t.data&&(s[0]|=128),e.enqueue(s),e.enqueue(n)}))}})},e.createPacketDecoderStream=function(t,e){r||(r=new TextDecoder);const n=[];let i=0,a=-1,d=!1;return new TransformStream({transform(h,u){for(n.push(h);;){if(0===i){if(c(n)<1)break;const t=l(n,1);d=!(128&~t[0]),a=127&t[0],i=a<126?3:126===a?1:2}else if(1===i){if(c(n)<2)break;const t=l(n,2);a=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),i=3}else if(2===i){if(c(n)<8)break;const t=l(n,8),e=new DataView(t.buffer,t.byteOffset,t.length),s=e.getUint32(0);if(s>Math.pow(2,21)-1){u.enqueue(o.ERROR_PACKET);break}a=s*Math.pow(2,32)+e.getUint32(4),i=3}else{if(c(n)<a)break;const t=l(n,a);u.enqueue((0,s.decodePacket)(d?t:r.decode(t),e)),i=0}if(0===a||a>t){u.enqueue(o.ERROR_PACKET);break}}}})};const i=n(2686);Object.defineProperty(e,"encodePacket",{enumerable:!0,get:function(){return i.encodePacket}});const s=n(2662);Object.defineProperty(e,"decodePacket",{enumerable:!0,get:function(){return s.decodePacket}});const o=n(2046),a=String.fromCharCode(30);let r;function c(t){return t.reduce(((t,e)=>t+e.length),0)}function l(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let i=0;for(let s=0;s<e;s++)n[s]=t[0][i++],i===t[0].length&&(t.shift(),i=0);return t.length&&i<t[0].length&&(t[0]=t[0].slice(i)),n}e.encodePayload=(t,e)=>{const n=t.length,s=new Array(n);let o=0;t.forEach(((t,r)=>{(0,i.encodePacket)(t,!1,(t=>{s[r]=t,++o===n&&e(s.join(a))}))}))},e.decodePayload=(t,e)=>{const n=t.split(a),i=[];for(let t=0;t<n.length;t++){const o=(0,s.decodePacket)(n[t],e);if(i.push(o),"error"===o.type)break}return i},e.protocol=4},6420:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionTrackingManager=void 0;const i=n(611);e.SessionTrackingManager=class{constructor(t,e={}){return this.sessionData=null,this.heartbeatTimer=null,this.inactivityTimer=null,this.isTabVisible=!0,this.sessionStartTime=0,this.lastActivityTime=0,this.lastHeartbeat=0,this.isMainTab=!1,this.broadcastChannel=null,this.activityDebounceTimer=null,this.activityEvents=["mousedown","mousemove","keypress","scroll","touchstart","click"],this.handleVisibilityChange=()=>{if(!this.sessionData)return;const t=this.isTabVisible;this.isTabVisible=!document.hidden;const e=Date.now();t&&!this.isTabVisible&&this.pauseSession(),!t&&this.isTabVisible&&this.resumeSession(),this.trackCallback({event:"page_visibility_change",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,isVisible:this.isTabVisible,wasVisible:t,timestamp:e,activeTimeBeforeChange:this.sessionData.totalActiveTime,isMainTab:this.isMainTab}),this.sessionData.isActive=this.isTabVisible},this.handlePageHide=t=>{if(!this.sessionData)return;const e=Date.now();if(this.storeUnloadTimestamp(e),this.isLikelyPageRefresh(t))return void this.debugLog("Page hide detected as likely refresh/navigation, not sending session_end");this.debugLog("Page hide detected as likely tab close, sending session_end"),this.broadcastChannel&&(this.broadcastMessage({type:"tab_closed",tabId:this.sessionData.tabId,timestamp:e,isMainTab:this.isMainTab}),this.isMainTab&&(this.broadcastMessage({type:"main_tab_closed",timestamp:e}),sessionStorage.removeItem("guiders_main_tab")));const n={event:"session_end",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:e,reason:"tab_close",totalActiveTime:this.sessionData.totalActiveTime,startTime:this.sessionData.startTime,isMainTab:this.isMainTab};this.sendBeaconData(n),this.endSessionTracking(!1)},this.handleBeforeUnload=()=>{if(!this.sessionData)return;const t=Date.now();this.storeUnloadTimestamp(t),this.debugLog("Before unload triggered, storing timestamp for refresh detection")},this.sendHeartbeat=()=>{if(!this.sessionData)return;if(!this.shouldSendHeartbeat())return void this.debugLog("Skipping heartbeat - user inactive");if(!this.isUserActive())return this.debugLog("User inactive for too long, ending session"),void this.handleInactivityTimeout();this.updateActiveTime(),this.lastHeartbeat=Date.now();const t={event:"session_heartbeat",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:this.lastHeartbeat,totalActiveTime:this.sessionData.totalActiveTime,isActive:!0,isMainTab:this.isMainTab,timeSinceLastActivity:this.lastHeartbeat-this.lastActivityTime};this.sendBeaconData(t),this.isMainTab&&this.broadcastChannel&&this.broadcastMessage(Object.assign(Object.assign({type:"session_heartbeat"},t),{isMainTab:!0}))},this.handleFocus=()=>{document.hidden||this.isTabVisible||this.handleVisibilityChange()},this.handleBlur=()=>{document.hidden&&this.isTabVisible&&this.handleVisibilityChange()},this.trackCallback=t,this.config=Object.assign({enabled:!0,heartbeatInterval:1e4,trackBackgroundTime:!1,maxInactivityTime:6e4,enableAutoTimeout:!0,enableCrossTabSync:!0,debugMode:!1,beaconEndpoint:"/api/track",activityDebounceTime:1e3,heartbeatActivityWindow:12e4,enableRealActivityDetection:!0},e),this.lastActivityTime=Date.now(),this.lastHeartbeat=Date.now(),this.boundActivityHandler=this.debounce((()=>{this.updateUserActivity()}),this.config.activityDebounceTime),"undefined"==typeof document?(console.warn("[SessionTrackingManager] Document not available - session tracking disabled"),void(this.config.enabled=!1)):"undefined"==typeof window?(console.warn("[SessionTrackingManager] Window not available - session tracking disabled"),void(this.config.enabled=!1)):(void 0===document.hidden&&console.warn("[SessionTrackingManager] Page Visibility API not supported"),this.isTabVisible=!document.hidden,this.setupCrossTabCommunication(),this.bindEventListeners(),void this.setupRealActivityDetection())}startSessionTracking(){if(!this.config.enabled)return;if(this.sessionData)return void this.debugLog("Session tracking already active",{sessionId:this.sessionData.sessionId});const t=this.wasLikelyRefresh();console.debug("[SessionTrackingManager] Starting session tracking...");const e=this.getOrCreateSession(),n=Date.now();this.sessionData={sessionId:e.sessionId,startTime:e.startTime,lastActiveTime:n,totalActiveTime:e.totalActiveTime||0,isActive:this.isTabVisible,tabId:e.tabId},this.sessionStartTime=e.startTime,this.updateLastActivity(),e.isNew&&!t?(this.debugLog("Starting new session",{sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId}),this.trackCallback({event:"session_start",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:this.sessionData.startTime,isVisible:this.isTabVisible})):(this.debugLog("Continuing existing session",{sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,existingActiveTime:this.sessionData.totalActiveTime,wasRefresh:t}),this.trackCallback({event:"session_continue",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:n,isVisible:this.isTabVisible,totalActiveTime:this.sessionData.totalActiveTime,reason:t?"page_refresh":"existing_session"})),this.isTabVisible&&this.startHeartbeat(),this.startInactivityTimer()}endSessionTracking(t=!1){if(!this.sessionData)return;this.stopHeartbeat(),this.stopInactivityTimer(),this.updateActiveTime();const e=Date.now(),n=e-this.sessionData.startTime;this.trackCallback({event:"session_end",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,startTime:this.sessionData.startTime,endTime:e,totalSessionTime:n,totalActiveTime:this.sessionData.totalActiveTime,timestamp:e}),this.sessionData=null}pauseSession(){if(!this.sessionData)return;this.updateActiveTime(),this.stopHeartbeat(),this.stopInactivityTimer();const t=Date.now()-this.lastHeartbeat;if(t<this.config.heartbeatActivityWindow){const t={event:"session_pause",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:Date.now(),reason:"tab_hidden",totalActiveTime:this.sessionData.totalActiveTime,isMainTab:this.isMainTab};this.sendBeaconData(t)}this.debugLog("Session paused",{sessionId:this.sessionData.sessionId,timeSinceLastHeartbeat:t})}resumeSession(){if(!this.sessionData)return;const t=Date.now();this.sessionData.lastActiveTime=t,this.lastActivityTime=t,this.startHeartbeat(),this.startInactivityTimer();const e={event:"session_resume",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:t,isMainTab:this.isMainTab};this.trackCallback(e),this.debugLog("Session resumed",{sessionId:this.sessionData.sessionId})}updateActiveTime(){if(!this.sessionData||!this.isTabVisible)return;const t=Date.now(),e=t-this.sessionData.lastActiveTime;this.sessionData.totalActiveTime+=e,this.sessionData.lastActiveTime=t,this.updateLastActivity(),this.persistSession()}startHeartbeat(){this.heartbeatTimer||(this.heartbeatTimer=setInterval(this.sendHeartbeat,this.config.heartbeatInterval))}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}startInactivityTimer(){this.config.enableAutoTimeout&&(this.stopInactivityTimer(),this.inactivityTimer=setTimeout((()=>{this.handleInactivityTimeout()}),this.config.maxInactivityTime),this.config.debugMode&&this.debugLog("Inactivity timer started",{maxInactivityTime:this.config.maxInactivityTime}))}stopInactivityTimer(){this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null,this.config.debugMode&&this.debugLog("Inactivity timer stopped"))}handleInactivityTimeout(){this.sessionData&&(this.config.debugMode&&this.debugLog("Session inactivity timeout reached",{sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,inactivityDuration:this.config.maxInactivityTime,lastActivityTime:this.lastActivityTime}),this.trackCallback({event:"session_timeout",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,reason:"inactivity",inactivityDuration:this.config.maxInactivityTime,lastActivityTime:this.lastActivityTime,timestamp:Date.now()}),this.endSessionTracking())}updateLastActivity(){this.lastActivityTime=Date.now(),this.config.enableAutoTimeout&&this.startInactivityTimer()}debugLog(t,e){this.config.debugMode&&console.log(`[SessionTrackingManager] ${t}`,e||"")}bindEventListeners(){document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("pagehide",this.handlePageHide),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("focus",this.handleFocus),window.addEventListener("blur",this.handleBlur)}cleanup(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("pagehide",this.handlePageHide),window.removeEventListener("beforeunload",this.handleBeforeUnload),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.config.enableRealActivityDetection&&this.activityEvents.forEach((t=>{document.removeEventListener(t,this.boundActivityHandler)})),this.stopHeartbeat(),this.stopInactivityTimer(),this.activityDebounceTimer&&(clearTimeout(this.activityDebounceTimer),this.activityDebounceTimer=null),this.broadcastChannel&&(this.broadcastChannel.close(),this.broadcastChannel=null),this.isMainTab&&sessionStorage.removeItem("guiders_main_tab"),this.sessionData&&this.endSessionTracking(),this.debugLog("SessionTrackingManager cleanup completed")}getCurrentSession(){return this.sessionData}updateConfig(t){this.config=Object.assign(Object.assign({},this.config),t),t.heartbeatInterval&&this.heartbeatTimer&&(this.stopHeartbeat(),this.isTabVisible&&this.sessionData&&this.startHeartbeat()),(void 0!==t.enableAutoTimeout||t.maxInactivityTime)&&(this.stopInactivityTimer(),this.config.enableAutoTimeout&&this.sessionData&&this.startInactivityTimer()),this.debugLog("Configuration updated",t)}getSessionStats(){if(!this.sessionData)return null;const t=Date.now(),e=this.isTabVisible?this.sessionData.totalActiveTime+(t-this.sessionData.lastActiveTime):this.sessionData.totalActiveTime,n=t-this.lastActivityTime,i=t-this.lastHeartbeat;return{sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,startTime:this.sessionData.startTime,currentTime:t,totalSessionTime:t-this.sessionData.startTime,totalActiveTime:e,isActive:this.sessionData.isActive,isVisible:this.isTabVisible,isMainTab:this.isMainTab,lastActivityTime:this.lastActivityTime,timeSinceLastActivity:n,lastHeartbeat:this.lastHeartbeat,timeSinceLastHeartbeat:i,isUserActive:this.isUserActive(),shouldSendHeartbeat:this.shouldSendHeartbeat(),inactivityTime:this.config.enableAutoTimeout?n:null,timeUntilTimeout:this.config.enableAutoTimeout?Math.max(0,this.config.maxInactivityTime-n):null,crossTabSyncEnabled:this.config.enableCrossTabSync,realActivityDetectionEnabled:this.config.enableRealActivityDetection,activityEventsCount:this.activityEvents.length}}forceSessionEnd(t="user_action"){this.sessionData&&(this.debugLog("Force ending session",{reason:t}),this.trackCallback({event:"session_force_end",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,reason:t,timestamp:Date.now(),totalActiveTime:this.sessionData.totalActiveTime}),this.endSessionTracking(!0))}sendBeaconData(t){try{if("undefined"!=typeof navigator&&navigator.sendBeacon){const e=JSON.stringify(t),n=new Blob([e],{type:"application/json"}),i=navigator.sendBeacon(this.config.beaconEndpoint,n);this.config.debugMode&&this.debugLog("sendBeacon attempt",{success:i,dataSize:e.length,event:t.event,endpoint:this.config.beaconEndpoint}),i||(this.debugLog("sendBeacon failed, falling back to regular tracking"),this.trackCallback(t))}else this.debugLog("sendBeacon not available, using regular tracking"),this.trackCallback(t)}catch(e){this.debugLog("Error in sendBeaconData",{error:e}),this.trackCallback(t)}}getOrCreateSession(){const t="guiders_session";console.log("[SessionTrackingManager] Retrieving or creating global session ID...");const e="guiders_global_session_id";let n,i=!1;try{const t=sessionStorage.getItem(e);t?(console.log("[SessionTrackingManager] Found existing global session ID:",t),n=t,i=!1):(console.log("[SessionTrackingManager] No existing global session ID found, creating a new one..."),n=this.generateGlobalSessionId(),sessionStorage.setItem(e,n),i=!0)}catch(t){console.warn("[SessionTrackingManager] Error handling global session ID:",t),n=this.generateGlobalSessionId(),i=!0}try{const e=sessionStorage.getItem(t);if(e){const t=JSON.parse(e);if(t.tabId&&t.startTime)return{sessionId:n,tabId:t.tabId,startTime:t.startTime,totalActiveTime:t.totalActiveTime||0,isNew:i}}}catch(t){console.warn("[SessionTrackingManager] Error reading session from storage:",t)}const s=Date.now(),o={sessionId:n,tabId:this.generateTabId(),startTime:s,totalActiveTime:0,isNew:i};try{const e={tabId:o.tabId,startTime:o.startTime,totalActiveTime:o.totalActiveTime};sessionStorage.setItem(t,JSON.stringify(e))}catch(t){console.warn("[SessionTrackingManager] Error saving session to storage:",t)}return o}persistSession(){if(!this.sessionData)return;const t={tabId:this.sessionData.tabId,startTime:this.sessionData.startTime,totalActiveTime:this.sessionData.totalActiveTime};try{sessionStorage.setItem("guiders_session",JSON.stringify(t))}catch(t){console.warn("[SessionTrackingManager] Error persisting session:",t)}}clearSession(){try{sessionStorage.removeItem("guiders_session"),sessionStorage.removeItem("guiders_global_session_id")}catch(t){console.warn("[SessionTrackingManager] Error clearing session:",t)}}clearTabSession(){try{sessionStorage.removeItem("guiders_session")}catch(t){console.warn("[SessionTrackingManager] Error clearing tab session:",t)}}clearGlobalSession(){this.clearSession(),this.debugLog("Global session cleared from sessionStorage")}getGlobalSessionId(){try{return sessionStorage.getItem("guiders_global_session_id")}catch(t){return console.warn("[SessionTrackingManager] Error reading global session ID:",t),null}}generateGlobalSessionId(){return`session_${Date.now()}_${(0,i.v4)().substr(0,8)}`}generateTabId(){return`tab_${Date.now()}_${(0,i.v4)().substr(0,8)}`}debounce(t,e){let n;return function(...i){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),t(...i)}),e)}}setupCrossTabCommunication(){if(this.config.enableCrossTabSync)try{if("undefined"==typeof BroadcastChannel)return void this.debugLog("BroadcastChannel not available, cross-tab sync disabled");this.broadcastChannel=new BroadcastChannel("guiders_session_tracking"),this.isMainTab=!sessionStorage.getItem("guiders_main_tab"),this.isMainTab&&(sessionStorage.setItem("guiders_main_tab","true"),this.debugLog("This tab is now the main tab")),this.broadcastChannel.addEventListener("message",(t=>{this.handleCrossTabMessage(t.data)})),this.broadcastMessage({type:"tab_opened",tabId:this.generateTabId(),timestamp:Date.now()})}catch(t){this.debugLog("Error setting up cross-tab communication",{error:t})}}handleCrossTabMessage(t){switch(t.type){case"tab_opened":this.debugLog("New tab opened",{tabId:t.tabId});break;case"tab_closed":this.debugLog("Tab closed",{tabId:t.tabId}),this.checkIfLastTab();break;case"session_heartbeat":t.isMainTab&&t.timestamp>this.lastActivityTime&&(this.lastActivityTime=t.timestamp);break;case"main_tab_closed":this.isMainTab||this.becomeMainTab()}}broadcastMessage(t){if(this.broadcastChannel)try{this.broadcastChannel.postMessage(t)}catch(t){this.debugLog("Error broadcasting message",{error:t})}}checkIfLastTab(){setTimeout((()=>{!document.hidden&&this.sessionData&&(this.debugLog("Checking if last tab - sending session end"),this.sendSessionEndEvent("last_tab_check"))}),100)}becomeMainTab(){this.isMainTab=!0,sessionStorage.setItem("guiders_main_tab","true"),this.debugLog("Became main tab")}setupRealActivityDetection(){this.config.enableRealActivityDetection&&(this.activityEvents.forEach((t=>{document.addEventListener(t,this.boundActivityHandler,{passive:!0,capture:!1})})),this.debugLog("Real activity detection setup complete",{events:this.activityEvents}))}updateUserActivity(){var t;const e=Date.now();this.lastActivityTime=e,this.sessionData&&(this.sessionData.lastActiveTime=e),this.debugLog("User activity detected",{timestamp:e}),this.isMainTab&&this.broadcastChannel&&this.broadcastMessage({type:"user_activity",timestamp:e,tabId:null===(t=this.sessionData)||void 0===t?void 0:t.tabId}),this.config.enableAutoTimeout&&this.startInactivityTimer()}isUserActive(){return Date.now()-this.lastActivityTime<this.config.maxInactivityTime}shouldSendHeartbeat(){Date.now(),this.lastHeartbeat;const t=Date.now()-this.lastActivityTime;return!!(this.isTabVisible&&this.sessionData&&t<this.config.heartbeatActivityWindow)}sendSessionEndEvent(t){if(!this.sessionData)return;const e={event:"session_end",sessionId:this.sessionData.sessionId,tabId:this.sessionData.tabId,timestamp:Date.now(),reason:t,totalActiveTime:this.sessionData.totalActiveTime,startTime:this.sessionData.startTime,isMainTab:this.isMainTab};this.sendBeaconData(e)}storeUnloadTimestamp(t){try{sessionStorage.setItem("guiders_unload_timestamp",t.toString())}catch(t){this.debugLog("Error storing unload timestamp",{error:t})}}wasLikelyRefresh(){try{const t=sessionStorage.getItem("guiders_unload_timestamp");if(!t)return!1;const e=Date.now(),n=e-parseInt(t,10),i=n<2e3;return this.debugLog("Refresh detection",{unloadTimestamp:parseInt(t,10),currentTime:e,timeSinceUnload:n,isRefresh:i}),sessionStorage.removeItem("guiders_unload_timestamp"),i}catch(t){return this.debugLog("Error checking refresh status",{error:t}),!1}}isLikelyPageRefresh(t){return!!t.persisted&&(this.debugLog("Page hide with persisted=true, likely navigation"),!0)}}},6585:t=>{var e=1e3,n=60*e,i=60*n,s=24*i,o=7*s;function a(t,e,n,i){var s=e>=1.5*n;return Math.round(t/n)+" "+i+(s?"s":"")}t.exports=function(t,r){r=r||{};var c,l,d=typeof t;if("string"===d&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(a){var r=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return r*o;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*i;case"minutes":case"minute":case"mins":case"min":case"m":return r*n;case"seconds":case"second":case"secs":case"sec":case"s":return r*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(t);if("number"===d&&isFinite(t))return r.long?(c=t,(l=Math.abs(c))>=s?a(c,l,s,"day"):l>=i?a(c,l,i,"hour"):l>=n?a(c,l,n,"minute"):l>=e?a(c,l,e,"second"):c+" ms"):function(t){var o=Math.abs(t);return o>=s?Math.round(t/s)+"d":o>=i?Math.round(t/i)+"h":o>=n?Math.round(t/n)+"m":o>=e?Math.round(t/e)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},6808:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DomTrackingManager=e.DefaultTrackDataExtractor=void 0;class n{extract(t){const e=t.dataset,n={event:e.trackEvent};return Object.keys(e).forEach((t=>{if("trackEvent"===t)return;const i=t.replace(/[A-Z]/g,(t=>`_${t.toLowerCase()}`));n[i]=e[t]})),n}}e.DefaultTrackDataExtractor=n,e.DomTrackingManager=class{constructor(t,e=new n){this.domEventMap={view_product:"mouseenter",add_to_cart:"click",view_cart:"mouseenter",purchase:"click",page_view:"DOMContentLoaded",search_vehicle_type:"change",search_brand:"change",search_model:"change",search_fuel:"change",search_price_type:"change",sort_vehicles:"change",calculate_financing:"click",add_to_favorites:"click",view_vehicle_location:"mouseenter",filter_by_price:"change",filter_by_payment:"change",search_submit:"click",search_input:"input",add_to_comparison:"click",remove_from_comparison:"click",select_comparison_vehicle:"click",view_vehicle_comparison:"mouseenter",save_comparison:"click",export_comparison:"click",share_comparison:"click",clear_comparison:"click",filter_by_year:"change",filter_by_transmission:"change",filter_by_doors:"change",filter_by_mileage:"change",filter_by_condition:"change",toggle_advanced_filters:"click",contact_dealer:"click",schedule_test_drive:"click",request_quote:"click",view_vehicle_details:"click",view_vehicle_gallery:"click",view_vehicle_specs:"click",view_vehicle_history:"click",download_brochure:"click",analytics_dashboard_view:"mouseenter",export_analytics:"click",share_analytics:"click",chat_ask_about_vehicle:"click",chat_request_financing:"click",chat_schedule_viewing:"click"},this.trackCallback=t,this.extractor=e}enableDOMTracking(){const t=document.querySelector('[data-track-event="page_view"]');t&&"DOMContentLoaded"===this.domEventMap.page_view&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.trackCallback(this.extractor.extract(t))})):this.trackCallback(this.extractor.extract(t))),Object.entries(this.domEventMap).forEach((([t,e])=>{"page_view"!==t&&document.querySelectorAll(`[data-track-event="${t}"]`).forEach((n=>{const i=`__track_listener_${t}`;n[i]||(n.addEventListener(e,(()=>{this.trackCallback(this.extractor.extract(n))})),n[i]=!0)}))}))}}},6894:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.url=function(t,e="",n){let i=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(o("protocol-less url %s",t),t=void 0!==n?n.protocol+"//"+t:"https://"+t),o("parse %s",t),i=(0,s.parse)(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const a=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port+e,i.href=i.protocol+"://"+a+(n&&n.port===i.port?"":":"+i.port),i};const s=n(4956),o=(0,i(n(7833)).default)("socket.io-client:url")},6932:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ConfidenceLevel=void 0,function(t){t[t.EXACT_MATCH=.95]="EXACT_MATCH",t[t.HIGH=.9]="HIGH",t[t.MEDIUM=.7]="MEDIUM",t[t.LOW=.5]="LOW",t[t.FALLBACK=.1]="FALLBACK"}(n||(e.ConfidenceLevel=n={}))},7690:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.URLPageDetector=void 0;const i=n(6932);e.URLPageDetector=class{constructor(){this.urlPatterns=[{pattern:/^\/?(index\.(php|html?)?)?$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/^\/?(home|inicio)$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/\/?(shop|tienda|ecommerce|store)/i,pageType:"ecommerce",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(product|producto)[\/-]?(\d+|[^\/]+)?/i,pageType:"product_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(cart|carrito|basket)/i,pageType:"cart",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(checkout|pago|payment)/i,pageType:"checkout",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(search|busqueda|buscar)?/i,pageType:"vehicle_search",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(vehiculos-ocasion|coches-ocasion|vehiculos-segunda-mano|coches-usados)/i,pageType:"used_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"used"}},{pattern:/\/?(vehiculos-nuevos|coches-nuevos)/i,pageType:"new_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"new"}},{pattern:/\/?(coches-km0|vehiculos-km0|km-0)/i,pageType:"km0_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"km0"}},{pattern:/\/?(ofertas-vehiculos|ofertas-coches|promociones-coches)/i,pageType:"vehicle_offers",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive",vehicleType:"offers"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(detail|detalle)[\/-]?(\d+|[^\/]+)?/i,pageType:"vehicle_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(comparison|comparar|compare)/i,pageType:"vehicle_comparison",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(financing|financiacion|finance)/i,pageType:"financing",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(contact|contacto|contact-us)/i,pageType:"contact",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(about|nosotros|acerca|about-us)/i,pageType:"about",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(analytics|dashboard|admin)/i,pageType:"analytics_dashboard",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"analytics"}},{pattern:/\/?(search|buscar|busqueda)/i,pageType:"search_results",confidence:i.ConfidenceLevel.MEDIUM,metadata:{pageCategory:"search"}},{pattern:/.*/,pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,metadata:{pageCategory:"unknown"}}]}detectCurrentPage(){const t=window.location.href,e=window.location.pathname;for(const n of this.urlPatterns)if(this.matchesPattern(e,n.pattern))return{pageType:n.pageType,confidence:n.confidence,url:t,path:e,metadata:Object.assign(Object.assign({},n.metadata),{title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()})};return{pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,url:t,path:e,metadata:{pageCategory:"unknown",title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()}}}matchesPattern(t,e){return e instanceof RegExp?e.test(t):t.toLowerCase().includes(e.toLowerCase())}addURLPattern(t){this.urlPatterns.splice(-1,0,t)}getURLPatterns(){return[...this.urlPatterns]}extractPageMetadata(){var t;const e=this.detectCurrentPage();return Object.assign(Object.assign({},e.metadata),{viewport:{width:window.innerWidth,height:window.innerHeight},userAgent:navigator.userAgent,language:navigator.language,page_url:window.location.href,page_path:window.location.pathname,page_search:window.location.search,page_host:window.location.host,page_protocol:window.location.protocol,page_hash:window.location.hash,page_type:e.pageType,page_confidence:e.confidence,page_category:null===(t=e.metadata)||void 0===t?void 0:t.pageCategory})}}},7743:(t,e)=>{"use strict";function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Object.defineProperty(e,"__esModule",{value:!0}),e.Backoff=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=1&Math.floor(10*e)?t+n:t-n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},7833:(t,e,n)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let i=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(i++,"%c"===t&&(s=i))})),e.splice(s,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t="MISSING_ENV_VAR".DEBUG),t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=n(736)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},8007:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WebTransport=e.WebSocket=e.NodeWebSocket=e.XHR=e.NodeXHR=e.Fetch=e.Socket=e.Manager=e.protocol=void 0,e.io=l,e.connect=l,e.default=l;const s=n(6894),o=n(3776);Object.defineProperty(e,"Manager",{enumerable:!0,get:function(){return o.Manager}});const a=n(6214);Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return a.Socket}});const r=(0,i(n(7833)).default)("socket.io-client"),c={};function l(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};const n=(0,s.url)(t,e.path||"/socket.io"),i=n.source,a=n.id,l=n.path,d=c[a]&&l in c[a].nsps;let h;return e.forceNew||e["force new connection"]||!1===e.multiplex||d?(r("ignoring socket cache for %s",i),h=new o.Manager(i,e)):(c[a]||(r("new io instance for %s",i),c[a]=new o.Manager(i,e)),h=c[a]),n.query&&!e.query&&(e.query=n.queryKey),h.socket(n.path,e)}Object.assign(l,{Manager:o.Manager,Socket:a.Socket,io:l,connect:l});var d=n(4627);Object.defineProperty(e,"protocol",{enumerable:!0,get:function(){return d.protocol}});var h=n(4956);Object.defineProperty(e,"Fetch",{enumerable:!0,get:function(){return h.Fetch}}),Object.defineProperty(e,"NodeXHR",{enumerable:!0,get:function(){return h.NodeXHR}}),Object.defineProperty(e,"XHR",{enumerable:!0,get:function(){return h.XHR}}),Object.defineProperty(e,"NodeWebSocket",{enumerable:!0,get:function(){return h.NodeWebSocket}}),Object.defineProperty(e,"WebSocket",{enumerable:!0,get:function(){return h.WebSocket}}),Object.defineProperty(e,"WebTransport",{enumerable:!0,get:function(){return h.WebTransport}}),t.exports=l},8156:function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||i(e,t,n)},o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const a=n(2597),r=n(969),c=n(2782);function l(){try{const{apiKey:t}=function(){const t=function(){const t=Array.from(document.getElementsByTagName("script"));for(const e of t)if(e.getAttribute("data-guiders-sdk"))return e;if(document.currentScript&&document.currentScript instanceof HTMLScriptElement){const t=document.currentScript;if(t.getAttribute("data-api-key")||t.getAttribute("data-apikey")||t.src&&(t.src.includes("apiKey=")||t.src.includes("apikey=")||t.src.includes("guiders")))return t}for(const e of t)if(e.getAttribute("data-api-key")||e.getAttribute("data-apikey"))return e;for(const e of t)if(e.src&&(e.src.includes("apiKey=")||e.src.includes("apikey=")))return e;for(const e of t)if(e.src&&e.src.includes("guiders"))return e;for(const e of t)if(e.src&&(e.src.includes("tracking")||e.src.includes("index.js"))&&(e.src.includes("apiKey=")||e.src.includes("apikey=")))return e;const e=t.filter((t=>t.src&&(t.src.includes(".js")||t.src.includes("index"))));for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.src.includes("guiders")||n.src.includes("tracking")||n.src.includes("apiKey=")||n.src.includes("apikey="))return n}return null}();if(!t)throw new Error("No se encontró el script del SDK Guiders. Asegúrate de incluir el atributo data-api-key.");let e=t.getAttribute("data-api-key")||t.getAttribute("data-apikey");if(!e&&t.src){const n=t.src.split("?")[1];if(n){const t=new URLSearchParams(n);e=t.get("apiKey")||t.get("apikey")}}if(!e&&"undefined"!=typeof window&&window.GUIDERS_CONFIG&&(e=window.GUIDERS_CONFIG.apiKey),!e)throw new Error("No se encontró la clave API. Usa data-api-key=\"tu-clave\" en el script o configura window.GUIDERS_CONFIG = {apiKey: 'tu-clave'}.");return{apiKey:e}}();window.GUIDERS_API_KEY=t,window.TrackingPixelSDK=a.TrackingPixelSDK,console.log("Entorno de desarrollo:","production");const e=!1;console.log("Entorno de desarrollo:",e);const n=e?"http://localhost:3000":"https://guiders.ancoradual.com/api",i=e?"ws://localhost:3000":"wss://guiders.ancoradual.com",s={apiKey:t,autoFlush:!0,flushInterval:1e3,maxRetries:2,heuristicDetection:{enabled:!0,config:{enabled:!0,confidenceThreshold:.7,fallbackToManual:!0}},sessionTracking:{enabled:!0,config:{enabled:!0,heartbeatInterval:3e4,trackBackgroundTime:!1}}};e||(s.endpoint=n,s.webSocketEndpoint=i),(new c.BotDetector).detect().then((t=>{if(t.isBot)return console.log("Bot detectado. Probabilidad:",t.probability),void console.log("Detalles:",t.details);window.guiders=new window.TrackingPixelSDK(s),(()=>{o(this,void 0,void 0,(function*(){const t=r.UnreadMessagesService.getInstance();console.log("Servicio de mensajes no leídos inicializado"),t.forceUpdate(),yield window.guiders.init(),window.guiders.enableAutomaticTracking()}))})()}))}catch(t){console.error("Error inicializando Guiders SDK:",t)}}s(n(2597),e),s(n(1921),e),s(n(2782),e),s(n(6808),e),s(n(2895),e),s(n(1034),e),s(n(7690),e),s(n(6420),e),s(n(1750),e),s(n(421),e),s(n(969),e),s(n(3574),e),"undefined"!=typeof window&&setTimeout((()=>{if(!window.guiders){const t=()=>{document.addEventListener("rocket-script-loaded",(t=>{const e=t.target;!window.guiders&&e&&e.src&&(e.src.includes("guiders")||e.src.includes("apiKey="))&&setTimeout(l,10)})),document.addEventListener("rocket-loaded",(()=>{window.guiders||setTimeout(l,10)}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),(void 0!==window.RocketLazyLoadScripts||document.querySelector('script[type="rocketlazyloadscript"]'))&&(setTimeout((()=>{window.guiders||l()}),100),setTimeout((()=>{window.guiders||l()}),500))}}),500)},8209:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Fetch=void 0;const i=n(528);class s extends i.Polling{doPoll(){this._fetch().then((t=>{if(!t.ok)return this.onError("fetch read error",t.status,t);t.text().then((t=>this.onData(t)))})).catch((t=>{this.onError("fetch read error",t)}))}doWrite(t,e){this._fetch(t).then((t=>{if(!t.ok)return this.onError("fetch write error",t.status,t);e()})).catch((t=>{this.onError("fetch write error",t)}))}_fetch(t){var e;const n=void 0!==t,i=new Headers(this.opts.extraHeaders);return n&&i.set("content-type","text/plain;charset=UTF-8"),null===(e=this.socket._cookieJar)||void 0===e||e.appendCookies(i),fetch(this.uri(),{method:n?"POST":"GET",body:n?t:null,headers:i,credentials:this.opts.withCredentials?"include":"omit"}).then((t=>{var e;return null===(e=this.socket._cookieJar)||void 0===e||e.parseCookies(t.headers.getSetCookie()),t}))}}e.Fetch=s},8223:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=e.SocketWithUpgrade=e.SocketWithoutUpgrade=void 0;const s=n(9419),o=n(5374),a=n(8661),r=n(1015),c=n(4454),l=n(6376),d=n(4624),h=(0,i(n(7833)).default)("engine.io-client:socket"),u="function"==typeof addEventListener&&"function"==typeof removeEventListener,p=[];u&&addEventListener("offline",(()=>{h("closing %d connection(s) because the network was lost",p.length),p.forEach((t=>t()))}),!1);class g extends c.Emitter{constructor(t,e){if(super(),this.binaryType=d.defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&"object"==typeof t&&(e=t,t=null),t){const n=(0,r.parse)(t);e.hostname=n.host,e.secure="https"===n.protocol||"wss"===n.protocol,e.port=n.port,n.query&&(e.query=n.query)}else e.host&&(e.hostname=(0,r.parse)(e.host).host);(0,o.installTimerFunctions)(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach((t=>{const e=t.prototype.name;this.transports.push(e),this._transportsByName[e]=t})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(0,a.decode)(this.opts.query)),u&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(h("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},p.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=(0,d.createCookieJar)()),this._open()}createTransport(t){h('creating transport "%s"',t);const e=Object.assign({},this.opts.query);e.EIO=l.protocol,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return h("options: %j",n),new this._transportsByName[t](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const t=this.opts.rememberUpgrade&&g.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){h("setting transport %s",t.name),this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(t=>this._onClose("transport close",t)))}onOpen(){h("socket open"),this.readyState="open",g.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(h('socket receive: type "%s", data "%s"',t.type,t.data),this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}else h('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();h("flushing %d packets in socket",t.length),this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){const n=this.writeBuffer[e].data;if(n&&(t+=(0,o.byteLength)(n)),e>0&&t>this._maxPayload)return h("only send %d out of %d packets",e,this.writeBuffer.length),this.writeBuffer.slice(0,e);t+=2}return h("payload size is %d (max: %d)",t,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(h("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,(0,d.nextTick)((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),t}write(t,e,n){return this._sendPacket("message",t,e,n),this}send(t,e,n){return this._sendPacket("message",t,e,n),this}_sendPacket(t,e,n,i){if("function"==typeof e&&(i=e,e=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const s={type:t,data:e,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),h("socket closing - telling transport to close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}_onError(t){if(h("socket error %j",t),g.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return h("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(h('socket close with reason: "%s"',t),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),u&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const t=p.indexOf(this._offlineEventListener);-1!==t&&(h("removing listener for the 'offline' event"),p.splice(t,1))}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}e.SocketWithoutUpgrade=g,g.protocol=l.protocol;class f extends g{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade){h("starting upgrade probes");for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}}_probe(t){h('probing transport "%s"',t);let e=this.createTransport(t),n=!1;g.priorWebsocketSuccess=!1;const i=()=>{n||(h('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(i=>{if(!n)if("pong"===i.type&&"probe"===i.data){if(h('probe transport "%s" pong',t),this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;g.priorWebsocketSuccess="websocket"===e.name,h('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{n||"closed"!==this.readyState&&(h("changing transport and sending upgrade packet"),l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{h('probe transport "%s" failed',t);const n=new Error("probe error");n.transport=e.name,this.emitReserved("upgradeError",n)}})))};function s(){n||(n=!0,l(),e.close(),e=null)}const o=n=>{const i=new Error("probe error: "+n);i.transport=e.name,s(),h('probe transport "%s" failed because of error: %s',t,n),this.emitReserved("upgradeError",i)};function a(){o("transport closed")}function r(){o("socket closed")}function c(t){e&&t.name!==e.name&&(h('"%s" works - aborting "%s"',t.name,e.name),s())}const l=()=>{e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",a),this.off("close",r),this.off("upgrading",c)};e.once("open",i),e.once("error",o),e.once("close",a),this.once("close",r),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{n||e.open()}),200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}e.SocketWithUpgrade=f,e.Socket=class extends f{constructor(t,e={}){const n="object"==typeof t?t:e;(!n.transports||n.transports&&"string"==typeof n.transports[0])&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map((t=>s.transports[t])).filter((t=>!!t))),super(t,n)}}},8661:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encode=function(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){let e={},n=t.split("&");for(let t=0,i=n.length;t<i;t++){let i=n[t].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},8716:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WS=e.BaseWS=void 0;const s=n(4689),o=n(5374),a=n(6376),r=n(4624),c=(0,i(n(7833)).default)("engine.io-client:websocket"),l="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class d extends s.Transport{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,n=l?{}:(0,o.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,n)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],i=e===t.length-1;(0,a.encodePacket)(n,this.supportsBinary,(t=>{try{this.doWrite(n,t)}catch(t){c("websocket closed before onclose event")}i&&(0,r.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,o.randomString)()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}e.BaseWS=d;const h=r.globalThisShim.WebSocket||r.globalThisShim.MozWebSocket;e.WS=class extends d{createSocket(t,e,n){return l?new h(t,e,n):e?new h(t,e):new h(t)}doWrite(t,e){this.ws.send(e)}}},9126:function(t,e,n){t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i,s,o=n(1)(),a=n(3),r=n(4),c=n(6),l=function(){var t=new r;return i=t.getResult(),s=new c,this};l.prototype={getSoftwareVersion:function(){return"0.1.11"},getBrowserData:function(){return i},getFingerprint:function(){var t="|",e=i.ua,n=this.getScreenPrint(),s=this.getPlugins(),o=this.getFonts(),r=this.isLocalStorage(),c=this.isSessionStorage(),l=this.getTimeZone(),d=this.getLanguage(),h=this.getSystemLanguage(),u=this.isCookie(),p=this.getCanvasPrint();return a(e+t+n+t+s+t+o+t+r+t+c+t+l+t+d+t+h+t+u+t+p,256)},getCustomFingerprint:function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+"|";return a(t,256)},getUserAgent:function(){return i.ua},getUserAgentLowerCase:function(){return i.ua.toLowerCase()},getBrowser:function(){return i.browser.name},getBrowserVersion:function(){return i.browser.version},getBrowserMajorVersion:function(){return i.browser.major},isIE:function(){return/IE/i.test(i.browser.name)},isChrome:function(){return/Chrome/i.test(i.browser.name)},isFirefox:function(){return/Firefox/i.test(i.browser.name)},isSafari:function(){return/Safari/i.test(i.browser.name)},isMobileSafari:function(){return/Mobile\sSafari/i.test(i.browser.name)},isOpera:function(){return/Opera/i.test(i.browser.name)},getEngine:function(){return i.engine.name},getEngineVersion:function(){return i.engine.version},getOS:function(){return i.os.name},getOSVersion:function(){return i.os.version},isWindows:function(){return/Windows/i.test(i.os.name)},isMac:function(){return/Mac/i.test(i.os.name)},isLinux:function(){return/Linux/i.test(i.os.name)},isUbuntu:function(){return/Ubuntu/i.test(i.os.name)},isSolaris:function(){return/Solaris/i.test(i.os.name)},getDevice:function(){return i.device.model},getDeviceType:function(){return i.device.type},getDeviceVendor:function(){return i.device.vendor},getCPU:function(){return i.cpu.architecture},isMobile:function(){var t=i.ua||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))},isMobileMajor:function(){return this.isMobileAndroid()||this.isMobileBlackBerry()||this.isMobileIOS()||this.isMobileOpera()||this.isMobileWindows()},isMobileAndroid:function(){return!!i.ua.match(/Android/i)},isMobileOpera:function(){return!!i.ua.match(/Opera Mini/i)},isMobileWindows:function(){return!!i.ua.match(/IEMobile/i)},isMobileBlackBerry:function(){return!!i.ua.match(/BlackBerry/i)},isMobileIOS:function(){return!!i.ua.match(/iPhone|iPad|iPod/i)},isIphone:function(){return!!i.ua.match(/iPhone/i)},isIpad:function(){return!!i.ua.match(/iPad/i)},isIpod:function(){return!!i.ua.match(/iPod/i)},getScreenPrint:function(){return"Current Resolution: "+this.getCurrentResolution()+", Available Resolution: "+this.getAvailableResolution()+", Color Depth: "+this.getColorDepth()+", Device XDPI: "+this.getDeviceXDPI()+", Device YDPI: "+this.getDeviceYDPI()},getColorDepth:function(){return screen.colorDepth},getCurrentResolution:function(){return screen.width+"x"+screen.height},getAvailableResolution:function(){return screen.availWidth+"x"+screen.availHeight},getDeviceXDPI:function(){return screen.deviceXDPI},getDeviceYDPI:function(){return screen.deviceYDPI},getPlugins:function(){for(var t="",e=0;e<navigator.plugins.length;e++)e==navigator.plugins.length-1?t+=navigator.plugins[e].name:t+=navigator.plugins[e].name+", ";return t},isJava:function(){return navigator.javaEnabled()},getJavaVersion:function(){throw new Error("Please use client.java.js or client.js if you need this functionality!")},isFlash:function(){return!!navigator.plugins["Shockwave Flash"]},getFlashVersion:function(){throw new Error("Please use client.flash.js or client.js if you need this functionality!")},isSilverlight:function(){return!!navigator.plugins["Silverlight Plug-In"]},getSilverlightVersion:function(){return this.isSilverlight()?navigator.plugins["Silverlight Plug-In"].description:""},isMimeTypes:function(){return!(!navigator.mimeTypes||!navigator.mimeTypes.length)},getMimeTypes:function(){var t="";if(navigator.mimeTypes)for(var e=0;e<navigator.mimeTypes.length;e++)e==navigator.mimeTypes.length-1?t+=navigator.mimeTypes[e].description:t+=navigator.mimeTypes[e].description+", ";return t},isFont:function(t){return s.detect(t)},getFonts:function(){for(var t=["Abadi MT Condensed Light","Adobe Fangsong Std","Adobe Hebrew","Adobe Ming Std","Agency FB","Aharoni","Andalus","Angsana New","AngsanaUPC","Aparajita","Arab","Arabic Transparent","Arabic Typesetting","Arial Baltic","Arial Black","Arial CE","Arial CYR","Arial Greek","Arial TUR","Arial","Batang","BatangChe","Bauhaus 93","Bell MT","Bitstream Vera Serif","Bodoni MT","Bookman Old Style","Braggadocio","Broadway","Browallia New","BrowalliaUPC","Calibri Light","Calibri","Californian FB","Cambria Math","Cambria","Candara","Castellar","Casual","Centaur","Century Gothic","Chalkduster","Colonna MT","Comic Sans MS","Consolas","Constantia","Copperplate Gothic Light","Corbel","Cordia New","CordiaUPC","Courier New Baltic","Courier New CE","Courier New CYR","Courier New Greek","Courier New TUR","Courier New","DFKai-SB","DaunPenh","David","DejaVu LGC Sans Mono","Desdemona","DilleniaUPC","DokChampa","Dotum","DotumChe","Ebrima","Engravers MT","Eras Bold ITC","Estrangelo Edessa","EucrosiaUPC","Euphemia","Eurostile","FangSong","Forte","FrankRuehl","Franklin Gothic Heavy","Franklin Gothic Medium","FreesiaUPC","French Script MT","Gabriola","Gautami","Georgia","Gigi","Gisha","Goudy Old Style","Gulim","GulimChe","GungSeo","Gungsuh","GungsuhChe","Haettenschweiler","Harrington","Hei S","HeiT","Heisei Kaku Gothic","Hiragino Sans GB","Impact","Informal Roman","IrisUPC","Iskoola Pota","JasmineUPC","KacstOne","KaiTi","Kalinga","Kartika","Khmer UI","Kino MT","KodchiangUPC","Kokila","Kozuka Gothic Pr6N","Lao UI","Latha","Leelawadee","Levenim MT","LilyUPC","Lohit Gujarati","Loma","Lucida Bright","Lucida Console","Lucida Fax","Lucida Sans Unicode","MS Gothic","MS Mincho","MS PGothic","MS PMincho","MS Reference Sans Serif","MS UI Gothic","MV Boli","Magneto","Malgun Gothic","Mangal","Marlett","Matura MT Script Capitals","Meiryo UI","Meiryo","Menlo","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU-ExtB","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","Miriam Fixed","Miriam","Mongolian Baiti","MoolBoran","NSimSun","Narkisim","News Gothic MT","Niagara Solid","Nyala","PMingLiU","PMingLiU-ExtB","Palace Script MT","Palatino Linotype","Papyrus","Perpetua","Plantagenet Cherokee","Playbill","Prelude Bold","Prelude Condensed Bold","Prelude Condensed Medium","Prelude Medium","PreludeCompressedWGL Black","PreludeCompressedWGL Bold","PreludeCompressedWGL Light","PreludeCompressedWGL Medium","PreludeCondensedWGL Black","PreludeCondensedWGL Bold","PreludeCondensedWGL Light","PreludeCondensedWGL Medium","PreludeWGL Black","PreludeWGL Bold","PreludeWGL Light","PreludeWGL Medium","Raavi","Rachana","Rockwell","Rod","Sakkal Majalla","Sawasdee","Script MT Bold","Segoe Print","Segoe Script","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Segoe UI","Shonar Bangla","Showcard Gothic","Shruti","SimHei","SimSun","SimSun-ExtB","Simplified Arabic Fixed","Simplified Arabic","Snap ITC","Sylfaen","Symbol","Tahoma","Times New Roman Baltic","Times New Roman CE","Times New Roman CYR","Times New Roman Greek","Times New Roman TUR","Times New Roman","TlwgMono","Traditional Arabic","Trebuchet MS","Tunga","Tw Cen MT Condensed Extra Bold","Ubuntu","Umpush","Univers","Utopia","Utsaah","Vani","Verdana","Vijaya","Vladimir Script","Vrinda","Webdings","Wide Latin","Wingdings"],e="",n=0;n<t.length;n++)s.detect(t[n])&&(e+=n==t.length-1?t[n]:t[n]+", ");return e},isLocalStorage:function(){try{return!!o.localStorage}catch(t){return!0}},isSessionStorage:function(){try{return!!o.sessionStorage}catch(t){return!0}},isCookie:function(){return navigator.cookieEnabled},getTimeZone:function(){var t,e;return t=new Date,(e=String(-t.getTimezoneOffset()/60))<0?"-"+("0"+(e*=-1)).slice(-2):"+"+("0"+e).slice(-2)},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language},isCanvas:function(){var t=document.createElement("canvas");try{return!(!t.getContext||!t.getContext("2d"))}catch(t){return!1}},getCanvasPrint:function(){var t,e=document.createElement("canvas");try{t=e.getContext("2d")}catch(t){return""}var n="ClientJS,org <canvas> 1.0";return t.textBaseline="top",t.font="14px 'Arial'",t.textBaseline="alphabetic",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText(n,2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText(n,4,17),e.toDataURL()}},e.ClientJS=l},function(t,e,i){"use strict";var s=i(2);t.exports=function(){return"object"==typeof n.g&&n.g&&n.g.Math===Math&&n.g.Array===Array?n.g:s}},function(t,e,n){"use strict";"undefined"!=typeof self?t.exports=self:"undefined"!=typeof window?t.exports=window:t.exports=Function("return this")()},function(t,e,n){t.exports=function(t,e){var n,i,s,o,a,r,c,l;for(n=3&t.length,i=t.length-n,s=e,a=3432918353,r=461845907,l=0;l<i;)c=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,s=27492+(65535&(o=5*(65535&(s=(s^=c=(65535&(c=(c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&t.charCodeAt(l+2))<<16;case 2:c^=(255&t.charCodeAt(l+1))<<8;case 1:s^=c=(65535&(c=(c=(65535&(c^=255&t.charCodeAt(l)))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},function(t,e,n){var i;!function(s,o){"use strict";var a="function",r="undefined",c="object",l="string",d="model",h="name",u="type",p="vendor",g="version",f="architecture",m="console",b="mobile",v="tablet",y="smarttv",w="wearable",k="embedded",T="Amazon",C="Apple",x="ASUS",_="BlackBerry",S="Google",E="Huawei",M="LG",I="Microsoft",D="Motorola",A="Samsung",P="Sony",L="Xiaomi",O="Zebra",j="Facebook",R=function(t){var e={};for(var n in t)e[t[n].toUpperCase()]=t[n];return e},N=function(t,e){return typeof t===l&&-1!==B(e).indexOf(B(t))},B=function(t){return t.toLowerCase()},U=function(t,e){if(typeof t===l)return t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof e===r?t:t.substring(0,255)},F=function(t,e){for(var n,i,s,r,l,d,h=0;h<e.length&&!l;){var u=e[h],p=e[h+1];for(n=i=0;n<u.length&&!l;)if(l=u[n++].exec(t))for(s=0;s<p.length;s++)d=l[++i],typeof(r=p[s])===c&&r.length>0?2==r.length?typeof r[1]==a?this[r[0]]=r[1].call(this,d):this[r[0]]=r[1]:3==r.length?typeof r[1]!==a||r[1].exec&&r[1].test?this[r[0]]=d?d.replace(r[1],r[2]):o:this[r[0]]=d?r[1].call(this,d,r[2]):o:4==r.length&&(this[r[0]]=d?r[3].call(this,d.replace(r[1],r[2])):o):this[r]=d||o;h+=2}},H=function(t,e){for(var n in e)if(typeof e[n]===c&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(N(e[n][i],t))return"?"===n?o:n}else if(N(e[n],t))return"?"===n?o:n;return t},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},W={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[g,[h,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[g,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure Browser"],g],[/\bfocus\/([\w\.]+)/i],[g,[h,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[g,[h,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 Browser"],g],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,j],g],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,"Chrome WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,g]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,B]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[p,A],[u,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[p,A],[u,b]],[/\((ip(?:hone|od)[\w ]*);/i],[d,[p,C],[u,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[p,C],[u,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[p,E],[u,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[d,[p,E],[u,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[p,L],[u,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[p,L],[u,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[d,[p,"OPPO"],[u,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[p,"Vivo"],[u,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[p,"Realme"],[u,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[p,D],[u,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[p,D],[u,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[p,M],[u,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[p,M],[u,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[p,"Lenovo"],[u,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[p,"Nokia"],[u,b]],[/(pixel c)\b/i],[d,[p,S],[u,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[p,S],[u,b]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[p,P],[u,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[p,P],[u,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[p,"OnePlus"],[u,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[p,T],[u,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[p,T],[u,b]],[/(playbook);[-\w\),; ]+(rim)/i],[d,p,[u,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[p,_],[u,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[p,x],[u,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[p,x],[u,b]],[/(nexus 9)/i],[d,[p,"HTC"],[u,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[p,[d,/_/g," "],[u,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[p,"Acer"],[u,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[p,"Meizu"],[u,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[p,"Sharp"],[u,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,d,[u,b]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,d,[u,v]],[/(surface duo)/i],[d,[p,I],[u,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[p,"Fairphone"],[u,b]],[/(u304aa)/i],[d,[p,"AT&T"],[u,b]],[/\bsie-(\w*)/i],[d,[p,"Siemens"],[u,b]],[/\b(rct\w+) b/i],[d,[p,"RCA"],[u,v]],[/\b(venue[\d ]{2,7}) b/i],[d,[p,"Dell"],[u,v]],[/\b(q(?:mv|ta)\w+) b/i],[d,[p,"Verizon"],[u,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[p,"Barnes & Noble"],[u,v]],[/\b(tm\d{3}\w+) b/i],[d,[p,"NuVision"],[u,v]],[/\b(k88) b/i],[d,[p,"ZTE"],[u,v]],[/\b(nx\d{3}j) b/i],[d,[p,"ZTE"],[u,b]],[/\b(gen\d{3}) b.+49h/i],[d,[p,"Swiss"],[u,b]],[/\b(zur\d{3}) b/i],[d,[p,"Swiss"],[u,v]],[/\b((zeki)?tb.*\b) b/i],[d,[p,"Zeki"],[u,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],d,[u,v]],[/\b(ns-?\w{0,9}) b/i],[d,[p,"Insignia"],[u,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[p,"NextBook"],[u,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],d,[u,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],d,[u,b]],[/\b(ph-1) /i],[d,[p,"Essential"],[u,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[p,"Envizen"],[u,v]],[/\b(trio[-\w\. ]+) b/i],[d,[p,"MachSpeed"],[u,v]],[/\btu_(1491) b/i],[d,[p,"Rotor"],[u,v]],[/(shield[\w ]+) b/i],[d,[p,"Nvidia"],[u,v]],[/(sprint) (\w+)/i],[p,d,[u,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[p,I],[u,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[p,O],[u,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[p,O],[u,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,d,[u,m]],[/droid.+; (shield) bui/i],[d,[p,"Nvidia"],[u,m]],[/(playstation [345portablevi]+)/i],[d,[p,P],[u,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[p,I],[u,m]],[/smart-tv.+(samsung)/i],[p,[u,y]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[p,A],[u,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,M],[u,y]],[/(apple) ?tv/i],[p,[d,"Apple TV"],[u,y]],[/crkey/i],[[d,"Chromecast"],[p,S],[u,y]],[/droid.+aft(\w)( bui|\))/i],[d,[p,T],[u,y]],[/\(dtv[\);].+(aquos)/i],[d,[p,"Sharp"],[u,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[p,U],[d,U],[u,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,y]],[/((pebble))app/i],[p,d,[u,w]],[/droid.+; (glass) \d/i],[d,[p,S],[u,w]],[/droid.+; (wt63?0{2,3})\)/i],[d,[p,O],[u,w]],[/(quest( 2)?)/i],[d,[p,j],[u,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[u,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[u,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[u,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,v]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[u,b]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[g,H,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[g,H,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,"Mac OS"],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,_]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/crkey\/([\d\.]+)/i],[g,[h,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[h,"Chromium OS"],g],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[h,g]]},q=function(t,e){if(typeof t===c&&(e=t,t=o),!(this instanceof q))return new q(t,e).getResult();var n=t||(typeof s!==r&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),i=e?function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n}(W,e):W;return this.getBrowser=function(){var t,e={};return e.name=o,e.version=o,F.call(e,n,i.browser),e.major=typeof(t=e.version)===l?t.replace(/[^\d\.]/g,"").split(".")[0]:o,e},this.getCPU=function(){var t={};return t.architecture=o,F.call(t,n,i.cpu),t},this.getDevice=function(){var t={};return t.vendor=o,t.model=o,t.type=o,F.call(t,n,i.device),t},this.getEngine=function(){var t={};return t.name=o,t.version=o,F.call(t,n,i.engine),t},this.getOS=function(){var t={};return t.name=o,t.version=o,F.call(t,n,i.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=typeof t===l&&t.length>255?U(t,255):t,this},this.setUA(n),this};q.VERSION="0.7.30",q.BROWSER=R([h,g,"major"]),q.CPU=R([f]),q.DEVICE=R([d,p,u,m,b,y,v,w,k]),q.ENGINE=q.OS=R([h,g]),typeof e!==r?(typeof t!==r&&t.exports&&(e=t.exports=q),e.UAParser=q):n(5)?(i=function(){return q}.call(e,n,e,t))===o||(t.exports=i):typeof s!==r&&(s.UAParser=q);var V=typeof s!==r&&(s.jQuery||s.Zepto);if(V&&!V.ua){var K=new q;V.ua=K.getResult(),V.ua.get=function(){return K.getUA()},V.ua.set=function(t){K.setUA(t);var e=K.getResult();for(var n in e)V.ua[n]=e[n]}}}("object"==typeof window?window:this)},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e){t.exports=function(){var t=["monospace","sans-serif","serif"],e=document.getElementsByTagName("body")[0],n=document.createElement("span");n.style.fontSize="72px",n.innerHTML="mmmmmmmmmmlli";var i={},s={};for(var o in t)n.style.fontFamily=t[o],e.appendChild(n),i[t[o]]=n.offsetWidth,s[t[o]]=n.offsetHeight,e.removeChild(n);this.detect=function(o){var a=!1;for(var r in t){n.style.fontFamily=o+","+t[r],e.appendChild(n);var c=n.offsetWidth!=i[t[r]]||n.offsetHeight!=s[t[r]];e.removeChild(n),a=a||c}return a}}}])},9133:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasBinary=e.isBinary=void 0;const n="function"==typeof ArrayBuffer,i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);function a(t){return n&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||s&&t instanceof Blob||o&&t instanceof File}e.isBinary=a,e.hasBinary=function t(e,n){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let n=0,i=e.length;n<i;n++)if(t(e[n]))return!0;return!1}if(a(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return!0;return!1}},9167:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchChatDetail=function(t){return i(this,void 0,void 0,(function*(){const e=localStorage.getItem("accessToken"),n=s.EndpointManager.getInstance(),i=localStorage.getItem("pixelEndpoint")||n.getEndpoint(),o=yield fetch(`${i}/chats/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e||""}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Error al obtener detalles del chat (${o.status})`);return o.json()}))};const s=n(2597)},9329:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.URLInjectionStage=void 0,e.URLInjectionStage=class{process(t){if("tracking:tracking-event"===t.type&&t.data&&"object"==typeof t.data&&"eventType"in t.data&&"page_view"===t.data.eventType){const e=t.data.metadata;e&&e.page_url?console.log("[URLInjectionStage] ✅ URL ya presente en metadata, omitiendo inyección automática"):"undefined"!=typeof window&&window.location?(t.data.metadata||(t.data.metadata={}),t.data.metadata.page_url=window.location.href,t.data.metadata.page_path=window.location.pathname,t.data.metadata.page_search=window.location.search,t.data.metadata.page_host=window.location.host,t.data.metadata.page_protocol=window.location.protocol,t.data.metadata.page_hash=window.location.hash,t.data.metadata.referrer=document.referrer||"",t.data.metadata.timestamp_url_injection=Date.now(),console.log("[URLInjectionStage] 🌐 URL generada automáticamente para page_view:",{page_url:t.data.metadata.page_url,page_path:t.data.metadata.page_path,page_search:t.data.metadata.page_search})):console.warn("[URLInjectionStage] ⚠️ No se puede acceder a window.location - entorno no es navegador")}return t}}},9419:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transports=void 0;const i=n(2071),s=n(8716),o=n(4480);e.transports={websocket:s.WS,webtransport:o.WT,polling:i.XHR}},9550:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((i=i.apply(t,e||[])).next())}))};function i(t,e){return n(this,void 0,void 0,(function*(){const n=`${localStorage.getItem("pixelEndpoint")}/pixel`,i=navigator.userAgent,s=yield fetch(`${n}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client:t,apiKey:e,userAgent:i})});if(!s.ok)throw new Error(`Error al registrar cliente: ${s.statusText}`);const o=yield s.json();return{access_token:o.access_token,refresh_token:o.refresh_token}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.fetchTokens=function(t){return n(this,void 0,void 0,(function*(){const e=`${localStorage.getItem("pixelEndpoint")}/pixel`,n=yield fetch(`${e}/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client:t})});if(!n.ok)throw new Error(`Error al obtener tokens: ${n.statusText}`);const i=yield n.json();return{access_token:i.access_token,refresh_token:i.refresh_token}}))},e.refreshToken=function(t){return n(this,void 0,void 0,(function*(){const e=`${localStorage.getItem("pixelEndpoint")}/pixel`,n=yield fetch(`${e}/token/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})}),i=yield n.json();if(!n.ok)throw new Error(`${i.message}`);return{access_token:i.access_token}}))},e.registerClient=i,e.ensureTokens=function(t,e){return n(this,void 0,void 0,(function*(){try{return yield i(t,e)}catch(t){throw new Error(`Error al intentar registrar y obtener tokens: ${t}`)}}))},e.isAccessTokenExpiring=function(t,e=60){try{const n=t.split(".")[1],i=atob(n),s=JSON.parse(i),o=Math.floor(Date.now()/1e3);return s.exp-o<e}catch(t){return console.error("Error al decodificar el token:",t),!0}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i=n(8156);return i.default})()));