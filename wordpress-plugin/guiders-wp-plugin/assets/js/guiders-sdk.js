!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GuidersPixel=t():e.GuidersPixel=t()}(this,(()=>(()=>{var e={343:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n=(t="string"==typeof e?(0,s.default)(e):e,Uint8Array.of((15&t[6])<<4|t[7]>>4&15,(15&t[7])<<4|(240&t[4])>>4,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,(15&t[1])<<4|(240&t[2])>>4,96|15&t[2],t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]));return"string"==typeof e?(0,o.unsafeStringify)(n):n};var i,s=(i=n(6792))&&i.__esModule?i:{default:i},o=n(9910)},401:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BotDetector=void 0,t.BotDetector=class{constructor(){this.score=0,this.checks=[]}detect(){return n(this,void 0,void 0,(function*(){this.checkUserAgent(),this.checkBrowserFeatures(),this.checkTiming(),yield this.checkBehavior();const e=this.score/this.checks.length;return{isBot:e>.6,probability:e,details:this.checks}}))}checkUserAgent(){const e=/bot|crawler|spider|scraper/i.test(navigator.userAgent);this.addCheck("userAgent",e,e?1:0)}checkBrowserFeatures(){const e=navigator.webdriver||!navigator.plugins.length||!window.MouseEvent;this.addCheck("browserFeatures",e,e?1:0)}checkTiming(){const e=performance.timing.loadEventEnd-performance.timing.navigationStart<100;this.addCheck("timing",e,e?.8:0)}checkBehavior(){return new Promise((e=>{let t=!1;["click","mousemove","keypress"].forEach((e=>{document.addEventListener(e,(()=>{t=!0}),{once:!0})})),setTimeout((()=>{this.addCheck("behavior",!t,t?0:1),e()}),1e3)}))}addCheck(e,t,n){this.checks.push({name:e,result:t}),this.score+=n}}},421:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenInjectionStage=void 0;const i=n(1921);t.TokenInjectionStage=class{process(e){return i.TokenManager.attachTokenToEvent(e)}}},528:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Polling=void 0;const s=n(4689),o=n(5374),a=n(6376),r=(0,i(n(7833)).default)("engine.io-client:polling");class c extends s.Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{r("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(r("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){r("pre-pause polling complete"),--e||t()}))),this.writable||(r("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){r("pre-pause writing complete"),--e||t()})))}else t()}_poll(){r("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){r("polling got data %s",e),(0,a.decodePayload)(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this._poll():r('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{r("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(r("transport open - closing"),e()):(r("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,(0,a.encodePayload)(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,o.randomString)()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}t.Polling=c},736:(e,t,n)=>{e.exports=function(e){function t(e){let n,s,o,a=null;function r(...e){if(!r.enabled)return;const i=r,s=Number(new Date),o=s-(n||s);i.diff=o,i.prev=n,i.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";a++;const o=t.formatters[s];if("function"==typeof o){const t=e[a];n=o.call(i,t),e.splice(a,1),a--}return n})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=i,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,o=t.enabled(e)),o),set:e=>{a=e}}),"function"==typeof t.init&&t.init(r),r}function i(e,n){const i=t(this.namespace+(void 0===n?":":n)+e);return i.log=this.log,i}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),s=i.length;for(n=0;n<s;n++)i[n]&&("-"===(e=i[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,i;for(n=0,i=t.skips.length;n<i;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;n<i;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(6585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s=(i=n(2858))&&i.__esModule?i:{default:i},o=n(9910),a=null,r=null,c=0;t.default=function(e,t,n){e=e||{};var i=t&&n||0,d=t||new Uint8Array(16),l=e.random||(e.rng||s.default)(),u=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.seq?e.seq:null,g=r,p=a;return u>c&&void 0===e.msecs&&(c=u,null!==h&&(g=null,p=null)),null!==h&&(h>2147483647&&(h=2147483647),g=h>>>19&4095,p=524287&h),null!==g&&null!==p||(g=(g=127&l[6])<<8|l[7],p=(p=(p=63&l[8])<<8|l[9])<<5|l[10]>>>3),u+1e4>c&&null===h?++p>524287&&(p=0,++g>4095&&(g=0,c++)):c=u,r=g,a=p,d[i++]=c/1099511627776&255,d[i++]=c/4294967296&255,d[i++]=c/16777216&255,d[i++]=c/65536&255,d[i++]=c/256&255,d[i++]=255&c,d[i++]=g>>>4&15|112,d[i++]=255&g,d[i++]=p>>>13&63|128,d[i++]=p>>>5&255,d[i++]=p<<3&255|7&l[10],d[i++]=l[11],d[i++]=l[12],d[i++]=l[13],d[i++]=l[14],d[i++]=l[15],t||(0,o.unsafeStringify)(d)}},969:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadMessagesService=void 0;const s=n(2597),o=n(3104);class a{constructor(){this.visitorId="",this.currentChatId=null,this.unreadCount=0,this.unreadMessages=[],this.onCountChangeCallback=null,this.debug=!1,this.wsService=o.WebSocketService.getInstance(),console.log("üì¨ [UnreadMessagesService] Instancia creada")}static getInstance(){return a.instance||(a.instance=new a),a.instance}initialize(e){this.visitorId=e.visitorId,this.onCountChangeCallback=e.onCountChange||null,this.debug=e.debug||!1,this.log("üöÄ Inicializando servicio con:",{visitorId:this.visitorId,hasCallback:!!this.onCountChangeCallback}),this.wsService.updateCallbacks({onMessage:e=>this.handleNewMessage(e)}),this.log("‚úÖ Servicio inicializado correctamente")}setCurrentChat(e){this.currentChatId!==e?(this.log("üìå Cambiando chat activo:",{anterior:this.currentChatId,nuevo:e}),this.currentChatId=e,this.refreshUnreadMessages()):this.log("Chat ya activo:",e)}getAuthHeaders(){const e={"Content-Type":"application/json"},t=sessionStorage.getItem("guiders_backend_session_id");t&&(e["X-Guiders-Sid"]=t);const n=localStorage.getItem("accessToken");return n&&(e.Authorization=`Bearer ${n}`),e}getFetchOptions(e="GET",t){return Object.assign({method:e,headers:this.getAuthHeaders(),credentials:"include"},t&&{body:t})}getApiUrl(){const e=s.EndpointManager.getInstance(),t=localStorage.getItem("pixelEndpoint")||e.getEndpoint();return t.endsWith("/api")?t:`${t}/api`}refreshUnreadMessages(){return i(this,void 0,void 0,(function*(){if(this.currentChatId){this.log("üîÑ Obteniendo mensajes no le√≠dos del chat:",this.currentChatId);try{const e=`${this.getApiUrl()}/v2/messages/chat/${this.currentChatId}/unread`,t=yield fetch(e,this.getFetchOptions("GET"));if(!t.ok){const e=yield t.text();throw console.error("[UnreadMessagesService] ‚ùå Error al obtener mensajes no le√≠dos:",e),new Error(`Error al obtener mensajes no le√≠dos (${t.status}): ${e}`)}const n=yield t.json();this.unreadMessages=n.filter((e=>e.senderId!==this.visitorId)),this.unreadCount=this.unreadMessages.length,this.log("‚úÖ Mensajes no le√≠dos obtenidos:",{total:n.length,filtrados:this.unreadCount,mensajes:this.unreadMessages.map((e=>({id:e.id,senderId:e.senderId})))}),this.notifyCountChange()}catch(e){console.error("[UnreadMessagesService] ‚ùå Error en refreshUnreadMessages:",e)}}else this.log("‚ö†Ô∏è No hay chat activo, omitiendo refresh")}))}markAsRead(e){return i(this,void 0,void 0,(function*(){if(0===e.length)return this.log("‚ö†Ô∏è No hay mensajes para marcar como le√≠dos"),!1;this.log("üìù Marcando mensajes como le√≠dos:",e);try{const t=`${this.getApiUrl()}/v2/messages/mark-as-read`,n=yield fetch(t,this.getFetchOptions("PUT",JSON.stringify({messageIds:e})));if(!n.ok){const e=yield n.text();return console.error("[UnreadMessagesService] ‚ùå Error al marcar mensajes como le√≠dos:",e),!1}const i=yield n.json();return this.log("‚úÖ Mensajes marcados como le√≠dos:",i.markedCount),this.unreadMessages=this.unreadMessages.filter((t=>!e.includes(t.id))),this.unreadCount=this.unreadMessages.length,this.notifyCountChange(),!0}catch(e){return console.error("[UnreadMessagesService] ‚ùå Error en markAsRead:",e),!1}}))}markAllAsRead(){return i(this,void 0,void 0,(function*(){const e=this.unreadMessages.map((e=>e.id));return this.markAsRead(e)}))}handleNewMessage(e){if(e.chatId!==this.currentChatId)return void this.log("‚ö†Ô∏è Mensaje de otro chat, ignorando");if(e.senderId===this.visitorId)return void this.log("üö´ Mensaje propio ignorado");if(e.isInternal)return void this.log("üîí Mensaje interno ignorado");this.log("üì® Nuevo mensaje no le√≠do recibido:",{messageId:e.messageId,senderId:e.senderId});const t={id:e.messageId,chatId:e.chatId,senderId:e.senderId,senderType:"commercial",content:e.content,type:e.type||"text",isRead:!1,readAt:null,readBy:null,createdAt:e.sentAt,updatedAt:e.sentAt,isInternal:e.isInternal||!1};this.unreadMessages.push(t),this.unreadCount=this.unreadMessages.length,this.log("‚úÖ Contador actualizado:",this.unreadCount),this.notifyCountChange()}notifyCountChange(){this.onCountChangeCallback&&(this.log("üì¢ Notificando cambio de contador:",this.unreadCount),this.onCountChangeCallback(this.unreadCount))}getUnreadCount(){return this.unreadCount}getUnreadMessages(){return[...this.unreadMessages]}reset(){this.unreadMessages=[],this.unreadCount=0,this.currentChatId=null,this.notifyCountChange(),this.log("üîÑ Servicio reseteado")}log(...e){this.debug&&console.log("üì¨ [UnreadMessagesService]",...e)}}t.UnreadMessagesService=a,a.instance=null},1015:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),o=e.indexOf("]");-1!=s&&-1!=o&&(e=e.substring(0,s)+e.substring(s,o).replace(/:/g,";")+e.substring(o,e.length));let a=n.exec(e||""),r={},c=14;for(;c--;)r[i[c]]=a[c]||"";return-1!=s&&-1!=o&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}(0,r.path),r.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}(0,r.query),r};const n=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]},1034:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeuristicElementDetector=void 0;const i=n(6932);t.HeuristicElementDetector=class{constructor(e={}){this.heuristicRules={add_to_cart:[{selector:'button, input[type="submit"], a',confidence:i.ConfidenceLevel.HIGH,textPatterns:["a√±adir","agregar","add to cart","add cart","comprar","buy"],attributePatterns:{class:"cart",id:"cart"},contextSelectors:['[class*="product"]','[class*="item"]','[class*="cart"]']},{selector:'input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,attributePatterns:{value:"carrito"}},{selector:'a[href*="cart"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["add","a√±adir"]}],contact_dealer:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["contactar","contact","concesionario","dealer"],contextSelectors:['[class*="dealer"]','[class*="contact"]','form[class*="contact"]']},{selector:'form input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['form[class*="contact"]','form[id*="contact"]']}],search_submit:[{selector:'button[type="submit"], input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,contextSelectors:['form[class*="search"]','[class*="filter"]','[class*="search"]']},{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["buscar","search","filtrar","filter"]}],schedule_test_drive:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["test drive","prueba","conducir","probar","cita"],contextSelectors:['[class*="vehicle"]','[class*="car"]','[class*="auto"]']}],request_quote:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["cotizar","quote","presupuesto","precio","solicitar"],contextSelectors:['[class*="vehicle"]','[class*="product"]','[class*="price"]']}],view_product:[{selector:"a, div, article",confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['[class*="product"]','[class*="item"]','[class*="card"]'],attributePatterns:{href:"product"}}],purchase:[{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["comprar","buy","purchase","pagar","pay","checkout"],contextSelectors:['[class*="checkout"]','[class*="payment"]','[class*="buy"]']}],view_cart:[{selector:"a, button, div",confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["carrito","cart","basket"],attributePatterns:{href:"cart",class:"cart"}}],download_brochure:[{selector:"a, button",confidence:i.ConfidenceLevel.HIGH,textPatterns:["descargar","download","brochure","folleto","cat√°logo","pdf"],attributePatterns:{href:".pdf"}}]},this.config=Object.assign({enabled:!0,confidenceThreshold:i.ConfidenceLevel.MEDIUM,fallbackToManual:!0},e),e.customRules&&(this.heuristicRules=Object.assign(Object.assign({},this.heuristicRules),e.customRules))}detectElements(e){if(!this.config.enabled)return[];const t=this.heuristicRules[e];if(!t||0===t.length)return[];const n=[];for(const i of t){const t=this.findElementsByRule(i);for(const s of t){const t=this.calculateConfidence(s,i);t>=this.config.confidenceThreshold&&n.push({element:s,eventType:e,confidence:t,matchedRule:i})}}return this.deduplicateResults(n).sort(((e,t)=>t.confidence-e.confidence))}findElementsByRule(e){return Array.from(document.querySelectorAll(e.selector)).filter((t=>this.elementMatchesRule(t,e)))}elementMatchesRule(e,t){var n,i;if(t.textPatterns){const i=(null===(n=e.textContent)||void 0===n?void 0:n.toLowerCase())||"";if(!t.textPatterns.some((e=>i.includes(e.toLowerCase()))))return!1}if(t.attributePatterns)for(const[n,s]of Object.entries(t.attributePatterns))if(!((null===(i=e.getAttribute(n))||void 0===i?void 0:i.toLowerCase())||"").includes(s.toLowerCase()))return!1;return!(t.contextSelectors&&!t.contextSelectors.some((t=>null!==e.closest(t)||null!==e.querySelector(t))))}calculateConfidence(e,t){var n;let i=t.confidence;if(t.textPatterns){const s=(null===(n=e.textContent)||void 0===n?void 0:n.toLowerCase())||"";i+=.1*t.textPatterns.filter((e=>s===e.toLowerCase())).length}if(t.attributePatterns){const n=Object.entries(t.attributePatterns).filter((([t,n])=>{var i;return((null===(i=e.getAttribute(t))||void 0===i?void 0:i.toLowerCase())||"").includes(n.toLowerCase())})).length;i+=.05*n}return Math.min(i,1)}deduplicateResults(e){const t=new Set;return e.filter((e=>!t.has(e.element)&&(t.add(e.element),!0)))}getConfig(){return Object.assign({},this.config)}updateConfig(e){this.config=Object.assign(Object.assign({},this.config),e)}addCustomRules(e,t){this.heuristicRules[e]||(this.heuristicRules[e]=[]),this.heuristicRules[e].push(...t)}}},1556:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSignal=t.Signal=void 0;class i{constructor(e=null){this.subscribers=[],this.state={loading:!1,data:e,error:null}}subscribe(e){return this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);t>=0&&this.subscribers.splice(t,1)}}unsubscribe(e){const t=this.subscribers.indexOf(e);t>=0&&this.subscribers.splice(t,1)}getState(){return Object.assign({},this.state)}getValue(){return this.state.data}isLoading(){return this.state.loading}hasError(){return null!==this.state.error}setState(e){const t=Object.assign({},this.state);this.state=Object.assign(Object.assign({},this.state),e),this.hasStateChanged(t,this.state)&&this.notifySubscribers()}notifySubscribers(){this.subscribers.forEach((e=>{try{e(this.getState())}catch(e){console.warn("[Signal] Error en subscriber:",e)}}))}hasStateChanged(e,t){return e.loading!==t.loading||e.data!==t.data||e.error!==t.error}setLoading(){this.setState({loading:!0,error:null})}setSuccess(e){this.setState({loading:!1,data:e,error:null})}setError(e){this.setState({loading:!1,error:e})}reset(){this.setState({loading:!1,data:null,error:null})}dispose(){this.subscribers.length=0}}t.Signal=i,t.AsyncSignal=class extends i{constructor(){super(...arguments),this.currentPromise=null,this.promiseId=0}execute(e){return n(this,void 0,void 0,(function*(){const t=++this.promiseId;this.setLoading();try{const n=e();this.currentPromise=n;const i=yield n;return this.promiseId===t?(this.setSuccess(i),this.currentPromise=null,i):(console.warn("[AsyncSignal] ‚ö†Ô∏è Operaci√≥n cancelada - reemplazada por una m√°s reciente (ID:",t,"‚Üí",this.promiseId,")"),i)}catch(e){throw this.promiseId===t?(this.setError(e instanceof Error?e:new Error(String(e))),this.currentPromise=null):console.warn("[AsyncSignal] ‚ö†Ô∏è Error en operaci√≥n cancelada (ID:",t,") - ignorando"),e}}))}cancel(){this.currentPromise&&(this.promiseId++,this.currentPromise=null,this.setState({loading:!1}))}isPending(){return null!==this.currentPromise}}},1688:(e,t)=>{"use strict";function n(e){return e.replace(/\s+/g,"").replace(/\/+$/,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.resolveDefaultEndpoints=function(){const e="undefined"!=typeof window&&window.GUIDERS_CONFIG?window.GUIDERS_CONFIG:{};let t=null;try{if("undefined"!=typeof window&&(t=new URL(window.location.href).searchParams.get("dev"),!t&&"undefined"!=typeof document)){let e=document.currentScript||null;if(e||(e=Array.from(document.getElementsByTagName("script")).find((e=>/index\.js/.test(e.src)))||null),e&&e.src)try{t=new URL(e.src,window.location.origin).searchParams.get("dev")}catch(e){}}}catch(e){}const i=!!t&&!/^0|false$/i.test(t);let s;s="production"===e.environment||"development"!==e.environment&&!i;const o="undefined"!=typeof process?"https://guiders.es/api":void 0,a="undefined"!=typeof process?"wss://guiders.es":void 0;let r=e.endpoint||o||(s?"https://guiders.es/api":"http://localhost:3000/api"),c=e.webSocketEndpoint||a||(s?"wss://guiders.es":"ws://localhost:3000");return r=n(r),c=n(c),{endpoint:r,webSocketEndpoint:c,isProd:s}}},1750:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1921:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TokenManager=void 0;class i{static subscribeToTokenChanges(e){this.tokenChangeSubscribers.push(e)}static unsubscribeFromTokenChanges(e){const t=this.tokenChangeSubscribers.indexOf(e);t>=0&&this.tokenChangeSubscribers.splice(t,1)}static notifyTokenChange(e){this.tokenChangeSubscribers.forEach((t=>t(e)))}static setTokens(e){this.accessToken=e.access_token,this.refreshToken=e.refresh_token,localStorage.setItem("accessToken",e.access_token),localStorage.setItem("refreshToken",e.refresh_token),this.setExpirationTime(e.access_token)}static setAccessToken(e){this.accessToken=e,localStorage.setItem("accessToken",e),this.setExpirationTime(e)}static isTokenExpiring(e=60){if(!this.expirationTime)return!0;const t=Math.floor(Date.now()/1e3);return this.expirationTime-t<e}static getValidAccessToken(){return n(this,void 0,void 0,(function*(){return this.isTokenExpiring()?(console.log("Access token expirando, solicitando nuevos tokens..."),console.log("‚ùå No hay servicio de tokens disponible."),null):this.accessToken}))}static loadTokensFromStorage(){try{const e=localStorage.getItem("accessToken"),t=localStorage.getItem("refreshToken"),n=localStorage.getItem("tokenExpiration");if(!e||!t||!n)return!1;const i=parseInt(n,10);return!(isNaN(i)||i<=0||(this.accessToken=e,this.refreshToken=t,this.expirationTime=i,0))}catch(e){return console.error("Error al cargar tokens desde almacenamiento:",e),!1}}static hasValidTokens(){return!!this.accessToken&&!!this.refreshToken}static attachTokenToEvent(e){return this.accessToken?(console.log("üîí Adjuntando token al evento."),Object.assign(Object.assign({},e),{token:this.accessToken})):(console.error("No hay access token disponible."),e)}static startTokenMonitor(){this.tokenMonitorInterval?console.warn("Token monitor ya est√° corriendo."):(this.tokenMonitorInterval=setInterval((()=>n(this,void 0,void 0,(function*(){if(console.log("‚è≥ Verificando el estado del token..."),this.isTokenExpiring()){console.log("‚ö†Ô∏è Token a punto de expirar, intentando refrescar...");const e=yield this.getValidAccessToken();e?(this.notifyTokenChange(e),console.log("‚úÖ Token refrescado autom√°ticamente.")):console.error("‚ùå No se pudo refrescar el token.")}}))),1e4),console.log("üü¢ Token monitor iniciado."))}static stopTokenMonitor(){this.tokenMonitorInterval&&(clearInterval(this.tokenMonitorInterval),this.tokenMonitorInterval=null,console.log("üõë Token monitor detenido."))}static setExpirationTime(e){try{const t=e.split(".")[1],n=atob(t),i=JSON.parse(n);this.expirationTime=i.exp,localStorage.setItem("tokenExpiration",i.exp.toString())}catch(e){console.error("Error al decodificar el token:",e),this.expirationTime=null}}}t.TokenManager=i,i.accessToken=null,i.refreshToken=null,i.expirationTime=null,i.tokenMonitorInterval=null,i.tokenChangeSubscribers=[]},1999:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationStage=void 0,t.ValidationStage=class{constructor(e="session"){this.authMode=e}process(e){if(!e.type)throw new Error("El evento debe tener un tipo");if(!e.data)throw new Error("El evento debe tener datos");if(!e.timestamp)throw new Error("El evento debe tener una marca de tiempo");if("jwt"===this.authMode&&!e.token)throw new Error("El evento debe tener un token en modo JWT");return e}}},2046:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_PACKET=t.PACKET_TYPES_REVERSE=t.PACKET_TYPES=void 0;const n=Object.create(null);t.PACKET_TYPES=n,n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const i=Object.create(null);t.PACKET_TYPES_REVERSE=i,Object.keys(n).forEach((e=>{i[n[e]]=e})),t.ERROR_PACKET={type:"error",data:"parser error"}},2071:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.XHR=t.Request=t.BaseXHR=void 0;const s=n(528),o=n(4454),a=n(5374),r=n(4624),c=n(4110),d=(0,i(n(7833)).default)("engine.io-client:polling");function l(){}class u extends s.Polling{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){d("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}t.BaseXHR=u;class h extends o.Emitter{constructor(e,t,n){super(),this.createRequest=e,(0,a.installTimerFunctions)(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=(0,a.pick)(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{d("xhr open %s: %s",this._method,this._uri),n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(e){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof n.status?n.status:0)}),0))},d("xhr data %s",this._data),n.send(this._data)}catch(e){return void this.setTimeoutFn((()=>{this._onError(e)}),0)}"undefined"!=typeof document&&(this._index=h.requestsCount++,h.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=l,e)try{this._xhr.abort()}catch(e){}"undefined"!=typeof document&&delete h.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(t.Request=h,h.requestsCount=0,h.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",g);else if("function"==typeof addEventListener){const e="onpagehide"in r.globalThisShim?"pagehide":"unload";addEventListener(e,g,!1)}function g(){for(let e in h.requests)h.requests.hasOwnProperty(e)&&h.requests[e].abort()}const p=function(){const e=f({xdomain:!1});return e&&null!==e.responseType}();function f(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||c.hasCORS))return new XMLHttpRequest}catch(e){}if(!t)try{return new(r.globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}t.XHR=class extends u{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=p&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new h(f,this.uri(),e)}}},2090:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsentManager=void 0;class n{constructor(e={}){var t;this.listeners=new Set,this.STORAGE_KEY="guiders_consent_state",this.config={defaultStatus:e.defaultStatus||"pending",storageKey:e.storageKey||this.STORAGE_KEY,version:e.version||"1.0.0",waitForConsent:null===(t=e.waitForConsent)||void 0===t||t,onConsentChange:e.onConsentChange||(()=>{})};const n=this.loadState();n?this.state=n:(this.state=this.createInitialState(),"granted"===this.config.defaultStatus&&(this.state.preferences={analytics:!0,functional:!0,personalization:!0},this.saveState(),console.log("[ConsentManager] ‚úÖ Estado inicial con consentimiento otorgado guardado"))),console.log("[ConsentManager] üîê Inicializado con estado:",this.state)}static getInstance(e){return n.instance||(n.instance=new n(e)),n.instance}static resetInstance(){n.instance=null}createInitialState(){return{status:this.config.defaultStatus,timestamp:Date.now(),version:this.config.version,preferences:{analytics:!1,functional:!1,personalization:!1}}}loadState(){try{if("undefined"==typeof localStorage)return null;const e=localStorage.getItem(this.config.storageKey);if(!e)return null;const t=JSON.parse(e);return console.log("[ConsentManager] üíæ Estado cargado desde localStorage:",t),t}catch(e){return console.error("[ConsentManager] ‚ùå Error cargando estado:",e),null}}saveState(){try{if("undefined"==typeof localStorage)return void console.warn("[ConsentManager] ‚ö†Ô∏è localStorage no disponible");localStorage.setItem(this.config.storageKey,JSON.stringify(this.state)),console.log("[ConsentManager] üíæ Estado guardado:",this.state)}catch(e){console.error("[ConsentManager] ‚ùå Error guardando estado:",e)}}notifyListeners(){if(this.listeners.forEach((e=>{try{e(this.state)}catch(e){console.error("[ConsentManager] ‚ùå Error en listener:",e)}})),this.config.onConsentChange)try{this.config.onConsentChange(this.state)}catch(e){console.error("[ConsentManager] ‚ùå Error en onConsentChange callback:",e)}}getState(){return Object.assign({},this.state)}getStatus(){return this.state.status}isGranted(){return"granted"===this.state.status}isDenied(){return"denied"===this.state.status}isPending(){return"pending"===this.state.status}shouldWaitForConsent(){return this.config.waitForConsent&&this.isPending()}isTrackingAllowed(){return!this.config.waitForConsent||this.isGranted()}isCategoryAllowed(e){var t,n;return!!this.isGranted()&&null!==(n=null===(t=this.state.preferences)||void 0===t?void 0:t[e])&&void 0!==n&&n}grantConsent(){console.log("[ConsentManager] ‚úÖ Consentimiento otorgado"),this.state={status:"granted",timestamp:Date.now(),version:this.config.version,preferences:{analytics:!0,functional:!0,personalization:!0}},this.saveState(),this.notifyListeners()}grantConsentWithPreferences(e){var t,n,i;console.log("[ConsentManager] ‚úÖ Consentimiento otorgado con preferencias:",e),this.state={status:"granted",timestamp:Date.now(),version:this.config.version,preferences:{analytics:null===(t=e.analytics)||void 0===t||t,functional:null===(n=e.functional)||void 0===n||n,personalization:null===(i=e.personalization)||void 0===i||i}},this.saveState(),this.notifyListeners()}denyConsent(){console.log("[ConsentManager] ‚ùå Consentimiento denegado"),this.state={status:"denied",timestamp:Date.now(),version:this.config.version,preferences:{analytics:!1,functional:!1,personalization:!1}},this.saveState(),this.notifyListeners()}revokeConsent(){console.log("[ConsentManager] üîÑ Consentimiento revocado"),this.denyConsent()}resetConsent(){console.log("[ConsentManager] üîÑ Consentimiento reseteado a pending"),this.state=this.createInitialState(),this.saveState(),this.notifyListeners()}subscribe(e){return this.listeners.add(e),e(this.state),()=>{this.listeners.delete(e)}}clearConsentData(){try{"undefined"!=typeof localStorage&&(localStorage.removeItem(this.config.storageKey),console.log("[ConsentManager] üóëÔ∏è Datos de consentimiento eliminados"))}catch(e){console.error("[ConsentManager] ‚ùå Error eliminando datos de consentimiento:",e)}}updateVersion(e){this.state.version=e,this.saveState(),console.log("[ConsentManager] üì¶ Versi√≥n actualizada a:",e)}needsRenewal(e){return this.state.version!==e&&this.isGranted()}exportState(){return JSON.stringify(Object.assign(Object.assign({},this.state),{exportedAt:(new Date).toISOString()}),null,2)}}t.ConsentManager=n},2311:(e,t)=>{"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function i(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,o,a){return i((r=i(i(t,e),i(s,a)))<<(c=o)|r>>>32-c,n);var r,c}function o(e,t,n,i,o,a,r){return s(t&n|~t&i,e,t,o,a,r)}function a(e,t,n,i,o,a,r){return s(t&i|n&~i,e,t,o,a,r)}function r(e,t,n,i,o,a,r){return s(t^n^i,e,t,o,a,r)}function c(e,t,n,i,o,a,r){return s(n^(t|~i),e,t,o,a,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var s=0;s<t.length;++s)e[s]=t.charCodeAt(s)}return function(e){for(var t=[],n=32*e.length,i="0123456789abcdef",s=0;s<n;s+=8){var o=e[s>>5]>>>s%32&255,a=parseInt(i.charAt(o>>>4&15)+i.charAt(15&o),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var s=1732584193,d=-271733879,l=-1732584194,u=271733878,h=0;h<e.length;h+=16){var g=s,p=d,f=l,m=u;s=o(s,d,l,u,e[h],7,-680876936),u=o(u,s,d,l,e[h+1],12,-389564586),l=o(l,u,s,d,e[h+2],17,606105819),d=o(d,l,u,s,e[h+3],22,-1044525330),s=o(s,d,l,u,e[h+4],7,-176418897),u=o(u,s,d,l,e[h+5],12,1200080426),l=o(l,u,s,d,e[h+6],17,-1473231341),d=o(d,l,u,s,e[h+7],22,-45705983),s=o(s,d,l,u,e[h+8],7,1770035416),u=o(u,s,d,l,e[h+9],12,-1958414417),l=o(l,u,s,d,e[h+10],17,-42063),d=o(d,l,u,s,e[h+11],22,-1990404162),s=o(s,d,l,u,e[h+12],7,1804603682),u=o(u,s,d,l,e[h+13],12,-40341101),l=o(l,u,s,d,e[h+14],17,-1502002290),s=a(s,d=o(d,l,u,s,e[h+15],22,1236535329),l,u,e[h+1],5,-165796510),u=a(u,s,d,l,e[h+6],9,-1069501632),l=a(l,u,s,d,e[h+11],14,643717713),d=a(d,l,u,s,e[h],20,-373897302),s=a(s,d,l,u,e[h+5],5,-701558691),u=a(u,s,d,l,e[h+10],9,38016083),l=a(l,u,s,d,e[h+15],14,-660478335),d=a(d,l,u,s,e[h+4],20,-405537848),s=a(s,d,l,u,e[h+9],5,568446438),u=a(u,s,d,l,e[h+14],9,-1019803690),l=a(l,u,s,d,e[h+3],14,-187363961),d=a(d,l,u,s,e[h+8],20,1163531501),s=a(s,d,l,u,e[h+13],5,-1444681467),u=a(u,s,d,l,e[h+2],9,-51403784),l=a(l,u,s,d,e[h+7],14,1735328473),s=r(s,d=a(d,l,u,s,e[h+12],20,-1926607734),l,u,e[h+5],4,-378558),u=r(u,s,d,l,e[h+8],11,-2022574463),l=r(l,u,s,d,e[h+11],16,1839030562),d=r(d,l,u,s,e[h+14],23,-35309556),s=r(s,d,l,u,e[h+1],4,-1530992060),u=r(u,s,d,l,e[h+4],11,1272893353),l=r(l,u,s,d,e[h+7],16,-155497632),d=r(d,l,u,s,e[h+10],23,-1094730640),s=r(s,d,l,u,e[h+13],4,681279174),u=r(u,s,d,l,e[h],11,-358537222),l=r(l,u,s,d,e[h+3],16,-722521979),d=r(d,l,u,s,e[h+6],23,76029189),s=r(s,d,l,u,e[h+9],4,-640364487),u=r(u,s,d,l,e[h+12],11,-421815835),l=r(l,u,s,d,e[h+15],16,530742520),s=c(s,d=r(d,l,u,s,e[h+2],23,-995338651),l,u,e[h],6,-198630844),u=c(u,s,d,l,e[h+7],10,1126891415),l=c(l,u,s,d,e[h+14],15,-1416354905),d=c(d,l,u,s,e[h+5],21,-57434055),s=c(s,d,l,u,e[h+12],6,1700485571),u=c(u,s,d,l,e[h+3],10,-1894986606),l=c(l,u,s,d,e[h+10],15,-1051523),d=c(d,l,u,s,e[h+1],21,-2054922799),s=c(s,d,l,u,e[h+8],6,1873313359),u=c(u,s,d,l,e[h+15],10,-30611744),l=c(l,u,s,d,e[h+6],15,-1560198380),d=c(d,l,u,s,e[h+13],21,1309151649),s=c(s,d,l,u,e[h+4],6,-145523070),u=c(u,s,d,l,e[h+11],10,-1120210379),l=c(l,u,s,d,e[h+2],15,718787259),d=c(d,l,u,s,e[h+9],21,-343485551),s=i(s,g),d=i(d,p),l=i(l,f),u=i(u,m)}return[s,d,l,u]}(function(e){if(0===e.length)return[];for(var t=8*e.length,i=new Uint32Array(n(t)),s=0;s<t;s+=8)i[s>>5]|=(255&e[s/8])<<s%32;return i}(e),8*e.length))}},2326:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DevRandomMessages=void 0;const s=n(7686),o=n(1688);class a{constructor(){this.config={enabled:!1,minInterval:1e3,maxInterval:3e3,messageCount:5},this.isActive=!1,this.chatId=null,this.randomMessages=["¬øTienen descuentos disponibles?","¬øCu√°l es el tiempo de entrega?","¬øAceptan devoluciones?","¬øTienen garant√≠a los productos?","¬øCu√°les son los m√©todos de pago?","¬øHacen env√≠os internacionales?","¬øHay stock del producto?","¬øCu√°ndo llega la nueva colecci√≥n?","¬øTienen tallas m√°s grandes?","¬øPuedo cambiar el producto?","Me gusta mucho este producto","Estoy interesado en m√°s informaci√≥n","¬øHay m√°s colores disponibles?","El precio est√° bien üëç","Necesito ayuda para elegir","Muy buena calidad","Perfecto para lo que busco","Excelente atenci√≥n al cliente","Recomendado por un amigo","Primera vez que compro aqu√≠","Testing scroll infinito üß™","Verificando respuestas autom√°ticas","Probando notificaciones","Test de rendimiento del chat","Debug de mensajes largos: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Validando funcionalidad de chat","Prueba de carga de mensajes","Testing de latencia","Verificando persistencia","Test de reconexi√≥n","üòÄ ¬°Excelente servicio!","üõí Quiero comprar esto","‚ùì Tengo una pregunta","‚≠ê 5 estrellas para esta tienda","üöÄ Muy r√°pido el env√≠o","üíù Perfecto como regalo","üî• Oferta incre√≠ble","üëå Todo perfecto","üíØ Recomendado al 100%","üéâ ¬°Genial!","Hola","Gracias","Perfecto","OK","Entendido","Genial","Bien","Claro","Por supuesto","Muchas gracias","Mensaje con\nnueva l√≠nea","Texto con 'comillas' y \"comillas dobles\"","Caracteres especiales: √±√ë√°√©√≠√≥√∫√Å√â√ç√ì√ö","N√∫meros: 123 - 456.78 - $99.99","Enlaces: https://ejemplo.com","Mensaje muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy muy largo para testing","Emojis m√∫ltiples: üéØüöÄüí¨üî•‚≠êüëçüõíüíùüéâ","TEXTO EN MAY√öSCULAS","texto en min√∫sculas","CaMeLcAsE tExTo","¬øCu√°nto cuesta el env√≠o?","¬øPuedo pagar a plazos?","¬øHay descuento por volumen?","¬øCu√°l es la pol√≠tica de privacidad?","¬øTienen programa de fidelidad?","¬øHacen facturaci√≥n empresarial?","¬øPuedo recoger en tienda?","¬øTienen chat 24/7?","¬øCu√°l es el horario de atenci√≥n?","¬øPuedo hablar con un humano?","Estoy muy contento con la compra","El producto lleg√≥ defectuoso","Super√≥ mis expectativas","No es lo que esperaba","Calidad-precio excelente","Tard√≥ m√°s de lo prometido","El empaque fue perfecto","Falta una pieza","Todo como en la descripci√≥n","La foto no coincide","¬øEs mejor que la marca X?","¬øCu√°l es la diferencia con el modelo anterior?","¬øVale la pena el upgrade?","¬øQu√© ventajas tiene?","¬øEs compatible con mi dispositivo?","¬øIncluye accesorios?","¬øViene con garant√≠a extendida?","¬øHay versi√≥n premium?","¬øCu√°l me recomiendan?","¬øEs el m√°s vendido?","S√≠mbolos: @#$%^&*()_+-=[]{}|;:,.<>?","Acentos: √†√°√¢√£√§√•√¶√ß√®√©√™√´√¨√≠√Æ√Ø√∞√±√≤√≥√¥√µ√∂√∏√π√∫√ª√º√Ω√æ√ø","Matem√°ticas: ‚àë‚àè‚àÜ‚àá‚àÇ‚à´‚àû¬±‚â†‚â§‚â•‚âà‚â°‚àö‚àù‚àà‚àâ‚à™‚à©‚äÇ‚äÉ","Monetario: $‚Ç¨¬£¬•‚Çπ‚ÇΩ‚Ç©‚Ç¶‚Ç®‚Ç°‚Ç™‚Ç´‚Ç±‚Ç°","Fracciones: ¬Ω‚Öì‚Öî¬º¬æ‚Öõ‚Öú‚Öù‚Öû","Quiero 2 unidades","Necesito 10 para mi empresa","¬øHay descuento desde 50 unidades?","Solo 1 por favor","¬øPuedo comprar 100?","M√°ximo 5 unidades","¬øCu√°ntos quedan en stock?","M√≠nimo pedido 25 piezas","Lote de 12 unidades","Precio por mayoreo 500+"],this.init()}static getInstance(){return a.instance||(a.instance=new a),a.instance}init(){(0,o.resolveDefaultEndpoints)().isProd?console.log("üé≤ [DevRandomMessages] ‚ùå Deshabilitado en modo producci√≥n"):(this.config.enabled=!0,console.log("üé≤ [DevRandomMessages] ‚úÖ Inicializado en modo desarrollo"),this.interceptChatInput())}interceptChatInput(){"undefined"!=typeof window&&(window.addEventListener("guidersDevCommand",(e=>{this.handleDevCommand(e.detail)})),console.log("üé≤ [DevRandomMessages] üéØ Interceptor de comandos configurado"))}handleDevCommand(e){if(!this.config.enabled||this.isActive)return;const{command:t,text:n,count:i,chatId:s}=e;if("random"===t)if(console.log(`üé≤ [DevRandomMessages] üéØ Comando detectado: ${n}`),null!==i){const e=200,t=Math.min(i,e);i>e&&console.warn(`üé≤ [DevRandomMessages] ‚ö†Ô∏è N√∫mero solicitado (${i}) excede el l√≠mite m√°ximo (${e}). Usando ${t} mensajes.`),console.log(`üé≤ [DevRandomMessages] üéØ Comando #random:${i} detectado, generando ${t} mensajes`);const n=this.config.messageCount;this.config.messageCount=t,this.chatId=s,this.startRandomMessages().finally((()=>{this.config.messageCount=n}))}else console.log("üé≤ [DevRandomMessages] üéØ Comando #random detectado (cantidad por defecto)"),this.chatId=s,this.startRandomMessages()}startRandomMessages(){return i(this,void 0,void 0,(function*(){if(!this.isActive&&this.chatId){this.isActive=!0,console.log(`üé≤ [DevRandomMessages] üöÄ Iniciando generaci√≥n de ${this.config.messageCount} mensajes aleatorios`);try{let e=this.config.minInterval,t=this.config.maxInterval;this.config.messageCount>50&&(e=Math.max(300,this.config.minInterval/2),t=Math.max(800,this.config.maxInterval/2),console.log(`üé≤ [DevRandomMessages] ‚ö° Usando intervalos optimizados para ${this.config.messageCount} mensajes: ${e}-${t}ms`));for(let n=0;n<this.config.messageCount;n++){const i=this.randomBetween(e,t);yield this.sleep(i);const s=this.getRandomMessage();yield this.sendRandomMessage(s),console.log(`üé≤ [DevRandomMessages] üì§ Mensaje ${n+1}/${this.config.messageCount}: "${s}"`)}}catch(e){console.error("üé≤ [DevRandomMessages] ‚ùå Error generando mensajes:",e)}finally{this.isActive=!1,console.log("üé≤ [DevRandomMessages] ‚úÖ Generaci√≥n de mensajes completada")}}}))}sendRandomMessage(e){return i(this,void 0,void 0,(function*(){if(!this.chatId)throw new Error("No hay chat ID disponible");try{yield s.ChatV2Service.getInstance().sendMessage(this.chatId,e,"text")}catch(e){throw console.warn("üé≤ [DevRandomMessages] ‚ö†Ô∏è Error enviando mensaje:",e),e}}))}getRandomMessage(){const e=Math.floor(Math.random()*this.randomMessages.length);return this.randomMessages[e]}randomBetween(e,t){return Math.floor(Math.random()*(t-e+1))+e}sleep(e){return new Promise((t=>setTimeout(t,e)))}setConfig(e){this.config=Object.assign(Object.assign({},this.config),e),console.log("üé≤ [DevRandomMessages] ‚öôÔ∏è Configuraci√≥n actualizada:",this.config)}getConfig(){return Object.assign({},this.config)}isEnabled(){return this.config.enabled}isGenerating(){return this.isActive}triggerRandomMessages(e,t){return i(this,void 0,void 0,(function*(){if(this.config.enabled)if(void 0!==t){const n=200,i=Math.min(t,n);t>n&&console.warn(`üé≤ [DevRandomMessages] ‚ö†Ô∏è N√∫mero solicitado (${t}) excede el l√≠mite m√°ximo (${n}). Usando ${i} mensajes.`);const s=this.config.messageCount;this.config.messageCount=i,this.chatId=e,yield this.startRandomMessages().finally((()=>{this.config.messageCount=s}))}else this.chatId=e,yield this.startRandomMessages();else console.warn("üé≤ [DevRandomMessages] ‚ö†Ô∏è No est√° habilitado en este entorno")}))}addCustomMessages(e){this.randomMessages.push(...e),console.log(`üé≤ [DevRandomMessages] ‚ûï Agregados ${e.length} mensajes personalizados`)}}t.DevRandomMessages=a,a.instance=null,"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{a.getInstance()})):a.getInstance()),t.default=a},2588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelineProcessorBuilder=t.PipelineProcessor=void 0;class n{constructor(e=[]){this.stages=e}process(e){let t;for(const n of this.stages)try{t=n.process(e),e=t,console.log(`Procesando evento con ${n.constructor.name}`)}catch(e){console.error(`Error en el pipeline: ${e}`);break}if(!t)throw new Error("No se pudo procesar el evento");return console.log("Evento procesado:",t),t}}t.PipelineProcessor=n,t.PipelineProcessorBuilder=class{constructor(){this.stages=[]}addStage(e){return this.stages.push(e),this}build(){return new n(this.stages)}}},2597:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingPixelSDK=t.EndpointManager=void 0;const o=n(9126),a=n(2588),r=n(1921),c=n(4815),d=n(421),l=n(1999),u=n(5861),h=n(9329),g=n(4476),p=n(3735),f=n(2919),m=n(7183),b=n(7785),v=n(7686),y=n(1688),w=n(5558),C=n(2969),S=n(9167),k=n(2831),x=n(6808),I=n(2895),T=n(6420),M=n(4412),E=n(5303),_=n(6571),P=n(3104),L=n(7696),D=n(2090),O=n(4968),A=n(4729),j=n(3974);class R{constructor(e,t){this.endpoint=e,this.webSocketEndpoint=t}static getInstance(e,t){if(R.instance)(e||t)&&(e&&(R.instance.endpoint=e),t&&(R.instance.webSocketEndpoint=t));else{const n=(0,y.resolveDefaultEndpoints)();R.instance=new R(e||n.endpoint,t||n.webSocketEndpoint)}return R.instance}static setInstance(e,t){R.instance?(R.instance.endpoint=e,R.instance.webSocketEndpoint=t):R.instance=new R(e,t)}getEndpoint(){return this.endpoint}getWebSocketEndpoint(){return this.webSocketEndpoint}setEndpoint(e){this.endpoint=e}setWebSocketEndpoint(e){this.webSocketEndpoint=e}}t.EndpointManager=R,t.TrackingPixelSDK=class{constructor(e){var t,n,i,s,o,r,f,m,b,v,w,C,S,k,M,A,U;this.pipelineBuilder=new a.PipelineProcessorBuilder,this.eventQueue=[],this.fingerprint=null,this.chatUI=null,this.chatMessagesUI=null,this.chatToggleButton=null,this.autoFlush=!1,this.flushInterval=1e4,this.flushTimer=null,this.maxRetries=3,this.listeners=new Map,this.sessionTrackingManager=null,this.visitorHeartbeatTimer=null,this.identifyExecuted=!1,this.consentBanner=null;const B=(0,y.resolveDefaultEndpoints)(),N=e.endpoint||B.endpoint,V=e.webSocketEndpoint||B.webSocketEndpoint;if(R.setInstance(N,V),this.endpoint=N,this.webSocketEndpoint=V,this.apiKey=e.apiKey,this.authMode=e.authMode||"session",this.autoFlush=null!==(t=e.autoFlush)&&void 0!==t&&t,this.flushInterval=null!==(n=e.flushInterval)&&void 0!==n?n:1e4,this.maxRetries=null!==(i=e.maxRetries)&&void 0!==i?i:3,this.welcomeMessageConfig=e.welcomeMessage||{enabled:!0,style:"friendly",includeEmojis:!0,language:"es",showTips:!0},this.chatPositionConfig=e.chatPosition,e.activeHours&&e.activeHours.enabled){const t={enabled:!0,ranges:e.activeHours.ranges||[],timezone:e.activeHours.timezone,fallbackMessage:e.activeHours.fallbackMessage},n=_.ActiveHoursValidator.validateConfig(t);n.length>0?console.warn("[TrackingPixelSDK] ‚ùå Errores en configuraci√≥n de horarios activos:",n):(this.activeHoursValidator=new _.ActiveHoursValidator(t),(0,j.debugLog)("[TrackingPixelSDK] üïê Validador de horarios activos configurado:",t))}this.identitySignal=E.IdentitySignal.getInstance(),this.wsService=P.WebSocketService.getInstance(),this.realtimeMessageManager=L.RealtimeMessageManager.getInstance();const H=null!==(s=e.requireConsent)&&void 0!==s&&s,z=null!==(r=null===(o=e.consent)||void 0===o?void 0:o.waitForConsent)&&void 0!==r?r:H,K=H?(null===(f=e.consent)||void 0===f?void 0:f.defaultStatus)||"pending":"granted";if(this.consentManager=D.ConsentManager.getInstance({version:"1.5.0",waitForConsent:z,defaultStatus:K,onConsentChange:t=>{var n;(0,j.debugLog)("[TrackingPixelSDK] üîê Estado de consentimiento cambiado:",t),"granted"===t.status&&((0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Consentimiento otorgado - habilitando tracking"),(0,j.debugLog)("[TrackingPixelSDK] üìù El backend registrar√° autom√°ticamente el consentimiento en identify()"),this.init().catch((e=>{console.error("[TrackingPixelSDK] ‚ùå Error inicializando SDK despu√©s de consentimiento:",e)}))),"denied"===t.status&&((0,j.debugLog)("[TrackingPixelSDK] ‚ùå Consentimiento denegado - deshabilitando tracking"),this.stopTrackingActivities()),(null===(n=e.consent)||void 0===n?void 0:n.onConsentChange)&&e.consent.onConsentChange(t)}}),this.consentBackendService=O.ConsentBackendService.getInstance(),(0,j.debugLog)("[TrackingPixelSDK] üîê ConsentBackendService inicializado"),H&&e.consentBanner&&!1!==e.consentBanner.enabled&&this.initConsentBanner(e.consentBanner),this.sessionInjectionStage=new g.SessionInjectionStage,this.pipelineBuilder.addStage(new c.TimeStampStage),"jwt"===this.authMode?this.pipelineBuilder.addStage(new d.TokenInjectionStage):(0,j.debugLog)("[TrackingPixelSDK] üîê authMode=session: omitiendo TokenInjectionStage"),this.eventPipeline=this.pipelineBuilder.addStage(new h.URLInjectionStage).addStage(this.sessionInjectionStage).addStage(new u.MetadataInjectionStage).addStage(new p.TrackingEventV2Stage).addStage(new l.ValidationStage(this.authMode)).build(),this.heuristicEnabled=null===(b=null===(m=e.heuristicDetection)||void 0===m?void 0:m.enabled)||void 0===b||b,this.heuristicEnabled?((0,j.debugLog)("[TrackingPixelSDK] üöÄ Initializing with heuristic detection enabled"),this.domTrackingManager=new I.EnhancedDomTrackingManager((e=>this.track(e)),new x.DefaultTrackDataExtractor,(null===(v=e.heuristicDetection)||void 0===v?void 0:v.config)||{})):((0,j.debugLog)("[TrackingPixelSDK] Initializing with legacy DOM tracking"),this.domTrackingManager=new x.DomTrackingManager((e=>this.track(e)))),null===(C=null===(w=e.sessionTracking)||void 0===w?void 0:w.enabled)||void 0===C||C){(0,j.debugLog)("[TrackingPixelSDK] üìä Initializing advanced session tracking with Intercom-like features");const t=(null===(S=e.sessionTracking)||void 0===S?void 0:S.config)||{},n=(null===(k=e.sessionTracking)||void 0===k?void 0:k.activityDetection)||{},i=(null===(M=e.sessionTracking)||void 0===M||M.multiTabSupport,Object.assign(Object.assign({},t),{maxInactivityTime:null!==(A=n.inactivityThreshold)&&void 0!==A?A:6e4,heartbeatInterval:null!==(U=t.heartbeatInterval)&&void 0!==U?U:1e4}));this.sessionTrackingManager=new T.SessionTrackingManager((e=>{setTimeout((()=>{this.track(e)}),500)}),i),this.sessionInjectionStage.setSessionManager(this.sessionTrackingManager),(0,j.debugLog)("[TrackingPixelSDK] Session tracking configured with enhanced features:",{heartbeatInterval:i.heartbeatInterval,inactivityThreshold:i.maxInactivityTime})}const F=this.consentManager.getState();"pending"===F.status?((0,j.debugLog)("[TrackingPixelSDK] üîê Estado inicial: pending - SDK pausado"),(0,j.debugLog)("[TrackingPixelSDK] ‚è∏Ô∏è SDK pausado hasta que se otorgue consentimiento")):"granted"===F.status?((0,j.debugLog)("[TrackingPixelSDK] üîê Estado inicial: granted - Inicializando SDK"),this.init().catch((e=>{console.error("[TrackingPixelSDK] ‚ùå Error inicializando SDK:",e)}))):(0,j.debugLog)("[TrackingPixelSDK] üîê Estado inicial: denied - SDK no se inicializar√°")}init(){return i(this,void 0,void 0,(function*(){(0,j.debugLog)("[TrackingPixelSDK] üöÄ Inicializando SDK con consentimiento otorgado..."),(0,j.debugLog)("[TrackingPixelSDK] üîê Consentimiento verificado - guardando configuraci√≥n en localStorage"),localStorage.setItem("pixelEndpoint",this.endpoint),localStorage.setItem("guidersApiKey",this.apiKey);const e=new o.ClientJS;this.fingerprint=localStorage.getItem("fingerprint")||e.getFingerprint().toString(),localStorage.setItem("fingerprint",this.fingerprint),"jwt"===this.authMode&&r.TokenManager.loadTokensFromStorage(),(0,j.debugLog)("‚úÖ SDK inicializado sin servicios de WebSocket."),this.autoFlush&&this.startAutoFlush(),(0,j.debugLog)("SDK listo para tracking..."),this.setupTabOpenListener(),this.chatUI=new f.ChatUI({widget:!0,welcomeMessage:this.welcomeMessageConfig,position:this.chatPositionConfig});const t=this.chatUI,n=new w.ChatInputUI(t);this.chatToggleButton=new C.ChatToggleButtonUI(t);const s=this.chatToggleButton,a=()=>{if((0,j.debugLog)("Inicializando componentes del chat r√°pidamente..."),this.activeHoursValidator&&!this.activeHoursValidator.isChatActive()){(0,j.debugLog)("üïê Chat no est√° disponible seg√∫n horarios configurados"),t.init(),t.hide(),n.init(),s.init(),s.hide();const e=this.activeHoursValidator.getFallbackMessage(),i=this.activeHoursValidator.getNextAvailableTime();let o=e;i&&(o+=` Pr√≥ximo horario disponible: ${i}`),(0,j.debugLog)("üïê "+o),t&&t.addSystemMessage(o);const a=setInterval((()=>{this.activeHoursValidator&&this.activeHoursValidator.isChatActive()&&((0,j.debugLog)("üïê ‚úÖ Chat ahora est√° disponible seg√∫n horarios"),s.show(),clearInterval(a))}),3e5);return}t.init(),t.hide(),n.init(),s.init();const e=t.getMessagesContainer();e&&(this.chatMessagesUI=new m.ChatMessagesUI(e)),s.show(),(0,j.debugLog)("üîò Bot√≥n de chat mostrado inmediatamente"),document.querySelectorAll(".chat-widget, .chat-widget-fixed").forEach((e=>{e.addEventListener("system-message",(e=>{const n=e;t.addSystemMessage(n.detail.message)}))})),(0,j.debugLog)("Componentes del chat inicializados. Chat oculto por defecto."),t.onChatInitialized((()=>{(0,j.debugLog)("üí¨ Chat inicializado, verificando disponibilidad de comerciales..."),this.checkCommercialAvailability(t,s)})),this.setupParticipantEventsListener(t,s),t.onOpen((()=>{this.captureEvent("visitor:open-chat",{timestamp:(new Date).getTime(),chatId:t.getChatId()}),s.updateState(!0),this.initializeWebSocketConnection(t),this.loadChatMessagesOnOpen(t),this.chatToggleButton&&setTimeout((()=>i(this,void 0,void 0,(function*(){yield this.chatToggleButton.markAllMessagesAsRead(),(0,j.debugLog)("üì¨ [TrackingPixelSDK] Mensajes marcados como le√≠dos al abrir chat")}))),1e3)})),t.onClose((()=>{this.captureEvent("visitor:close-chat",{timestamp:(new Date).getTime(),chatId:t.getChatId()}),s.updateState(!1)})),t.onActiveInterval((()=>{(0,j.debugLog)("Intervalo activo"),this.captureEvent("visitor:chat-active",{timestamp:(new Date).getTime(),chatId:t.getChatId()})}),1e4),s.onToggle((e=>{(0,j.debugLog)("Toggle event: chat debe estar "+(e?"visible":"oculto")),e?t.show():t.hide()})),n.onSubmit((e=>i(this,void 0,void 0,(function*(){if(!e)return;(0,j.debugLog)("üí¨ [TrackingPixelSDK] üìù Mensaje enviado desde UI:",e),this.captureEvent("visitor:send-message",{id:(0,k.v4)(),message:e,timestamp:(new Date).getTime(),chatId:t.getChatId()}),this.flush();const n=this.getVisitorId(),i=this.isVisitorIdentified();if((0,j.debugLog)("üí¨ [TrackingPixelSDK] üîç Estado del visitante:",{visitorId:n,isIdentified:i,identityState:this.identitySignal.getState()}),!n){console.warn("üí¨ [TrackingPixelSDK] ‚ùå No hay visitorId disponible para enviar mensaje"),console.warn("üí¨ [TrackingPixelSDK] üîÑ Intentando identificar visitante primero...");try{yield this.executeIdentify();const e=this.getVisitorId();if(!e)return void console.error("üí¨ [TrackingPixelSDK] ‚ùå No se pudo identificar el visitante");(0,j.debugLog)("üí¨ [TrackingPixelSDK] ‚úÖ Visitante identificado:",e)}catch(e){return void console.error("üí¨ [TrackingPixelSDK] ‚ùå Error identificando visitante:",e)}}try{const n=this.getVisitorId(),i=t.getChatId();let s;if((0,j.debugLog)("üí¨ [TrackingPixelSDK] üì§ Enviando mensaje para visitante:",n),(0,j.debugLog)("üí¨ [TrackingPixelSDK] üîç Chat ID actual:",i),i)(0,j.debugLog)("üí¨ [TrackingPixelSDK] üìã Enviando mensaje a chat existente (WebSocket):",i),this.wsService.isConnected()||this.initializeWebSocketConnection(t),this.realtimeMessageManager.getCurrentChatId()!==i&&this.realtimeMessageManager.setCurrentChat(i),yield this.realtimeMessageManager.sendMessage(e,"text"),s={chat:{id:i},message:{id:"pending"},isNewChat:!1};else if(t.isCreatingChat()){(0,j.debugLog)("üí¨ [TrackingPixelSDK] ‚è≥ Ya se est√° creando un chat, esperando..."),yield t.waitForChatCreation();const n=t.getChatId();if(!n)throw new Error("No se pudo obtener el chatId despu√©s de la creaci√≥n");(0,j.debugLog)("üí¨ [TrackingPixelSDK] üìã Enviando mensaje a chat reci√©n creado:",n),s={chat:{id:n},message:yield v.ChatV2Service.getInstance().sendMessage(n,e,"text"),isNewChat:!1}}else{t.setCreatingChat(!0),(0,j.debugLog)("üí¨ [TrackingPixelSDK] üÜï Creando nuevo chat con mensaje");try{const n=yield v.ChatV2Service.getInstance().createChatWithMessage({},{content:e,type:"text"}),i=n.chatId;i&&(t.setChatId(i),(0,j.debugLog)("üí¨ [TrackingPixelSDK] üÜï Chat ID asignado:",i),this.initializeWebSocketConnection(t),this.realtimeMessageManager.setCurrentChat(i)),s={chat:{id:i},message:{id:n.messageId},isNewChat:!0}}finally{t.setCreatingChat(!1)}}if(s&&((0,j.debugLog)("üí¨ [TrackingPixelSDK] ‚úÖ Mensaje enviado exitosamente:",{chatId:s.chat.id,isNewChat:s.isNewChat}),"undefined"!=typeof window)){const t=new CustomEvent("guidersMessageSent",{detail:{message:e,chatId:s.chat.id,isNewChat:s.isNewChat}});window.dispatchEvent(t)}}catch(e){console.error("üí¨ [TrackingPixelSDK] ‚ùå Error enviando mensaje:",e),t.setCreatingChat(!1)}})))),this.on("receive-message",(e=>{(0,j.debugLog)("Mensaje recibido via WebSocket:",e),e.data.senderId||console.warn("‚ö†Ô∏è Mensaje WebSocket sin senderId:",e),t.renderChatMessage({text:e.data.message,sender:"other",senderId:e.data.senderId,timestamp:e.data.timestamp})}))};"loading"===document.readyState?((0,j.debugLog)("El DOM a√∫n no est√° completamente cargado. Esperando..."),document.addEventListener("DOMContentLoaded",a),(0,j.debugLog)("Esperando a que el DOM est√© completamente cargado...")):((0,j.debugLog)("El DOM ya est√° completamente cargado."),a()),this.sessionTrackingManager&&(0,j.debugLog)("üéØ Starting session tracking..."),this.enableAutomaticTracking(),this.setupPageUnloadHandlers()}))}setupTabOpenListener(){"undefined"!=typeof window&&((0,j.debugLog)("[TrackingPixelSDK] üîç Configurando listener para apertura de pesta√±a (una sola vez)"),"visible"===document.visibilityState&&((0,j.debugLog)("[TrackingPixelSDK] üöÄ Pesta√±a cargada - ejecutando identify una sola vez"),this.executeIdentify()))}executeIdentify(){return i(this,void 0,void 0,(function*(){var e,t;if(this.identifyExecuted)(0,j.debugLog)("[TrackingPixelSDK] ‚ö†Ô∏è identify() ya ejecutado - ignorando llamada duplicada");else{this.identifyExecuted=!0;try{(0,j.debugLog)("[TrackingPixelSDK] üîç Ejecutando identify...");const n=yield this.identitySignal.identify(this.fingerprint,this.apiKey);if(null===(e=null==n?void 0:n.identity)||void 0===e?void 0:e.visitorId){(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Visitante identificado con identitySignal:",n.identity.visitorId);const e=sessionStorage.getItem("guiders_backend_session_id");if(e&&(this.consentBackendService.setSessionId(e),(0,j.debugLog)("[TrackingPixelSDK] üîê SessionId configurado en ConsentBackendService")),this.chatToggleButton&&(this.chatToggleButton.connectUnreadService(n.identity.visitorId),(0,j.debugLog)("üì¨ [TrackingPixelSDK] ‚úÖ Servicio de mensajes no le√≠dos conectado tempranamente")),(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Consentimientos registrados autom√°ticamente por el backend en identify()"),this.consentManager.isGranted())try{const e=this.consentManager.getState(),t=Date.now()-e.timestamp;if(t>5e3){(0,j.debugLog)("[TrackingPixelSDK] üîÑ Sincronizando con backend (visitante recurrente, consentimiento antiguo)...");const t=yield this.consentBackendService.syncWithBackend(n.identity.visitorId);(0,j.debugLog)("[TrackingPixelSDK] üîÑ Estado de consentimiento sincronizado con backend:",t),e.preferences&&(e.preferences.analytics!==t.analytics||e.preferences.functional!==t.functional||e.preferences.personalization!==t.personalization)&&((0,j.debugLog)("[TrackingPixelSDK] üîÑ Actualizando preferencias locales con estado del backend"),this.consentManager.grantConsentWithPreferences(t))}else(0,j.debugLog)("[TrackingPixelSDK] ‚è≠Ô∏è Saltando sincronizaci√≥n: consentimiento reci√©n otorgado (edad: "+Math.round(t/1e3)+"s)"),(0,j.debugLog)("[TrackingPixelSDK] üìù El backend ya tiene los consentimientos del identify() actual")}catch(e){console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudo sincronizar con backend, continuando con estado local:",e)}this.visitorHeartbeatTimer&&clearInterval(this.visitorHeartbeatTimer),this.visitorHeartbeatTimer=setInterval((()=>{b.VisitorsV2Service.getInstance().heartbeat()}),3e4);const i=(null===(t=n.chats)||void 0===t?void 0:t.chats)&&n.chats.chats.length>0;i&&n.chats?(localStorage.setItem("guiders_recent_chats",JSON.stringify(n.chats.chats)),M.ChatMemoryStore.getInstance().setChatId(n.chats.chats[0].id),(0,j.debugLog)("[TrackingPixelSDK] ‚ôªÔ∏è Chat reutilizable (m√°s reciente) guardado en memoria:",n.chats.chats[0].id),this.chatToggleButton&&n.chats.chats[0].id&&(this.chatToggleButton.setActiveChatForUnread(n.chats.chats[0].id),(0,j.debugLog)("üì¨ [TrackingPixelSDK] Cargando mensajes no le√≠dos al inicializar con chat existente"))):((0,j.debugLog)("[TrackingPixelSDK] üí¨ No hay chats previos, mostrando mensaje de bienvenida autom√°ticamente"),this.chatUI&&this.chatUI.checkAndAddWelcomeMessage&&setTimeout((()=>{this.chatUI&&this.chatUI.checkAndAddWelcomeMessage&&(this.chatUI.checkAndAddWelcomeMessage(),(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Mensaje de bienvenida mostrado autom√°ticamente"))}),500)),this.chatUI&&!this.wsService.isConnected()&&((0,j.debugLog)("üì° [TrackingPixelSDK] üöÄ Inicializando WebSocket para notificaciones en tiempo real"),this.initializeWebSocketConnection(this.chatUI),i&&n.chats&&n.chats.chats[0].id?(this.realtimeMessageManager.setCurrentChat(n.chats.chats[0].id),(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ WebSocket configurado para chat existente:",n.chats.chats[0].id)):(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ WebSocket configurado para recibir notificaciones de chats nuevos"))}}catch(e){(e instanceof Error?e.message:String(e)).includes("Operation was superseded")?(0,j.debugLog)("[TrackingPixelSDK] ‚ÑπÔ∏è identify cancelado por operaci√≥n m√°s reciente"):(console.warn("[TrackingPixelSDK] ‚ùå identify V2 fallido:",e),this.identifyExecuted=!1)}}}))}setupPageUnloadHandlers(){if("undefined"==typeof window)return;let e=!1;const t=t=>{if(!e){e=!0;try{if((0,j.debugLog)(`[TrackingPixelSDK] üö™ Finalizando sesi√≥n por: ${t}`),this.eventQueue.length>0){const e=[...this.eventQueue];if(this.eventQueue=[],"undefined"!=typeof navigator&&"sendBeacon"in navigator)try{const t=R.getInstance().getEndpoint(),n=`${t.endsWith("/api")?t:`${t}/api`}/tracking/events/batch`,i=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(n,i),(0,j.debugLog)(`[TrackingPixelSDK] üì§ ${e.length} eventos enviados via beacon`)}catch(e){console.warn("[TrackingPixelSDK] ‚ùå Error enviando eventos via beacon:",e)}}b.VisitorsV2Service.getInstance().endSession({useBeacon:!0})}catch(e){console.warn(`[TrackingPixelSDK] ‚ùå Error en endSession (${t}):`,e)}}};(0,j.debugLog)("[TrackingPixelSDK] üö™ Configurando listeners simplificados para cierre de ventana"),window.addEventListener("beforeunload",(()=>{(0,j.debugLog)("[TrackingPixelSDK] üö™ beforeunload detectado"),t("window_close")})),window.addEventListener("pagehide",(()=>{(0,j.debugLog)("[TrackingPixelSDK] üö™ pagehide detectado"),t("window_close")}))}configureTypingIndicators(e){(0,j.debugLog)("üí¨ Indicadores de escritura desactivados (sin WebSocket)")}on(e,t){var n;this.listeners.has(e)||this.listeners.set(e,new Set),null===(n=this.listeners.get(e))||void 0===n||n.add(t)}off(e,t){var n;null===(n=this.listeners.get(e))||void 0===n||n.delete(t)}once(e,t){const n=i=>{t(i),this.off(e,n)};this.on(e,n)}addPipelineStage(e){this.eventPipeline=this.pipelineBuilder.addStage(e).build()}enableDOMTracking(){this.domTrackingManager instanceof I.EnhancedDomTrackingManager?((0,j.debugLog)("[TrackingPixelSDK] üéØ Enabling automatic heuristic tracking"),this.domTrackingManager.enableAutomaticTracking()):((0,j.debugLog)("[TrackingPixelSDK] Enabling legacy DOM tracking"),this.domTrackingManager.enableDOMTracking())}enableAutomaticTracking(){this.domTrackingManager instanceof I.EnhancedDomTrackingManager?this.domTrackingManager.enableAutomaticTracking():(console.warn("[TrackingPixelSDK] Heuristic detection not available. Use enableDOMTracking() instead."),this.domTrackingManager.enableDOMTracking())}getHeuristicConfig(){return this.domTrackingManager instanceof I.EnhancedDomTrackingManager?this.domTrackingManager.getHeuristicConfig():null}updateHeuristicConfig(e){this.domTrackingManager instanceof I.EnhancedDomTrackingManager?this.domTrackingManager.updateHeuristicConfig(e):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}setHeuristicEnabled(e){this.domTrackingManager instanceof I.EnhancedDomTrackingManager?this.domTrackingManager.setHeuristicEnabled(e):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}updateActiveHoursConfig(e){var t;try{this.activeHoursValidator=new _.ActiveHoursValidator(e),(0,j.debugLog)("[TrackingPixelSDK] üïê Configuraci√≥n de horarios activos actualizada:",{enabled:e.enabled,timezone:e.timezone,ranges:(null===(t=e.ranges)||void 0===t?void 0:t.length)||0,fallbackMessage:e.fallbackMessage?"Configurado":"No configurado"}),!this.activeHoursValidator.isChatActive()&&e.fallbackMessage&&(0,j.debugLog)("[TrackingPixelSDK] üïê Chat fuera de horario activo, aplicando mensaje de fallback")}catch(e){console.error("[TrackingPixelSDK] ‚ùå Error actualizando configuraci√≥n de horarios activos:",e)}}getActiveHoursConfig(){var e;return(null===(e=this.activeHoursValidator)||void 0===e?void 0:e.getConfig())||null}enableSessionTracking(){this.sessionTrackingManager?(0,j.debugLog)("[TrackingPixelSDK] üéØ Session tracking already enabled and initialized"):console.warn("[TrackingPixelSDK] Session tracking not initialized.")}setMetadata(e,t){const n=this.eventQueue.findIndex((t=>t.type===e));-1!==n?this.eventQueue[n].metadata=t:console.warn(`Evento '${e}' no encontrado en la cola.`)}flush(){return i(this,void 0,void 0,(function*(){if(0===this.eventQueue.length)return;const e=[...this.eventQueue];this.eventQueue=[],yield Promise.all(e.map((e=>this.trySendEventWithRetry(e,this.maxRetries))))}))}stopAutoFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null)}track(e){return i(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{if(!this.consentManager.isTrackingAllowed())return(0,j.debugLog)("[TrackingPixelSDK] üîê Tracking bloqueado - sin consentimiento"),void t();const{event:i}=e,o=s(e,["event"]);if("string"!=typeof i)return console.error("El evento debe tener un tipo."),void n(new Error("El evento debe tener un tipo."));try{this.captureEvent("tracking:tracking-event",{trackingEventId:(0,k.v4)(),metadata:Object.assign({},o),eventType:i}),t()}catch(e){console.error("Error al capturar el evento:",e),n(e)}}))}))}trackEvent(e,t){return i(this,void 0,void 0,(function*(){return console.warn("[TrackingPixelSDK] ‚ö†Ô∏è  trackEvent() is deprecated. Please use track() instead."),this.track(Object.assign({event:e},t))}))}captureEvent(e,t){if(!this.consentManager.isTrackingAllowed())return void(0,j.debugLog)("[TrackingPixelSDK] üîê Evento bloqueado - sin consentimiento:",e);if(!this.consentManager.isCategoryAllowed("analytics"))return void(0,j.debugLog)("[TrackingPixelSDK] üîê Evento bloqueado - analytics no permitido:",e);const n={type:e,data:t,timestamp:Date.now()},i=this.eventPipeline.process(n);this.eventQueue.push(i)}trySendEventWithRetry(e,t){return i(this,void 0,void 0,(function*(){try{(0,j.debugLog)("üì° Enviando evento via HTTP (sin WebSocket):",e.type)}catch(n){console.error("‚ùå Error al enviar evento:",n),t>0?(console.warn(`Retrying (${this.maxRetries-t+1})...`),setTimeout((()=>{this.trySendEventWithRetry(e,t-1)}),1e3)):console.error("‚ùå No se pudo enviar el evento despu√©s de varios intentos:",e)}}))}startAutoFlush(){this.flushTimer&&clearInterval(this.flushTimer),this.flushTimer=setInterval((()=>{this.flush()}),this.flushInterval)}dispatchMessage(e){const t=this.listeners.get(e.type);if("receive-message"===e.type&&((0,j.debugLog)("üí¨ Mensaje recibido (sin servicio de mensajes no le√≠dos)"),"undefined"!=typeof window&&"Notification"in window)){const t=e.data&&"string"==typeof e.data.message&&e.data.message?e.data.message:"Tienes un nuevo mensaje en el chat";"granted"===Notification.permission?new Notification("Nuevo mensaje",{body:t,icon:"/favicon.ico"}):"denied"!==Notification.permission&&Notification.requestPermission().then((e=>{"granted"===e&&new Notification("Nuevo mensaje",{body:t,icon:"/favicon.ico"})}))}t&&0!==t.size&&t.forEach((t=>{try{t(e)}catch(e){console.error("Error al ejecutar listener:",e)}}))}cleanup(){this.visitorHeartbeatTimer&&(clearInterval(this.visitorHeartbeatTimer),this.visitorHeartbeatTimer=null),b.VisitorsV2Service.getInstance().endSession().catch((()=>{})),this.stopAutoFlush(),this.eventQueue=[],this.listeners.clear(),(0,j.debugLog)("[TrackingPixelSDK] Cleanup completed")}setupParticipantEventsListener(e,t){(0,j.debugLog)("üí¨ Eventos de participantes desactivados (sin WebSocket)")}checkAndUpdateChatVisibility(e,t,n){return i(this,void 0,void 0,(function*(){try{(0,j.debugLog)(`üîç checkAndUpdateChatVisibility - Verificando chat ${e}`);const t=yield this.fetchChatDetail(e);(0,j.debugLog)("üìã Detalles del chat obtenidos:",{totalParticipants:t.participants.length,participants:t.participants.map((e=>({name:e.name,isCommercial:e.isCommercial,isOnline:e.isOnline,id:e.id})))});const i=t.participants.filter((e=>e.isCommercial));(0,j.debugLog)(`üè™ Comerciales encontrados: ${i.length}`,i.map((e=>({name:e.name,isOnline:e.isOnline,id:e.id}))));const s=i.some((e=>e.isOnline)),o=i.filter((e=>e.isOnline));(0,j.debugLog)("üìä Resumen de comerciales:"),(0,j.debugLog)(`  - Total comerciales: ${i.length}`),(0,j.debugLog)(`  - Comerciales online: ${o.length}`),(0,j.debugLog)(`  - ¬øHay al menos un comercial online? ${s}`),(0,j.debugLog)(`  - Estado actual del bot√≥n: ${n.isButtonVisible()}`),n.show()}catch(e){console.error("‚ùå Error al verificar y actualizar visibilidad del chat:",e),e instanceof Error&&console.error("‚ùå Stack trace:",e.stack)}}))}checkCommercialAvailability(e,t){return i(this,void 0,void 0,(function*(){try{let n=e.getChatId(),i=0;const s=10;for(;!n&&i<s;)yield new Promise((e=>setTimeout(e,500))),n=e.getChatId(),i++,(0,j.debugLog)(`Esperando chat ID... intento ${i}/${s}`);if(!n)return console.error("‚ùå [checkCommercialAvailability] No se pudo obtener el ID del chat despu√©s de varios intentos. Abortando para evitar /v2/chats/undefined",{attempts:i}),(0,j.debugLog)("üîò Mostrando bot√≥n de chat sin verificaci√≥n de comerciales"),void t.show();(0,j.debugLog)(`Verificando disponibilidad de comerciales para el chat ${n}...`);const o=yield this.fetchChatDetail(n),a=o.participants.filter((e=>e.isCommercial)),r=a.some((e=>e.isOnline));(0,j.debugLog)("Participantes del chat:",o.participants),(0,j.debugLog)("Comerciales en el chat:",a.length),(0,j.debugLog)("Comerciales online:",a.filter((e=>e.isOnline)).length),(0,j.debugLog)("¬øHay comerciales online?",r),t.show()}catch(e){console.error("Error al verificar disponibilidad de comerciales:",e),(0,j.debugLog)("üîò Mostrando bot√≥n de chat a pesar del error en verificaci√≥n"),t.show()}}))}fetchChatDetail(e){return i(this,void 0,void 0,(function*(){if(!e)throw console.warn("‚ùå fetchChatDetail llamado sin chatId. Abortando."),new Error("chatId requerido");(0,j.debugLog)(`üåê fetchChatDetail - Obteniendo detalles para chat ${e} (usando API V2)`);try{const t=yield(0,S.fetchChatDetailV2)(e);(0,j.debugLog)("üåê fetchChatDetail - Detalles V2 obtenidos:",{id:t.id,status:t.status,visitorId:t.visitorId,assignedCommercialId:t.assignedCommercialId,availableCommercialIds:t.availableCommercialIds,isActive:t.isActive});const n=this.convertV2ToLegacyDetail(t);return(0,j.debugLog)("üåê fetchChatDetail - Convertido a formato legacy:",{id:n.id,participantsCount:n.participants.length,participants:n.participants.map((e=>({id:e.id,name:e.name,isCommercial:e.isCommercial,isOnline:e.isOnline})))}),n}catch(t){return console.warn("üåê fetchChatDetail - Error con API V2, intentando API legacy:",t),yield(0,S.fetchChatDetail)(e)}}))}convertV2ToLegacyDetail(e){var t,n,i,s,o;const a=[];if(a.push({id:e.visitorInfo.id,name:e.visitorInfo.name,isCommercial:!1,isVisitor:!0,isOnline:!0,assignedAt:e.createdAt.toISOString(),lastSeenAt:(null===(t=e.lastMessageDate)||void 0===t?void 0:t.toISOString())||null,isViewing:e.isActive,isTyping:!1,isAnonymous:!1}),e.assignedCommercialId){const t=(null===(n=e.assignedCommercial)||void 0===n?void 0:n.name)||`Comercial ${e.assignedCommercialId}`;a.push({id:e.assignedCommercialId,name:t,isCommercial:!0,isVisitor:!1,isOnline:e.isActive,assignedAt:(null===(i=e.assignedAt)||void 0===i?void 0:i.toISOString())||e.createdAt.toISOString(),lastSeenAt:(null===(s=e.lastMessageDate)||void 0===s?void 0:s.toISOString())||null,isViewing:e.isActive,isTyping:!1,isAnonymous:!1})}return e.availableCommercialIds&&e.availableCommercialIds.length>0&&e.availableCommercialIds.forEach((t=>{t!==e.assignedCommercialId&&a.push({id:t,name:`Comercial ${t}`,isCommercial:!0,isVisitor:!1,isOnline:!0,assignedAt:e.createdAt.toISOString(),lastSeenAt:null,isViewing:!1,isTyping:!1,isAnonymous:!1})})),{id:e.id,participants:a,status:e.status,lastMessage:null,lastMessageAt:(null===(o=e.lastMessageDate)||void 0===o?void 0:o.toISOString())||null,createdAt:e.createdAt.toISOString()}}get visitorsService(){return b.VisitorsV2Service.getInstance()}getIdentitySignal(){return this.identitySignal}identifyVisitor(e,t){return i(this,void 0,void 0,(function*(){const n=e||this.fingerprint||this.generateFingerprint(),i=t||this.apiKey;(0,j.debugLog)("[TrackingPixelSDK] üîç Identificando visitante con fingerprint:",n);try{const e=yield this.identitySignal.identify(n,i);return(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Visitante identificado exitosamente:",e.identity.visitorId),e}catch(e){throw console.error("[TrackingPixelSDK] ‚ùå Error identificando visitante:",e),e}}))}generateFingerprint(){const e=(new o.ClientJS).getFingerprint().toString();return localStorage.setItem("fingerprint",e),this.fingerprint=e,e}reloadVisitorChats(){return i(this,void 0,void 0,(function*(){return(0,j.debugLog)("[TrackingPixelSDK] üîÑ Recargando chats del visitante..."),this.identitySignal.reloadChats()}))}getIdentityState(){return this.identitySignal.getState()}getVisitorId(){return this.identitySignal.getVisitorId()}isVisitorIdentified(){return this.identitySignal.isIdentified()}subscribeToIdentityChanges(e){return this.identitySignal.subscribe(e)}subscribeToChatChanges(e){return this.identitySignal.getChatsSignal().subscribe(e)}showChat(){(0,j.debugLog)("[TrackingPixelSDK] üí¨ Mostrando chat..."),this.chatUI?this.chatUI.show():console.warn("[TrackingPixelSDK] ‚ùå Chat UI no est√° inicializado")}hideChat(){(0,j.debugLog)("[TrackingPixelSDK] üí¨ Ocultando chat..."),this.chatUI&&this.chatUI.hide()}updateWelcomeMessage(e){(0,j.debugLog)("[TrackingPixelSDK] üé® Actualizando mensaje de bienvenida:",e),this.welcomeMessageConfig=e,this.chatUI&&this.chatUI.setWelcomeMessage(e)}getWelcomeMessageConfig(){return this.welcomeMessageConfig||null}isChatVisible(){var e;return(null===(e=this.chatUI)||void 0===e?void 0:e.isVisible())||!1}resetChat(){(0,j.debugLog)("[TrackingPixelSDK] üîÑ Reiniciando chat..."),this.chatUI&&(this.chatUI.hide(),setTimeout((()=>{this.chatUI&&this.chatUI.show()}),500))}loadChatMessagesOnOpen(e){return i(this,void 0,void 0,(function*(){var t;e.setLoadingInitialMessages(!0);try{const n=e.getChatId();if(!n)return(0,j.debugLog)("[TrackingPixelSDK] üí¨ No hay chatId, omitiendo carga de mensajes"),void(null===(t=e.checkAndAddWelcomeMessage)||void 0===t||t.call(e));if((0,j.debugLog)("[TrackingPixelSDK] üí¨ üîí Iniciando carga de mensajes con protecci√≥n de race condition para chat:",n),this.chatMessagesUI)return(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Usando ChatMessagesUI para carga unificada"),yield this.chatMessagesUI.initializeChat(n),(0,j.debugLog)("[TrackingPixelSDK] üí¨ Carga completa, verificando necesidad de mensaje de bienvenida"),void(e.checkAndAddWelcomeMessage&&e.checkAndAddWelcomeMessage());(0,j.debugLog)("[TrackingPixelSDK] ‚ö†Ô∏è ChatMessagesUI no disponible, usando sistema legacy"),e.showLoadingMessages();const i=yield v.ChatV2Service.getInstance().getChatMessages(n,50,void 0);if(e.clearMessages(),i.messages&&i.messages.length>0){const t=i.messages.reverse();for(const n of t){let t="";t="string"==typeof n.content?n.content:n.content&&"object"==typeof n.content?n.content.text||n.content.message||n.content.body||JSON.stringify(n.content):String(n.content||""),e.renderChatMessage({text:t,sender:n.senderId===this.getVisitorId()?"user":"other",timestamp:new Date(n.createdAt).getTime(),senderId:n.senderId})}(0,j.debugLog)(`[TrackingPixelSDK] ‚úÖ Cargados ${t.length} mensajes del chat (sistema legacy)`)}else(0,j.debugLog)("[TrackingPixelSDK] üì≠ No hay mensajes en el chat (sistema legacy)");e.hideLoadingMessages(),setTimeout((()=>{e.scrollToBottomV2?e.scrollToBottomV2():e.scrollToBottom(!0)}),100),(0,j.debugLog)("[TrackingPixelSDK] üí¨ Carga legacy completa, verificando necesidad de mensaje de bienvenida"),e.checkAndAddWelcomeMessage&&e.checkAndAddWelcomeMessage()}catch(t){console.error("[TrackingPixelSDK] ‚ùå Error cargando mensajes del chat:",t),e.hideLoadingMessages(),(0,j.debugLog)("[TrackingPixelSDK] ‚ö†Ô∏è Error en carga, verificando mensaje de bienvenida como fallback"),e.checkAndAddWelcomeMessage&&e.checkAndAddWelcomeMessage()}finally{e.setLoadingInitialMessages(!1),(0,j.debugLog)("[TrackingPixelSDK] üí¨ üîí Bandera de carga limpiada, race condition protection finalizada")}}))}loadInitialMessagesFromFirstChat(e){return i(this,void 0,void 0,(function*(){try{if(!(null==e?void 0:e.id))return void(0,j.debugLog)("[TrackingPixelSDK] üì≠ No hay ID en el primer chat, omitiendo carga inicial");if((0,j.debugLog)("[TrackingPixelSDK] üîÑ Cargando mensajes iniciales del chat:",e.id),this.chatMessagesUI)return this.chatMessagesUI.isChatInitialized(e.id)?void(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Chat ya inicializado con ChatMessagesUI, omitiendo carga duplicada"):this.chatMessagesUI.isLoadingMessages()?void(0,j.debugLog)("[TrackingPixelSDK] ‚è≥ ChatMessagesUI ya est√° cargando mensajes, omitiendo carga duplicada"):(yield this.chatMessagesUI.initializeChat(e.id),void(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Mensajes iniciales cargados con ChatMessagesUI"));const t=yield v.ChatV2Service.getInstance().getChatMessages(e.id,50,void 0);if(t.messages&&t.messages.length>0){const n=t.messages.reverse();localStorage.setItem("guiders_initial_messages",JSON.stringify({chatId:e.id,messages:n,loadedAt:Date.now()})),(0,j.debugLog)(`[TrackingPixelSDK] üíæ ${n.length} mensajes iniciales almacenados en memoria`)}else(0,j.debugLog)("[TrackingPixelSDK] üì≠ No hay mensajes iniciales para cargar")}catch(e){console.error("[TrackingPixelSDK] ‚ùå Error cargando mensajes iniciales:",e)}}))}isChatActive(){return!this.activeHoursValidator||this.activeHoursValidator.isChatActive()}getChatFallbackMessage(){return this.activeHoursValidator?this.activeHoursValidator.getFallbackMessage():null}getNextAvailableTime(){return this.activeHoursValidator?this.activeHoursValidator.getNextAvailableTime():null}updateActiveHours(e){var t;try{const n={enabled:null===(t=e.enabled)||void 0===t||t,ranges:e.ranges||[],timezone:e.timezone,fallbackMessage:e.fallbackMessage},i=_.ActiveHoursValidator.validateConfig(n);return i.length>0?(console.warn("[TrackingPixelSDK] ‚ùå Errores en nueva configuraci√≥n de horarios activos:",i),!1):(this.activeHoursValidator=new _.ActiveHoursValidator(n),(0,j.debugLog)("[TrackingPixelSDK] üïê ‚úÖ Configuraci√≥n de horarios activos actualizada"),this.checkAndUpdateChatAvailability(),!0)}catch(e){return console.error("[TrackingPixelSDK] ‚ùå Error actualizando horarios activos:",e),!1}}disableActiveHours(){this.activeHoursValidator=void 0,(0,j.debugLog)("[TrackingPixelSDK] üïê Validaci√≥n de horarios activos desactivada"),this.checkAndUpdateChatAvailability()}checkAndUpdateChatAvailability(){if(!this.chatUI)return;const e=this.isChatActive(),t=document.querySelector(".chat-toggle-button");if(e)t&&(t.style.display="block"),(0,j.debugLog)("[TrackingPixelSDK] üïê ‚úÖ Chat ahora disponible seg√∫n horarios");else{t&&(t.style.display="none"),this.chatUI.isVisible&&this.chatUI.isVisible()&&this.chatUI.hide();const e=this.getChatFallbackMessage(),n=this.getNextAvailableTime();let i=e||"Chat no disponible en este momento";n&&(i+=` Pr√≥ximo horario: ${n}`),(0,j.debugLog)("[TrackingPixelSDK] üïê "+i)}}initializeWebSocketConnection(e){const t=this.getVisitorId();if(t)if(this.wsService.isConnected()){(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ WebSocket ya conectado");const t=e.getChatId();t&&this.realtimeMessageManager.getCurrentChatId()!==t&&this.realtimeMessageManager.setCurrentChat(t)}else{(0,j.debugLog)("üì° [TrackingPixelSDK] üöÄ Inicializando conexi√≥n WebSocket...");try{const n=sessionStorage.getItem("guiders_backend_session_id");this.wsService.connect({sessionId:n||void 0},{onConnect:()=>{(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ WebSocket conectado exitosamente"),t&&(this.wsService.joinVisitorRoom(t),(0,j.debugLog)("üì° [TrackingPixelSDK] üöÄ Unido a sala de visitante para notificaciones proactivas"))},onDisconnect:e=>{(0,j.debugLog)("üì° [TrackingPixelSDK] ‚ö†Ô∏è WebSocket desconectado:",e)},onError:e=>{console.error("üì° [TrackingPixelSDK] ‚ùå Error WebSocket:",e.message)},onChatCreated:e=>{(0,j.debugLog)("üì° [TrackingPixelSDK] üéâ Chat creado proactivamente por un comercial:",e),this.wsService.joinChatRoom(e.chatId),this.realtimeMessageManager.setCurrentChat(e.chatId),M.ChatMemoryStore.getInstance().setChatId(e.chatId),this.chatToggleButton&&this.chatToggleButton.setActiveChatForUnread(e.chatId),this.showChatCreatedNotification(e),(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ Configurado autom√°ticamente para el nuevo chat:",e.chatId)}}),this.realtimeMessageManager.initialize({chatUI:e,visitorId:t,enableTypingIndicators:!0});const i=e.getChatId();i&&this.realtimeMessageManager.setCurrentChat(i),this.chatToggleButton&&(this.chatToggleButton.connectUnreadService(t),i&&this.chatToggleButton.setActiveChatForUnread(i),(0,j.debugLog)("üì¨ [TrackingPixelSDK] ‚úÖ Servicio de mensajes no le√≠dos inicializado")),(0,j.debugLog)("üì° [TrackingPixelSDK] ‚úÖ Sistema de mensajer√≠a en tiempo real inicializado")}catch(e){console.error("üì° [TrackingPixelSDK] ‚ùå Error inicializando WebSocket:",e)}}else console.warn("üì° [TrackingPixelSDK] ‚ö†Ô∏è No se puede conectar WebSocket sin visitorId")}sendRealtimeMessage(e){return i(this,arguments,void 0,(function*(e,t="text"){try{yield this.realtimeMessageManager.sendMessage(e,t)}catch(e){throw console.error("üì° [TrackingPixelSDK] ‚ùå Error enviando mensaje en tiempo real:",e),e}}))}showChatCreatedNotification(e){try{if("Notification"in window&&"default"===Notification.permission?Notification.requestPermission().then((t=>{"granted"===t&&this.displayChatNotification(e)})):"Notification"in window&&"granted"===Notification.permission&&this.displayChatNotification(e),this.chatToggleButton){const e=this.chatToggleButton.getButtonElement();e&&(e.classList.add("pulse-animation"),setTimeout((()=>{e.classList.remove("pulse-animation")}),3e3))}(0,j.debugLog)("üì° [TrackingPixelSDK] üîî Notificaci√≥n de nuevo chat mostrada")}catch(e){console.error("üì° [TrackingPixelSDK] ‚ùå Error mostrando notificaci√≥n:",e)}}displayChatNotification(e){try{const t=new Notification("¬°Un comercial ha iniciado un chat!",{body:e.message||"Tienes un nuevo mensaje esper√°ndote",icon:"/chat-icon.png",tag:e.chatId,requireInteraction:!0});t.onclick=()=>{this.chatUI&&this.chatUI.show(),t.close()}}catch(e){console.error("üì° [TrackingPixelSDK] ‚ùå Error creando notificaci√≥n del navegador:",e)}}getWebSocketState(){return this.wsService.getState()}isWebSocketConnected(){return this.wsService.isConnected()}disconnectWebSocket(){this.wsService.disconnect(),this.realtimeMessageManager.cleanup(),(0,j.debugLog)("üì° [TrackingPixelSDK] üîå WebSocket desconectado")}initChatUIOnly(){return i(this,void 0,void 0,(function*(){(0,j.debugLog)("[TrackingPixelSDK] üîê Inicializando solo chat UI (sin tracking)"),this.chatUI=new f.ChatUI({widget:!0,welcomeMessage:this.welcomeMessageConfig,position:this.chatPositionConfig});const e=()=>{if(!this.chatUI)return;if(this.activeHoursValidator&&!this.activeHoursValidator.isChatActive())return void(0,j.debugLog)("[TrackingPixelSDK] üïê Chat no disponible seg√∫n horarios");const e=this.chatUI,t=new w.ChatInputUI(e);this.chatToggleButton=new C.ChatToggleButtonUI(e);const n=this.chatToggleButton;e.init(),e.hide(),t.init(),n.init(),n.show(),(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Chat UI inicializado (sin tracking)"),e.onOpen((()=>{(0,j.debugLog)("[TrackingPixelSDK] üí¨ Chat abierto (sin tracking de eventos)")})),e.onClose((()=>{(0,j.debugLog)("[TrackingPixelSDK] üí¨ Chat cerrado (sin tracking de eventos)")})),n.onToggle((t=>{t?e.show():e.hide()})),t.onSubmit((t=>i(this,void 0,void 0,(function*(){if(t){if(!this.consentManager.isCategoryAllowed("functional"))return console.warn("[TrackingPixelSDK] üîê Env√≠o de mensajes bloqueado - se requiere consentimiento funcional"),void e.addSystemMessage("Se requiere aceptar cookies funcionales para enviar mensajes.");try{this.getVisitorId()||(yield this.executeIdentify());const n=e.getChatId();if(n)yield v.ChatV2Service.getInstance().sendMessage(n,t,"text");else{const n=yield v.ChatV2Service.getInstance().createChatWithMessage({},{content:t,type:"text"});e.setChatId(n.chatId)}}catch(e){console.error("[TrackingPixelSDK] ‚ùå Error enviando mensaje:",e)}}}))))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}))}stopTrackingActivities(){(0,j.debugLog)("[TrackingPixelSDK] üõë Deteniendo todas las actividades de tracking..."),this.domTrackingManager&&(0,j.debugLog)("[TrackingPixelSDK] üõë DOM tracking detenido"),this.sessionTrackingManager&&(0,j.debugLog)("[TrackingPixelSDK] üõë Session tracking detenido"),this.visitorHeartbeatTimer&&(clearInterval(this.visitorHeartbeatTimer),this.visitorHeartbeatTimer=null,(0,j.debugLog)("[TrackingPixelSDK] üõë Visitor heartbeat detenido")),this.stopAutoFlush(),this.eventQueue=[],(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Todas las actividades de tracking detenidas")}initConsentBanner(e){(0,j.debugLog)("[TrackingPixelSDK] üé® Inicializando banner de consentimiento..."),this.consentBanner=new A.ConsentBannerUI(e),this.consentBanner.onAccept=()=>{var e;(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Usuario acept√≥ desde banner"),this.grantConsent(),null===(e=this.consentBanner)||void 0===e||e.hide()},this.consentBanner.onDeny=()=>{var e;(0,j.debugLog)("[TrackingPixelSDK] ‚ùå Usuario rechaz√≥ desde banner"),this.denyConsent(),null===(e=this.consentBanner)||void 0===e||e.hide()},this.consentBanner.onPreferences=()=>{(0,j.debugLog)("[TrackingPixelSDK] ‚öôÔ∏è Usuario abri√≥ preferencias desde banner"),alert("Modal de preferencias: Pr√≥ximamente.\n\nPor ahora, puedes:\n- Aceptar Todo = Otorgar consentimiento completo\n- Rechazar = Solo cookies esenciales")},this.consentBanner.render(),e.autoShow&&this.consentManager.isPending()&&(this.consentBanner.show(),(0,j.debugLog)("[TrackingPixelSDK] üëÅÔ∏è Banner mostrado autom√°ticamente (consent pending)"))}grantConsent(){(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Otorgando consentimiento completo..."),this.consentManager.grantConsent(),(0,j.debugLog)("[TrackingPixelSDK] üìù El backend registrar√° el consentimiento autom√°ticamente durante identify()"),(0,j.debugLog)("[TrackingPixelSDK] üîÑ Reiniciando SDK con tracking habilitado..."),this.init().catch((e=>{console.error("[TrackingPixelSDK] ‚ùå Error reiniciando SDK:",e)}))}grantConsentWithPreferences(e){(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Otorgando consentimiento con preferencias:",e),this.consentManager.grantConsentWithPreferences(e),(0,j.debugLog)("[TrackingPixelSDK] üìù El backend registrar√° el consentimiento autom√°ticamente durante identify()"),(0,j.debugLog)("[TrackingPixelSDK] üîÑ Reiniciando SDK..."),this.init().catch((e=>{console.error("[TrackingPixelSDK] ‚ùå Error reiniciando SDK:",e)}))}denyConsent(){(0,j.debugLog)("[TrackingPixelSDK] ‚ùå Denegando consentimiento..."),this.consentManager.denyConsent(),this.stopTrackingActivities(),(0,j.debugLog)("[TrackingPixelSDK] üìù Registrando rechazo de consentimiento en el backend...");const e=new o.ClientJS,t=this.fingerprint||e.getFingerprint().toString();this.identitySignal.identify(t,this.apiKey).catch((e=>{console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudo registrar el rechazo en el backend:",e)}))}revokeConsent(){(0,j.debugLog)("[TrackingPixelSDK] üîÑ Revocando consentimiento..."),this.consentManager.revokeConsent(),this.stopTrackingActivities();const e=this.getVisitorId();e&&this.consentBackendService.revokeAllConsents(e,"Usuario revoc√≥ consentimiento desde el SDK").then((()=>{(0,j.debugLog)("[TrackingPixelSDK] üîÑ Revocaci√≥n sincronizada con backend")})).catch((e=>{console.error("[TrackingPixelSDK] ‚ùå Error revocando en backend:",e)}))}getConsentStatus(){return this.consentManager.getStatus()}getConsentState(){return this.consentManager.getState()}isConsentGranted(){return this.consentManager.isGranted()}isCategoryAllowed(e){return this.consentManager.isCategoryAllowed(e)}subscribeToConsentChanges(e){return this.consentManager.subscribe(e)}deleteVisitorData(){return i(this,void 0,void 0,(function*(){(0,j.debugLog)("[TrackingPixelSDK] üóëÔ∏è Eliminando datos del visitante (GDPR Right to Erasure)...");try{const e=this.getVisitorId();if(this.stopTrackingActivities(),this.clearLocalStorageData(),this.consentManager.clearConsentData(),e)try{yield this.consentBackendService.deleteConsentData(e),(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Datos de consentimiento eliminados del backend"),(0,j.debugLog)("[TrackingPixelSDK] üì° Solicitud de eliminaci√≥n enviada al servidor para visitor:",e)}catch(e){throw console.error("[TrackingPixelSDK] ‚ùå Error eliminando datos del servidor:",e),new Error("No se pudieron eliminar los datos del servidor")}this.identitySignal.reset(),this.fingerprint=null,(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Datos del visitante eliminados exitosamente")}catch(e){throw console.error("[TrackingPixelSDK] ‚ùå Error eliminando datos del visitante:",e),e}}))}clearLocalStorageData(){"undefined"!=typeof localStorage&&(["fingerprint","guiders_backend_session_id","guiders_recent_chats","guiders_initial_messages","pixelEndpoint","guidersApiKey","guiders_consent_state"].forEach((e=>{try{localStorage.removeItem(e),(0,j.debugLog)("[TrackingPixelSDK] üóëÔ∏è Eliminado:",e)}catch(t){console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudo eliminar:",e,t)}})),(0,j.debugLog)("[TrackingPixelSDK] üóëÔ∏è Datos locales eliminados"))}exportVisitorData(){return i(this,void 0,void 0,(function*(){(0,j.debugLog)("[TrackingPixelSDK] üì¶ Exportando datos del visitante...");const e=this.getVisitorId(),t={visitorId:e,fingerprint:this.fingerprint,sessionId:this.identitySignal.getSessionId(),identityState:this.identitySignal.getState(),consentState:this.consentManager.getState(),localStorage:this.getLocalStorageData(),exportedAt:(new Date).toISOString()};if(e)try{const n=yield this.consentBackendService.exportConsentData(e);t.backendConsents=JSON.parse(n),(0,j.debugLog)("[TrackingPixelSDK] ‚úÖ Datos de consentimiento del backend incluidos en exportaci√≥n")}catch(e){console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudieron obtener datos de consentimiento del backend:",e),t.backendConsents={error:"No se pudieron obtener datos del backend"}}return JSON.stringify(t,null,2)}))}getLocalStorageData(){if("undefined"==typeof localStorage)return{};const e={};return["fingerprint","guiders_backend_session_id","guiders_recent_chats","pixelEndpoint","guiders_consent_state"].forEach((t=>{try{const n=localStorage.getItem(t);n&&(e[t]=n)}catch(e){console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudo leer:",t)}})),e}}},2662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodePacket=void 0;const i=n(2046),s=n(2745),o="function"==typeof ArrayBuffer;t.decodePacket=(e,t)=>{if("string"!=typeof e)return{type:"message",data:r(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:a(e.substring(1),t)}:i.PACKET_TYPES_REVERSE[n]?e.length>1?{type:i.PACKET_TYPES_REVERSE[n],data:e.substring(1)}:{type:i.PACKET_TYPES_REVERSE[n]}:i.ERROR_PACKET};const a=(e,t)=>{if(o){const n=(0,s.decode)(e);return r(n,t)}return{base64:!0,data:e}},r=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},2686:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodePacket=void 0,t.encodePacketToBinary=function(e,t){return s&&e.data instanceof Blob?e.data.arrayBuffer().then(d).then(t):o&&(e.data instanceof ArrayBuffer||a(e.data))?t(d(e.data)):void r(e,!1,(e=>{l||(l=new TextEncoder),t(l.encode(e))}))};const i=n(2046),s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),o="function"==typeof ArrayBuffer,a=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,r=({type:e,data:t},n,r)=>s&&t instanceof Blob?n?r(t):c(t,r):o&&(t instanceof ArrayBuffer||a(t))?n?r(t):c(new Blob([t]),r):r(i.PACKET_TYPES[e]+(t||""));t.encodePacket=r;const c=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function d(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let l},2745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)i[n.charCodeAt(e)]=e;t.encode=e=>{let t,i=new Uint8Array(e),s=i.length,o="";for(t=0;t<s;t+=3)o+=n[i[t]>>2],o+=n[(3&i[t])<<4|i[t+1]>>4],o+=n[(15&i[t+1])<<2|i[t+2]>>6],o+=n[63&i[t+2]];return s%3==2?o=o.substring(0,o.length-1)+"=":s%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=e=>{let t,n,s,o,a,r=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);const l=new ArrayBuffer(r),u=new Uint8Array(l);for(t=0;t<c;t+=4)n=i[e.charCodeAt(t)],s=i[e.charCodeAt(t+1)],o=i[e.charCodeAt(t+2)],a=i[e.charCodeAt(t+3)],u[d++]=n<<2|s>>4,u[d++]=(15&s)<<4|o>>2,u[d++]=(3&o)<<6|63&a;return l}},2782:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRenderer=void 0,t.MessageRenderer=class{static createMessageElement(e){const t=document.createElement("div"),n="user"===e.sender,i=n?"chat-message-wrapper chat-message-user-wrapper":"chat-message-wrapper chat-message-other-wrapper";return t.className=i,e.id&&t.setAttribute("data-message-id",e.id),t.innerHTML=n?`\n                <div class="message-content-wrapper">\n                    <div class="chat-message chat-message-user">\n                        <div class="message-text">${this.escapeHtml(e.content)}</div>\n                        <div class="chat-message-time">${this.formatTime(e.timestamp)} ‚úì</div>\n                    </div>\n                </div>\n            `:`\n                <div class="chat-avatar">\n                    <div class="avatar-circle">\n                        <span class="avatar-text">${this.getParticipantInitials(e.senderId||"")}</span>\n                    </div>\n                </div>\n                <div class="message-content-wrapper">\n                    <div class="chat-message chat-message-other">\n                        <div class="message-text">${this.escapeHtml(e.content)}</div>\n                        <div class="chat-message-time">${this.formatTime(e.timestamp)}</div>\n                    </div>\n                </div>\n            `,this.applyModernMessageStyles(t,n),t}static fromMessageV2(e){return{id:e.id,content:e.content,sender:this.determineSender(e),timestamp:e.createdAt,senderId:e.senderId}}static determineSender(e){try{const t=localStorage.getItem("visitorId");if(t&&e.senderId===t)return"user"}catch(e){console.warn("No se pudo determinar el visitor ID actual:",e)}return"user"===e.type?"user":"system"===e.type?"system":"agent"}static getParticipantInitials(e){if(!e)return"BOT";if(e.length<=3)return e.toUpperCase();const t=e.split(/[\s_-]+/);return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():e.substring(0,2).toUpperCase()}static escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}static formatTime(e){let t;return t=e?new Date(e):new Date,t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})}static applyModernMessageStyles(e,t){const n=e.querySelector(".chat-avatar"),i=e.querySelector(".chat-message"),s=e.querySelector(".message-text"),o=e.querySelector(".chat-message-time"),a=e.querySelector(".message-content-wrapper");if(e.style.cssText=`\n            display: flex;\n            align-items: flex-end;\n            margin-bottom: 3px;\n            ${t?"flex-direction: row-reverse; padding-left: 4px;":"flex-direction: row; padding-right: 4px;"}\n            opacity: 1;\n            transform: translateY(0);\n        `,n){n.style.cssText="\n                margin-right: 12px;\n                margin-bottom: 4px;\n                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));\n            ";const e=n.querySelector(".avatar-circle");e&&(e.style.cssText="\n                    width: 32px;\n                    height: 32px;\n                    border-radius: 50%;\n                    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: white;\n                    font-size: 11px;\n                    font-weight: 600;\n                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n                    border: none;\n                    box-sizing: border-box;\n                    min-width: 32px;\n                    min-height: 32px;\n                    max-width: 32px;\n                    max-height: 32px;\n                ")}a&&(a.style.cssText=`\n                display: flex;\n                flex-direction: column;\n                ${t?"align-items: flex-end; max-width: 85%;":"align-items: flex-start; max-width: 80%;"}\n                min-width: 120px;\n            `),i&&(i.style.cssText=`\n                padding: 8px 12px;\n                border-radius: 10px;\n                position: relative;\n                word-break: break-word;\n                white-space: normal;\n                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n                display: flex;\n                flex-direction: row;\n                align-items: baseline;\n                gap: 6px;\n                ${t?"background: #D1E7FF;\n                     color: #2c3e50;\n                     border-bottom-right-radius: 2px;\n                     max-width: 90%;\n                     margin-left: auto;":"background: #FFFFFF;\n                     color: #2c3e50;\n                     border-bottom-left-radius: 2px;\n                     max-width: 90%;"}\n                transition: all 0.2s ease;\n            `),s&&(s.style.cssText="\n                font-size: 14px;\n                line-height: 1.4;\n                margin: 0;\n                word-break: break-word;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n                flex: 0 1 auto;\n                color: #2c3e50;\n            "),o&&(o.style.cssText="\n                font-size: 10px;\n                color: rgba(44, 62, 80, 0.5);\n                font-weight: 400;\n                letter-spacing: 0.01em;\n                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n                white-space: nowrap;\n                flex-shrink: 0;\n                margin-left: auto;\n                opacity: 0.9;\n            "),this.ensureAnimationStyles()}static ensureAnimationStyles(){if(document.getElementById("guiders-message-animations"))return;const e=document.createElement("style");e.id="guiders-message-animations",e.innerHTML="\n            @keyframes messageSlideIn {\n                0% {\n                    opacity: 0;\n                    transform: translateY(20px) scale(0.95);\n                    filter: blur(4px);\n                }\n                50% {\n                    opacity: 0.7;\n                    transform: translateY(8px) scale(0.98);\n                    filter: blur(2px);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                    filter: blur(0);\n                }\n            }\n            \n            .modern-message {\n                will-change: transform, opacity;\n            }\n            \n            .modern-message .message-content {\n                transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            }\n            \n            .modern-message .message-avatar {\n                transition: transform 0.2s ease;\n            }\n            \n            /* Efecto hover del avatar deshabilitado por solicitud del usuario */\n        ",document.head.appendChild(e)}}},2831:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return m.default}});var i=b(n(4213)),s=b(n(4808)),o=b(n(6792)),a=b(n(9910)),r=b(n(3518)),c=b(n(343)),d=b(n(4948)),l=b(n(5073)),u=b(n(7186)),h=b(n(4671)),g=b(n(3507)),p=b(n(744)),f=b(n(7037)),m=b(n(7775));function b(e){return e&&e.__esModule?e:{default:e}}},2858:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)};var i=new Uint8Array(16)},2895:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedDomTrackingManager=void 0;const i=n(6808),s=n(1034),o=n(7690);class a extends i.DomTrackingManager{constructor(e,t=new i.DefaultTrackDataExtractor,n={}){super(e,t),this.heuristicEnabled=!0,this.registeredListeners=new Map,this.heuristicDetector=new s.HeuristicElementDetector(n),this.urlDetector=new o.URLPageDetector}enableAutomaticTracking(){this.heuristicEnabled?(console.log("[EnhancedDomTrackingManager] üöÄ Enabling automatic heuristic tracking"),this.handlePageViewTracking(),this.setupHeuristicEventListeners(),this.observeDOMChanges()):console.log("[EnhancedDomTrackingManager] Heuristic detection is disabled")}handlePageViewTracking(){const e=()=>{const e=this.urlDetector.detectCurrentPage();console.log("[EnhancedDomTrackingManager] üìÑ Page detected:",e.pageType,"confidence:",e.confidence),this.trackCallback({event:"page_view"})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}setupHeuristicEventListeners(){Object.keys(this.getDomEventMap()).forEach((e=>{"page_view"!==e&&this.setupEventTypeListeners(e)}))}setupEventTypeListeners(e){const t=this.getDomEventMap()[e];if(!t)return;const n=this.heuristicDetector.detectElements(e);console.log(`[EnhancedDomTrackingManager] üéØ Found ${n.length} elements for "${e}"`),n.forEach((n=>{this.attachEventListener(n.element,e,t,n)}))}attachEventListener(e,t,n,i){this.registeredListeners.has(e)||this.registeredListeners.set(e,new Map);const s=this.registeredListeners.get(e),o=`${t}_${n}`;if(s.has(o))return;const a=()=>{console.log(`[EnhancedDomTrackingManager] üìä Tracking "${t}" (confidence: ${i.confidence.toFixed(2)})`);const n=this.createHeuristicEventData(e,t,i);this.trackCallback(n)};e.addEventListener(n,a),s.set(o,a)}createHeuristicEventData(e,t,n){var i;return Object.assign({event:t,detection_method:"heuristic",confidence:n.confidence,matched_selector:n.matchedRule.selector,element_text:(null===(i=e.textContent)||void 0===i?void 0:i.trim())||"",element_tag:e.tagName.toLowerCase(),element_class:e.className||"",element_id:e.id||"",timestamp:Date.now()},this.urlDetector.extractPageMetadata())}addVisualIndicator(e,t,n){const i=document.createElement("div");i.innerHTML=`üéØ ${t} (${Math.round(100*n)}%)`,i.style.cssText="\n            position: absolute;\n            background: rgba(30, 58, 138, 0.9);\n            color: white;\n            padding: 2px 6px;\n            font-size: 10px;\n            border-radius: 3px;\n            z-index: 10000;\n            pointer-events: none;\n            font-family: monospace;\n        ";const s=e.getBoundingClientRect();i.style.top=s.top+window.scrollY-20+"px",i.style.left=s.left+window.scrollX+"px",document.body.appendChild(i),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i)}),3e3)}observeDOMChanges(){new MutationObserver((e=>{let t=!1;e.forEach((e=>{"childList"===e.type&&e.addedNodes.length>0&&e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&(t=!0)}))})),t&&setTimeout((()=>this.rescanForNewElements()),500)})).observe(document.body,{childList:!0,subtree:!0})}rescanForNewElements(){console.log("[EnhancedDomTrackingManager] üîÑ Rescanning for new elements"),Object.keys(this.getDomEventMap()).forEach((e=>{"page_view"!==e&&this.setupEventTypeListeners(e)}))}setHeuristicEnabled(e){this.heuristicEnabled=e,console.log("[EnhancedDomTrackingManager] Heuristic detection "+(e?"enabled":"disabled"))}getHeuristicConfig(){return this.heuristicDetector.getConfig()}updateHeuristicConfig(e){this.heuristicDetector.updateConfig(e)}getURLDetector(){return this.urlDetector}getHeuristicDetector(){return this.heuristicDetector}getDomEventMap(){return this.domEventMap}enableDOMTracking(){console.warn("[EnhancedDomTrackingManager] enableDOMTracking() is deprecated. Use enableAutomaticTracking() instead."),this.enableAutomaticTracking()}}t.EnhancedDomTrackingManager=a},2919:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatInputUI=t.ChatUI=t.createDateSeparator=t.generateInitials=t.isBot=t.formatDate=t.formatTime=void 0;var o=n(5649);Object.defineProperty(t,"formatTime",{enumerable:!0,get:function(){return o.formatTime}}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return o.formatDate}}),Object.defineProperty(t,"isBot",{enumerable:!0,get:function(){return o.isBot}}),Object.defineProperty(t,"generateInitials",{enumerable:!0,get:function(){return o.generateInitials}}),Object.defineProperty(t,"createDateSeparator",{enumerable:!0,get:function(){return o.createDateSeparator}});var a=n(3129);Object.defineProperty(t,"ChatUI",{enumerable:!0,get:function(){return a.ChatUI}});var r=n(3626);Object.defineProperty(t,"ChatInputUI",{enumerable:!0,get:function(){return r.ChatInputUI}}),s(n(3129),t),s(n(3626),t),s(n(4505),t),s(n(5649),t)},2969:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatToggleButtonUI=void 0;const s=n(969);t.ChatToggleButtonUI=class{constructor(e,t={}){this.badgeElement=null,this.isVisible=!1,this.toggleCallback=[],this.chatUI=e,this.resolvedPosition=this.chatUI.getResolvedPosition(),console.log("üîò [ChatToggleButton] Posici√≥n resuelta del bot√≥n:",this.resolvedPosition.button);const n=this.chatUI.getOptions().widgetWidth||"300px";parseInt(n.replace("px","")),this.options=Object.assign({label:"Chat",buttonSize:"50px",backgroundColor:"#007bff",textColor:"#ffffff",positionRight:"20px",positionBottom:"20px",borderRadius:"50%"},t),this.button=document.createElement("button"),this.button.className="chat-toggle-btn",this.unreadService=s.UnreadMessagesService.getInstance(),this.isVisible=!1}getButtonPositionCSS(){const e=this.resolvedPosition.button,t=[];return e.top&&t.push(`top: ${e.top};`),e.bottom&&t.push(`bottom: ${e.bottom};`),e.left&&t.push(`left: ${e.left};`),e.right&&t.push(`right: ${e.right};`),t.join(" ")}getBadgePositionCSS(){const e=this.resolvedPosition.button,t=[];return e.bottom?(parseInt(e.bottom),t.push(`bottom: calc(${e.bottom} + 43px);`)):e.top&&(parseInt(e.top),t.push(`top: calc(${e.top} + 13px);`)),e.right?t.push(`right: calc(${e.right} + 13px);`):e.left&&t.push(`left: calc(${e.left} + 43px);`),t.join(" ")}init(){this.button||(this.button=document.createElement("button"),this.button.className="chat-toggle-btn"),this.isVisible=!1,this.button.classList.remove("open"),this.addButtonToDOM(),this.applyStyles(),this.addEventListeners(),this.initializeStyles(),console.log("üí¨ Inicializando sistema de notificaciones")}addButtonToDOM(){const e=document.querySelector(".chat-widget-host");if(e&&e.shadowRoot){if(e.shadowRoot.querySelectorAll(".chat-toggle-btn").forEach((e=>e.remove())),e.shadowRoot.querySelectorAll(".chat-unread-badge").forEach((e=>e.remove())),e.shadowRoot.insertBefore(this.button,e.shadowRoot.firstChild),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),e.shadowRoot.appendChild(this.badgeElement),this.hideBadge(),console.log("üí¨ Badge inicializado y oculto (0 mensajes no le√≠dos)"),!e.shadowRoot.querySelector("style[data-chat-toggle-btn]")){const t=this.getButtonPositionCSS(),n=this.getBadgePositionCSS(),i=document.createElement("style");i.setAttribute("data-chat-toggle-btn","true"),i.textContent=`\n\t\t\t\t\t.chat-toggle-btn {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\t${t}\n\t\t\t\t\t\twidth: 56px;\n\t\t\t\t\t\theight: 56px;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\t\tcolor: #fff !important;\n\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbox-shadow: 0 4px 10px rgba(0,123,255,0.3), 0 0 0 rgba(0,123,255,0);\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t\tposition: relative; /* Asegurar que el badge se posicione correctamente */\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn::before {\n\t\t\t\t\t\tcontent: '';\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\twidth: 24px;\n\t\t\t\t\t\theight: 24px;\n\t\t\t\t\t\tbackground-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 3C6.5 3 2 6.58 2 11C2.05 13.15 3.06 15.17 4.75 16.5C4.75 17.1 4.33 18.67 2 21C4.37 20.89 6.64 20 8.47 18.5C9.61 18.83 10.81 19 12 19C17.5 19 22 15.42 22 11C22 6.58 17.5 3 12 3ZM12 17C7.58 17 4 14.31 4 11C4 7.69 7.58 5 12 5C16.42 5 20 7.69 20 11C20 14.31 16.42 17 12 17Z' fill='white'/%3E%3C/svg%3E");\n\t\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\t\tbackground-position: center;\n\t\t\t\t\t\ttransition: transform 0.3s ease;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn.open::before {\n\t\t\t\t\t\tbackground-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z' fill='white'/%3E%3C/svg%3E");\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:hover {\n\t\t\t\t\t\ttransform: translateY(-3px);\n\t\t\t\t\t\tbox-shadow: 0 6px 16px rgba(0,123,255,0.4);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0090ff, #0070e0);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:active {\n\t\t\t\t\t\ttransform: translateY(0) scale(0.95);\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,123,255,0.3);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0062cc, #0084ff);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\t${n}\n\t\t\t\t\t\tmin-width: 22px;\n\t\t\t\t\t\theight: 22px;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #ff5146, #e53a30);\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tpadding: 0 5px;\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tborder: 2px solid white;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(255,65,54,0.3);\n\t\t\t\t\t\tpointer-events: none; /* Evitar que el badge interfiera con el bot√≥n */\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge.hidden {\n\t\t\t\t\t\ttransform: scale(0);\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\tdisplay: flex !important;\n\t\t\t\t\t}\n\t\t\t\t\t@keyframes pulse {\n\t\t\t\t\t\t0% { transform: scale(0.8); opacity: 0.7; }\n\t\t\t\t\t\t50% { transform: scale(1.3); opacity: 1; }\n\t\t\t\t\t\t80% { transform: scale(0.95); opacity: 1; }\n\t\t\t\t\t\t100% { transform: scale(1); opacity: 1; }\n\t\t\t\t\t}\n\t\t\t\t`,e.shadowRoot.appendChild(i)}console.log("üí¨ Bot√≥n a√±adido al shadow DOM del chat")}else document.body.appendChild(this.button),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),document.body.appendChild(this.badgeElement),this.hideBadge(),console.log("üí¨ Bot√≥n a√±adido al body (sin shadow DOM)")}onToggle(e){this.toggleCallback.push(e)}applyStyles(){Array.from(this.button.childNodes).forEach((e=>{e.nodeType!==Node.TEXT_NODE&&"SPAN"!==e.tagName||this.button.removeChild(e)}));const e=this.options.backgroundColor||"#0084ff";this.button.style.background=`linear-gradient(145deg, ${e}, #0062cc)`,this.button.style.color=this.options.textColor||"#ffffff"}addEventListeners(){this.button.addEventListener("click",(()=>{this.isVisible=!this.isVisible,console.log("Toggle button clicked, new state:",this.isVisible?"visible":"hidden"),this.isVisible?this.button.classList.add("open"):this.button.classList.remove("open"),this.toggleCallback.forEach((e=>{e(this.isVisible)}))}))}hideBadge(){this.badgeElement&&(this.badgeElement.classList.add("hidden"),this.badgeElement.style.opacity="0",this.badgeElement.style.transform="scale(0)",this.badgeElement.style.display="none",this.badgeElement.textContent="",console.log("üö´ Badge oculto - sin mensajes no le√≠dos"))}updateUnreadBadge(e){this.badgeElement?(console.log(`üì¨ Actualizando badge: ${e} mensajes no le√≠dos`),e<=0?this.hideBadge():(this.badgeElement.classList.remove("hidden"),this.badgeElement.style.opacity="1",this.badgeElement.textContent=e>99?"99+":e.toString(),console.log(`üî¥ Badge visible - ${e} mensajes no le√≠dos`),this.badgeElement.style.display="flex",this.badgeElement.style.opacity="1",this.badgeElement.style.transform="scale(1)",this.badgeElement&&(this.badgeElement.style.animation="none",setTimeout((()=>{this.badgeElement&&(this.badgeElement.style.animation="pulse 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)")}),10)))):console.error("Badge element no encontrado")}initializeStyles(){const e=this.resolvedPosition.button,t={position:"fixed",width:"56px",height:"56px",borderRadius:"50%",background:`linear-gradient(145deg, ${this.options.backgroundColor||"#0084ff"}, #0062cc)`,color:this.options.textColor||"#ffffff",border:"none",cursor:"pointer",zIndex:"2147483647",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",boxShadow:"0 4px 10px rgba(0,123,255,0.3)",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",overflow:"hidden"};if(e.top&&(t.top=e.top),e.bottom&&(t.bottom=e.bottom),e.left&&(t.left=e.left),e.right&&(t.right=e.right),Object.assign(this.button.style,t),this.badgeElement){const t={position:"fixed",minWidth:"22px",height:"22px",background:"linear-gradient(145deg, #ff5146, #e53a30)",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxSizing:"border-box",border:"2px solid white",zIndex:"2147483647",boxShadow:"0 2px 8px rgba(255,65,54,0.3)",pointerEvents:"none",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)"};e.bottom?t.bottom=`calc(${e.bottom} + 43px)`:e.top&&(t.top=`calc(${e.top} + 13px)`),e.right?t.right=`calc(${e.right} + 13px)`:e.left&&(t.left=`calc(${e.left} + 43px)`),Object.assign(this.badgeElement.style,t)}}show(){console.log("üîò ChatToggleButton.show() llamado"),console.log("üîò Elemento bot√≥n existe:",!!this.button),this.button?(console.log("üîò Estado antes de mostrar:",this.button.style.display),this.button.style.display="flex",console.log("üîò Estado despu√©s de mostrar:",this.button.style.display),console.log("üîò Bot√≥n en DOM:",document.contains(this.button))):console.error("üîò Error: Elemento bot√≥n no existe")}hide(){console.log("üîò ChatToggleButton.hide() llamado"),console.log("üîò Elemento bot√≥n existe:",!!this.button),this.button?(console.log("üîò Estado antes de ocultar:",this.button.style.display),this.button.style.display="none",console.log("üîò Estado despu√©s de ocultar:",this.button.style.display)):console.error("üîò Error: Elemento bot√≥n no existe")}isButtonVisible(){const e=this.button&&"none"!==this.button.style.display;return console.log("üîò isButtonVisible() - Elemento existe:",!!this.button),this.button&&console.log("üîò isButtonVisible() - Display style:",this.button.style.display),console.log("üîò isButtonVisible() - Resultado:",e),e}hideUnreadBadge(){this.hideBadge()}updateUnreadCount(e){const t=null!=e?e:0;this.updateUnreadBadge(t)}updateState(e){this.isVisible=e,e?this.button.classList.add("open"):this.button.classList.remove("open"),console.log("üîò Estado del toggle button actualizado: "+(e?"abierto":"cerrado"))}connectUnreadService(e){console.log("üîå Conectando servicio de mensajes no le√≠dos con visitorId:",e),this.unreadService.initialize({visitorId:e,onCountChange:e=>{console.log("üì¨ Contador de mensajes no le√≠dos actualizado:",e),this.updateUnreadCount(e)},debug:!1}),console.log("‚úÖ Servicio de mensajes no le√≠dos conectado")}setActiveChatForUnread(e){console.log("üìå Estableciendo chat activo para mensajes no le√≠dos:",e),this.unreadService.setCurrentChat(e)}markAllMessagesAsRead(){return i(this,void 0,void 0,(function*(){console.log("‚úÖ Marcando todos los mensajes como le√≠dos..."),yield this.unreadService.markAllAsRead()}))}getUnreadService(){return this.unreadService}getButtonElement(){return this.button}}},3104:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketService=void 0;const i=n(8007),s=n(6161),o=n(2597),a=n(3974);class r{constructor(){this.socket=null,this.state=s.WebSocketState.DISCONNECTED,this.config=null,this.callbacks={},this.currentRooms=new Set,this.currentVisitorId=null,(0,a.debugLog)("üì° [WebSocketService] Instancia creada")}static getInstance(){return r.instance||(r.instance=new r),r.instance}connect(e,t={}){if(this.socket&&this.socket.connected)return void(0,a.debugLog)("üì° [WebSocketService] ‚ö†Ô∏è Ya hay una conexi√≥n activa");const n=o.EndpointManager.getInstance().getWebSocketEndpoint();(0,a.debugLog)("üì° [WebSocketService] üîç INICIO DE CONEXI√ìN WebSocket"),(0,a.debugLog)("üì° [WebSocketService] üìã Endpoint resuelto:",n),(0,a.debugLog)("üì° [WebSocketService] üìã Config recibida:",{url:e.url,path:e.path,hasAuthToken:!!e.authToken,hasSessionId:!!e.sessionId}),this.config={url:e.url||n,path:e.path||"/socket.io/",transports:e.transports||["websocket","polling"],withCredentials:void 0===e.withCredentials||e.withCredentials,reconnection:void 0===e.reconnection||e.reconnection,reconnectionAttempts:e.reconnectionAttempts||5,reconnectionDelay:e.reconnectionDelay||1e3,authToken:e.authToken,sessionId:e.sessionId},this.callbacks=t,(0,a.debugLog)("üì° [WebSocketService] üöÄ INTENTANDO CONECTAR a:",{url:this.config.url,fullUrl:this.config.url+this.config.path,path:this.config.path,transports:this.config.transports,withCredentials:this.config.withCredentials,reconnection:this.config.reconnection,reconnectionAttempts:this.config.reconnectionAttempts,hasToken:!!this.config.authToken,hasSessionId:!!this.config.sessionId}),(0,a.debugLog)("üì° [WebSocketService] üåê URL COMPLETA WebSocket:",`${this.config.url}${this.config.path}`);const s={path:this.config.path,transports:this.config.transports,withCredentials:this.config.withCredentials,reconnection:this.config.reconnection,reconnectionAttempts:this.config.reconnectionAttempts,reconnectionDelay:this.config.reconnectionDelay};this.config.authToken&&(s.auth={token:this.config.authToken}),this.socket=(0,i.io)(this.config.url,s),(0,a.debugLog)("üì° [WebSocketService] ‚úÖ Socket.IO cliente creado"),(0,a.debugLog)("üì° [WebSocketService] üîå Esperando conexi√≥n..."),this.registerEventListeners()}registerEventListeners(){this.socket&&(this.socket.on("connect",(()=>{var e,t,n,i,o,r,c;this.state=s.WebSocketState.CONNECTED,(0,a.debugLog)("üì° [WebSocketService] ‚úÖ‚úÖ‚úÖ CONEXI√ìN EXITOSA! ‚úÖ‚úÖ‚úÖ"),(0,a.debugLog)("üì° [WebSocketService] üÜî Socket ID:",null===(e=this.socket)||void 0===e?void 0:e.id),(0,a.debugLog)("üì° [WebSocketService] üåê URL conectada:",null===(t=this.config)||void 0===t?void 0:t.url),(0,a.debugLog)("üì° [WebSocketService] üìç Path:",null===(n=this.config)||void 0===n?void 0:n.path),(0,a.debugLog)("üì° [WebSocketService] üöÄ Transporte usado:",null===(c=null===(r=null===(o=null===(i=this.socket)||void 0===i?void 0:i.io)||void 0===o?void 0:o.engine)||void 0===r?void 0:r.transport)||void 0===c?void 0:c.name),this.currentVisitorId&&((0,a.debugLog)("üì° [WebSocketService] üîÑ Re-uni√©ndose a sala de visitante:",this.currentVisitorId),this.joinVisitorRoom(this.currentVisitorId)),this.currentRooms.size>0&&((0,a.debugLog)("üì° [WebSocketService] üîÑ Re-uni√©ndose a salas activas:",Array.from(this.currentRooms)),this.currentRooms.forEach((e=>{this.joinChatRoom(e)}))),this.callbacks.onConnect&&this.callbacks.onConnect()})),this.socket.on("disconnect",(e=>{var t;this.state=s.WebSocketState.DISCONNECTED,(0,a.debugLog)("üì° [WebSocketService] ‚ö†Ô∏è‚ö†Ô∏è DESCONECTADO ‚ö†Ô∏è‚ö†Ô∏è"),(0,a.debugLog)("üì° [WebSocketService] üìã Raz√≥n:",e),(0,a.debugLog)("üì° [WebSocketService] üåê URL que estaba conectada:",null===(t=this.config)||void 0===t?void 0:t.url),this.callbacks.onDisconnect&&this.callbacks.onDisconnect(e)})),this.socket.on("connect_error",(e=>{var t,n;this.state=s.WebSocketState.ERROR,console.error("üì° [WebSocketService] ‚ùå‚ùå‚ùå ERROR DE CONEXI√ìN ‚ùå‚ùå‚ùå"),console.error("üì° [WebSocketService] üåê URL intentada:",null===(t=this.config)||void 0===t?void 0:t.url),console.error("üì° [WebSocketService] üìç Path:",null===(n=this.config)||void 0===n?void 0:n.path),console.error("üì° [WebSocketService] üö® Mensaje de error:",e.message),console.error("üì° [WebSocketService] üìä Error completo:",e),console.error("üì° [WebSocketService] üîç Stack trace:",e.stack),this.callbacks.onError&&this.callbacks.onError(e)})),this.socket.on("error",(e=>{console.error("üì° [WebSocketService] ‚ùå ERROR GEN√âRICO del socket:",e)})),this.socket.io.on("reconnect_attempt",(e=>{var t;this.state=s.WebSocketState.RECONNECTING,(0,a.debugLog)("üì° [WebSocketService] üîÑ INTENTO DE RECONEXI√ìN #"+e),(0,a.debugLog)("üì° [WebSocketService] üåê URL:",null===(t=this.config)||void 0===t?void 0:t.url)})),this.socket.io.on("reconnect",(e=>{this.state=s.WebSocketState.CONNECTED,(0,a.debugLog)("üì° [WebSocketService] ‚úÖ Reconectado despu√©s de",e,"intentos")})),this.socket.on("message:new",(e=>{(0,a.debugLog)("üì° [WebSocketService] üì® Nuevo mensaje recibido:",{messageId:e.messageId,chatId:e.chatId,senderId:e.senderId,content:e.content.substring(0,50)+"..."}),this.callbacks.onMessage&&this.callbacks.onMessage(e)})),this.socket.on("chat:status",(e=>{(0,a.debugLog)("üì° [WebSocketService] üìä Estado del chat actualizado:",e),this.callbacks.onChatStatus&&this.callbacks.onChatStatus(e)})),this.socket.on("user:typing",(e=>{(0,a.debugLog)("üì° [WebSocketService] ‚úçÔ∏è Typing indicator:",e),this.callbacks.onTyping&&this.callbacks.onTyping(e)})),this.socket.on("chat:created",(e=>{(0,a.debugLog)("üì° [WebSocketService] üéâ Chat creado proactivamente:",{chatId:e.chatId,visitorId:e.visitorId,status:e.status,message:e.message}),this.callbacks.onChatCreated&&this.callbacks.onChatCreated(e)})),this.socket.on("visitor:joined",(e=>{(0,a.debugLog)("üì° [WebSocketService] ‚úÖ Confirmaci√≥n de uni√≥n a sala de visitante:",e)})),this.socket.on("visitor:left",(e=>{(0,a.debugLog)("üì° [WebSocketService] ‚úÖ Confirmaci√≥n de salida de sala de visitante:",e)})))}joinChatRoom(e){if(!this.socket||!this.socket.connected)return void console.warn("üì° [WebSocketService] ‚ö†Ô∏è No conectado, no se puede unir a sala:",e);(0,a.debugLog)("üì° [WebSocketService] üö™ Uni√©ndose a sala de chat:",e);const t={chatId:e};this.socket.emit("chat:join",t),this.currentRooms.add(e)}leaveChatRoom(e){if(!this.socket||!this.socket.connected)return void console.warn("üì° [WebSocketService] ‚ö†Ô∏è No conectado, no se puede salir de sala:",e);(0,a.debugLog)("üì° [WebSocketService] üö™ Saliendo de sala de chat:",e);const t={chatId:e};this.socket.emit("chat:leave",t),this.currentRooms.delete(e)}emitTyping(e,t){if(!this.socket||!this.socket.connected)return void console.warn("üì° [WebSocketService] ‚ö†Ô∏è No conectado, no se puede emitir typing");const n={chatId:e,isTyping:t};this.socket.emit("user:typing",n)}joinVisitorRoom(e){if(!this.socket||!this.socket.connected)return void console.warn("üì° [WebSocketService] ‚ö†Ô∏è No conectado, no se puede unir a sala de visitante:",e);(0,a.debugLog)("üì° [WebSocketService] üö™ Uni√©ndose a sala de visitante:",e);const t={visitorId:e};this.socket.emit("visitor:join",t,(t=>{(null==t?void 0:t.success)?((0,a.debugLog)("üì° [WebSocketService] ‚úÖ Unido a sala de visitante:",t.roomName),this.currentVisitorId=e):console.error("üì° [WebSocketService] ‚ùå Error al unirse a sala de visitante:",null==t?void 0:t.message)}))}leaveVisitorRoom(e){if(!this.socket||!this.socket.connected)return void console.warn("üì° [WebSocketService] ‚ö†Ô∏è No conectado, no se puede salir de sala de visitante:",e);(0,a.debugLog)("üì° [WebSocketService] üö™ Saliendo de sala de visitante:",e);const t={visitorId:e};this.socket.emit("visitor:leave",t,(e=>{(null==e?void 0:e.success)&&((0,a.debugLog)("üì° [WebSocketService] ‚úÖ Saliste de sala de visitante"),this.currentVisitorId=null)}))}disconnect(){this.socket&&((0,a.debugLog)("üì° [WebSocketService] üîå Desconectando..."),this.currentVisitorId&&this.leaveVisitorRoom(this.currentVisitorId),this.currentRooms.forEach((e=>{this.leaveChatRoom(e)})),this.socket.disconnect(),this.socket=null,this.state=s.WebSocketState.DISCONNECTED,this.currentRooms.clear(),this.currentVisitorId=null)}getState(){return this.state}isConnected(){var e;return(null===(e=this.socket)||void 0===e?void 0:e.connected)||!1}getSocketId(){var e;return null===(e=this.socket)||void 0===e?void 0:e.id}getCurrentRooms(){return Array.from(this.currentRooms)}updateCallbacks(e){const t=this.callbacks.onConnect,n=this.callbacks.onDisconnect,i=this.callbacks.onError,s=this.callbacks.onMessage,o=this.callbacks.onChatStatus,r=this.callbacks.onTyping,c=this.callbacks.onChatCreated,d={};(t||e.onConnect)&&(d.onConnect=()=>{t&&t(),e.onConnect&&e.onConnect()}),(n||e.onDisconnect)&&(d.onDisconnect=t=>{n&&n(t),e.onDisconnect&&e.onDisconnect(t)}),(i||e.onError)&&(d.onError=t=>{i&&i(t),e.onError&&e.onError(t)}),(s||e.onMessage)&&(d.onMessage=t=>{s&&s(t),e.onMessage&&e.onMessage(t)}),(o||e.onChatStatus)&&(d.onChatStatus=t=>{o&&o(t),e.onChatStatus&&e.onChatStatus(t)}),(r||e.onTyping)&&(d.onTyping=t=>{r&&r(t),e.onTyping&&e.onTyping(t)}),(c||e.onChatCreated)&&(d.onChatCreated=t=>{c&&c(t),e.onChatCreated&&e.onChatCreated(t)}),this.callbacks=d,(0,a.debugLog)("üì° [WebSocketService] üîÑ Callbacks actualizados y fusionados")}}t.WebSocketService=r},3129:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatUI=void 0;const s=n(3974),o=n(8334),a=n(9167),r=n(4412),c=n(4006),d=n(5649),l=n(2782),u=n(5770);t.ChatUI=class{constructor(e={}){if(this.container=null,this.containerMessages=null,this.currentIndex=null,this.chatId=null,this.chatDetail=null,this.lastKnownChatStatus=null,this.lastNotificationType=null,this.messagesLoaded=!1,this.isLoadingInitialMessages=!1,this.openCallbacks=[],this.closeCallbacks=[],this.initializationCallbacks=[],this.activeIntervals=[],this.titleElement=null,this.subtitleElement=null,this.typingIndicator=null,this.lastMessageDate=null,this.isCreatingChatFlag=!1,this.chatCreationPromise=null,this.chatCreationResolve=null,this.options=Object.assign({widget:!1,widgetWidth:"300px",widgetHeight:"400px",userBgColor:"#007bff",otherBgColor:"#6c757d",textColor:"#fff",maxWidthMessage:"80%"},e),this.welcomeMessageManager=new c.WelcomeMessageManager(e.welcomeMessage),this.resolvedPosition=(0,u.resolvePosition)(e.position),(0,s.debugLog)("üí¨ [ChatUI] Posici√≥n resuelta:",this.resolvedPosition),this.options.containerId){const e=document.getElementById(this.options.containerId);if(!e)throw new Error(`No se encontr√≥ el contenedor con ID "${this.options.containerId}"`);this.container=e}}init(){if(!this.container||this.options.widget){const e=document.createElement("div");e.classList.add("chat-widget-host"),document.body.appendChild(e);const t=e.attachShadow({mode:"open"});this.container=document.createElement("div"),this.container.classList.add("chat-widget"),this.options.widget&&this.container.classList.add("chat-widget-fixed"),this.container.style.display="none",this.container.style.opacity="0",this.container.style.transform="translateY(20px)",this.container.setAttribute("data-initial-state","hidden"),(0,s.debugLog)("Chat inicializado con estado: oculto"),t.appendChild(this.container),this.createChatHeader(),this.injectStyles(t)}else this.container&&!this.options.widget||(this.container=document.createElement("div"),this.container.classList.add("chat-widget"),document.body.appendChild(this.container),this.options.widget&&this.container.classList.add("chat-widget-fixed"));this.createChatBody(),this.initializeChatContent()}createChatHeader(){if(!this.container)return;const e=document.createElement("div");e.className="chat-header";const t=document.createElement("div");t.className="chat-header-title",t.textContent="Chat",this.titleElement=t;const n=document.createElement("div");n.className="chat-header-subtitle",n.textContent="Atenci√≥n personalizada",this.subtitleElement=n,t.appendChild(n),e.appendChild(t);const i=document.createElement("div");i.className="chat-header-actions";const s=document.createElement("button");s.className="chat-close-btn",s.setAttribute("aria-label","Cerrar chat"),s.innerHTML='\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t</svg>\n\t\t',s.addEventListener("click",(()=>{this.hide()})),i.appendChild(s),e.appendChild(i),this.container.appendChild(e)}createChatBody(){if(!this.container)return;const e=document.createElement("div");e.className="chat-messages",this.container.appendChild(e),this.containerMessages=e;const t=document.createElement("div");t.className="chat-messages-bottom",this.containerMessages.appendChild(t),this.container.style.display="none",this.container.style.flexDirection="column",this.container.style.gap="0",this.container.setAttribute("data-content-ready","true"),this.containerMessages.addEventListener("scroll",(()=>{}))}injectStyles(e){const t=document.createElement("style");t.textContent=this.getChatStyles(),e.appendChild(t)}getChatStyles(){const e=this.resolvedPosition.widget;return`\n\t\t\t@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');\n\t\t\t:host { all: initial; font-family: 'Inter', sans-serif; }\n\n\t\t\t.chat-widget {\n\t\t\t\tbox-shadow: 0 8px 48px 0 rgba(0,0,0,0.22), 0 1.5px 8px 0 rgba(0,0,0,0.10);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\toverflow: hidden;\n\t\t\t\tbackground: linear-gradient(135deg, #f7faff 0%, #e3e9f6 100%);\n\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\ttransition: box-shadow 0.3s cubic-bezier(0.175,0.885,0.32,1.275);\n\t\t\t}\n\n\t\t\t.chat-widget-fixed {\n\t\t\t\twidth: 340px;\n\t\t\t\theight: 520px;\n\t\t\t\tposition: fixed;\n\t\t\t\t${`\n\t\t\t${e.top?`top: ${e.top};`:""}\n\t\t\t${e.bottom?`bottom: ${e.bottom};`:""}\n\t\t\t${e.left?`left: ${e.left};`:""}\n\t\t\t${e.right?`right: ${e.right};`:""}\n\t\t`.trim()}\n\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\tz-index: 2147483647;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t}\n\t\t\t\n\t\t\t/* üì± ESTILOS M√ìVIL - Chat pantalla completa */\n\t\t\t@media (max-width: 768px) {\n\t\t\t\t.chat-widget-fixed {\n\t\t\t\t\twidth: 100% !important;\n\t\t\t\t\theight: 100% !important;\n\t\t\t\t\ttop: 0 !important;\n\t\t\t\t\tleft: 0 !important;\n\t\t\t\t\tright: 0 !important;\n\t\t\t\t\tbottom: 0 !important;\n\t\t\t\t\tborder-radius: 0 !important;\n\t\t\t\t\tmax-width: 100vw;\n\t\t\t\t\tmax-height: 100vh;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.chat-header {\n\t\t\t\tbackground: #0084ff;\n\t\t\t\tcolor: #fff;\n\t\t\t\tpadding: 18px 20px 14px 20px;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\tborder-top-left-radius: 8px;\n\t\t\t\tborder-top-right-radius: 8px;\n\t\t\t\tbox-shadow: 0 2px 8px rgba(0,132,255,0.08);\n\t\t\t}\n\t\t\t\n\t\t\t/* üì± Header m√≥vil sin border-radius superior */\n\t\t\t@media (max-width: 768px) {\n\t\t\t\t.chat-header {\n\t\t\t\t\tborder-top-left-radius: 0 !important;\n\t\t\t\t\tborder-top-right-radius: 0 !important;\n\t\t\t\t\tpadding: 20px 20px 16px 20px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.chat-header-title {\n\t\t\t\tfont-weight: 700;\n\t\t\t\tfont-size: 17px;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: flex-start;\n\t\t\t\tgap: 4px;\n\t\t\t\tletter-spacing: 0.01em;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-header-subtitle {\n\t\t\t\tfont-size: 13px;\n\t\t\t\tfont-weight: 400;\n\t\t\t\topacity: 0.85;\n\t\t\t\tmargin-top: 2px;\n\t\t\t\tcolor: #fff;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-header-actions {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-close-btn {\n\t\t\t\tbackground: transparent;\n\t\t\t\tborder: none;\n\t\t\t\tcolor: #fff;\n\t\t\t\tcursor: pointer;\n\t\t\t\twidth: 32px;\n\t\t\t\theight: 32px;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tpadding: 0;\n\t\t\t\topacity: 0.9;\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\tborder-radius: 50%;\n\t\t\t}\n\n\t\t\t.chat-close-btn:hover {\n\t\t\t\topacity: 1;\n\t\t\t\tbackground: rgba(255, 255, 255, 0.1);\n\t\t\t}\n\n\t\t\t.chat-close-btn:active {\n\t\t\t\ttransform: scale(0.95);\n\t\t\t\tbackground: rgba(255, 255, 255, 0.15);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-close-btn svg {\n\t\t\t\twidth: 20px;\n\t\t\t\theight: 20px;\n\t\t\t}\n\t\t\t\n\t\t\t/* üì± Bot√≥n de cierre m√°s visible en m√≥vil */\n\t\t\t@media (max-width: 768px) {\n\t\t\t\t.chat-close-btn {\n\t\t\t\t\twidth: 36px;\n\t\t\t\t\theight: 36px;\n\t\t\t\t\tbackground: rgba(255, 255, 255, 0.15);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn:hover {\n\t\t\t\t\tbackground: rgba(255, 255, 255, 0.25);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn svg {\n\t\t\t\t\twidth: 22px;\n\t\t\t\t\theight: 22px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.chat-messages {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tflex: 1;\n\t\t\t\toverflow-y: auto;\n\t\t\t\tpadding: 18px 16px 12px 16px;\n\t\t\t\tbackground: linear-gradient(120deg, #f7faff 60%, #e3e9f6 100%);\n\t\t\t\tscroll-behavior: smooth;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-wrapper {\n\t\t\t\tposition: relative;\n\t\t\t\tmargin-bottom: 16px;\n\t\t\t\tmax-width: 85%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message {\n\t\t\t\tpadding: 12px 16px;\n\t\t\t\tborder-radius: 18px;\n\t\t\t\twhite-space: pre-wrap;\n\t\t\t\tword-break: break-word;\n\t\t\t\tline-height: 1.5;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tposition: relative;\n\t\t\t\tbox-shadow: 0 1px 2px rgba(0,0,0,0.1);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-user-wrapper {\n\t\t\t\talign-self: flex-end;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-user {\n\t\t\t\tbackground: linear-gradient(145deg, #0084ff 70%, #00c6fb 100%);\n\t\t\t\tcolor: #fff;\n\t\t\t\tborder-bottom-right-radius: 8px;\n\t\t\t\tbox-shadow: 0 2px 8px rgba(0,132,255,0.08);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-other-wrapper {\n\t\t\t\talign-self: flex-start;\n\t\t\t\tdisplay: flex;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-other {\n\t\t\t\tbackground: #fff;\n\t\t\t\tcolor: #333;\n\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\tborder-bottom-left-radius: 4px;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-avatar {\n\t\t\t\twidth: 28px;\n\t\t\t\theight: 28px;\n\t\t\t\tborder-radius: 50%;\n\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-message-time {\n\t\t\t\tfont-size: 11px;\n\t\t\t\tcolor: #8a9aa9;\n\t\t\t\tmargin-top: 4px;\n\t\t\t\topacity: 0.8;\n\t\t\t}\n\n\t\t\t.chat-input-container {\n\t\t\t\tpadding: 12px 16px;\n\t\t\t\tbackground: linear-gradient(120deg, #f7faff 60%, #e3e9f6 100%);\n\t\t\t\tdisplay: -webkit-flex;\n\t\t\t\tdisplay: flex;\n\t\t\t\t-webkit-align-items: center;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t\tborder-bottom-left-radius: 8px;\n\t\t\t\tborder-bottom-right-radius: 8px;\n\t\t\t\t/* Fix Safari: Asegurar que el contenedor mantenga su altura */\n\t\t\t\tmin-height: 60px;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\t\t\t\n\t\t\t/* üì± Input m√≥vil sin border-radius inferior */\n\t\t\t@media (max-width: 768px) {\n\t\t\t\t.chat-input-container {\n\t\t\t\t\tborder-bottom-left-radius: 0 !important;\n\t\t\t\t\tborder-bottom-right-radius: 0 !important;\n\t\t\t\t\tpadding: 14px 16px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.chat-input-field {\n\t\t\t\t-webkit-flex: 1;\n\t\t\t\tflex: 1;\n\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 10px 16px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\toutline: none;\n\t\t\t\tbackground: #f8fafb;\n\t\t\t\tcolor: #333;\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t/* Fix Safari: Asegurar que el input no cause overflow */\n\t\t\t\tmin-width: 0;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-input-field:focus {\n\t\t\t\tborder-color: #0084ff;\n\t\t\t\tbackground: #fff;\n\t\t\t\tbox-shadow: 0 0 0 3px rgba(0, 132, 255, 0.1);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-input-field::placeholder {\n\t\t\t\tcolor: #8a9aa9;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-send-btn {\n\t\t\t\tbackground: -webkit-linear-gradient(145deg, #0084ff, #00c6fb);\n\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #00c6fb);\n\t\t\t\tcolor: white;\n\t\t\t\tborder: none;\n\t\t\t\tborder-radius: 50%;\n\t\t\t\twidth: 36px;\n\t\t\t\theight: 36px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tdisplay: -webkit-flex;\n\t\t\t\tdisplay: flex;\n\t\t\t\t-webkit-align-items: center;\n\t\t\t\talign-items: center;\n\t\t\t\t-webkit-justify-content: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t-webkit-flex-shrink: 0;\n\t\t\t\tflex-shrink: 0;\n\t\t\t\t/* Fix Safari: Asegurar dimensiones exactas y prevenir compresi√≥n */\n\t\t\t\tmin-width: 36px;\n\t\t\t\tmin-height: 36px;\n\t\t\t\tmax-width: 36px;\n\t\t\t\tmax-height: 36px;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\t/* Asegurar que el bot√≥n mantenga su posici√≥n */\n\t\t\t\tmargin-left: auto;\n\t\t\t}\n\t\t\t\n\t\t\t.chat-send-btn:hover {\n\t\t\t\tbackground: -webkit-linear-gradient(145deg, #0090ff, #00d6fb);\n\t\t\t\tbackground: linear-gradient(145deg, #0090ff, #00d6fb);\n\t\t\t\t-webkit-transform: scale(1.05);\n\t\t\t\ttransform: scale(1.05);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-send-btn:active {\n\t\t\t\t-webkit-transform: scale(0.95);\n\t\t\t\ttransform: scale(0.95);\n\t\t\t}\n\t\t\t\n\t\t\t.chat-send-btn::before {\n\t\t\t\tcontent: '';\n\t\t\t\twidth: 20px;\n\t\t\t\theight: 20px;\n\t\t\t\tbackground-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3.29106 3.3088C3.00745 3.18938 2.67967 3.25533 2.4643 3.47514C2.24894 3.69495 2.1897 4.02401 2.31488 4.30512L5.40752 11.25H13C13.4142 11.25 13.75 11.5858 13.75 12C13.75 12.4142 13.4142 12.75 13 12.75H5.40754L2.31488 19.6949C2.1897 19.976 2.24894 20.3051 2.4643 20.5249C2.67967 20.7447 3.00745 20.8107 3.29106 20.6912L22.2911 12.6913C22.5692 12.5742 22.75 12.3018 22.75 12C22.75 11.6983 22.5692 11.4259 22.2911 11.3088L3.29106 3.3088Z' fill='white'/%3E%3C/svg%3E");\n\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\tbackground-position: center;\n\t\t\t}\n\t\t`}setChatId(e){if(!this.container)throw new Error("No se ha inicializado el chat");this.chatId!==e&&(this.messagesLoaded=!1,this.lastKnownChatStatus=null,this.lastNotificationType=null),this.chatId=e,this.container.setAttribute("data-chat-id",e),o.ChatSessionStore.getInstance().setCurrent(e),r.ChatMemoryStore.getInstance().setChatId(e)}getChatId(){if(!this.container)throw new Error("No se ha inicializado el chat");return this.chatId||(this.chatId=r.ChatMemoryStore.getInstance().getChatId()),this.chatId}getMessagesContainer(){return this.containerMessages}renderChatMessage(e){const{text:t,sender:n,timestamp:i,senderId:s}=e;this.addMessage(t,n,i,s),this.rebuildDateSeparators()}scrollToBottom(e){this.containerMessages&&(this.containerMessages.scrollTop=e?this.containerMessages.scrollHeight:0)}hide(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"!==this.container.style.display&&(this.container.style.transform="translateY(20px)",this.container.style.opacity="0",setTimeout((()=>{this.container&&(this.container.style.display="none"),this.activeIntervals.forEach((e=>{null!==e.id&&(clearInterval(e.id),e.id=null)})),this.closeCallbacks.forEach((e=>e()))}),300))}show(){if(!this.container)throw new Error("No se ha inicializado el chat");this.container.style.display="flex",this.container.offsetHeight,this.container.style.opacity="1",this.container.style.transform="translateY(0)",this.loadChatContent(),this.refreshChatDetails(),this.scrollToBottom(!0),this.activeIntervals.forEach((e=>{null===e.id&&(e.id=window.setInterval(e.callback,e.intervalMs))})),this.openCallbacks.forEach((e=>e()))}toggle(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"===this.container.style.display?this.show():this.hide()}isVisible(){return!!this.container&&"none"!==this.container.style.display}getOptions(){return this.options}addMessage(e,t,n,i){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");const s=n?new Date(n):new Date;this.addDateSeparatorIfNeeded(s);const o=this.createMessageDiv(e,t,n,i);this.containerMessages.appendChild(o),this.scrollToBottom(!0)}createMessageDiv(e,t,n,i){const s={content:e,sender:this.mapSenderType(t),timestamp:n,senderId:i};return l.MessageRenderer.createMessageElement(s)}mapSenderType(e){return"user"===e?"user":"agent"}getParticipantInitials(e){if(!e)return"BOT";if(!this.chatDetail)return"AH";const t=this.chatDetail.participants.find((t=>t.id===e));return t?(0,d.isBot)(t.name)?"BOT":(0,d.generateInitials)(t.name):"AH"}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}applyModernMessageStyles(e,t){const n=e.querySelector(".message-avatar"),i=e.querySelector(".message-bubble"),s=e.querySelector(".message-content"),o=e.querySelector(".message-text"),a=e.querySelector(".message-metadata"),r=e.querySelector(".message-time"),c=e.querySelector(".message-status");if(e.style.cssText=`\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-end;\n\t\t\tmargin-bottom: 16px;\n\t\t\t${t?"flex-direction: row-reverse; padding-left: 60px;":"flex-direction: row; padding-right: 60px;"}\n\t\t\tanimation: messageSlideIn 0.3s ease-out;\n\t\t`,n){n.style.cssText="\n\t\t\t\tmargin-right: 12px;\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t";const e=n.querySelector(".avatar-circle");e&&(e.style.cssText="\n\t\t\t\t\twidth: 32px;\n\t\t\t\t\theight: 32px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tfont-size: 11px;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tmin-width: 32px;\n\t\t\t\t\tmin-height: 32px;\n\t\t\t\t\tmax-width: 32px;\n\t\t\t\t\tmax-height: 32px;\n\t\t\t\t")}i&&(i.style.cssText="\n\t\t\t\tposition: relative;\n\t\t\t\tmax-width: 85%;\n\t\t\t\tmin-width: 120px;\n\t\t\t"),s&&(s.style.cssText=`\n\t\t\t\tpadding: 12px 16px 8px;\n\t\t\t\tborder-radius: 20px;\n\t\t\t\tposition: relative;\n\t\t\t\tword-break: break-word;\n\t\t\t\t${t?"background: linear-gradient(145deg, #0084ff 60%, #00c6fb 100%);\n\t\t\t\t\t color: white;\n\t\t\t\t\t border-bottom-right-radius: 6px;\n\t\t\t\t\t box-shadow: 0 2px 12px rgba(0, 132, 255, 0.3);":"background: white;\n\t\t\t\t\t color: #1d1d1f;\n\t\t\t\t\t border: 1px solid rgba(0, 0, 0, 0.08);\n\t\t\t\t\t border-bottom-left-radius: 6px;\n\t\t\t\t\t box-shadow: 0 1px 8px rgba(0, 0, 0, 0.08);"}\n\t\t\t\tbackdrop-filter: blur(10px);\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t`),o&&(o.style.cssText="\n\t\t\t\tfont-size: 15px;\n\t\t\t\tline-height: 1.4;\n\t\t\t\tmargin: 0;\n\t\t\t\tfont-weight: 400;\n\t\t\t\tletter-spacing: -0.01em;\n\t\t\t\t-webkit-font-smoothing: antialiased;\n\t\t\t\t-moz-osx-font-smoothing: grayscale;\n\t\t\t"),a&&(a.style.cssText=`\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: ${t?"flex-end":"flex-start"};\n\t\t\t\tgap: 6px;\n\t\t\t\tmargin-top: 2px;\n\t\t\t\tpadding: 0 4px;\n\t\t\t`),r&&(r.style.cssText=`\n\t\t\t\tfont-size: 11px;\n\t\t\t\tcolor: ${t?"rgba(0, 0, 0, 0.8)":"rgba(60, 60, 67, 0.6)"};\n\t\t\t\tfont-weight: 500;\n\t\t\t\tletter-spacing: 0.01em;\n\t\t\t`),c&&(c.style.cssText="\n\t\t\t\tfont-size: 12px;\n\t\t\t\tcolor: rgba(255, 255, 255, 0.8);\n\t\t\t\tmargin-left: 2px;\n\t\t\t"),this.addMessageAnimations()}addMessageAnimations(){if(document.getElementById("modern-message-animations"))return;const e=document.createElement("style");e.id="modern-message-animations",e.textContent="\n\t\t\t@keyframes messageSlideIn {\n\t\t\t\tfrom {\n\t\t\t\t\topacity: 0;\n\t\t\t\t\ttransform: translateY(10px);\n\t\t\t\t}\n\t\t\t\tto {\n\t\t\t\t\topacity: 1;\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Efecto hover deshabilitado por solicitud del usuario */\n\n\t\t\t/* Mejorar tipograf√≠a */\n\t\t\t.modern-message .message-text {\n\t\t\t\t-webkit-font-smoothing: antialiased;\n\t\t\t\t-moz-osx-font-smoothing: grayscale;\n\t\t\t}\n\n\t\t\t/* Estilos responsivos */\n\t\t\t@media (max-width: 480px) {\n\t\t\t\t.modern-message {\n\t\t\t\t\tpadding-left: 20px !important;\n\t\t\t\t\tpadding-right: 20px !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.modern-message .message-bubble {\n\t\t\t\t\tmax-width: 95% !important;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Fix espec√≠fico para Safari */\n\t\t\t@media not all and (min-resolution: 0.001dpcm) {\n\t\t\t\t@supports (-webkit-appearance: none) {\n\t\t\t\t\t.chat-input-container {\n\t\t\t\t\t\tdisplay: -webkit-box !important;\n\t\t\t\t\t\tdisplay: -webkit-flex !important;\n\t\t\t\t\t\t-webkit-box-align: center !important;\n\t\t\t\t\t\t-webkit-align-items: center !important;\n\t\t\t\t\t\tposition: relative !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.chat-send-btn {\n\t\t\t\t\t\tposition: relative !important;\n\t\t\t\t\t\t-webkit-flex-shrink: 0 !important;\n\t\t\t\t\t\tflex-shrink: 0 !important;\n\t\t\t\t\t\twidth: 36px !important;\n\t\t\t\t\t\theight: 36px !important;\n\t\t\t\t\t\tmin-width: 36px !important;\n\t\t\t\t\t\tmin-height: 36px !important;\n\t\t\t\t\t\tdisplay: -webkit-box !important;\n\t\t\t\t\t\tdisplay: -webkit-flex !important;\n\t\t\t\t\t\t-webkit-box-pack: center !important;\n\t\t\t\t\t\t-webkit-justify-content: center !important;\n\t\t\t\t\t\t-webkit-box-align: center !important;\n\t\t\t\t\t\t-webkit-align-items: center !important;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.chat-input-field {\n\t\t\t\t\t\t-webkit-flex: 1 1 auto !important;\n\t\t\t\t\t\tflex: 1 1 auto !important;\n\t\t\t\t\t\tmin-width: 0 !important;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t",document.head.appendChild(e)}getParticipantName(e){if(!e)return"Asistente";if(!this.chatDetail)return"Asesor";const t=this.chatDetail.participants.find((t=>t.id===e));return t?(0,d.isBot)(t.name)?"Asistente":t.name:"Asesor"}addDateSeparatorIfNeeded(e){if(!this.containerMessages)return;const t=(0,d.formatDate)(e);if(!this.lastMessageDate||this.lastMessageDate!==t){const e=(0,d.createDateSeparator)(t);this.containerMessages.appendChild(e),this.lastMessageDate=t}}rebuildDateSeparators(){if(!this.containerMessages)return;this.lastMessageDate=null,this.containerMessages.querySelectorAll(".chat-date-separator").forEach((e=>{var t;return null===(t=e.parentNode)||void 0===t?void 0:t.removeChild(e)}));const e=Array.from(this.containerMessages.querySelectorAll(".chat-message-wrapper"));if(0===e.length)return;let t=null;e.forEach((e=>{const n=new Date,i=(0,d.formatDate)(n);if(i!==t){t=i;const n=(0,d.createDateSeparator)(i);this.containerMessages&&this.containerMessages.insertBefore(n,e)}})),t&&(this.lastMessageDate=t)}initializeChatContent(){return i(this,void 0,void 0,(function*(){try{(0,s.debugLog)("üí¨ [ChatUI] Inicializando contenido del chat..."),this.isVisible()&&this.loadChatContent()}catch(e){console.error("Error iniciando chat:",e)}}))}loadChatContent(){return i(this,void 0,void 0,(function*(){var e;if(null===(e=this.container)||void 0===e?void 0:e.getAttribute("data-chat-initialized"))if(this.messagesLoaded)(0,s.debugLog)("Los mensajes ya fueron cargados previamente, omitiendo fetch...");else{(0,s.debugLog)("Cargando contenido del chat...");try{this.messagesLoaded=!0,this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}catch(e){console.error("Error al cargar el contenido del chat:",e),this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}}else(0,s.debugLog)("Chat no inicializado a√∫n, esperando...")}))}loadChatDetails(){return i(this,void 0,void 0,(function*(){if(this.chatId)try{(0,s.debugLog)("Cargando detalles del chat..."),this.chatDetail=yield(0,a.fetchChatDetail)(this.chatId),(0,s.debugLog)("Detalles del chat:",this.chatDetail),this.lastKnownChatStatus=this.chatDetail.status,(0,s.debugLog)("Estado actual del chat:",this.lastKnownChatStatus),this.updateChatHeader()}catch(e){console.warn("Error al cargar detalles del chat:",e)}}))}checkInitialCommercialStatus(){this.chatDetail&&this.chatDetail.participants.filter((e=>e.isCommercial)).forEach((e=>{e.isOnline||"offline"===this.lastNotificationType||((0,s.debugLog)("Comercial",e.name,"est√° offline en la carga inicial"),setTimeout((()=>{this.sendOfflineNotificationMessage(e.name,!0),this.lastNotificationType="offline"}),100))}))}updateChatHeader(){if(!this.chatDetail||!this.titleElement||!this.subtitleElement)return;const e=this.chatDetail.participants.filter((e=>e.isCommercial));if("pending"===this.chatDetail.status&&e.length>1)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con asesor (${e.length} disponibles)...`;else if("pending"===this.chatDetail.status&&1===e.length)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con ${e[0].name}...`;else if(e.length>0){const t=e[0];if("active"===this.chatDetail.status){const e=document.createElement("div");e.className="chat-online-indicator";const n=document.createElement("span");n.className="chat-status-dot "+(t.isOnline?"online":"offline");const i=document.createElement("span");i.textContent=`Chat con ${t.name}`,e.appendChild(n),e.appendChild(i),this.titleElement.innerHTML="",this.titleElement.appendChild(e);const s=t.isOnline?"En l√≠nea":"Desconectado",o=t.isTyping?" ‚Ä¢ Escribiendo...":"";this.subtitleElement.textContent=`${s}${o}`}else{this.titleElement.textContent=`Chat con ${t.name}`;const e="inactive"===this.chatDetail.status?"Inactivo":"closed"===this.chatDetail.status?"Cerrado":"archived"===this.chatDetail.status?"Archivado":"Conectando...";this.subtitleElement.textContent=e}}else this.titleElement.textContent="Chat",this.subtitleElement.textContent="Buscando asesor disponible..."}sendOfflineNotificationMessage(e,t=!1){let n;n=t?`${e} no est√° disponible en este momento. Te responder√° tan pronto como est√© online.`:`${e} se ha desconectado temporalmente. Te responder√° tan pronto como est√© disponible nuevamente.`,(0,s.debugLog)("Enviando mensaje autom√°tico de desconexi√≥n:",n),this.addSystemMessage(n)}addWelcomeMessage(){if((0,s.debugLog)("üí¨ [ChatUI] Verificando si agregar mensaje de bienvenida..."),!this.containerMessages||!Array.from(this.containerMessages.children).some((e=>e.classList&&(e.classList.contains("chat-message-user-wrapper")||e.classList.contains("chat-message-other-wrapper"))))){const e=this.welcomeMessageManager.getWelcomeMessage();if(e){this.addMessage(e,"other"),(0,s.debugLog)("üí¨ [ChatUI] ‚úÖ Mensaje de bienvenida agregado");const t=this.welcomeMessageManager.getTips();t.length>0&&setTimeout((()=>{t.forEach(((e,t)=>{setTimeout((()=>{this.addMessage(e,"other")}),1e3*t)}))}),2e3)}}}checkAndAddWelcomeMessage(){if(!this.containerMessages)return void(0,s.debugLog)("üí¨ [ChatUI] Container de mensajes no disponible, omitiendo verificaci√≥n de bienvenida");if(this.isLoadingInitialMessages)return void(0,s.debugLog)("üí¨ [ChatUI] üîí Carga inicial de mensajes en progreso, omitiendo verificaci√≥n de bienvenida para evitar race condition");const e=this.containerMessages.querySelector(".loading-messages-indicator");if(e&&"none"!==e.style.display)return void(0,s.debugLog)("üí¨ [ChatUI] Indicador de carga visible, omitiendo mensaje de bienvenida autom√°tico");const t=Array.from(this.containerMessages.children).filter((e=>e.classList&&(e.classList.contains("chat-message-user-wrapper")||e.classList.contains("chat-message-other-wrapper"))));(0,s.debugLog)(`üí¨ [ChatUI] Verificaci√≥n autom√°tica: ${t.length} mensajes encontrados`),0===t.length?((0,s.debugLog)("üí¨ [ChatUI] ‚úÖ Chat vac√≠o confirmado, agregando mensaje de bienvenida autom√°ticamente"),this.addWelcomeMessage()):(0,s.debugLog)("üí¨ [ChatUI] Chat tiene mensajes, omitiendo mensaje de bienvenida autom√°tico")}addSystemMessage(e){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");this.addDateSeparatorIfNeeded(new Date);const t=document.createElement("div");t.classList.add("chat-message-wrapper","chat-system-message-wrapper");const n=document.createElement("div");n.classList.add("chat-message","chat-system-message"),n.textContent=e,t.appendChild(n),this.containerMessages.appendChild(t),this.scrollToBottom(!0)}refreshChatDetails(){return i(this,void 0,void 0,(function*(){yield this.loadChatDetails()}))}onOpen(e){this.openCallbacks.push(e)}onClose(e){this.closeCallbacks.push(e)}setWelcomeMessage(e){this.welcomeMessageManager.updateConfig(e)}setCustomWelcomeMessage(e){this.welcomeMessageManager.updateConfig({style:"custom",customMessage:e})}getWelcomeMessageConfig(){return this.welcomeMessageManager.getConfig()}onChatInitialized(e){this.initializationCallbacks.push(e)}onActiveInterval(e,t=5e3){this.activeIntervals.push({id:null,callback:e,intervalMs:t})}isCreatingChat(){return this.isCreatingChatFlag}waitForChatCreation(){return i(this,void 0,void 0,(function*(){this.chatCreationPromise&&(yield this.chatCreationPromise)}))}setCreatingChat(e){this.isCreatingChatFlag=e,e?this.chatCreationPromise=new Promise((e=>{this.chatCreationResolve=e})):(this.chatCreationResolve&&(this.chatCreationResolve(),this.chatCreationResolve=null),this.chatCreationPromise=null)}showLoadingMessages(){if(!this.containerMessages)return;let e=this.containerMessages.querySelector(".loading-messages-indicator");e||(e=document.createElement("div"),e.className="loading-messages-indicator",e.style.cssText="\n\t\t\t\ttext-align: center;\n\t\t\t\tpadding: 20px;\n\t\t\t\tcolor: #666;\n\t\t\t\tfont-size: 14px;\n\t\t\t",e.innerHTML='\n\t\t\t\t<div style="display: inline-block; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #0084ff; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;"></div>\n\t\t\t\tCargando mensajes...\n\t\t\t\t<style>\n\t\t\t\t\t@keyframes spin {\n\t\t\t\t\t\t0% { transform: rotate(0deg); }\n\t\t\t\t\t\t100% { transform: rotate(360deg); }\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t',this.containerMessages.appendChild(e)),e.style.display="block",(0,s.debugLog)("üí¨ [ChatUI] Indicador de carga de mensajes mostrado")}hideLoadingMessages(){if(!this.containerMessages)return;const e=this.containerMessages.querySelector(".loading-messages-indicator");e&&(e.style.display="none"),(0,s.debugLog)("üí¨ [ChatUI] Indicador de carga de mensajes ocultado")}clearMessages(){this.containerMessages&&(Array.from(this.containerMessages.children).forEach((e=>{e.classList.contains("loading-messages-indicator")||e.remove()})),this.messagesLoaded=!1,this.lastMessageDate=null,(0,s.debugLog)("üí¨ [ChatUI] Mensajes limpiados"))}scrollToBottomV2(){this.containerMessages&&requestAnimationFrame((()=>{this.containerMessages&&(this.containerMessages.scrollTop=this.containerMessages.scrollHeight,(0,s.debugLog)("üí¨ [ChatUI] Scroll al bottom realizado (V2)"))}))}setLoadingInitialMessages(e){this.isLoadingInitialMessages=e,(0,s.debugLog)(`üí¨ [ChatUI] üîí Estado isLoadingInitialMessages cambiado a: ${e}`)}isLoadingMessages(){return this.isLoadingInitialMessages}getResolvedPosition(){return this.resolvedPosition}}},3507:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n=(t="string"==typeof e?(0,s.default)(e):e,Uint8Array.of((15&t[3])<<4|t[4]>>4&15,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|15&t[6],t[7],(15&t[1])<<4|(240&t[2])>>4,(15&t[2])<<4|(240&t[3])>>4,16|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]));return"string"==typeof e?(0,o.unsafeStringify)(n):n};var i,s=(i=n(6792))&&i.__esModule?i:{default:i},o=n(9910)},3518:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s,o,a=(i=n(2858))&&i.__esModule?i:{default:i},r=n(9910),c=0,d=0;t.default=function(e,t,n){var i=t&&n||0,l=t||new Array(16),u=(e=e||{}).node,h=e.clockseq;if(e._v6||(u||(u=s),null==h&&(h=o)),null==u||null==h){var g=e.random||(e.rng||a.default)();null==u&&(u=[g[0],g[1],g[2],g[3],g[4],g[5]],s||e._v6||(u[0]|=1,s=u)),null==h&&(h=16383&(g[6]<<8|g[7]),void 0!==o||e._v6||(o=h))}var p=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:d+1,m=p-c+(f-d)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||p>c)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,d=f,o=h;var b=(1e4*(268435455&(p+=122192928e5))+f)%4294967296;l[i++]=b>>>24&255,l[i++]=b>>>16&255,l[i++]=b>>>8&255,l[i++]=255&b;var v=p/4294967296*1e4&268435455;l[i++]=v>>>8&255,l[i++]=255&v,l[i++]=v>>>24&15|16,l[i++]=v>>>16&255,l[i++]=h>>>8|128,l[i++]=255&h;for(var y=0;y<6;++y)l[i+y]=u[y];return t||(0,r.unsafeStringify)(l)}},3574:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingType=t.COMMON_ACTIVE_HOURS=t.createActiveHoursConfig=t.ActiveHoursValidator=t.BUSINESS_WELCOME_TEMPLATES=t.WelcomeMessageManager=t.useIdentitySignal=t.IdentitySignal=t.AsyncSignal=t.Signal=t.ConfidenceLevel=void 0;var o=n(6932);Object.defineProperty(t,"ConfidenceLevel",{enumerable:!0,get:function(){return o.ConfidenceLevel}});var a=n(1556);Object.defineProperty(t,"Signal",{enumerable:!0,get:function(){return a.Signal}}),Object.defineProperty(t,"AsyncSignal",{enumerable:!0,get:function(){return a.AsyncSignal}});var r=n(5303);Object.defineProperty(t,"IdentitySignal",{enumerable:!0,get:function(){return r.IdentitySignal}}),Object.defineProperty(t,"useIdentitySignal",{enumerable:!0,get:function(){return r.useIdentitySignal}});var c=n(4006);Object.defineProperty(t,"WelcomeMessageManager",{enumerable:!0,get:function(){return c.WelcomeMessageManager}}),Object.defineProperty(t,"BUSINESS_WELCOME_TEMPLATES",{enumerable:!0,get:function(){return c.BUSINESS_WELCOME_TEMPLATES}});var d,l=n(6571);Object.defineProperty(t,"ActiveHoursValidator",{enumerable:!0,get:function(){return l.ActiveHoursValidator}}),Object.defineProperty(t,"createActiveHoursConfig",{enumerable:!0,get:function(){return l.createActiveHoursConfig}}),Object.defineProperty(t,"COMMON_ACTIVE_HOURS",{enumerable:!0,get:function(){return l.COMMON_ACTIVE_HOURS}}),s(n(6161),t),function(e){e.PAGE_VIEW="page_view",e.CLICK="click",e.HOVER="hover"}(d||(t.TrackingType=d={}))},3626:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatInputUI=void 0,t.ChatInputUI=class{constructor(e){this.inputContainer=null,this.submitCallbacks=[],this.chatUI=e}init(){this.inputContainer=document.createElement("div"),this.inputContainer.style.display="flex",this.inputContainer.style.padding="5px";const e=document.createElement("input");e.type="text",e.style.flex="1",e.placeholder="Escribe un mensaje...";const t=document.createElement("button");t.textContent="Enviar",t.addEventListener("click",(()=>{const t=e.value.trim();t&&(this.submitCallbacks.forEach((e=>e(t))),this.chatUI.renderChatMessage({text:t,sender:"user"}),e.value="")})),e.addEventListener("keydown",(e=>{"Enter"===e.key&&t.click()})),this.inputContainer.appendChild(e),this.inputContainer.appendChild(t),document.body.appendChild(this.inputContainer)}onSubmit(e){this.submitCallbacks.push(e)}getContainer(){return this.inputContainer}destroy(){this.inputContainer&&this.inputContainer.parentNode&&this.inputContainer.parentNode.removeChild(this.inputContainer),this.inputContainer=null,this.submitCallbacks=[]}}},3735:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingEventV2Stage=void 0;const i=n(2831);t.TrackingEventV2Stage=class{process(e){var t,n;if("tracking:tracking-event"!==e.type)return e;try{const s=e.data||{},o=e.metadata||{},a=localStorage.getItem("guidersApiKey")||(null===(t=window.GUIDERS_CONFIG)||void 0===t?void 0:t.apiKey)||"",r=localStorage.getItem("fingerprint")||null,c=(null===(n=o.session)||void 0===n?void 0:n.sessionId)||null;let d=null;try{const e=localStorage.getItem("accessToken");if(e){const t=JSON.parse(atob(e.split(".")[1]));d=(null==t?void 0:t.sub)||null}}catch(e){}const l=s.eventType||s.type||e.type,u=Object.assign(Object.assign({},s.metadata||{}),o),h={event_id:s.trackingEventId||(0,i.v4)(),ts_client:new Date(e.timestamp).toISOString(),ts_server:null,api_key:a,device_id:r,session_id:c,visitor_id:null,user_id:d,event_name:l,props:u,ua:"undefined"!=typeof navigator?navigator.userAgent:"",ip:null};e.data=h,delete e.metadata}catch(e){console.warn("[TrackingEventV2Stage] ‚ùå Fall√≥ transformaci√≥n a esquema v2, se env√≠a original:",e)}return e}}},3776:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;const r=n(4956),c=n(6214),d=o(n(4627)),l=n(5942),u=n(7743),h=n(4454),g=(0,a(n(7833)).default)("socket.io-client:manager");class p extends h.Emitter{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,(0,r.installTimerFunctions)(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new u.Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||d;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(g("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;g("opening %s",this.uri),this.engine=new r.Socket(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=(0,l.on)(t,"open",(function(){n.onopen(),e&&e()})),s=t=>{g("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},o=(0,l.on)(t,"error",s);if(!1!==this._timeout){const e=this._timeout;g("connect attempt will timeout after %d",e);const n=this.setTimeoutFn((()=>{g("connect attempt timed out after %d",e),i(),s(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){g("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push((0,l.on)(e,"ping",this.onping.bind(this)),(0,l.on)(e,"data",this.ondata.bind(this)),(0,l.on)(e,"error",this.onerror.bind(this)),(0,l.on)(e,"close",this.onclose.bind(this)),(0,l.on)(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){(0,r.nextTick)((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){g("error",e),this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new c.Socket(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return void g("socket %s is still active, skipping close",e);this._close()}_packet(e){g("writing packet %j",e);const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){g("cleanup"),this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){g("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;g("closed due to %s",e),this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)g("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();g("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(g("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(g("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(g("reconnect success"),e.onreconnect())})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}t.Manager=p},3974:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugLog=function(...e){"undefined"!=typeof window&&!0===window.GUIDERS_DEBUG&&console.log(...e)},t.debugWarn=function(...e){console.warn(...e)},t.debugError=function(...e){console.error(...e)},t.enableDebug=function(){"undefined"!=typeof window&&(window.GUIDERS_DEBUG=!0,console.log("[Guiders SDK] üêõ Modo debug habilitado"))},t.disableDebug=function(){"undefined"!=typeof window&&(window.GUIDERS_DEBUG=!1,console.log("[Guiders SDK] üêõ Modo debug deshabilitado"))}},4006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUSINESS_WELCOME_TEMPLATES=t.WelcomeMessageManager=void 0,t.WelcomeMessageManager=class{constructor(e={}){this.config=Object.assign({enabled:!0,style:"friendly",includeEmojis:!0,language:"es",showTips:!0},e)}getWelcomeMessage(){return this.config.enabled?"custom"===this.config.style&&this.config.customMessage?this.config.customMessage:this.getPresetMessage(this.config.style,this.config.language):""}getPresetMessage(e,t="es"){const n={es:{friendly:this.config.includeEmojis?"¬°Hola! üëã Me alegra que est√©s aqu√≠. Soy tu asistente virtual y estoy listo para ayudarte con cualquier pregunta que tengas. ¬øEn qu√© puedo ayudarte hoy? üòä":"¬°Hola! Me alegra que est√©s aqu√≠. Soy tu asistente virtual y estoy listo para ayudarte con cualquier pregunta que tengas. ¬øEn qu√© puedo ayudarte hoy?",professional:this.config.includeEmojis?"Buenos d√≠as/tardes. üëî Bienvenido a nuestro servicio de atenci√≥n al cliente. Estoy aqu√≠ para proporcionarle asistencia especializada. Por favor, describa su consulta y un agente le atender√° a la brevedad.":"Buenos d√≠as/tardes. Bienvenido a nuestro servicio de atenci√≥n al cliente. Estoy aqu√≠ para proporcionarle asistencia especializada. Por favor, describa su consulta y un agente le atender√° a la brevedad.",casual:this.config.includeEmojis?"¬°Hey! ü§ô ¬øQu√© tal? Soy tu chat de soporte. Si necesitas algo o tienes alguna duda, solo escr√≠beme. Estoy aqu√≠ para echarte una mano. ¬°Dale! üöÄ":"¬°Hey! ¬øQu√© tal? Soy tu chat de soporte. Si necesitas algo o tienes alguna duda, solo escr√≠beme. Estoy aqu√≠ para echarte una mano. ¬°Dale!",helpful:this.config.includeEmojis?"¬°Hola y bienvenido! üåü Estoy aqu√≠ para hacer tu experiencia lo m√°s f√°cil posible. Puedes preguntarme sobre nuestros productos, servicios, o cualquier duda que tengas. ¬°Empezamos! üí¨":"¬°Hola y bienvenido! Estoy aqu√≠ para hacer tu experiencia lo m√°s f√°cil posible. Puedes preguntarme sobre nuestros productos, servicios, o cualquier duda que tengas. ¬°Empezamos!"},en:{friendly:this.config.includeEmojis?"Hello! üëã I'm so glad you're here. I'm your virtual assistant and I'm ready to help you with any questions you might have. How can I help you today? üòä":"Hello! I'm so glad you're here. I'm your virtual assistant and I'm ready to help you with any questions you might have. How can I help you today?",professional:this.config.includeEmojis?"Good day. üëî Welcome to our customer service platform. I'm here to provide you with specialized assistance. Please describe your inquiry and an agent will attend to you shortly.":"Good day. Welcome to our customer service platform. I'm here to provide you with specialized assistance. Please describe your inquiry and an agent will attend to you shortly.",casual:this.config.includeEmojis?"Hey there! ü§ô What's up? I'm your support chat. If you need anything or have questions, just drop me a message. I'm here to help you out. Let's go! üöÄ":"Hey there! What's up? I'm your support chat. If you need anything or have questions, just drop me a message. I'm here to help you out. Let's go!",helpful:this.config.includeEmojis?"Hello and welcome! üåü I'm here to make your experience as smooth as possible. You can ask me about our products, services, or any questions you might have. Let's get started! üí¨":"Hello and welcome! I'm here to make your experience as smooth as possible. You can ask me about our products, services, or any questions you might have. Let's get started!"}};return(n[t]||n.es)[e]||n.es.friendly}getTips(){if(!this.config.showTips)return[];const e={es:["üí° Tip: S√© espec√≠fico en tu consulta para obtener una respuesta m√°s r√°pida","‚è±Ô∏è Tiempo promedio de respuesta: 2-5 minutos","üì± Este chat funciona desde cualquier dispositivo"],en:["üí° Tip: Be specific in your query to get a faster response","‚è±Ô∏è Average response time: 2-5 minutes","üì± This chat works from any device"]};return[...e[this.config.language||"es"]||e.es]}updateConfig(e){this.config=Object.assign(Object.assign({},this.config),e)}getConfig(){return Object.assign({},this.config)}},t.BUSINESS_WELCOME_TEMPLATES={ecommerce:{es:"¬°Hola! üõçÔ∏è Bienvenido a nuestra tienda. Estoy aqu√≠ para ayudarte con tus compras, seguimiento de pedidos, devoluciones o cualquier pregunta sobre nuestros productos. ¬øEn qu√© puedo asistirte?",en:"Hello! üõçÔ∏è Welcome to our store. I'm here to help you with your purchases, order tracking, returns, or any questions about our products. How can I assist you?"},saas:{es:"¬°Hola! üíª Bienvenido al soporte t√©cnico. Estoy aqu√≠ para ayudarte con configuraci√≥n, resoluci√≥n de problemas, facturaci√≥n o cualquier duda sobre nuestro software. ¬°Cu√©ntame qu√© necesitas!",en:"Hello! üíª Welcome to technical support. I'm here to help you with setup, troubleshooting, billing, or any questions about our software. Tell me what you need!"},healthcare:{es:"¬°Hola! üè• Bienvenido a nuestro centro de atenci√≥n. Estoy aqu√≠ para ayudarte con citas, informaci√≥n sobre servicios, seguros m√©dicos o consultas generales. ¬øC√≥mo puedo ayudarte hoy?",en:"Hello! üè• Welcome to our care center. I'm here to help you with appointments, service information, medical insurance, or general inquiries. How can I help you today?"},education:{es:"¬°Hola! üìö Bienvenido a nuestro centro de aprendizaje. Estoy aqu√≠ para ayudarte con cursos, inscripciones, material de estudio o cualquier consulta acad√©mica. ¬øQu√© necesitas saber?",en:"Hello! üìö Welcome to our learning center. I'm here to help you with courses, enrollments, study materials, or any academic inquiries. What do you need to know?"},finance:{es:"¬°Hola! üí∞ Bienvenido a nuestros servicios financieros. Estoy aqu√≠ para ayudarte con consultas sobre cuentas, transacciones, inversiones o servicios bancarios. ¬øEn qu√© puedo asistirte?",en:"Hello! üí∞ Welcome to our financial services. I'm here to help you with account inquiries, transactions, investments, or banking services. How can I assist you?"}}},4110:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasCORS=void 0;let n=!1;try{n="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}t.hasCORS=n},4213:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},4412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMemoryStore=void 0;class n{constructor(){this.currentChatId=null}static getInstance(){return n.instance||(n.instance=new n),n.instance}setChatId(e){this.currentChatId=e,console.log("[ChatMemoryStore] üíæ Chat ID guardado en memoria:",e)}getChatId(){return this.currentChatId}clearChatId(){this.currentChatId=null,console.log("[ChatMemoryStore] üóëÔ∏è Chat ID limpiado de memoria")}hasChatId(){return null!==this.currentChatId}}t.ChatMemoryStore=n},4454:(e,t,n)=>{"use strict";function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}n.r(t),n.d(t,{Emitter:()=>i}),i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<i.length;s++)if((n=i[s])===t||n.fn===t){i.splice(s,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var s=(n=n.slice(0)).length;i<s;++i)n[i].apply(this,t)}return this},i.prototype.emitReserved=i.prototype.emit,i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},4476:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInjectionStage=void 0,t.SessionInjectionStage=class{constructor(e=null){this.sessionManager=e}setSessionManager(e){this.sessionManager=e}process(e){var t;if(console.log("SessionInjectionStage: Iniciando inyecci√≥n de sesi√≥n..."),!this.sessionManager)return console.warn("SessionInjectionStage: No session manager set, skipping session injection."),e;const n=this.sessionManager.getCurrentSession();return n&&(e.metadata||(e.metadata={}),e.metadata.session={sessionId:n.sessionId,startTime:n.startTime,lastActiveTime:n.lastActiveTime,totalActiveTime:n.totalActiveTime,isActive:n.isActive,isIdle:n.isIdle},e.data||(e.data={}),e.data.sessionId=n.sessionId),console.log("SessionInjectionStage: Sesi√≥n inyectada en el evento:",null===(t=e.metadata)||void 0===t?void 0:t.session),e}}},4480:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WT=void 0;const s=n(4689),o=n(4624),a=n(6376),r=(0,i(n(7833)).default)("engine.io-client:webtransport");class c extends s.Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then((()=>{r("transport closed gracefully"),this.onClose()})).catch((e=>{r("transport closed due to %s",e),this.onError("webtransport error",e)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((e=>{const t=(0,a.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=(0,a.createPacketEncoderStream)();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{n.read().then((({done:e,value:t})=>{e?r("session is closed"):(r("received chunk: %o",t),this.onPacket(t),s())})).catch((e=>{r("an error occurred while reading: %s",e)}))};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then((()=>this.onOpen()))}))}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then((()=>{i&&(0,o.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}}t.WT=c},4505:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4624:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultBinaryType=t.globalThisShim=t.nextTick=void 0,t.createCookieJar=function(){},t.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),t.globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),t.defaultBinaryType="arraybuffer"},4627:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const i=n(4454),s=n(4926),o=n(9133),a=(0,n(7833).default)("socket.io-parser"),r=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var c;function d(e){return"[object Object]"===Object.prototype.toString.call(e)}t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(c=t.PacketType||(t.PacketType={})),t.Encoder=class{constructor(e){this.replacer=e}encode(e){return a("encoding packet %j",e),e.type!==c.EVENT&&e.type!==c.ACK||!(0,o.hasBinary)(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===c.EVENT?c.BINARY_EVENT:c.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==c.BINARY_EVENT&&e.type!==c.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),a("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=(0,s.deconstructPacket)(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}};class l extends i.Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===c.BINARY_EVENT;n||t.type===c.BINARY_ACK?(t.type=n?c.EVENT:c.ACK,this.reconstructor=new u(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!(0,o.isBinary)(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===c[n.type])throw new Error("unknown packet type "+n.type);if(n.type===c.BINARY_EVENT||n.type===c.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(i,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(i,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!l.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return a("decoded %s as %j",e,n),n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case c.CONNECT:return d(t);case c.DISCONNECT:return void 0===t;case c.CONNECT_ERROR:return"string"==typeof t||d(t);case c.EVENT:case c.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===r.indexOf(t[0]));case c.ACK:case c.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}t.Decoder=l;class u{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=(0,s.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},4671:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e={},t,n=0){var a=(0,s.default)(c(c({},e),{},{_v6:!0}),new Uint8Array(16));if(a=(0,o.default)(a),t){for(var r=0;r<16;r++)t[n+r]=a[r];return t}return(0,i.unsafeStringify)(a)};var i=n(9910),s=a(n(3518)),o=a(n(343));function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},4689:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=t.TransportError=void 0;const s=n(6376),o=n(4454),a=n(5374),r=n(8661),c=(0,i(n(7833)).default)("engine.io-client:transport");class d extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}t.TransportError=d;class l extends o.Emitter{constructor(e){super(),this.writable=!1,(0,a.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new d(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):c("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=(0,s.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=(0,r.encode)(e);return t.length?"?"+t:""}}t.Transport=l},4729:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsentBannerUI=void 0,t.ConsentBannerUI=class{constructor(e={}){var t,n,i,s,o,a,r,c,d,l,u,h,g,p,f,m,b,v,y,w,C;this.bannerElement=null,this.onAccept=()=>{console.log("[ConsentBannerUI] üü¢ Callback onAccept (no configurado)")},this.onDeny=()=>{console.log("[ConsentBannerUI] üî¥ Callback onDeny (no configurado)")},this.onPreferences=()=>{console.log("[ConsentBannerUI] ‚öôÔ∏è Callback onPreferences (no configurado)")};this.config={enabled:null===(t=e.enabled)||void 0===t||t,style:null!==(n=e.style)&&void 0!==n?n:"bottom_bar",text:null!==(i=e.text)&&void 0!==i?i:"üç™ Usamos cookies para mejorar tu experiencia y proporcionar chat en vivo.",acceptText:null!==(s=e.acceptText)&&void 0!==s?s:"Aceptar Todo",denyText:null!==(o=e.denyText)&&void 0!==o?o:"Rechazar",preferencesText:null!==(a=e.preferencesText)&&void 0!==a?a:"Preferencias",showPreferences:null===(r=e.showPreferences)||void 0===r||r,colors:{background:null!==(d=null===(c=e.colors)||void 0===c?void 0:c.background)&&void 0!==d?d:"#2c3e50",text:null!==(u=null===(l=e.colors)||void 0===l?void 0:l.text)&&void 0!==u?u:"#ffffff",acceptButton:null!==(g=null===(h=e.colors)||void 0===h?void 0:h.acceptButton)&&void 0!==g?g:"#27ae60",denyButton:null!==(f=null===(p=e.colors)||void 0===p?void 0:p.denyButton)&&void 0!==f?f:"#95a5a6",preferencesButton:null!==(b=null===(m=e.colors)||void 0===m?void 0:m.preferencesButton)&&void 0!==b?b:"#3498db"},position:null!==(v=e.position)&&void 0!==v?v:"bottom",showCloseButton:null!==(y=e.showCloseButton)&&void 0!==y&&y,autoShow:null===(w=e.autoShow)||void 0===w||w,className:null!==(C=e.className)&&void 0!==C?C:""},console.log("[ConsentBannerUI] üé® Inicializado con config:",this.config)}render(){if(this.config.enabled&&"none"!==this.config.style){switch(this.remove(),this.config.style){case"bottom_bar":this.bannerElement=this.createBottomBar();break;case"modal":this.bannerElement=this.createModal();break;case"corner":this.bannerElement=this.createCorner()}this.bannerElement&&(this.config.className&&this.bannerElement.classList.add(this.config.className),document.body.appendChild(this.bannerElement),console.log("[ConsentBannerUI] ‚úÖ Banner renderizado (estilo: "+this.config.style+")"))}else console.log("[ConsentBannerUI] ‚ö†Ô∏è Banner deshabilitado")}show(){this.bannerElement&&(this.bannerElement.style.display="block",console.log("[ConsentBannerUI] üëÅÔ∏è Banner mostrado"))}hide(){this.bannerElement&&(this.bannerElement.style.display="none",console.log("[ConsentBannerUI] üôà Banner oculto"))}remove(){this.bannerElement&&this.bannerElement.parentNode&&(this.bannerElement.parentNode.removeChild(this.bannerElement),this.bannerElement=null,console.log("[ConsentBannerUI] üóëÔ∏è Banner removido"))}isVisible(){return null!==this.bannerElement&&"none"!==this.bannerElement.style.display}createBottomBar(){const e=document.createElement("div");e.id="guiders-consent-banner",e.setAttribute("role","dialog"),e.setAttribute("aria-label","Consentimiento de cookies"),e.style.cssText=`\n      position: fixed;\n      ${this.config.position}: 0;\n      left: 0;\n      right: 0;\n      background: ${this.config.colors.background};\n      color: ${this.config.colors.text};\n      padding: 20px;\n      z-index: 999999;\n      box-shadow: 0 -2px 10px rgba(0,0,0,0.2);\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n      animation: slideUp 0.3s ease-out;\n    `;const t=document.createElement("div");t.style.cssText="\n      max-width: 1200px;\n      margin: 0 auto;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      flex-wrap: wrap;\n      gap: 15px;\n    ";const n=document.createElement("p");n.textContent=this.config.text,n.style.cssText="\n      margin: 0;\n      flex: 1;\n      min-width: 300px;\n      font-size: 14px;\n      line-height: 1.5;\n    ",t.appendChild(n);const i=document.createElement("div");i.style.cssText="\n      display: flex;\n      gap: 10px;\n      flex-wrap: wrap;\n    ";const s=this.createButton(this.config.acceptText,this.config.colors.acceptButton,(()=>this.onAccept()));if(s.setAttribute("aria-label","Aceptar todas las cookies"),i.appendChild(s),this.config.showPreferences){const e=this.createButton(this.config.preferencesText,this.config.colors.preferencesButton,(()=>this.onPreferences()));e.setAttribute("aria-label","Configurar preferencias de cookies"),i.appendChild(e)}const o=this.createButton(this.config.denyText,this.config.colors.denyButton,(()=>this.onDeny()));return o.setAttribute("aria-label","Rechazar cookies no esenciales"),i.appendChild(o),t.appendChild(i),e.appendChild(t),this.injectStyles(),e}createModal(){const e=document.createElement("div");e.id="guiders-consent-overlay",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-label","Consentimiento de cookies"),e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0,0,0,0.7);\n      z-index: 999998;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n      animation: fadeIn 0.3s ease-out;\n    ";const t=document.createElement("div");t.style.cssText='\n      background: white;\n      padding: 30px;\n      border-radius: 8px;\n      max-width: 500px;\n      width: 100%;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n      animation: scaleIn 0.3s ease-out;\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n    ';const n=document.createElement("h2");n.textContent="üç™ Gesti√≥n de Cookies",n.style.cssText="\n      margin-top: 0;\n      color: #2c3e50;\n      font-size: 20px;\n      font-weight: 600;\n    ",t.appendChild(n);const i=document.createElement("p");i.textContent=this.config.text,i.style.cssText="\n      color: #555;\n      line-height: 1.6;\n      margin-bottom: 20px;\n      font-size: 14px;\n    ",t.appendChild(i);const s=document.createElement("div");s.style.cssText="\n      display: flex;\n      gap: 10px;\n      justify-content: flex-end;\n      flex-wrap: wrap;\n    ";const o=this.createButton(this.config.acceptText,this.config.colors.acceptButton,(()=>this.onAccept()));if(s.appendChild(o),this.config.showPreferences){const e=this.createButton(this.config.preferencesText,this.config.colors.preferencesButton,(()=>this.onPreferences()));s.appendChild(e)}const a=this.createButton(this.config.denyText,this.config.colors.denyButton,(()=>this.onDeny()));return s.appendChild(a),t.appendChild(s),e.appendChild(t),this.injectStyles(),e}createCorner(){const e=document.createElement("div");e.id="guiders-consent-banner",e.setAttribute("role","dialog"),e.setAttribute("aria-label","Consentimiento de cookies"),e.style.cssText=`\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: ${this.config.colors.background};\n      color: ${this.config.colors.text};\n      padding: 20px;\n      border-radius: 8px;\n      max-width: 350px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      z-index: 999999;\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n      animation: slideInRight 0.3s ease-out;\n    `;const t=document.createElement("p");t.textContent=this.config.text,t.style.cssText="\n      margin: 0 0 15px 0;\n      font-size: 13px;\n      line-height: 1.5;\n    ",e.appendChild(t);const n=document.createElement("div");n.style.cssText="\n      display: flex;\n      gap: 8px;\n      flex-direction: column;\n    ";const i=this.createButton(this.config.acceptText,this.config.colors.acceptButton,(()=>this.onAccept()));if(i.style.width="100%",n.appendChild(i),this.config.showPreferences){const e=this.createButton(this.config.preferencesText,this.config.colors.preferencesButton,(()=>this.onPreferences()));e.style.width="100%",n.appendChild(e)}const s=this.createButton(this.config.denyText,this.config.colors.denyButton,(()=>this.onDeny()));return s.style.width="100%",n.appendChild(s),e.appendChild(n),this.injectStyles(),e}createButton(e,t,n){const i=document.createElement("button");return i.textContent=e,i.style.cssText=`\n      background: ${t};\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      cursor: pointer;\n      border-radius: 4px;\n      font-weight: 600;\n      font-size: 14px;\n      transition: all 0.2s ease;\n      font-family: inherit;\n    `,i.addEventListener("mouseenter",(()=>{i.style.transform="translateY(-1px)",i.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)"})),i.addEventListener("mouseleave",(()=>{i.style.transform="translateY(0)",i.style.boxShadow="none"})),i.addEventListener("click",n),i}injectStyles(){if(document.getElementById("guiders-consent-banner-styles"))return;const e=document.createElement("style");e.id="guiders-consent-banner-styles",e.textContent="\n      @keyframes slideUp {\n        from {\n          transform: translateY(100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateY(0);\n          opacity: 1;\n        }\n      }\n\n      @keyframes slideInRight {\n        from {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n\n      @keyframes fadeIn {\n        from {\n          opacity: 0;\n        }\n        to {\n          opacity: 1;\n        }\n      }\n\n      @keyframes scaleIn {\n        from {\n          transform: scale(0.9);\n          opacity: 0;\n        }\n        to {\n          transform: scale(1);\n          opacity: 1;\n        }\n      }\n\n      /* Responsive para m√≥viles */\n      @media (max-width: 768px) {\n        #guiders-consent-banner {\n          padding: 15px !important;\n        }\n\n        #guiders-consent-banner > div {\n          flex-direction: column !important;\n          align-items: flex-start !important;\n        }\n\n        #guiders-consent-banner button {\n          width: 100%;\n        }\n      }\n    ",document.head.appendChild(e)}updateConfig(e){e.colors&&(this.config.colors=Object.assign(Object.assign({},this.config.colors),e.colors)),void 0!==e.enabled&&(this.config.enabled=e.enabled),e.style&&(this.config.style=e.style),e.text&&(this.config.text=e.text),e.acceptText&&(this.config.acceptText=e.acceptText),e.denyText&&(this.config.denyText=e.denyText),e.preferencesText&&(this.config.preferencesText=e.preferencesText),void 0!==e.showPreferences&&(this.config.showPreferences=e.showPreferences),e.position&&(this.config.position=e.position),void 0!==e.showCloseButton&&(this.config.showCloseButton=e.showCloseButton),void 0!==e.autoShow&&(this.config.autoShow=e.autoShow),e.className&&(this.config.className=e.className),console.log("[ConsentBannerUI] üîÑ Configuraci√≥n actualizada"),this.bannerElement&&(this.remove(),this.render())}}},4808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},4815:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeStampStage=void 0,t.TimeStampStage=class{process(e){return e.timestamp=(new Date).getTime(),e}}},4926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;const i=n(9133);function s(e,t){if(!e)return e;if((0,i.isBinary)(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=s(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=s(e[i],t));return n}return e}function o(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=o(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=o(e[n],t));return e}t.deconstructPacket=function(e){const t=[],n=e.data,i=e;return i.data=s(n,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=o(e.data,t),delete e.attachments,e}},4948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(9025)),s=o(n(2311));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,i.default)("v3",48,s.default);t.default=a},4956:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTransport=t.WebSocket=t.NodeWebSocket=t.XHR=t.NodeXHR=t.Fetch=t.nextTick=t.parse=t.installTimerFunctions=t.transports=t.TransportError=t.Transport=t.protocol=t.SocketWithUpgrade=t.SocketWithoutUpgrade=t.Socket=void 0;const i=n(8223);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return i.Socket}});var s=n(8223);Object.defineProperty(t,"SocketWithoutUpgrade",{enumerable:!0,get:function(){return s.SocketWithoutUpgrade}}),Object.defineProperty(t,"SocketWithUpgrade",{enumerable:!0,get:function(){return s.SocketWithUpgrade}}),t.protocol=i.Socket.protocol;var o=n(4689);Object.defineProperty(t,"Transport",{enumerable:!0,get:function(){return o.Transport}}),Object.defineProperty(t,"TransportError",{enumerable:!0,get:function(){return o.TransportError}});var a=n(9419);Object.defineProperty(t,"transports",{enumerable:!0,get:function(){return a.transports}});var r=n(5374);Object.defineProperty(t,"installTimerFunctions",{enumerable:!0,get:function(){return r.installTimerFunctions}});var c=n(1015);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return c.parse}});var d=n(4624);Object.defineProperty(t,"nextTick",{enumerable:!0,get:function(){return d.nextTick}});var l=n(8209);Object.defineProperty(t,"Fetch",{enumerable:!0,get:function(){return l.Fetch}});var u=n(2071);Object.defineProperty(t,"NodeXHR",{enumerable:!0,get:function(){return u.XHR}});var h=n(2071);Object.defineProperty(t,"XHR",{enumerable:!0,get:function(){return h.XHR}});var g=n(8716);Object.defineProperty(t,"NodeWebSocket",{enumerable:!0,get:function(){return g.WS}});var p=n(8716);Object.defineProperty(t,"WebSocket",{enumerable:!0,get:function(){return p.WS}});var f=n(4480);Object.defineProperty(t,"WebTransport",{enumerable:!0,get:function(){return f.WT}})},4968:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsentBackendService=void 0;const s=n(2597),o={analytics:"analytics",functional:"privacy_policy",personalization:"marketing"},a={analytics:"analytics",privacy_policy:"functional",marketing:"personalization"};class r{constructor(){this.sessionId=null}static getInstance(){return r.instance||(r.instance=new r),r.instance}setSessionId(e){this.sessionId=e,console.log("[ConsentBackendService] üîê Session ID establecido")}getBaseUrl(){return`${s.EndpointManager.getInstance().getEndpoint()}/consents`}makeRequest(e){return i(this,arguments,void 0,(function*(e,t={}){const n=`${this.getBaseUrl()}${e}`,i=Object.assign({"Content-Type":"application/json"},t.headers||{}),s=this.sessionId||("undefined"!=typeof sessionStorage?sessionStorage.getItem("guiders_backend_session_id"):null);s&&(i["x-guiders-sid"]=s,console.log("[ConsentBackendService] üîê Enviando x-guiders-sid:",s));try{const e=yield fetch(n,Object.assign(Object.assign({},t),{headers:i,credentials:"include"}));if(!e.ok){const t=yield e.json().catch((()=>({})));throw new Error(`Backend consent API error: ${e.status} - ${t.message||e.statusText}`)}return yield e.json()}catch(e){throw console.error("[ConsentBackendService] ‚ùå Error en petici√≥n:",e),e}}))}sdkCategoryToBackendType(e){return o[e]||"privacy_policy"}backendTypeToSdkCategory(e){return a[e]||"functional"}grantConsents(e,t){return i(this,void 0,void 0,(function*(){console.log("[ConsentBackendService] ‚úÖ Otorgando consentimientos:",t);const n=[];for(const[i,s]of Object.entries(t)){if(!s)continue;const t=this.sdkCategoryToBackendType(i);try{const s=yield this.makeRequest("/grant",{method:"POST",body:JSON.stringify({visitorId:e,type:t,metadata:{source:"sdk",category:i}})});n.push(s)}catch(e){console.error(`[ConsentBackendService] ‚ùå Error otorgando ${i}:`,e)}}return n}))}revokeConsent(e,t,n){return i(this,void 0,void 0,(function*(){const i=this.sdkCategoryToBackendType(t);return console.log("[ConsentBackendService] ‚ùå Revocando consentimiento:",{visitorId:e,category:t,backendType:i,reason:n}),this.makeRequest("/revoke",{method:"POST",body:JSON.stringify({visitorId:e,type:i,reason:n||"Usuario revoc√≥ consentimiento desde el SDK"})})}))}revokeAllConsents(e,t){return i(this,void 0,void 0,(function*(){console.log("[ConsentBackendService] ‚ùå Revocando TODOS los consentimientos");const n=["analytics","functional","personalization"],i=[];for(const s of n)try{const n=yield this.revokeConsent(e,s,t);i.push(n)}catch(e){console.error(`[ConsentBackendService] ‚ö†Ô∏è Error revocando ${s}:`,e)}return i}))}renewConsent(e,t){return i(this,void 0,void 0,(function*(){const n=this.sdkCategoryToBackendType(t);return console.log("[ConsentBackendService] üîÑ Renovando consentimiento:",{visitorId:e,category:t,backendType:n}),this.makeRequest("/renew",{method:"POST",body:JSON.stringify({visitorId:e,type:n})})}))}getConsentHistory(e){return i(this,void 0,void 0,(function*(){return console.log("[ConsentBackendService] üìã Obteniendo historial de consentimientos"),this.makeRequest(`/visitors/${e}`)}))}getAuditLogs(e){return i(this,void 0,void 0,(function*(){return console.log("[ConsentBackendService] üìú Obteniendo audit logs"),this.makeRequest(`/visitors/${e}/audit-logs`)}))}syncWithBackend(e){return i(this,void 0,void 0,(function*(){console.log("[ConsentBackendService] üîÑ Sincronizando con backend...");try{const t=yield this.getConsentHistory(e),n={analytics:!1,functional:!1,personalization:!1};for(const e of t.consents)if("granted"===e.status){const t=this.backendTypeToSdkCategory(e.type);"analytics"!==t&&"functional"!==t&&"personalization"!==t||(n[t]=!0)}return console.log("[ConsentBackendService] ‚úÖ Estado sincronizado:",n),n}catch(e){return console.error("[ConsentBackendService] ‚ùå Error sincronizando:",e),{analytics:!1,functional:!1,personalization:!1}}}))}isConsentActive(e,t){return i(this,void 0,void 0,(function*(){try{const n=yield this.getConsentHistory(e),i=this.sdkCategoryToBackendType(t),s=n.consents.find((e=>e.type===i));return"granted"===(null==s?void 0:s.status)}catch(e){return console.error("[ConsentBackendService] ‚ùå Error verificando consentimiento:",e),!1}}))}exportConsentData(e){return i(this,void 0,void 0,(function*(){console.log("[ConsentBackendService] üì¶ Exportando datos de consentimiento");try{const[t,n]=yield Promise.all([this.getConsentHistory(e),this.getAuditLogs(e)]),i={visitorId:e,exportDate:(new Date).toISOString(),consents:t.consents,auditLogs:n.logs,summary:{totalConsents:t.total,activeConsents:t.consents.filter((e=>"granted"===e.status)).length,revokedConsents:t.consents.filter((e=>"revoked"===e.status)).length,expiredConsents:t.consents.filter((e=>"expired"===e.status)).length,totalAuditEntries:n.total}};return JSON.stringify(i,null,2)}catch(e){throw console.error("[ConsentBackendService] ‚ùå Error exportando datos:",e),e}}))}deleteConsentData(e){return i(this,void 0,void 0,(function*(){console.log("[ConsentBackendService] üóëÔ∏è Eliminando datos de consentimiento del backend");try{yield this.revokeAllConsents(e,"Usuario solicit√≥ eliminaci√≥n completa de datos (Right to Erasure)"),console.log("[ConsentBackendService] ‚úÖ Datos de consentimiento eliminados")}catch(e){throw console.error("[ConsentBackendService] ‚ùå Error eliminando datos:",e),e}}))}}t.ConsentBackendService=r},5073:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(6140)),s=a(n(2858)),o=n(9910);function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,n){if(i.default.randomUUID&&!t&&!e)return i.default.randomUUID();var a=(e=e||{}).random||(e.rng||s.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=a[r];return t}return(0,o.unsafeStringify)(a)}},5303:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.IdentitySignal=void 0,t.useIdentitySignal=function(){const e=c.getInstance();return{signal:e,identify:(t,n)=>e.identify(t,n),reloadChats:()=>e.reloadChats(),getState:()=>e.getState(),getIdentity:()=>e.getIdentity(),getChats:()=>e.getChats(),getVisitorId:()=>e.getVisitorId(),getSessionId:()=>e.getSessionId(),isIdentified:()=>e.isIdentified(),isLoading:()=>e.isLoading(),hasError:()=>e.hasError(),subscribe:t=>e.subscribe(t),subscribeToChats:t=>e.getChatsSignal().subscribe(t),reset:()=>e.reset()}};const s=n(1556),o=n(7785),a=n(7686);class r extends s.Signal{setLoading(){super.setLoading()}setSuccess(e){super.setSuccess(e)}setError(e){super.setError(e)}}class c extends s.AsyncSignal{constructor(){super(),this.chatsSignal=new r}static getInstance(){return c.instance||(c.instance=new c),c.instance}getChatsSignal(){return this.chatsSignal}identify(e,t){return i(this,void 0,void 0,(function*(){return console.log("[IdentitySignal] üöÄ Iniciando identificaci√≥n del visitante..."),this.execute((()=>i(this,void 0,void 0,(function*(){let n;if("undefined"!=typeof localStorage){const e=localStorage.getItem("guiders_consent_state");if(e)try{const t=JSON.parse(e);n={hasAcceptedPrivacyPolicy:"granted"===t.status,consentVersion:t.version||"v1.0"},console.log("[IdentitySignal] üîê Estado de consentimiento:",n)}catch(e){console.warn("[IdentitySignal] ‚ö†Ô∏è No se pudo parsear estado de consentimiento")}}const i=yield o.VisitorsV2Service.getInstance().identify(e,t,n);if(!i)throw new Error("Failed to identify visitor");console.log("[IdentitySignal] ‚úÖ Visitante identificado:",i.visitorId);let s=null;if(i.visitorId)try{console.log("[IdentitySignal] üí¨ Cargando chats del visitante..."),this.chatsSignal.setLoading(),s=yield a.ChatV2Service.getInstance().getVisitorChats(i.visitorId,void 0,20),this.chatsSignal.setSuccess(s),console.log("[IdentitySignal] ‚úÖ Chats cargados:",s.chats.length,"chats encontrados")}catch(e){console.warn("[IdentitySignal] ‚ö†Ô∏è Error cargando chats:",e),this.chatsSignal.setError(e instanceof Error?e:new Error(String(e)))}else console.warn("[IdentitySignal] ‚ö†Ô∏è No se obtuvo visitorId, saltando carga de chats");return{identity:i,chats:s}}))))}))}reloadChats(){return i(this,void 0,void 0,(function*(){var e,t;const n=this.getState();if(!(null===(t=null===(e=n.data)||void 0===e?void 0:e.identity)||void 0===t?void 0:t.visitorId))return console.warn("[IdentitySignal] ‚ùå No hay visitorId disponible para recargar chats"),null;try{console.log("[IdentitySignal] üîÑ Recargando chats..."),this.chatsSignal.setLoading();const e=yield a.ChatV2Service.getInstance().getVisitorChats(n.data.identity.visitorId,void 0,20);return this.chatsSignal.setSuccess(e),this.setSuccess(Object.assign(Object.assign({},n.data),{chats:e})),console.log("[IdentitySignal] ‚úÖ Chats recargados exitosamente"),e}catch(e){const t=e instanceof Error?e:new Error(String(e));throw console.error("[IdentitySignal] ‚ùå Error recargando chats:",t),this.chatsSignal.setError(t),t}}))}getIdentity(){var e;return(null===(e=this.getState().data)||void 0===e?void 0:e.identity)||null}getChats(){var e;return(null===(e=this.getState().data)||void 0===e?void 0:e.chats)||null}isIdentified(){const e=this.getIdentity();return!!(null==e?void 0:e.visitorId)}getVisitorId(){var e;return(null===(e=this.getIdentity())||void 0===e?void 0:e.visitorId)||null}getSessionId(){var e;return(null===(e=this.getIdentity())||void 0===e?void 0:e.sessionId)||null}reset(){super.reset(),this.chatsSignal.reset()}dispose(){super.dispose(),this.chatsSignal.dispose()}}t.IdentitySignal=c},5374:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=function(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})},t.installTimerFunctions=function(e,t){t.useNativeTimers?(e.setTimeoutFn=s.bind(i.globalThisShim),e.clearTimeoutFn=o.bind(i.globalThisShim)):(e.setTimeoutFn=i.globalThisShim.setTimeout.bind(i.globalThisShim),e.clearTimeoutFn=i.globalThisShim.clearTimeout.bind(i.globalThisShim))},t.byteLength=function(e){return"string"==typeof e?function(e){let t=0,n=0;for(let i=0,s=e.length;i<s;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(e):Math.ceil((e.byteLength||e.size)*a)},t.randomString=function(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)};const i=n(4624),s=i.globalThisShim.setTimeout,o=i.globalThisShim.clearTimeout,a=1.33},5558:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatInputUI=void 0;const i=n(3974);t.ChatInputUI=class{constructor(e,t={}){this.listeners={},this.chatUI=e,this.options=Object.assign({placeholder:"Escribe tu mensaje..."},t),this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container",this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.placeholder=this.options.placeholder,this.inputField.className="chat-input-field",this.inputField.addEventListener("keydown",(e=>{"Enter"===e.key&&this.handleSendMessage()}))}init(){const e=this.getChatContainer();this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container",this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.className="chat-input-field",this.inputField.placeholder=this.options.placeholder||"Escribe un mensaje...",this.inputField.setAttribute("aria-label","Mensaje");const t=document.createElement("button");t.className="chat-send-btn",t.setAttribute("aria-label","Enviar mensaje"),t.type="button",t.addEventListener("click",(()=>this.handleSendMessage())),this.inputContainer.appendChild(this.inputField),this.inputContainer.appendChild(t),this.inputField.addEventListener("keydown",(e=>{"Enter"===e.key&&(this.handleSendMessage(),e.preventDefault())})),e.appendChild(this.inputContainer)}onSubmit(e){this.listeners.submit=e}handleSendMessage(){const e=this.inputField.value.trim();if(e){if(this.isDevCommand(e))return(0,i.debugLog)(`üé≤ [ChatInput] Comando de desarrollo detectado: ${e}`),this.handleDevCommand(e),void(this.inputField.value="");this.chatUI.renderChatMessage({text:e,sender:"user"}),this.inputField.value="",this.listeners.submit&&this.listeners.submit(e)}}isDevCommand(e){return null!==e.trim().toLowerCase().match(/^#random(?::\d+)?$/)}handleDevCommand(e){const t=e.trim().toLowerCase().match(/^#random(?::(\d+))?$/);if(t&&"undefined"!=typeof window){const n=new CustomEvent("guidersDevCommand",{detail:{command:"random",text:e,count:t[1]?parseInt(t[1],10):null,chatId:this.getCurrentChatId()}});window.dispatchEvent(n),(0,i.debugLog)(`üé≤ [ChatInput] Evento guidersDevCommand disparado para: ${e}`)}}getCurrentChatId(){try{return this.chatUI.chatId||null}catch(e){return console.warn("üé≤ [ChatInput] No se pudo obtener el chat ID:",e),null}}getChatContainer(){const e=this.chatUI.container;if(!e)throw new Error("ChatUI no est√° inicializado o el contenedor es null");return e}}},5649:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatTime=function(e){return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},t.formatDate=function(e){const t=new Date,n=new Date;n.setDate(n.getDate()-1);const i=e.toDateString()===t.toDateString(),s=e.toDateString()===n.toDateString();if(i)return"Hoy";if(s)return"Ayer";{const t={day:"numeric",month:"long",year:"numeric"};return e.toLocaleDateString("es-ES",t)}},t.isBot=function(e){const t=e.toLowerCase();return["bot","chatbot","assistant","asistente","ia","ai","autom√°tico","virtual"].some((e=>t.includes(e)))},t.generateInitials=function(e){const t=e.trim().split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():1===t.length?t[0].substring(0,2).toUpperCase():"AH"},t.createDateSeparator=function(e){const t=document.createElement("div");t.className="chat-date-separator",t.setAttribute("data-date",e),t.style.cssText="\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin: 16px 0;\n\t\tposition: relative;\n\t";const n=document.createElement("div");n.style.cssText="\n\t\tflex: 1;\n\t\theight: 1px;\n\t\tbackground: linear-gradient(to right, transparent, #e1e9f1);\n\t\tmargin-right: 12px;\n\t";const i=document.createElement("div");if(i.style.cssText="\n\t\tbackground: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n\t\tcolor: #64748b;\n\t\tpadding: 6px 16px;\n\t\tborder-radius: 16px;\n\t\tfont-size: 12px;\n\t\tfont-weight: 500;\n\t\tborder: 1px solid #e2e8f0;\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n\t\twhite-space: nowrap;\n\t\tposition: relative;\n\t\tletter-spacing: 0.025em;\n\t","Hoy"===e){const e=document.createElement("span");e.innerHTML="üìÖ",e.style.cssText="\n\t\t\tmargin-right: 6px;\n\t\t\tfont-size: 11px;\n\t\t",i.appendChild(e)}const s=document.createElement("span");s.textContent=e,i.appendChild(s);const o=document.createElement("div");return o.style.cssText="\n\t\tflex: 1;\n\t\theight: 1px;\n\t\tbackground: linear-gradient(to left, transparent, #e1e9f1);\n\t\tmargin-left: 12px;\n\t",t.appendChild(n),t.appendChild(i),t.appendChild(o),t}},5770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMobileDevice=s,t.resolvePosition=function(e){if(!e)return{button:{bottom:"20px",right:"20px"},widget:{bottom:"90px",right:"20px"}};const t=e;let o,a;o=void 0!==t.default?s()&&t.mobile?t.mobile:t.default:e,a=function(e){return"string"==typeof e&&["bottom-right","bottom-left","top-right","top-left"].includes(e)}(o)?n[o]:o;const r=function(e){const t=Object.assign({},e);if(e.widgetBottom||e.widgetTop||e.widgetLeft||e.widgetRight)return t;if(e.bottom){const n=parseInt(e.bottom);t.widgetBottom=`${n+i}px`}else if(e.top){const n=parseInt(e.top);t.widgetTop=`${n+i}px`}return e.right&&(t.widgetRight=e.right),e.left&&(t.widgetLeft=e.left),t}(a);return{button:{top:r.top,bottom:r.bottom,left:r.left,right:r.right},widget:{top:r.widgetTop,bottom:r.widgetBottom,left:r.widgetLeft,right:r.widgetRight}}},t.generatePositionCSS=function(e,t=!1){const n=t?e.widget:e.button,i=[];return n.top&&i.push(`top: ${n.top}`),n.bottom&&i.push(`bottom: ${n.bottom}`),n.left&&i.push(`left: ${n.left}`),n.right&&i.push(`right: ${n.right}`),i.join("; ")},t.validateCoordinates=function(e){if(!(e.top||e.bottom||e.widgetTop||e.widgetBottom))return!1;if(!(e.left||e.right||e.widgetLeft||e.widgetRight))return!1;const t=[e.top,e.bottom,e.left,e.right,e.widgetTop,e.widgetBottom,e.widgetLeft,e.widgetRight].filter(Boolean);for(const e of t)if("string"!=typeof e||!/(px|%|em|rem|vh|vw)$/.test(e))return!1;return!0};const n={"bottom-right":{bottom:"20px",right:"20px",widgetBottom:"90px",widgetRight:"20px"},"bottom-left":{bottom:"20px",left:"20px",widgetBottom:"90px",widgetLeft:"20px"},"top-right":{top:"20px",right:"20px",widgetTop:"90px",widgetRight:"20px"},"top-left":{top:"20px",left:"20px",widgetTop:"90px",widgetLeft:"20px"}},i=70;function s(){if("undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(max-width: 768px)").matches)return!0;if("undefined"!=typeof navigator){const e=navigator.userAgent.toLowerCase();return["android","webos","iphone","ipad","ipod","blackberry","windows phone"].some((t=>e.includes(t)))}return!1}},5829:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePaginationService=void 0;const s=n(2597);class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}getAuthHeaders(){const e={"Content-Type":"application/json"},t=sessionStorage.getItem("guiders_backend_session_id");t&&(e["X-Guiders-Sid"]=t);const n=localStorage.getItem("accessToken");return n&&(e.Authorization=`Bearer ${n}`),e}getFetchOptions(){return{method:"GET",headers:this.getAuthHeaders(),credentials:"include"}}getMessagesEndpoint(){const e=s.EndpointManager.getInstance(),t=localStorage.getItem("pixelEndpoint")||e.getEndpoint();return`${t.endsWith("/api")?t:`${t}/api`}/v2/messages`}loadInitialMessages(e){return i(this,arguments,void 0,(function*(e,t=20){var n;console.log(`üìã [MessagePagination] Cargando mensajes iniciales del chat: ${e}`);const i=`${this.getMessagesEndpoint()}/chat/${e}?limit=${t}`;try{const e=yield fetch(i,this.getFetchOptions());if(!e.ok){const t=yield e.text();throw console.error("‚ùå [MessagePagination] Error al cargar mensajes iniciales:",t),new Error(`Error al cargar mensajes iniciales (${e.status}): ${t}`)}const t=yield e.json();return t.nextCursor&&!t.cursor&&(t.cursor=t.nextCursor),console.log("‚úÖ [MessagePagination] Mensajes iniciales cargados:",{count:(null===(n=t.messages)||void 0===n?void 0:n.length)||0,total:t.total,hasMore:t.hasMore,hasCursor:!!t.cursor}),t}catch(e){throw console.error("‚ùå [MessagePagination] Error de red al cargar mensajes iniciales:",e),e}}))}loadOlderMessages(e,t){return i(this,arguments,void 0,(function*(e,t,n=20){var i;console.log(`üìú [MessagePagination] Cargando mensajes antiguos del chat: ${e} con cursor: ${t.substring(0,20)}...`);const s=encodeURIComponent(t),o=`${this.getMessagesEndpoint()}/chat/${e}?limit=${n}&cursor=${s}`;try{const e=yield fetch(o,this.getFetchOptions());if(!e.ok){const t=yield e.text();throw console.error("‚ùå [MessagePagination] Error al cargar mensajes antiguos:",t),new Error(`Error al cargar mensajes antiguos (${e.status}): ${t}`)}const t=yield e.json();return t.nextCursor&&!t.cursor&&(t.cursor=t.nextCursor),console.log("‚úÖ [MessagePagination] Mensajes antiguos cargados:",{count:(null===(i=t.messages)||void 0===i?void 0:i.length)||0,total:t.total,hasMore:t.hasMore,hasCursor:!!t.cursor}),t}catch(e){throw console.error("‚ùå [MessagePagination] Error de red al cargar mensajes antiguos:",e),e}}))}isValidCursor(e){if(!e||""===e.trim())return!1;try{return atob(e),!0}catch(t){return console.warn("‚ö†Ô∏è [MessagePagination] Cursor inv√°lido:",e),!1}}}t.MessagePaginationService=o},5861:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataInjectionStage=void 0,t.MetadataInjectionStage=class{process(e){return e.metadata=Object.assign(Object.assign({},e.metadata),{device:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,screen:{width:screen.width,height:screen.height,pixelRatio:window.devicePixelRatio},hardware:{cores:navigator.hardwareConcurrency},touch:{maxTouchPoints:navigator.maxTouchPoints}}}),e}}},5942:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,n){return e.on(t,n),function(){e.off(t,n)}}},6140:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);t.default={randomUUID:n}},6161:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketState=void 0,function(e){e.DISCONNECTED="disconnected",e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.ERROR="error"}(n||(t.WebSocketState=n={}))},6214:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;const s=n(4627),o=n(5942),a=n(4454),r=(0,i(n(7833)).default)("socket.io-client:socket"),c=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class d extends a.Emitter{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[(0,o.on)(e,"open",this.onopen.bind(this)),(0,o.on)(e,"packet",this.onpacket.bind(this)),(0,o.on)(e,"error",this.onerror.bind(this)),(0,o.on)(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,i,o;if(c.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const a={type:s.PacketType.EVENT,data:t,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++;r("emitting packet with ack id %d",e);const n=t.pop();this._registerAckCallback(e,n),a.id=e}const d=null===(i=null===(n=this.io.engine)||void 0===n?void 0:n.transport)||void 0===i?void 0:i.writable,l=this.connected&&!(null===(o=this.io.engine)||void 0===o?void 0:o._hasPingExpired());return this.flags.volatile&&!d?r("discard packet as the transport is not currently writable"):l?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const s=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&(r("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(t,1));r("event with ack id %d has timed out after %d ms",e,i),t.call(this,new Error("operation has timed out"))}),i),o=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,e)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise(((n,i)=>{const s=(e,t)=>e?i(e):n(t);s.withError=!0,t.push(s),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(n===this._queue[0])return null!==e?n.tryCount>this._opts.retries&&(r("packet [%d] is discarded after %d tries",n.id,n.tryCount),this._queue.shift(),t&&t(e)):(r("packet [%d] was successfully sent",n.id),this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(r("draining queue"),!this.connected||0===this._queue.length)return;const t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,r("sending packet [%d] (try n¬∞%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):r("packet [%d] has already been sent and is waiting for an ack",t.id)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){r("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:s.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){r("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case s.PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case s.PacketType.EVENT:case s.PacketType.BINARY_EVENT:this.onevent(e);break;case s.PacketType.ACK:case s.PacketType.BINARY_ACK:this.onack(e);break;case s.PacketType.DISCONNECT:this.ondisconnect();break;case s.PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];r("emitting event %j",t),null!=e.id&&(r("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,r("sending ack %j",i),t.packet({type:s.PacketType.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(delete this.acks[e.id],r("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)):r("bad ack %s",e.id)}onconnect(e,t){r("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:s.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}t.Socket=d},6376:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodePayload=t.decodePacket=t.encodePayload=t.encodePacket=t.protocol=void 0,t.createPacketEncoderStream=function(){return new TransformStream({transform(e,t){(0,i.encodePacketToBinary)(e,(n=>{const i=n.length;let s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(n)}))}})},t.createPacketDecoderStream=function(e,t){r||(r=new TextDecoder);const n=[];let i=0,a=-1,l=!1;return new TransformStream({transform(u,h){for(n.push(u);;){if(0===i){if(c(n)<1)break;const e=d(n,1);l=!(128&~e[0]),a=127&e[0],i=a<126?3:126===a?1:2}else if(1===i){if(c(n)<2)break;const e=d(n,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(c(n)<8)break;const e=d(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){h.enqueue(o.ERROR_PACKET);break}a=s*Math.pow(2,32)+t.getUint32(4),i=3}else{if(c(n)<a)break;const e=d(n,a);h.enqueue((0,s.decodePacket)(l?e:r.decode(e),t)),i=0}if(0===a||a>e){h.enqueue(o.ERROR_PACKET);break}}}})};const i=n(2686);Object.defineProperty(t,"encodePacket",{enumerable:!0,get:function(){return i.encodePacket}});const s=n(2662);Object.defineProperty(t,"decodePacket",{enumerable:!0,get:function(){return s.decodePacket}});const o=n(2046),a=String.fromCharCode(30);let r;function c(e){return e.reduce(((e,t)=>e+t.length),0)}function d(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let s=0;s<t;s++)n[s]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}t.encodePayload=(e,t)=>{const n=e.length,s=new Array(n);let o=0;e.forEach(((e,r)=>{(0,i.encodePacket)(e,!1,(e=>{s[r]=e,++o===n&&t(s.join(a))}))}))},t.decodePayload=(e,t)=>{const n=e.split(a),i=[];for(let e=0;e<n.length;e++){const o=(0,s.decodePacket)(n[e],t);if(i.push(o),"error"===o.type)break}return i},t.protocol=4},6420:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionTrackingManager=void 0;const i=n(2831);t.SessionTrackingManager=class{constructor(e,t={}){this.sessionData=null,this.heartbeatTimer=null,this._throttleTimeout=null,this.trackCallback=e,this.config=Object.assign({enabled:!0,heartbeatInterval:1e4,maxInactivityTime:6e4},t),this.config.enabled&&(this.startSession(),this.registerActivityListeners())}saveSessionData(){this.sessionData&&sessionStorage.setItem("guiders_session",JSON.stringify(this.sessionData))}startSession(){this.sessionData=sessionStorage.getItem("guiders_session")?JSON.parse(sessionStorage.getItem("guiders_session")):{sessionId:(0,i.v4)(),startTime:Date.now(),lastActiveTime:Date.now(),totalActiveTime:0,isActive:!0,isIdle:!1,isNew:!0},this.sessionData&&this.sessionData.isNew&&(this.trackCallback({event:"session_start",startTime:this.sessionData.startTime,isNew:this.sessionData.isNew}),this.sessionData.isNew=!1),this.saveSessionData(),this.initializeHeartbeat()}endSession(){this.sessionData&&(this.sessionData.isActive&&!this.sessionData.isIdle&&(this.sessionData.totalActiveTime+=Date.now()-this.sessionData.lastActiveTime),this.sessionData.isActive=!1,this.sessionData.isIdle=!1,this.trackCallback({event:"session_end",endTime:Date.now(),startTime:this.sessionData.startTime,totalActiveTime:this.sessionData.totalActiveTime,totalSessionTime:Date.now()-this.sessionData.startTime}),sessionStorage.removeItem("guiders_session"),this.sessionData=null),this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.removeActivityListeners(),this._throttleTimeout&&(clearTimeout(this._throttleTimeout),this._throttleTimeout=null)}updateActivity(e=!1){if(!this.sessionData)return null;const t=Date.now(),n=this.sessionData.isIdle,i=!this.sessionData.isActive,s=this.sessionData.lastActiveTime;if(this.sessionData.isActive&&!this.sessionData.isIdle){const e=t-this.sessionData.lastActiveTime;this.sessionData.totalActiveTime+=e}return this.sessionData.lastActiveTime=t,this.sessionData.isActive=!0,(n||e)&&(this.sessionData.isIdle=!1,this.trackCallback({event:"user_resume",resumeTime:t,previousIdleTime:n?t-s:0,totalActiveTime:this.sessionData.totalActiveTime})),i&&this.trackCallback({event:"session_reactivate",reactivateTime:t,totalActiveTime:this.sessionData.totalActiveTime}),this.saveSessionData(),this.sessionData}getCurrentSession(){return this.sessionData}initializeHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>{this.checkUserActivity()}),this.config.heartbeatInterval)}checkUserActivity(){if(!this.sessionData||!this.sessionData.isActive)return;const e=Date.now();if(e-this.sessionData.lastActiveTime>this.config.maxInactivityTime&&!this.sessionData.isIdle){this.sessionData.isIdle=!0;const t=this.config.maxInactivityTime;this.sessionData.totalActiveTime+=t,this.trackCallback({event:"user_idle",sessionId:this.sessionData.sessionId,idleStartTime:e,lastActiveTime:this.sessionData.lastActiveTime,totalActiveTime:this.sessionData.totalActiveTime}),this.saveSessionData()}}registerActivityListeners(){if("undefined"==typeof window)return;const e=this.handleUserActivity.bind(this);["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach((t=>{window.addEventListener(t,e,{passive:!0})})),document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState?this.updateActivity(!0):this.checkUserActivity()}))}removeActivityListeners(){if("undefined"==typeof window)return;const e=this.handleUserActivity.bind(this);["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach((t=>{window.removeEventListener(t,e)})),document.removeEventListener("visibilitychange",(()=>{}))}handleUserActivity(e){this._throttleTimeout||(this._throttleTimeout=setTimeout((()=>{this._throttleTimeout=null}),1e3),this.updateActivity())}}},6571:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMON_ACTIVE_HOURS=t.ActiveHoursValidator=void 0,t.createActiveHoursConfig=i;class n{constructor(e){this.config=e}getEffectiveTimezone(){if("auto"===this.config.timezone)try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return console.warn("‚ùå [ActiveHoursValidator] No se pudo detectar timezone autom√°ticamente, usando UTC:",e),"UTC"}if(!this.config.timezone)try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return console.warn("‚ùå [ActiveHoursValidator] No se pudo detectar timezone autom√°ticamente, usando UTC:",e),"UTC"}return this.config.timezone}isChatActive(){if(!this.config.enabled)return!0;if(!this.config.ranges||0===this.config.ranges.length)return console.warn("[ActiveHoursValidator] ‚ùå No hay rangos de horarios configurados"),!0;const e=this.getCurrentTime();return this.config.ranges.some((t=>this.isTimeInRange(e,t)))}getCurrentTime(){const e=new Date,t=this.getEffectiveTimezone();try{const n=e.toLocaleString("en-US",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return new Date(n)}catch(e){console.warn("[ActiveHoursValidator] ‚ùå Zona horaria inv√°lida:",t,e)}return e}isTimeInRange(e,t){try{const n=this.timeToMinutes(e),i=this.parseTimeString(t.start),s=this.parseTimeString(t.end);return i>s?n>=i||n<=s:n>=i&&n<=s}catch(e){return console.warn("[ActiveHoursValidator] ‚ùå Error validando rango:",t,e),!0}}parseTimeString(e){const t=e.match(/^(\d{1,2}):(\d{2})$/);if(!t)throw new Error(`Formato de hora inv√°lido: ${e}. Use formato HH:MM`);const n=parseInt(t[1],10),i=parseInt(t[2],10);if(n<0||n>23)throw new Error(`Hora inv√°lida: ${n}. Debe estar entre 0-23`);if(i<0||i>59)throw new Error(`Minutos inv√°lidos: ${i}. Debe estar entre 0-59`);return 60*n+i}timeToMinutes(e){return 60*e.getHours()+e.getMinutes()}getFallbackMessage(){return this.config.fallbackMessage||"El chat no est√° disponible en este momento. Por favor, int√©ntalo m√°s tarde."}getNextAvailableTime(){if(!this.config.enabled||!this.config.ranges.length)return null;const e=this.getCurrentTime(),t=this.timeToMinutes(e);let n=null;for(const e of this.config.ranges)try{const i=this.parseTimeString(e.start);i>t?(null===n||i<n)&&(n=i):null===n&&(n=i)}catch(t){console.warn("[ActiveHoursValidator] ‚ùå Error procesando rango:",e,t)}if(null!==n){const e=n%60;return`${Math.floor(n/60).toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}return null}getConfig(){return Object.assign({},this.config)}static validateConfig(e){const t=[];if(e.enabled&&(e.ranges&&Array.isArray(e.ranges)?0===e.ranges.length?t.push("Se requiere al menos un rango horario"):e.ranges.forEach(((e,i)=>{if(e.start&&e.end)try{const t=new n({enabled:!0,ranges:[]});t.parseTimeString(e.start),t.parseTimeString(e.end)}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`Rango ${i+1}: ${n}`)}else t.push(`Rango ${i+1}: Se requieren propiedades 'start' y 'end'`)})):t.push("Se requiere un array de rangos horarios cuando activeHours est√° habilitado"),e.timezone))try{(new Date).toLocaleString("en-US",{timeZone:e.timezone})}catch(n){const i=n instanceof Error?n.message:String(n);t.push(`Zona horaria inv√°lida: ${e.timezone} - ${i}`)}return t}}function i(e,t={}){return{enabled:!0,ranges:e,timezone:t.timezone,fallbackMessage:t.fallbackMessage}}t.ActiveHoursValidator=n,t.COMMON_ACTIVE_HOURS={BUSINESS_HOURS:i([{start:"09:00",end:"18:00"}]),SPLIT_SCHEDULE:i([{start:"08:00",end:"14:00"},{start:"15:00",end:"17:00"}]),EXTENDED_HOURS:i([{start:"07:00",end:"22:00"}]),NIGHT_SHIFT:i([{start:"22:00",end:"06:00"}])}},6585:e=>{var t=1e3,n=60*t,i=60*n,s=24*i,o=7*s;function a(e,t,n,i){var s=t>=1.5*n;return Math.round(e/n)+" "+i+(s?"s":"")}e.exports=function(e,r){r=r||{};var c,d,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var r=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return r*o;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*i;case"minutes":case"minute":case"mins":case"min":case"m":return r*n;case"seconds":case"second":case"secs":case"sec":case"s":return r*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===l&&isFinite(e))return r.long?(c=e,(d=Math.abs(c))>=s?a(c,d,s,"day"):d>=i?a(c,d,i,"hour"):d>=n?a(c,d,n,"minute"):d>=t?a(c,d,t,"second"):c+" ms"):function(e){var o=Math.abs(e);return o>=s?Math.round(e/s)+"d":o>=i?Math.round(e/i)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},6792:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s=(i=n(7037))&&i.__esModule?i:{default:i};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}},6808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomTrackingManager=t.DefaultTrackDataExtractor=void 0;class n{extract(e){const t=e.dataset,n={event:t.trackEvent};return Object.keys(t).forEach((e=>{if("trackEvent"===e)return;const i=e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));n[i]=t[e]})),n}}t.DefaultTrackDataExtractor=n,t.DomTrackingManager=class{constructor(e,t=new n){this.domEventMap={view_product:"mouseenter",add_to_cart:"click",view_cart:"mouseenter",purchase:"click",page_view:"DOMContentLoaded",search_vehicle_type:"change",search_brand:"change",search_model:"change",search_fuel:"change",search_price_type:"change",sort_vehicles:"change",calculate_financing:"click",add_to_favorites:"click",view_vehicle_location:"mouseenter",filter_by_price:"change",filter_by_payment:"change",search_submit:"click",search_input:"input",add_to_comparison:"click",remove_from_comparison:"click",select_comparison_vehicle:"click",view_vehicle_comparison:"mouseenter",save_comparison:"click",export_comparison:"click",share_comparison:"click",clear_comparison:"click",filter_by_year:"change",filter_by_transmission:"change",filter_by_doors:"change",filter_by_mileage:"change",filter_by_condition:"change",toggle_advanced_filters:"click",contact_dealer:"click",schedule_test_drive:"click",request_quote:"click",view_vehicle_details:"click",view_vehicle_gallery:"click",view_vehicle_specs:"click",view_vehicle_history:"click",download_brochure:"click",analytics_dashboard_view:"mouseenter",export_analytics:"click",share_analytics:"click",chat_ask_about_vehicle:"click",chat_request_financing:"click",chat_schedule_viewing:"click"},this.trackCallback=e,this.extractor=t}enableDOMTracking(){const e=document.querySelector('[data-track-event="page_view"]');e&&"DOMContentLoaded"===this.domEventMap.page_view&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.trackCallback(this.extractor.extract(e))})):this.trackCallback(this.extractor.extract(e))),Object.entries(this.domEventMap).forEach((([e,t])=>{"page_view"!==e&&document.querySelectorAll(`[data-track-event="${e}"]`).forEach((n=>{const i=`__track_listener_${e}`;n[i]||(n.addEventListener(t,(()=>{this.trackCallback(this.extractor.extract(n))})),n[i]=!0)}))}))}}},6894:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.url=function(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),o("parse %s",e),i=(0,s.parse)(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const a=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port+t,i.href=i.protocol+"://"+a+(n&&n.port===i.port?"":":"+i.port),i};const s=n(4956),o=(0,i(n(7833)).default)("socket.io-client:url")},6932:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ConfidenceLevel=void 0,function(e){e[e.EXACT_MATCH=.95]="EXACT_MATCH",e[e.HIGH=.9]="HIGH",e[e.MEDIUM=.7]="MEDIUM",e[e.LOW=.5]="LOW",e[e.FALLBACK=.1]="FALLBACK"}(n||(t.ConfidenceLevel=n={}))},7037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s=(i=n(7656))&&i.__esModule?i:{default:i};t.default=function(e){return"string"==typeof e&&s.default.test(e)}},7183:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessagesUI=void 0;const s=n(5829),o=n(2782),a=n(3974);t.ChatMessagesUI=class{constructor(e){this.chatId=null,this.currentCursor=null,this.hasMoreMessages=!0,this.isLoading=!1,this.isInitialLoad=!0,this.preventAutoScrollLoad=!1,this.topLoadingIndicator=null,this.SCROLL_THRESHOLD=100,this.MESSAGE_LIMIT=20,this.container=e,this.messagePaginationService=s.MessagePaginationService.getInstance(),this.setupUI(),this.setupScrollListener()}setupUI(){this.messagesContainer=this.container,this.messagesContainer.style.cssText+="\n            overflow-y: auto;\n            scroll-behavior: smooth;\n        ",(0,a.debugLog)("üì¶ [ChatMessagesUI] setupUI: Usando contenedor existente como messagesContainer")}setupScrollListener(){this.messagesContainer.addEventListener("scroll",this.handleScroll.bind(this))}handleScroll(){return i(this,void 0,void 0,(function*(){const{scrollTop:e,scrollHeight:t,clientHeight:n}=this.messagesContainer;if((0,a.debugLog)("üîç [ChatMessagesUI] handleScroll ejecut√°ndose:",{scrollTop:e,scrollHeight:t,clientHeight:n,threshold:this.SCROLL_THRESHOLD,chatId:this.chatId,hasMoreMessages:this.hasMoreMessages,isLoading:this.isLoading,currentCursor:this.currentCursor,preventAutoScrollLoad:this.preventAutoScrollLoad}),this.chatId)if(this.hasMoreMessages)if(this.isLoading)(0,a.debugLog)("‚ùå [ChatMessagesUI] handleScroll: isLoading = true");else{if(this.preventAutoScrollLoad)return(0,a.debugLog)("üõ°Ô∏è [ChatMessagesUI] handleScroll: preventAutoScrollLoad activo - ignorando threshold"),void(e>2*this.SCROLL_THRESHOLD&&(this.preventAutoScrollLoad=!1,(0,a.debugLog)("‚úÖ [ChatMessagesUI] handleScroll: Usuario hizo scroll manual - desactivando preventAutoScrollLoad")));(0,a.debugLog)(`üîç [ChatMessagesUI] Verificando threshold: scrollTop=${e} <= ${this.SCROLL_THRESHOLD}?`),e<=this.SCROLL_THRESHOLD?((0,a.debugLog)("üöÄ [ChatMessagesUI] THRESHOLD ALCANZADO! Iniciando loadOlderMessages..."),yield this.loadOlderMessages()):(0,a.debugLog)("üìä [ChatMessagesUI] Threshold no alcanzado. Necesita scroll m√°s arriba.")}else(0,a.debugLog)("‚ùå [ChatMessagesUI] handleScroll: hasMoreMessages = false");else(0,a.debugLog)("‚ùå [ChatMessagesUI] handleScroll: Sin chatId")}))}initializeChat(e){return i(this,void 0,void 0,(function*(){(0,a.debugLog)(`üí¨ [ChatMessagesUI] Inicializando chat: ${e}`),this.chatId!==e||this.isInitialLoad?(this.chatId=e,this.isInitialLoad=!0,this.currentCursor=null,this.hasMoreMessages=!0,this.isLoading=!1,this.preventAutoScrollLoad=!1,this.clearMessages(),yield this.loadInitialMessages(),this.isInitialLoad=!1):(0,a.debugLog)(`üí¨ [ChatMessagesUI] Chat ${e} ya est√° inicializado`)}))}loadInitialMessages(){return i(this,void 0,void 0,(function*(){if(this.chatId)try{this.isLoading=!0,(0,a.debugLog)("üìã [ChatMessagesUI] Cargando mensajes iniciales...");const e=yield this.messagePaginationService.loadInitialMessages(this.chatId,this.MESSAGE_LIMIT);this.renderInitialMessages(e),this.updatePaginationState(e),this.scrollToBottom(),(0,a.debugLog)("‚úÖ [ChatMessagesUI] Mensajes iniciales cargados y scroll al bottom realizado")}catch(e){console.error("‚ùå [ChatMessagesUI] Error cargando mensajes iniciales:",e),this.showErrorMessage("Error al cargar mensajes")}finally{this.isLoading=!1}}))}loadOlderMessages(){return i(this,void 0,void 0,(function*(){if((0,a.debugLog)("üöÄ [ChatMessagesUI] loadOlderMessages INICIADO"),(0,a.debugLog)("üîç [ChatMessagesUI] Estado antes de validaciones:",{chatId:this.chatId,currentCursor:this.currentCursor,hasMoreMessages:this.hasMoreMessages,isLoading:this.isLoading}),this.chatId)if(this.currentCursor)if(this.hasMoreMessages)try{this.isLoading=!0,this.showTopLoadingIndicator(),(0,a.debugLog)("üìú [ChatMessagesUI] ‚úÖ LLAMANDO AL BACKEND - Cargando mensajes antiguos..."),(0,a.debugLog)("üìã [ChatMessagesUI] Par√°metros de petici√≥n:",{chatId:this.chatId,cursor:this.currentCursor,limit:this.MESSAGE_LIMIT});const e=this.messagesContainer.scrollHeight,t=this.messagesContainer.scrollTop,n=yield this.messagePaginationService.loadOlderMessages(this.chatId,this.currentCursor,this.MESSAGE_LIMIT);(0,a.debugLog)("üì¶ [ChatMessagesUI] Respuesta del backend:",n),this.renderOlderMessages(n),this.updatePaginationState(n);const i=this.messagesContainer.scrollHeight-e;this.messagesContainer.scrollTop=t+i,(0,a.debugLog)(`‚úÖ [ChatMessagesUI] ${n.messages.length} mensajes antiguos cargados`)}catch(e){console.error("‚ùå [ChatMessagesUI] Error cargando mensajes antiguos:",e)}finally{this.hideTopLoadingIndicator(),this.isLoading=!1}else(0,a.debugLog)("‚ùå [ChatMessagesUI] loadOlderMessages: hasMoreMessages = false");else(0,a.debugLog)("‚ùå [ChatMessagesUI] loadOlderMessages: Sin currentCursor");else(0,a.debugLog)("‚ùå [ChatMessagesUI] loadOlderMessages: Sin chatId")}))}renderInitialMessages(e){e.messages&&0!==e.messages.length?[...e.messages].reverse().forEach((e=>{const t=this.createMessageElement(e);this.messagesContainer.appendChild(t)})):this.showEmptyState()}renderOlderMessages(e){e.messages&&0!==e.messages.length&&[...e.messages].reverse().forEach(((e,t)=>{const n=this.createMessageElement(e),i=this.messagesContainer.firstChild;i?this.messagesContainer.insertBefore(n,i):this.messagesContainer.appendChild(n)}))}createMessageElement(e){const t=o.MessageRenderer.fromMessageV2(e);return o.MessageRenderer.createMessageElement(t)}applyModernMessageStyles(e,t){const n=e.querySelector(".message-avatar"),i=e.querySelector(".message-bubble"),s=e.querySelector(".message-content"),o=e.querySelector(".message-text"),a=e.querySelector(".message-metadata"),r=e.querySelector(".message-time"),c=e.querySelector(".message-status");if(e.style.cssText=`\n            display: flex;\n            align-items: flex-end;\n            margin-bottom: 16px;\n            ${t?"flex-direction: row-reverse; padding-left: 60px;":"flex-direction: row; padding-right: 60px;"}\n            animation: messageSlideIn 0.3s ease-out;\n        `,n){n.style.cssText="\n                margin-right: 12px;\n                margin-bottom: 4px;\n            ";const e=n.querySelector(".avatar-circle");e&&(e.style.cssText="\n                    width: 32px;\n                    height: 32px;\n                    border-radius: 50%;\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: white;\n                    font-size: 11px;\n                    font-weight: 600;\n                    border: none;\n                    box-sizing: border-box;\n                    min-width: 32px;\n                    min-height: 32px;\n                    max-width: 32px;\n                    max-height: 32px;\n                ")}i.style.cssText="\n            position: relative;\n            max-width: 85%;\n            min-width: 120px;\n        ",s.style.cssText=`\n            padding: 12px 16px 8px;\n            border-radius: 20px;\n            position: relative;\n            word-break: break-word;\n            ${t?"background: linear-gradient(145deg, #0084ff 60%, #00c6fb 100%);\n                 color: white;\n                 border-bottom-right-radius: 6px;\n                 box-shadow: 0 2px 12px rgba(0, 132, 255, 0.3);":"background: white;\n                 color: #1d1d1f;\n                 border: 1px solid rgba(0, 0, 0, 0.08);\n                 border-bottom-left-radius: 6px;\n                 box-shadow: 0 1px 8px rgba(0, 0, 0, 0.08);"}\n            backdrop-filter: blur(10px);\n            transition: all 0.2s ease;\n        `,o.style.cssText="\n            font-size: 15px;\n            line-height: 1.4;\n            margin: 0;\n            font-weight: 400;\n            letter-spacing: -0.01em;\n        ",a.style.cssText=`\n            display: flex;\n            align-items: center;\n            justify-content: ${t?"flex-end":"flex-start"};\n            gap: 6px;\n            margin-top: 2px;\n            padding: 0 4px;\n        `,r.style.cssText=`\n            font-size: 11px;\n            color: ${t?"rgba(0, 0, 0, 0.8)":"rgba(60, 60, 67, 0.6)"};\n            font-weight: 500;\n            letter-spacing: 0.01em;\n        `,c&&(c.style.cssText="\n                font-size: 12px;\n                color: rgba(255, 255, 255, 0.8);\n                margin-left: 2px;\n            "),this.addMessageAnimations()}addMessageAnimations(){if(document.getElementById("modern-message-animations"))return;const e=document.createElement("style");e.id="modern-message-animations",e.textContent="\n            @keyframes messageSlideIn {\n                from {\n                    opacity: 0;\n                    transform: translateY(10px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n\n            /* Efecto hover deshabilitado por solicitud del usuario */\n\n            /* Mejorar tipograf√≠a */\n            .modern-message .message-text {\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n\n            /* Estilos responsivos */\n            @media (max-width: 480px) {\n                .modern-message {\n                    padding-left: 20px !important;\n                    padding-right: 20px !important;\n                }\n                \n                .modern-message .message-bubble {\n                    max-width: 90% !important;\n                }\n            }\n        ",document.head.appendChild(e)}isUserMessage(e){try{const t=localStorage.getItem("visitorId");if(t)return e.senderId===t}catch(e){console.warn("No se pudo determinar el visitor ID actual:",e)}return!1}updatePaginationState(e){var t;(0,a.debugLog)("üîÑ [ChatMessagesUI] updatePaginationState ANTES:",{prevHasMore:this.hasMoreMessages,prevCursor:this.currentCursor}),(0,a.debugLog)("üì• [ChatMessagesUI] Respuesta recibida:",{hasMore:e.hasMore,cursor:e.cursor,nextCursor:e.nextCursor,messagesCount:(null===(t=e.messages)||void 0===t?void 0:t.length)||0}),this.hasMoreMessages=e.hasMore;const n=e.cursor||e.nextCursor;(0,a.debugLog)("üîç [ChatMessagesUI] Cursor extra√≠do:",{extractedCursor:n,hasMore:e.hasMore}),n&&e.hasMore?this.currentCursor=n:this.currentCursor=null,(0,a.debugLog)("üìä [ChatMessagesUI] Estado paginaci√≥n actualizado DESPU√âS:",{hasMore:this.hasMoreMessages,hasCursor:!!this.currentCursor,cursor:this.currentCursor,totalMessages:this.messagesContainer.children.length})}scrollToBottom(){this.preventAutoScrollLoad=!0,(0,a.debugLog)("üõ°Ô∏è [ChatMessagesUI] scrollToBottom: Activando preventAutoScrollLoad"),requestAnimationFrame((()=>{this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight,setTimeout((()=>{this.preventAutoScrollLoad=!1,(0,a.debugLog)("‚úÖ [ChatMessagesUI] scrollToBottom: Desactivando preventAutoScrollLoad despu√©s de delay")}),500)}))}addNewMessage(e){const t=this.createMessageElement(e);this.messagesContainer.appendChild(t),this.scrollToBottom()}showTopLoadingIndicator(){this.topLoadingIndicator||(this.topLoadingIndicator=document.createElement("div"),this.topLoadingIndicator.className="top-loading-indicator",this.topLoadingIndicator.innerHTML='\n            <div style="text-align: center; padding: 12px; color: #666; font-size: 12px;">\n                <div style="display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #0084ff; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;"></div>\n                Cargando mensajes anteriores...\n            </div>\n            <style>\n                @keyframes spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n            </style>\n        ',this.messagesContainer.insertBefore(this.topLoadingIndicator,this.messagesContainer.firstChild))}hideTopLoadingIndicator(){this.topLoadingIndicator&&(this.topLoadingIndicator.remove(),this.topLoadingIndicator=null)}showErrorMessage(e){const t=document.createElement("div");t.style.cssText="\n            text-align: center;\n            padding: 20px;\n            color: #dc3545;\n            font-size: 14px;\n        ",t.textContent=e,this.messagesContainer.appendChild(t)}showEmptyState(){const e=document.createElement("div");e.style.cssText="\n            text-align: center;\n            padding: 40px 20px;\n            color: #8a9aa9;\n            font-size: 14px;\n        ",e.innerHTML='\n            <div style="font-size: 48px; margin-bottom: 16px;">üí¨</div>\n            <div>¬°Inicia la conversaci√≥n!</div>\n            <div style="font-size: 12px; margin-top: 8px;">Este es el comienzo de tu chat</div>\n        ',this.messagesContainer.appendChild(e)}clearMessages(){this.messagesContainer.innerHTML="",this.hideTopLoadingIndicator()}formatMessageTime(e){return new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.messagesContainer.removeEventListener("scroll",this.handleScroll),this.clearMessages(),this.chatId=null,this.currentCursor=null,this.hasMoreMessages=!0,this.isLoading=!1,this.preventAutoScrollLoad=!1}getScrollState(){return{hasMore:this.hasMoreMessages,isLoading:this.isLoading,messageCount:this.messagesContainer.children.length}}isChatInitialized(e){return e?this.chatId===e&&!this.isInitialLoad:null!==this.chatId&&!this.isInitialLoad}getCurrentChatId(){return this.chatId}isLoadingMessages(){return this.isLoading}}},7186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(9025)),s=o(n(9042));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,i.default)("v5",80,s.default);t.default=a},7656:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},7686:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatV2Service=void 0;const s=n(2597),o=n(3974);class a{constructor(){}static getInstance(){return a.instance||(a.instance=new a),a.instance}getAuthHeaders(){const e={"Content-Type":"application/json"},t=sessionStorage.getItem("guiders_backend_session_id");t&&(e["X-Guiders-Sid"]=t);const n=localStorage.getItem("accessToken");return n&&(e.Authorization=`Bearer ${n}`),e}getFetchOptions(e="GET",t){return Object.assign({method:e,headers:this.getAuthHeaders(),credentials:"include"},t&&{body:t})}getBaseUrl(){const e=s.EndpointManager.getInstance(),t=localStorage.getItem("pixelEndpoint")||e.getEndpoint();return`${t.endsWith("/api")?t:`${t}/api`}/v2/chats`}getVisitorChats(e,t){return i(this,arguments,void 0,(function*(e,t,n=20){(0,o.debugLog)(`[ChatV2Service] üë§ Obteniendo chats del visitante: ${e}`);const i=new URLSearchParams;t&&i.append("cursor",t),i.append("limit",n.toString());const s=`${this.getBaseUrl()}/visitor/${e}?${i.toString()}`,a=yield fetch(s,this.getFetchOptions("GET"));if(!a.ok){const t=yield a.text();throw console.error(`[ChatV2Service] ‚ùå Error al obtener chats del visitante ${e}:`,t),new Error(`Error al obtener chats del visitante (${a.status}): ${t}`)}const r=yield a.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chats del visitante obtenidos:",{count:r.chats.length,total:r.total,hasMore:r.hasMore}),r}))}getLatestVisitorChat(e){return i(this,void 0,void 0,(function*(){try{const t=yield this.getVisitorChats(e,void 0,20);return t.chats&&t.chats.length>0?t.chats[0]:null}catch(e){return console.warn("[ChatV2Service] ‚ùå Error obteniendo √∫ltimo chat del visitante:",e),null}}))}getCommercialChats(e,t){return i(this,arguments,void 0,(function*(e,t,n=20,i){(0,o.debugLog)(`[ChatV2Service] üè™ Obteniendo chats del comercial: ${e}`);const s=new URLSearchParams;t&&s.append("cursor",t),s.append("limit",n.toString()),i&&Object.entries(i).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>s.append(`filters[${e}][]`,t))):s.append(`filters[${e}]`,t)}));const a=`${this.getBaseUrl()}/commercial/${e}?${s.toString()}`,r=yield fetch(a,this.getFetchOptions("GET"));if(!r.ok){const t=yield r.text();throw console.error(`[ChatV2Service] ‚ùå Error al obtener chats del comercial ${e}:`,t),new Error(`Error al obtener chats del comercial (${r.status}): ${t}`)}const c=yield r.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chats del comercial obtenidos:",{count:c.chats.length,total:c.total,hasMore:c.hasMore}),c}))}getPendingQueue(e){return i(this,arguments,void 0,(function*(e,t=50){(0,o.debugLog)("[ChatV2Service] üìã Obteniendo cola de chats pendientes");const n=new URLSearchParams;e&&n.append("department",e),n.append("limit",t.toString());const i=`${this.getBaseUrl()}/queue/pending?${n.toString()}`,s=yield fetch(i,this.getFetchOptions("GET"));if(!s.ok){const e=yield s.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener cola pendiente:",e),new Error(`Error al obtener cola pendiente (${s.status}): ${e}`)}const a=yield s.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Cola de chats pendientes obtenida:",{count:a.length}),a}))}assignChat(e,t){return i(this,void 0,void 0,(function*(){(0,o.debugLog)(`[ChatV2Service] üìå Asignando chat ${e} al comercial ${t}`);const n=yield fetch(`${this.getBaseUrl()}/${e}/assign/${t}`,this.getFetchOptions("PUT"));if(!n.ok){const e=yield n.text();throw console.error("[ChatV2Service] ‚ùå Error al asignar chat:",e),new Error(`Error al asignar chat (${n.status}): ${e}`)}const i=yield n.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chat asignado exitosamente"),i}))}closeChat(e){return i(this,void 0,void 0,(function*(){(0,o.debugLog)(`[ChatV2Service] üîí Cerrando chat ${e}`);const t=yield fetch(`${this.getBaseUrl()}/${e}/close`,this.getFetchOptions("PUT"));if(!t.ok){const e=yield t.text();throw console.error("[ChatV2Service] ‚ùå Error al cerrar chat:",e),new Error(`Error al cerrar chat (${t.status}): ${e}`)}const n=yield t.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chat cerrado exitosamente"),n}))}getCommercialMetrics(e,t,n){return i(this,void 0,void 0,(function*(){(0,o.debugLog)(`[ChatV2Service] üìä Obteniendo m√©tricas del comercial: ${e}`);const i=new URLSearchParams;t&&i.append("dateFrom",t.toISOString()),n&&i.append("dateTo",n.toISOString());const s=`${this.getBaseUrl()}/metrics/commercial/${e}?${i.toString()}`,a=yield fetch(s,this.getFetchOptions("GET"));if(!a.ok){const e=yield a.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener m√©tricas:",e),new Error(`Error al obtener m√©tricas (${a.status}): ${e}`)}const r=yield a.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ M√©tricas obtenidas"),r}))}getResponseTimeStats(e,t){return i(this,arguments,void 0,(function*(e,t,n="day"){(0,o.debugLog)("[ChatV2Service] ‚è±Ô∏è Obteniendo estad√≠sticas de tiempo de respuesta");const i=new URLSearchParams;e&&i.append("dateFrom",e.toISOString()),t&&i.append("dateTo",t.toISOString()),i.append("groupBy",n);const s=`${this.getBaseUrl()}/response-time-stats?${i.toString()}`,a=yield fetch(s,this.getFetchOptions("GET"));if(!a.ok){const e=yield a.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener estad√≠sticas:",e),new Error(`Error al obtener estad√≠sticas (${a.status}): ${e}`)}const r=yield a.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Estad√≠sticas obtenidas"),r}))}createChatAuto(e){return i(this,void 0,void 0,(function*(){(0,o.debugLog)("[ChatV2Service] üÜï Creando chat V2 por POST (auto-id)");const t=yield fetch(`${this.getBaseUrl()}`,this.getFetchOptions("POST",JSON.stringify(e)));if(!t.ok){const e=yield t.text();throw console.error("[ChatV2Service] ‚ùå Error al crear chat V2 (POST):",e),new Error(`Error al crear chat V2 (POST) (${t.status}): ${e}`)}const n=yield t.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chat V2 creado (POST):",n.id),n}))}createChatWithMessage(e,t){return i(this,void 0,void 0,(function*(){var n,i;(0,o.debugLog)("[ChatV2Service] üÜïüí¨ Creando chat V2 con mensaje inicial");const s=Object.assign(Object.assign({},e),{firstMessage:t});(0,o.debugLog)("[ChatV2Service] üì§ Payload enviado:",JSON.stringify(s,null,2));const a=yield fetch(`${this.getBaseUrl()}/with-message`,this.getFetchOptions("POST",JSON.stringify(s)));if(!a.ok){const e=yield a.text();throw console.error("[ChatV2Service] ‚ùå Error al crear chat V2 con mensaje:",e),new Error(`Error al crear chat V2 con mensaje (${a.status}): ${e}`)}const r=yield a.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Chat V2 con mensaje creado:",(null===(n=r.chat)||void 0===n?void 0:n.chatId)||(null===(i=r.chat)||void 0===i?void 0:i.id)),r}))}sendMessage(e,t){return i(this,arguments,void 0,(function*(e,t,n="text"){(0,o.debugLog)(`[ChatV2Service] üí¨ Enviando mensaje al chat ${e}`);const i={chatId:e,content:t,type:n},a=s.EndpointManager.getInstance(),r=localStorage.getItem("pixelEndpoint")||a.getEndpoint(),c=`${r.endsWith("/api")?r:`${r}/api`}/v2/messages`,d=yield fetch(c,this.getFetchOptions("POST",JSON.stringify(i)));if(!d.ok){const e=yield d.text();throw console.error("[ChatV2Service] ‚ùå Error al enviar mensaje:",e),new Error(`Error al enviar mensaje (${d.status}): ${e}`)}const l=yield d.json();return(0,o.debugLog)("[ChatV2Service] ‚úÖ Mensaje enviado:",l.messageId||l.id),l}))}sendMessageSmart(e,t){return i(this,arguments,void 0,(function*(e,t,n={},i="text"){(0,o.debugLog)(`[ChatV2Service] üß† Enviando mensaje inteligente para visitante ${e}`);try{const s=yield this.getVisitorChats(e,void 0,1);if(s.chats&&s.chats.length>0){const e=s.chats[0];(0,o.debugLog)(`[ChatV2Service] üìã Chat existente encontrado: ${e.id}, enviando mensaje`);const n=yield this.sendMessage(e.id,t,i);return{chat:{id:e.id},message:{id:n.messageId||n.id},isNewChat:!1}}{(0,o.debugLog)("[ChatV2Service] üÜï No hay chats existentes, creando chat nuevo con mensaje");const e={content:t,type:i},s=yield this.createChatWithMessage(n,e);return{chat:{id:s.chatId},message:{id:s.messageId},isNewChat:!0}}}catch(e){throw console.error("[ChatV2Service] ‚ùå Error en sendMessageSmart:",e),e}}))}getChatMessages(e){return i(this,arguments,void 0,(function*(e,t=50,n){var i;(0,o.debugLog)(`[ChatV2Service] üìã Obteniendo mensajes del chat: ${e}`);const a=new URLSearchParams;a.append("limit",t.toString()),n&&a.append("cursor",n);const r=s.EndpointManager.getInstance(),c=localStorage.getItem("pixelEndpoint")||r.getEndpoint(),d=`${c.endsWith("/api")?c:`${c}/api`}/v2/messages/chat/${e}?${a.toString()}`,l=yield fetch(d,this.getFetchOptions("GET"));if(!l.ok){const e=yield l.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener mensajes del chat:",e),new Error(`Error al obtener mensajes del chat (${l.status}): ${e}`)}const u=yield l.json();return u.nextCursor&&!u.cursor&&(u.cursor=u.nextCursor),(0,o.debugLog)("[ChatV2Service] ‚úÖ Mensajes del chat obtenidos:",{count:(null===(i=u.messages)||void 0===i?void 0:i.length)||0,total:u.total,hasMore:u.hasMore,cursor:u.cursor}),u}))}}t.ChatV2Service=a},7690:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URLPageDetector=void 0;const i=n(6932);t.URLPageDetector=class{constructor(){this.urlPatterns=[{pattern:/^\/?(index\.(php|html?)?)?$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/^\/?(home|inicio)$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/\/?(shop|tienda|ecommerce|store)/i,pageType:"ecommerce",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(product|producto)[\/-]?(\d+|[^\/]+)?/i,pageType:"product_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(cart|carrito|basket)/i,pageType:"cart",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(checkout|pago|payment)/i,pageType:"checkout",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(search|busqueda|buscar)?/i,pageType:"vehicle_search",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(vehiculos-ocasion|coches-ocasion|vehiculos-segunda-mano|coches-usados)/i,pageType:"used_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"used"}},{pattern:/\/?(vehiculos-nuevos|coches-nuevos)/i,pageType:"new_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"new"}},{pattern:/\/?(coches-km0|vehiculos-km0|km-0)/i,pageType:"km0_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"km0"}},{pattern:/\/?(ofertas-vehiculos|ofertas-coches|promociones-coches)/i,pageType:"vehicle_offers",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive",vehicleType:"offers"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(detail|detalle)[\/-]?(\d+|[^\/]+)?/i,pageType:"vehicle_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(comparison|comparar|compare)/i,pageType:"vehicle_comparison",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(financing|financiacion|finance)/i,pageType:"financing",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(contact|contacto|contact-us)/i,pageType:"contact",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(about|nosotros|acerca|about-us)/i,pageType:"about",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(analytics|dashboard|admin)/i,pageType:"analytics_dashboard",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"analytics"}},{pattern:/\/?(search|buscar|busqueda)/i,pageType:"search_results",confidence:i.ConfidenceLevel.MEDIUM,metadata:{pageCategory:"search"}},{pattern:/.*/,pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,metadata:{pageCategory:"unknown"}}]}detectCurrentPage(){const e=window.location.href,t=window.location.pathname;for(const n of this.urlPatterns)if(this.matchesPattern(t,n.pattern))return{pageType:n.pageType,confidence:n.confidence,url:e,path:t,metadata:Object.assign(Object.assign({},n.metadata),{title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()})};return{pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,url:e,path:t,metadata:{pageCategory:"unknown",title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()}}}matchesPattern(e,t){return t instanceof RegExp?t.test(e):e.toLowerCase().includes(t.toLowerCase())}addURLPattern(e){this.urlPatterns.splice(-1,0,e)}getURLPatterns(){return[...this.urlPatterns]}extractPageMetadata(){var e;const t=this.detectCurrentPage();return Object.assign(Object.assign({},t.metadata),{viewport:{width:window.innerWidth,height:window.innerHeight},userAgent:navigator.userAgent,language:navigator.language,page_url:window.location.href,page_path:window.location.pathname,page_search:window.location.search,page_host:window.location.host,page_protocol:window.location.protocol,page_hash:window.location.hash,page_type:t.pageType,page_confidence:t.confidence,page_category:null===(e=t.metadata)||void 0===e?void 0:e.pageCategory})}}},7696:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeMessageManager=void 0;const s=n(3974),o=n(3104),a=n(7686);class r{constructor(){this.chatUI=null,this.visitorId="",this.currentChatId=null,this.enableTypingIndicators=!0,this.typingIndicatorDelay=3e3,this.typingTimeouts=new Map,this.wsService=o.WebSocketService.getInstance(),this.chatService=a.ChatV2Service.getInstance(),(0,s.debugLog)("üí¨ [RealtimeMessageManager] Instancia creada")}static getInstance(){return r.instance||(r.instance=new r),r.instance}initialize(e){(0,s.debugLog)("üí¨ [RealtimeMessageManager] üöÄ Inicializando con:",{visitorId:e.visitorId,hasChatUI:!!e.chatUI,enableTyping:e.enableTypingIndicators}),this.chatUI=e.chatUI,this.visitorId=e.visitorId,this.enableTypingIndicators=!1!==e.enableTypingIndicators,this.typingIndicatorDelay=e.typingIndicatorDelay||3e3,this.wsService.updateCallbacks({onConnect:()=>this.handleConnect(),onDisconnect:e=>this.handleDisconnect(e),onError:e=>this.handleError(e),onMessage:e=>this.handleNewMessage(e),onChatStatus:e=>this.handleChatStatus(e),onTyping:e=>this.handleTyping(e)}),(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úÖ Inicializado correctamente")}setCurrentChat(e){this.currentChatId!==e?((0,s.debugLog)("üí¨ [RealtimeMessageManager] üìå Cambiando chat activo:",{anterior:this.currentChatId,nuevo:e}),this.currentChatId&&this.wsService.leaveChatRoom(this.currentChatId),this.currentChatId=e,this.wsService.joinChatRoom(e),this.chatUI&&this.chatUI.setChatId(e)):(0,s.debugLog)("üí¨ [RealtimeMessageManager] Chat ya activo:",e)}sendMessage(e){return i(this,arguments,void 0,(function*(e,t="text"){if(!this.currentChatId)throw console.error("üí¨ [RealtimeMessageManager] ‚ùå No hay chat activo"),new Error("No hay chat activo");(0,s.debugLog)("üí¨ [RealtimeMessageManager] üì§ Enviando mensaje via HTTP:",{chatId:this.currentChatId,contentLength:e.length,type:t});try{const n=yield this.chatService.sendMessage(this.currentChatId,e,t);(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úÖ Mensaje enviado (HTTP):",n.messageId||n.id)}catch(e){throw console.error("üí¨ [RealtimeMessageManager] ‚ùå Error enviando mensaje:",e),e}}))}emitTyping(e){if(this.currentChatId&&this.enableTypingIndicators&&(this.wsService.emitTyping(this.currentChatId,e),e)){const e=this.typingTimeouts.get(this.visitorId);e&&clearTimeout(e);const t=setTimeout((()=>{this.wsService.emitTyping(this.currentChatId,!1),this.typingTimeouts.delete(this.visitorId)}),this.typingIndicatorDelay);this.typingTimeouts.set(this.visitorId,t)}}handleConnect(){(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úÖ WebSocket conectado"),this.currentChatId&&this.wsService.joinChatRoom(this.currentChatId)}handleDisconnect(e){(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚ö†Ô∏è WebSocket desconectado:",e),this.chatUI&&"io client disconnect"!==e&&console.warn("‚ö†Ô∏è Conexi√≥n perdida, intentando reconectar...")}handleError(e){console.error("üí¨ [RealtimeMessageManager] ‚ùå Error WebSocket:",e.message)}handleNewMessage(e){if((0,s.debugLog)("üí¨ [RealtimeMessageManager] üì® Procesando mensaje nuevo:",{messageId:e.messageId,chatId:e.chatId,senderId:e.senderId,senderName:e.senderName,isInternal:e.isInternal}),e.chatId===this.currentChatId)if(e.isInternal)(0,s.debugLog)("üí¨ [RealtimeMessageManager] üîí Mensaje interno, no visible para visitante");else if(e.senderId!==this.visitorId)if(this.chatUI)try{const t="other";this.chatUI.renderChatMessage({text:e.content,sender:t,timestamp:new Date(e.sentAt).getTime(),senderId:e.senderId}),this.chatUI.scrollToBottom(!0),(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úÖ Mensaje renderizado en UI")}catch(e){console.error("üí¨ [RealtimeMessageManager] ‚ùå Error renderizando mensaje:",e)}else console.warn("üí¨ [RealtimeMessageManager] ‚ö†Ô∏è ChatUI no disponible");else(0,s.debugLog)("üí¨ [RealtimeMessageManager] üö´ Mensaje propio ignorado (ya renderizado):",{messageId:e.messageId,visitorId:this.visitorId});else(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚ö†Ô∏è Mensaje de otro chat, ignorando")}handleChatStatus(e){if((0,s.debugLog)("üí¨ [RealtimeMessageManager] üìä Estado del chat actualizado:",e),e.chatId===this.currentChatId&&this.chatUI)switch(e.status){case"IN_PROGRESS":(0,s.debugLog)("üí¨ Chat en progreso - primera respuesta del comercial");break;case"RESOLVED":(0,s.debugLog)("üí¨ Chat resuelto");break;case"CLOSED":(0,s.debugLog)("üí¨ Chat cerrado"),this.chatUI&&this.chatUI.addSystemMessage("El chat ha sido cerrado.")}}handleTyping(e){this.enableTypingIndicators&&e.userId!==this.visitorId&&(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úçÔ∏è Typing indicator:",{user:e.userName,isTyping:e.isTyping})}cleanup(){(0,s.debugLog)("üí¨ [RealtimeMessageManager] üßπ Limpiando recursos..."),this.typingTimeouts.forEach((e=>clearTimeout(e))),this.typingTimeouts.clear(),this.currentChatId&&(this.wsService.leaveChatRoom(this.currentChatId),this.currentChatId=null),(0,s.debugLog)("üí¨ [RealtimeMessageManager] ‚úÖ Recursos limpiados")}getCurrentChatId(){return this.currentChatId}isConnected(){return this.wsService.isConnected()}}t.RealtimeMessageManager=r,r.instance=null},7743:(e,t)=>{"use strict";function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Object.defineProperty(t,"__esModule",{value:!0}),t.Backoff=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},7775:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s=(i=n(7037))&&i.__esModule?i:{default:i};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},7785:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.VisitorsV2Service=void 0;const s=n(2597);class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}getBaseUrl(){const e=localStorage.getItem("pixelEndpoint")||s.EndpointManager.getInstance().getEndpoint();return`${e.endsWith("/api")?e:`${e}/api`}/visitors`}identify(e,t,n){return i(this,void 0,void 0,(function*(){var i,s,o;try{const a=`${this.getBaseUrl()}/identify`,r="undefined"!=typeof window?window.location.hostname:"localhost";let c=!1,d="v1.0";if(n)c=n.hasAcceptedPrivacyPolicy,d=n.consentVersion;else if("undefined"!=typeof localStorage){const e=localStorage.getItem("guiders_consent_state");if(e)try{const t=JSON.parse(e);c="granted"===t.status,d=t.version||"v1.0"}catch(e){console.warn("[VisitorsV2Service] ‚ö†Ô∏è No se pudo parsear estado de consentimiento")}}const l={fingerprint:e,domain:r,apiKey:t||localStorage.getItem("guidersApiKey")||"",hasAcceptedPrivacyPolicy:c,consentVersion:d,currentUrl:"undefined"!=typeof window?window.location.href:void 0};console.log("[VisitorsV2Service] üîê Enviando identify con consentimiento:",{hasAcceptedPrivacyPolicy:c,consentVersion:d,currentUrl:l.currentUrl});const u=yield fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),credentials:"include"});if(u.ok){const e=yield u.json(),t={visitorId:e.visitorId||e.id,sessionId:e.sessionId||e.session_id,name:null!==(i=e.name)&&void 0!==i?i:null,email:null!==(s=e.email)&&void 0!==s?s:null,tel:null!==(o=e.tel)&&void 0!==o?o:null,lifecycle:e.lifecycle,isNewVisitor:e.isNewVisitor,consentStatus:e.consentStatus||"granted",allowedActions:e.allowedActions||["chat","forms","tracking","all"]};return t.visitorId&&localStorage.setItem("visitorId",t.visitorId),t.sessionId&&sessionStorage.setItem("guiders_backend_session_id",t.sessionId),console.log("[VisitorsV2Service] ‚úÖ identify OK (consentimiento aceptado):",t.visitorId,"session:",t.sessionId),t}if(400===u.status)try{const e=yield u.json();if("denied"===e.consentStatus&&e.visitorId){const t={visitorId:e.visitorId,sessionId:null,lifecycle:e.lifecycle||"anon",isNewVisitor:e.isNewVisitor,consentStatus:"denied",allowedActions:e.allowedActions||["read_only"]};return t.visitorId&&localStorage.setItem("visitorId",t.visitorId),console.warn("[VisitorsV2Service] ‚ö†Ô∏è identify: consentimiento rechazado (modo limitado):",t.visitorId),console.log("[VisitorsV2Service] üìã Acciones permitidas:",t.allowedActions),t}}catch(e){console.error("[VisitorsV2Service] ‚ùå Error parseando respuesta 400:",e)}const h=yield u.text();return console.warn("[VisitorsV2Service] ‚ùå Error al identificar visitante:",u.status,h),null}catch(e){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n en identify:",e),null}}))}heartbeat(){return i(this,void 0,void 0,(function*(){try{const e=sessionStorage.getItem("guiders_backend_session_id");if(!e)return console.warn("[VisitorsV2Service] ‚ùå No sessionId disponible para heartbeat"),!1;const t=`${this.getBaseUrl()}/session/heartbeat`,n=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json","x-guiders-sid":e},body:JSON.stringify({sessionId:e}),credentials:"include"});if(!n.ok){const e=yield n.text();return console.warn("[VisitorsV2Service] ‚ùå Heartbeat fallido:",n.status,e),!1}return console.log("[VisitorsV2Service] ‚úÖ Heartbeat exitoso"),!0}catch(e){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n heartbeat:",e),!1}}))}endSession(){return i(this,arguments,void 0,(function*(e={}){const t=sessionStorage.getItem("guiders_backend_session_id");if(!t)return console.warn("[VisitorsV2Service] ‚ùå No sessionId disponible para endSession"),!1;const n=`${this.getBaseUrl()}/session/end`,i={sessionId:t,reason:e.reason||(e.useBeacon?"page_unload":"manual")};if(e.useBeacon&&"undefined"!=typeof navigator&&"sendBeacon"in navigator)try{const e=new Blob([JSON.stringify(i)],{type:"application/json"});if(navigator.sendBeacon(n,e))return console.log("[VisitorsV2Service] ‚úÖ endSession enviado via beacon"),sessionStorage.removeItem("guiders_backend_session_id"),!0;console.warn("[VisitorsV2Service] ‚ö†Ô∏è sendBeacon fall√≥, intentando fetch...")}catch(e){console.warn("[VisitorsV2Service] ‚ùå Error con sendBeacon, fallback a fetch:",e)}if(!e.useBeacon)try{const e=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json","x-guiders-sid":t},body:JSON.stringify(i),credentials:"include",keepalive:!0});if(!e.ok){const t=yield e.text();return console.warn("[VisitorsV2Service] ‚ùå endSession fallido:",e.status,t),!1}return console.log("[VisitorsV2Service] ‚úÖ endSession exitoso via fetch"),sessionStorage.removeItem("guiders_backend_session_id"),!0}catch(e){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n endSession:",e),!1}return console.warn("[VisitorsV2Service] ‚ùå No se pudo enviar endSession"),!1}))}}t.VisitorsV2Service=o},7833:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(s=i))})),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e="MISSING_ENV_VAR".DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(736)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},8007:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebTransport=t.WebSocket=t.NodeWebSocket=t.XHR=t.NodeXHR=t.Fetch=t.Socket=t.Manager=t.protocol=void 0,t.io=d,t.connect=d,t.default=d;const s=n(6894),o=n(3776);Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return o.Manager}});const a=n(6214);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return a.Socket}});const r=(0,i(n(7833)).default)("socket.io-client"),c={};function d(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const n=(0,s.url)(e,t.path||"/socket.io"),i=n.source,a=n.id,d=n.path,l=c[a]&&d in c[a].nsps;let u;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(r("ignoring socket cache for %s",i),u=new o.Manager(i,t)):(c[a]||(r("new io instance for %s",i),c[a]=new o.Manager(i,t)),u=c[a]),n.query&&!t.query&&(t.query=n.queryKey),u.socket(n.path,t)}Object.assign(d,{Manager:o.Manager,Socket:a.Socket,io:d,connect:d});var l=n(4627);Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return l.protocol}});var u=n(4956);Object.defineProperty(t,"Fetch",{enumerable:!0,get:function(){return u.Fetch}}),Object.defineProperty(t,"NodeXHR",{enumerable:!0,get:function(){return u.NodeXHR}}),Object.defineProperty(t,"XHR",{enumerable:!0,get:function(){return u.XHR}}),Object.defineProperty(t,"NodeWebSocket",{enumerable:!0,get:function(){return u.NodeWebSocket}}),Object.defineProperty(t,"WebSocket",{enumerable:!0,get:function(){return u.WebSocket}}),Object.defineProperty(t,"WebTransport",{enumerable:!0,get:function(){return u.WebTransport}}),e.exports=d},8156:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.disableDebug=t.enableDebug=t.debugError=t.debugWarn=t.debugLog=void 0;const o=n(2597),a=n(401),r=n(1688);n(2326),s(n(2597),t),s(n(1921),t),s(n(401),t),s(n(6808),t),s(n(2895),t),s(n(1034),t),s(n(7690),t),s(n(6420),t),s(n(1750),t),s(n(421),t),s(n(9167),t),s(n(7686),t),s(n(4968),t),s(n(2090),t),s(n(3574),t);var c=n(3974);Object.defineProperty(t,"debugLog",{enumerable:!0,get:function(){return c.debugLog}}),Object.defineProperty(t,"debugWarn",{enumerable:!0,get:function(){return c.debugWarn}}),Object.defineProperty(t,"debugError",{enumerable:!0,get:function(){return c.debugError}}),Object.defineProperty(t,"enableDebug",{enumerable:!0,get:function(){return c.enableDebug}}),Object.defineProperty(t,"disableDebug",{enumerable:!0,get:function(){return c.disableDebug}});const d=r.resolveDefaultEndpoints;function l(){if(window.guiders||window.__GUIDERS_INITIALIZING__)console.warn("[Guiders SDK] ‚ùå Inicializaci√≥n ignorada: instancia existente o en progreso");else{window.__GUIDERS_INITIALIZING__=!0;try{const{apiKey:e}=function(){const e=function(){const e=Array.from(document.getElementsByTagName("script"));for(const t of e)if(t.getAttribute("data-guiders-sdk"))return t;if(document.currentScript&&document.currentScript instanceof HTMLScriptElement){const e=document.currentScript;if(e.getAttribute("data-api-key")||e.getAttribute("data-apikey")||e.src&&(e.src.includes("apiKey=")||e.src.includes("apikey=")||e.src.includes("guiders")))return e}for(const t of e)if(t.getAttribute("data-api-key")||t.getAttribute("data-apikey"))return t;for(const t of e)if(t.src&&(t.src.includes("apiKey=")||t.src.includes("apikey=")))return t;for(const t of e)if(t.src&&t.src.includes("guiders"))return t;for(const t of e)if(t.src&&(t.src.includes("tracking")||t.src.includes("index.js"))&&(t.src.includes("apiKey=")||t.src.includes("apikey=")))return t;const t=e.filter((e=>e.src&&(e.src.includes(".js")||e.src.includes("index"))));for(let e=t.length-1;e>=0;e--){const n=t[e];if(n.src.includes("guiders")||n.src.includes("tracking")||n.src.includes("apiKey=")||n.src.includes("apikey="))return n}return null}();if(!e)throw new Error("No se encontr√≥ el script del SDK Guiders. Aseg√∫rate de incluir el atributo data-api-key.");let t=e.getAttribute("data-api-key")||e.getAttribute("data-apikey");if(!t&&e.src){const n=e.src.split("?")[1];if(n){const e=new URLSearchParams(n);t=e.get("apiKey")||e.get("apikey")}}if(!t&&"undefined"!=typeof window&&window.GUIDERS_CONFIG&&(t=window.GUIDERS_CONFIG.apiKey),!t)throw new Error("No se encontr√≥ la clave API. Usa data-api-key=\"tu-clave\" en el script o configura window.GUIDERS_CONFIG = {apiKey: 'tu-clave'}.");return{apiKey:t}}();window.GUIDERS_API_KEY=e,window.TrackingPixelSDK=o.TrackingPixelSDK;const{endpoint:t,webSocketEndpoint:i,isProd:s}=d();console.log("[Guiders SDK] üåê Endpoints resueltos:",{endpoint:t,webSocketEndpoint:i,isProd:s});const r={apiKey:e,autoFlush:!0,flushInterval:1e3,maxRetries:2,heuristicDetection:{enabled:!0,config:{enabled:!0,confidenceThreshold:.7,fallbackToManual:!0}},sessionTracking:{enabled:!0,config:{enabled:!0,heartbeatInterval:3e4,trackBackgroundTime:!1}},welcomeMessage:{enabled:!0,style:"friendly",includeEmojis:!0,language:"es",showTips:!0},endpoint:t,webSocketEndpoint:i};window.GUIDERS_CONFIG&&(window.GUIDERS_CONFIG.welcomeMessage&&(r.welcomeMessage=Object.assign(Object.assign({},r.welcomeMessage),window.GUIDERS_CONFIG.welcomeMessage)),Object.keys(window.GUIDERS_CONFIG).forEach((e=>{"welcomeMessage"!==e&&(r[e]=window.GUIDERS_CONFIG[e])}))),(new a.BotDetector).detect().then((e=>{if(e.isBot)return console.log("Bot detectado. Probabilidad:",e.probability),console.log("Detalles:",e.details),void(window.__GUIDERS_INITIALIZING__=!1);window.guiders=new window.TrackingPixelSDK(r),s||"undefined"==typeof window||Promise.resolve().then((()=>n(2326))).then((({DevRandomMessages:e})=>{const t=e.getInstance();window.guidersDevRandomMessages={trigger:(e,n)=>t.triggerRandomMessages(e,n),setConfig:e=>t.setConfig(e),getConfig:()=>t.getConfig(),isEnabled:()=>t.isEnabled(),isGenerating:()=>t.isGenerating()},console.log("üé≤ [DevRandomMessages] üåê Interfaz global configurada en window.guidersDevRandomMessages")})),console.log("[Guiders SDK] ‚úÖ SDK instanciado - esperando consentimiento del usuario"),window.__GUIDERS_INITIALIZING__=!1}))}catch(e){console.error("Error inicializando Guiders SDK:",e),window.__GUIDERS_INITIALIZING__=!1}}}"undefined"!=typeof window&&(window.GUIDERS_CONFIG&&window.GUIDERS_CONFIG.preventAutoInit?console.log("[Guiders SDK] ‚è∏Ô∏è Auto-init desactivado por configuraci√≥n (preventAutoInit)"):setTimeout((()=>{if(!window.guiders){const e=()=>{document.addEventListener("rocket-script-loaded",(e=>{const t=e.target;!window.guiders&&t&&t.src&&(t.src.includes("guiders")||t.src.includes("apiKey="))&&setTimeout(l,10)})),document.addEventListener("rocket-loaded",(()=>{window.guiders||setTimeout(l,10)}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),(void 0!==window.RocketLazyLoadScripts||document.querySelector('script[type="rocketlazyloadscript"]'))&&(setTimeout((()=>{window.guiders||l()}),100),setTimeout((()=>{window.guiders||l()}),500))}}),500))},8209:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fetch=void 0;const i=n(528);class s extends i.Polling{doPoll(){this._fetch().then((e=>{if(!e.ok)return this.onError("fetch read error",e.status,e);e.text().then((e=>this.onData(e)))})).catch((e=>{this.onError("fetch read error",e)}))}doWrite(e,t){this._fetch(e).then((e=>{if(!e.ok)return this.onError("fetch write error",e.status,e);t()})).catch((e=>{this.onError("fetch write error",e)}))}_fetch(e){var t;const n=void 0!==e,i=new Headers(this.opts.extraHeaders);return n&&i.set("content-type","text/plain;charset=UTF-8"),null===(t=this.socket._cookieJar)||void 0===t||t.appendCookies(i),fetch(this.uri(),{method:n?"POST":"GET",body:n?e:null,headers:i,credentials:this.opts.withCredentials?"include":"omit"}).then((e=>{var t;return null===(t=this.socket._cookieJar)||void 0===t||t.parseCookies(e.headers.getSetCookie()),e}))}}t.Fetch=s},8223:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=t.SocketWithUpgrade=t.SocketWithoutUpgrade=void 0;const s=n(9419),o=n(5374),a=n(8661),r=n(1015),c=n(4454),d=n(6376),l=n(4624),u=(0,i(n(7833)).default)("engine.io-client:socket"),h="function"==typeof addEventListener&&"function"==typeof removeEventListener,g=[];h&&addEventListener("offline",(()=>{u("closing %d connection(s) because the network was lost",g.length),g.forEach((e=>e()))}),!1);class p extends c.Emitter{constructor(e,t){if(super(),this.binaryType=l.defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const n=(0,r.parse)(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=(0,r.parse)(t.host).host);(0,o.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach((e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(0,a.decode)(this.opts.query)),h&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(u("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},g.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=(0,l.createCookieJar)()),this._open()}createTransport(e){u('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=d.protocol,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return u("options: %j",n),new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const e=this.opts.rememberUpgrade&&p.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){u("setting transport %s",e.name),this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(e=>this._onClose("transport close",e)))}onOpen(){u("socket open"),this.readyState="open",p.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(u('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else u('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();u("flushing %d packets in socket",e.length),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=(0,o.byteLength)(n)),t>0&&e>this._maxPayload)return u("only send %d out of %d packets",t,this.writeBuffer.length),this.writeBuffer.slice(0,t);e+=2}return u("payload size is %d (max: %d)",e,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(u("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,(0,l.nextTick)((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),u("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}_onError(e){if(u("socket error %j",e),p.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return u("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(u('socket close with reason: "%s"',e),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),h&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=g.indexOf(this._offlineEventListener);-1!==e&&(u("removing listener for the 'offline' event"),g.splice(e,1))}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}t.SocketWithoutUpgrade=p,p.protocol=d.protocol;class f extends p{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade){u("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){u('probing transport "%s"',e);let t=this.createTransport(e),n=!1;p.priorWebsocketSuccess=!1;const i=()=>{n||(u('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(i=>{if(!n)if("pong"===i.type&&"probe"===i.data){if(u('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;p.priorWebsocketSuccess="websocket"===t.name,u('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{n||"closed"!==this.readyState&&(u("changing transport and sending upgrade packet"),d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{u('probe transport "%s" failed',e);const n=new Error("probe error");n.transport=t.name,this.emitReserved("upgradeError",n)}})))};function s(){n||(n=!0,d(),t.close(),t=null)}const o=n=>{const i=new Error("probe error: "+n);i.transport=t.name,s(),u('probe transport "%s" failed because of error: %s',e,n),this.emitReserved("upgradeError",i)};function a(){o("transport closed")}function r(){o("socket closed")}function c(e){t&&e.name!==t.name&&(u('"%s" works - aborting "%s"',e.name,t.name),s())}const d=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",r),this.off("upgrading",c)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",r),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}t.SocketWithUpgrade=f,t.Socket=class extends f{constructor(e,t={}){const n="object"==typeof e?e:t;(!n.transports||n.transports&&"string"==typeof n.transports[0])&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map((e=>s.transports[e])).filter((e=>!!e))),super(e,n)}}},8334:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatSessionStore=void 0;class n{constructor(){this.openChats=new Set,this.currentChatId=null,this.LS_KEY="guiders_open_chats",this.hydrate()}static getInstance(){return n.instance||(n.instance=new n),n.instance}hydrate(){try{const e=localStorage.getItem(this.LS_KEY);if(!e)return;const t=JSON.parse(e);Array.isArray(t.open)&&t.open.forEach((e=>e&&this.openChats.add(e))),t.current&&(this.currentChatId=t.current)}catch(e){console.warn("[ChatSessionStore] ‚ùå Error al hidratar open chats:",e)}}persist(){try{const e={current:this.currentChatId,open:Array.from(this.openChats),lastUpdated:Date.now()};localStorage.setItem(this.LS_KEY,JSON.stringify(e))}catch(e){console.warn("[ChatSessionStore] ‚ùå Error al persistir open chats:",e)}}setCurrent(e){e&&(this.currentChatId=e,this.openChats.add(e),this.persist())}add(e){e&&(this.openChats.add(e),this.persist())}remove(e){e&&(this.openChats.delete(e),this.currentChatId===e&&(this.currentChatId=null),this.persist())}getCurrent(){return this.currentChatId}getAll(){return Array.from(this.openChats)}}t.ChatSessionStore=n},8661:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){let t={},n=e.split("&");for(let e=0,i=n.length;e<i;e++){let i=n[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},8716:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WS=t.BaseWS=void 0;const s=n(4689),o=n(5374),a=n(6376),r=n(4624),c=(0,i(n(7833)).default)("engine.io-client:websocket"),d="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class l extends s.Transport{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=d?{}:(0,o.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;(0,a.encodePacket)(n,this.supportsBinary,(e=>{try{this.doWrite(n,e)}catch(e){c("websocket closed before onclose event")}i&&(0,r.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,o.randomString)()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}t.BaseWS=l;const u=r.globalThisShim.WebSocket||r.globalThisShim.MozWebSocket;t.WS=class extends l{createSocket(e,t,n){return d?new u(e,t,n):t?new u(e,t):new u(e)}doWrite(e,t){this.ws.send(t)}}},9025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function i(e,i,a,r){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof i&&(i=(0,o.default)(i)),16!==(null===(c=i)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+e.length);if(d.set(i),d.set(e,i.length),(d=n(d))[6]=15&d[6]|t,d[8]=63&d[8]|128,a){r=r||0;for(var l=0;l<16;++l)a[r+l]=d[l];return a}return(0,s.unsafeStringify)(d)}try{i.name=e}catch(e){}return i.DNS=a,i.URL=r,i};var i,s=n(9910),o=(i=n(6792))&&i.__esModule?i:{default:i},a=t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r=t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8"},9042:(e,t)=>{"use strict";function n(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:case 3:return t^n^i;case 2:return t&n^t&i^n&i}}function i(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=function(e){var t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var a=0;a<o.length;++a)e.push(o.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var r=e.length/4+2,c=Math.ceil(r/16),d=new Array(c),l=0;l<c;++l){for(var u=new Uint32Array(16),h=0;h<16;++h)u[h]=e[64*l+4*h]<<24|e[64*l+4*h+1]<<16|e[64*l+4*h+2]<<8|e[64*l+4*h+3];d[l]=u}d[c-1][14]=8*(e.length-1)/Math.pow(2,32),d[c-1][14]=Math.floor(d[c-1][14]),d[c-1][15]=8*(e.length-1)&4294967295;for(var g=0;g<c;++g){for(var p=new Uint32Array(80),f=0;f<16;++f)p[f]=d[g][f];for(var m=16;m<80;++m)p[m]=i(p[m-3]^p[m-8]^p[m-14]^p[m-16],1);for(var b=s[0],v=s[1],y=s[2],w=s[3],C=s[4],S=0;S<80;++S){var k=Math.floor(S/20),x=i(b,5)+n(k,v,y,w)+C+t[k]+p[S]>>>0;C=w,w=y,y=i(v,30)>>>0,v=b,b=x}s[0]=s[0]+b>>>0,s[1]=s[1]+v>>>0,s[2]=s[2]+y>>>0,s[3]=s[3]+w>>>0,s[4]=s[4]+C>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]}},9126:function(e,t,n){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i,s,o=n(1)(),a=n(3),r=n(4),c=n(6),d=function(){var e=new r;return i=e.getResult(),s=new c,this};d.prototype={getSoftwareVersion:function(){return"0.1.11"},getBrowserData:function(){return i},getFingerprint:function(){var e="|",t=i.ua,n=this.getScreenPrint(),s=this.getPlugins(),o=this.getFonts(),r=this.isLocalStorage(),c=this.isSessionStorage(),d=this.getTimeZone(),l=this.getLanguage(),u=this.getSystemLanguage(),h=this.isCookie(),g=this.getCanvasPrint();return a(t+e+n+e+s+e+o+e+r+e+c+e+d+e+l+e+u+e+h+e+g,256)},getCustomFingerprint:function(){for(var e="",t=0;t<arguments.length;t++)e+=arguments[t]+"|";return a(e,256)},getUserAgent:function(){return i.ua},getUserAgentLowerCase:function(){return i.ua.toLowerCase()},getBrowser:function(){return i.browser.name},getBrowserVersion:function(){return i.browser.version},getBrowserMajorVersion:function(){return i.browser.major},isIE:function(){return/IE/i.test(i.browser.name)},isChrome:function(){return/Chrome/i.test(i.browser.name)},isFirefox:function(){return/Firefox/i.test(i.browser.name)},isSafari:function(){return/Safari/i.test(i.browser.name)},isMobileSafari:function(){return/Mobile\sSafari/i.test(i.browser.name)},isOpera:function(){return/Opera/i.test(i.browser.name)},getEngine:function(){return i.engine.name},getEngineVersion:function(){return i.engine.version},getOS:function(){return i.os.name},getOSVersion:function(){return i.os.version},isWindows:function(){return/Windows/i.test(i.os.name)},isMac:function(){return/Mac/i.test(i.os.name)},isLinux:function(){return/Linux/i.test(i.os.name)},isUbuntu:function(){return/Ubuntu/i.test(i.os.name)},isSolaris:function(){return/Solaris/i.test(i.os.name)},getDevice:function(){return i.device.model},getDeviceType:function(){return i.device.type},getDeviceVendor:function(){return i.device.vendor},getCPU:function(){return i.cpu.architecture},isMobile:function(){var e=i.ua||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))},isMobileMajor:function(){return this.isMobileAndroid()||this.isMobileBlackBerry()||this.isMobileIOS()||this.isMobileOpera()||this.isMobileWindows()},isMobileAndroid:function(){return!!i.ua.match(/Android/i)},isMobileOpera:function(){return!!i.ua.match(/Opera Mini/i)},isMobileWindows:function(){return!!i.ua.match(/IEMobile/i)},isMobileBlackBerry:function(){return!!i.ua.match(/BlackBerry/i)},isMobileIOS:function(){return!!i.ua.match(/iPhone|iPad|iPod/i)},isIphone:function(){return!!i.ua.match(/iPhone/i)},isIpad:function(){return!!i.ua.match(/iPad/i)},isIpod:function(){return!!i.ua.match(/iPod/i)},getScreenPrint:function(){return"Current Resolution: "+this.getCurrentResolution()+", Available Resolution: "+this.getAvailableResolution()+", Color Depth: "+this.getColorDepth()+", Device XDPI: "+this.getDeviceXDPI()+", Device YDPI: "+this.getDeviceYDPI()},getColorDepth:function(){return screen.colorDepth},getCurrentResolution:function(){return screen.width+"x"+screen.height},getAvailableResolution:function(){return screen.availWidth+"x"+screen.availHeight},getDeviceXDPI:function(){return screen.deviceXDPI},getDeviceYDPI:function(){return screen.deviceYDPI},getPlugins:function(){for(var e="",t=0;t<navigator.plugins.length;t++)t==navigator.plugins.length-1?e+=navigator.plugins[t].name:e+=navigator.plugins[t].name+", ";return e},isJava:function(){return navigator.javaEnabled()},getJavaVersion:function(){throw new Error("Please use client.java.js or client.js if you need this functionality!")},isFlash:function(){return!!navigator.plugins["Shockwave Flash"]},getFlashVersion:function(){throw new Error("Please use client.flash.js or client.js if you need this functionality!")},isSilverlight:function(){return!!navigator.plugins["Silverlight Plug-In"]},getSilverlightVersion:function(){return this.isSilverlight()?navigator.plugins["Silverlight Plug-In"].description:""},isMimeTypes:function(){return!(!navigator.mimeTypes||!navigator.mimeTypes.length)},getMimeTypes:function(){var e="";if(navigator.mimeTypes)for(var t=0;t<navigator.mimeTypes.length;t++)t==navigator.mimeTypes.length-1?e+=navigator.mimeTypes[t].description:e+=navigator.mimeTypes[t].description+", ";return e},isFont:function(e){return s.detect(e)},getFonts:function(){for(var e=["Abadi MT Condensed Light","Adobe Fangsong Std","Adobe Hebrew","Adobe Ming Std","Agency FB","Aharoni","Andalus","Angsana New","AngsanaUPC","Aparajita","Arab","Arabic Transparent","Arabic Typesetting","Arial Baltic","Arial Black","Arial CE","Arial CYR","Arial Greek","Arial TUR","Arial","Batang","BatangChe","Bauhaus 93","Bell MT","Bitstream Vera Serif","Bodoni MT","Bookman Old Style","Braggadocio","Broadway","Browallia New","BrowalliaUPC","Calibri Light","Calibri","Californian FB","Cambria Math","Cambria","Candara","Castellar","Casual","Centaur","Century Gothic","Chalkduster","Colonna MT","Comic Sans MS","Consolas","Constantia","Copperplate Gothic Light","Corbel","Cordia New","CordiaUPC","Courier New Baltic","Courier New CE","Courier New CYR","Courier New Greek","Courier New TUR","Courier New","DFKai-SB","DaunPenh","David","DejaVu LGC Sans Mono","Desdemona","DilleniaUPC","DokChampa","Dotum","DotumChe","Ebrima","Engravers MT","Eras Bold ITC","Estrangelo Edessa","EucrosiaUPC","Euphemia","Eurostile","FangSong","Forte","FrankRuehl","Franklin Gothic Heavy","Franklin Gothic Medium","FreesiaUPC","French Script MT","Gabriola","Gautami","Georgia","Gigi","Gisha","Goudy Old Style","Gulim","GulimChe","GungSeo","Gungsuh","GungsuhChe","Haettenschweiler","Harrington","Hei S","HeiT","Heisei Kaku Gothic","Hiragino Sans GB","Impact","Informal Roman","IrisUPC","Iskoola Pota","JasmineUPC","KacstOne","KaiTi","Kalinga","Kartika","Khmer UI","Kino MT","KodchiangUPC","Kokila","Kozuka Gothic Pr6N","Lao UI","Latha","Leelawadee","Levenim MT","LilyUPC","Lohit Gujarati","Loma","Lucida Bright","Lucida Console","Lucida Fax","Lucida Sans Unicode","MS Gothic","MS Mincho","MS PGothic","MS PMincho","MS Reference Sans Serif","MS UI Gothic","MV Boli","Magneto","Malgun Gothic","Mangal","Marlett","Matura MT Script Capitals","Meiryo UI","Meiryo","Menlo","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU-ExtB","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","Miriam Fixed","Miriam","Mongolian Baiti","MoolBoran","NSimSun","Narkisim","News Gothic MT","Niagara Solid","Nyala","PMingLiU","PMingLiU-ExtB","Palace Script MT","Palatino Linotype","Papyrus","Perpetua","Plantagenet Cherokee","Playbill","Prelude Bold","Prelude Condensed Bold","Prelude Condensed Medium","Prelude Medium","PreludeCompressedWGL Black","PreludeCompressedWGL Bold","PreludeCompressedWGL Light","PreludeCompressedWGL Medium","PreludeCondensedWGL Black","PreludeCondensedWGL Bold","PreludeCondensedWGL Light","PreludeCondensedWGL Medium","PreludeWGL Black","PreludeWGL Bold","PreludeWGL Light","PreludeWGL Medium","Raavi","Rachana","Rockwell","Rod","Sakkal Majalla","Sawasdee","Script MT Bold","Segoe Print","Segoe Script","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Segoe UI","Shonar Bangla","Showcard Gothic","Shruti","SimHei","SimSun","SimSun-ExtB","Simplified Arabic Fixed","Simplified Arabic","Snap ITC","Sylfaen","Symbol","Tahoma","Times New Roman Baltic","Times New Roman CE","Times New Roman CYR","Times New Roman Greek","Times New Roman TUR","Times New Roman","TlwgMono","Traditional Arabic","Trebuchet MS","Tunga","Tw Cen MT Condensed Extra Bold","Ubuntu","Umpush","Univers","Utopia","Utsaah","Vani","Verdana","Vijaya","Vladimir Script","Vrinda","Webdings","Wide Latin","Wingdings"],t="",n=0;n<e.length;n++)s.detect(e[n])&&(t+=n==e.length-1?e[n]:e[n]+", ");return t},isLocalStorage:function(){try{return!!o.localStorage}catch(e){return!0}},isSessionStorage:function(){try{return!!o.sessionStorage}catch(e){return!0}},isCookie:function(){return navigator.cookieEnabled},getTimeZone:function(){var e,t;return e=new Date,(t=String(-e.getTimezoneOffset()/60))<0?"-"+("0"+(t*=-1)).slice(-2):"+"+("0"+t).slice(-2)},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language},isCanvas:function(){var e=document.createElement("canvas");try{return!(!e.getContext||!e.getContext("2d"))}catch(e){return!1}},getCanvasPrint:function(){var e,t=document.createElement("canvas");try{e=t.getContext("2d")}catch(e){return""}var n="ClientJS,org <canvas> 1.0";return e.textBaseline="top",e.font="14px 'Arial'",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText(n,2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText(n,4,17),t.toDataURL()}},t.ClientJS=d},function(e,t,i){"use strict";var s=i(2);e.exports=function(){return"object"==typeof n.g&&n.g&&n.g.Math===Math&&n.g.Array===Array?n.g:s}},function(e,t,n){"use strict";"undefined"!=typeof self?e.exports=self:"undefined"!=typeof window?e.exports=window:e.exports=Function("return this")()},function(e,t,n){e.exports=function(e,t){var n,i,s,o,a,r,c,d;for(n=3&e.length,i=e.length-n,s=t,a=3432918353,r=461845907,d=0;d<i;)c=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,s=27492+(65535&(o=5*(65535&(s=(s^=c=(65535&(c=(c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:s^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(d)))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},function(e,t,n){var i;!function(s,o){"use strict";var a="function",r="undefined",c="object",d="string",l="model",u="name",h="type",g="vendor",p="version",f="architecture",m="console",b="mobile",v="tablet",y="smarttv",w="wearable",C="embedded",S="Amazon",k="Apple",x="ASUS",I="BlackBerry",T="Google",M="Huawei",E="LG",_="Microsoft",P="Motorola",L="Samsung",D="Sony",O="Xiaomi",A="Zebra",j="Facebook",R=function(e){var t={};for(var n in e)t[e[n].toUpperCase()]=e[n];return t},U=function(e,t){return typeof e===d&&-1!==B(t).indexOf(B(e))},B=function(e){return e.toLowerCase()},N=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===r?e:e.substring(0,255)},V=function(e,t){for(var n,i,s,r,d,l,u=0;u<t.length&&!d;){var h=t[u],g=t[u+1];for(n=i=0;n<h.length&&!d;)if(d=h[n++].exec(e))for(s=0;s<g.length;s++)l=d[++i],typeof(r=g[s])===c&&r.length>0?2==r.length?typeof r[1]==a?this[r[0]]=r[1].call(this,l):this[r[0]]=r[1]:3==r.length?typeof r[1]!==a||r[1].exec&&r[1].test?this[r[0]]=l?l.replace(r[1],r[2]):o:this[r[0]]=l?r[1].call(this,l,r[2]):o:4==r.length&&(this[r[0]]=l?r[3].call(this,l.replace(r[1],r[2])):o):this[r]=l||o;u+=2}},H=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(U(t[n][i],e))return"?"===n?o:n}else if(U(t[n],e))return"?"===n?o:n;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,p],[/opios[\/ ]+([\w\.]+)/i],[p,[u,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[p,[u,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[u,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[p,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure Browser"],p],[/\bfocus\/([\w\.]+)/i],[p,[u,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[p,[u,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[u,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[p,[u,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 Browser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,j],p],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,"Chrome WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,p],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[p,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[p,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[u,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,B]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[g,L],[h,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[g,L],[h,b]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[g,k],[h,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[g,k],[h,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[g,M],[h,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[l,[g,M],[h,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[g,O],[h,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[g,O],[h,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[l,[g,"OPPO"],[h,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[g,"Vivo"],[h,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[g,"Realme"],[h,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[g,P],[h,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[g,P],[h,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[g,E],[h,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[g,E],[h,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[g,"Lenovo"],[h,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[g,"Nokia"],[h,b]],[/(pixel c)\b/i],[l,[g,T],[h,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[g,T],[h,b]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[g,D],[h,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[g,D],[h,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[g,"OnePlus"],[h,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[g,S],[h,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[g,S],[h,b]],[/(playbook);[-\w\),; ]+(rim)/i],[l,g,[h,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[g,I],[h,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[g,x],[h,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[g,x],[h,b]],[/(nexus 9)/i],[l,[g,"HTC"],[h,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[g,[l,/_/g," "],[h,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[g,"Acer"],[h,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[g,"Meizu"],[h,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[g,"Sharp"],[h,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,l,[h,b]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,l,[h,v]],[/(surface duo)/i],[l,[g,_],[h,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[g,"Fairphone"],[h,b]],[/(u304aa)/i],[l,[g,"AT&T"],[h,b]],[/\bsie-(\w*)/i],[l,[g,"Siemens"],[h,b]],[/\b(rct\w+) b/i],[l,[g,"RCA"],[h,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[g,"Dell"],[h,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[g,"Verizon"],[h,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[g,"Barnes & Noble"],[h,v]],[/\b(tm\d{3}\w+) b/i],[l,[g,"NuVision"],[h,v]],[/\b(k88) b/i],[l,[g,"ZTE"],[h,v]],[/\b(nx\d{3}j) b/i],[l,[g,"ZTE"],[h,b]],[/\b(gen\d{3}) b.+49h/i],[l,[g,"Swiss"],[h,b]],[/\b(zur\d{3}) b/i],[l,[g,"Swiss"],[h,v]],[/\b((zeki)?tb.*\b) b/i],[l,[g,"Zeki"],[h,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],l,[h,v]],[/\b(ns-?\w{0,9}) b/i],[l,[g,"Insignia"],[h,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[g,"NextBook"],[h,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],l,[h,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],l,[h,b]],[/\b(ph-1) /i],[l,[g,"Essential"],[h,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[g,"Envizen"],[h,v]],[/\b(trio[-\w\. ]+) b/i],[l,[g,"MachSpeed"],[h,v]],[/\btu_(1491) b/i],[l,[g,"Rotor"],[h,v]],[/(shield[\w ]+) b/i],[l,[g,"Nvidia"],[h,v]],[/(sprint) (\w+)/i],[g,l,[h,b]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[g,_],[h,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[g,A],[h,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[g,A],[h,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,l,[h,m]],[/droid.+; (shield) bui/i],[l,[g,"Nvidia"],[h,m]],[/(playstation [345portablevi]+)/i],[l,[g,D],[h,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[g,_],[h,m]],[/smart-tv.+(samsung)/i],[g,[h,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[g,L],[h,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,E],[h,y]],[/(apple) ?tv/i],[g,[l,"Apple TV"],[h,y]],[/crkey/i],[[l,"Chromecast"],[g,T],[h,y]],[/droid.+aft(\w)( bui|\))/i],[l,[g,S],[h,y]],[/\(dtv[\);].+(aquos)/i],[l,[g,"Sharp"],[h,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[g,N],[l,N],[h,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,y]],[/((pebble))app/i],[g,l,[h,w]],[/droid.+; (glass) \d/i],[l,[g,T],[h,w]],[/droid.+; (wt63?0{2,3})\)/i],[l,[g,A],[h,w]],[/(quest( 2)?)/i],[l,[g,j],[h,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[h,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[h,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[h,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,v]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[h,b]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[p,H,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[p,H,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[p,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,p],[/\(bb(10);/i],[p,[u,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[u,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[u,"webOS"]],[/crkey\/([\d\.]+)/i],[p,[u,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[u,"Chromium OS"],p],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,p],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,p]]},F=function(e,t){if(typeof e===c&&(t=e,e=o),!(this instanceof F))return new F(e,t).getResult();var n=e||(typeof s!==r&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),i=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(K,t):K;return this.getBrowser=function(){var e,t={};return t.name=o,t.version=o,V.call(t,n,i.browser),t.major=typeof(e=t.version)===d?e.replace(/[^\d\.]/g,"").split(".")[0]:o,t},this.getCPU=function(){var e={};return e.architecture=o,V.call(e,n,i.cpu),e},this.getDevice=function(){var e={};return e.vendor=o,e.model=o,e.type=o,V.call(e,n,i.device),e},this.getEngine=function(){var e={};return e.name=o,e.version=o,V.call(e,n,i.engine),e},this.getOS=function(){var e={};return e.name=o,e.version=o,V.call(e,n,i.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===d&&e.length>255?N(e,255):e,this},this.setUA(n),this};F.VERSION="0.7.30",F.BROWSER=R([u,p,"major"]),F.CPU=R([f]),F.DEVICE=R([l,g,h,m,b,y,v,w,C]),F.ENGINE=F.OS=R([u,p]),typeof t!==r?(typeof e!==r&&e.exports&&(t=e.exports=F),t.UAParser=F):n(5)?(i=function(){return F}.call(t,n,t,e))===o||(e.exports=i):typeof s!==r&&(s.UAParser=F);var $=typeof s!==r&&(s.jQuery||s.Zepto);if($&&!$.ua){var W=new F;$.ua=W.getResult(),$.ua.get=function(){return W.getUA()},$.ua.set=function(e){W.setUA(e);var t=W.getResult();for(var n in t)$.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t){e.exports=function(){var e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],n=document.createElement("span");n.style.fontSize="72px",n.innerHTML="mmmmmmmmmmlli";var i={},s={};for(var o in e)n.style.fontFamily=e[o],t.appendChild(n),i[e[o]]=n.offsetWidth,s[e[o]]=n.offsetHeight,t.removeChild(n);this.detect=function(o){var a=!1;for(var r in e){n.style.fontFamily=o+","+e[r],t.appendChild(n);var c=n.offsetWidth!=i[e[r]]||n.offsetHeight!=s[e[r]];t.removeChild(n),a=a||c}return a}}}])},9133:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;const n="function"==typeof ArrayBuffer,i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);function a(e){return n&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||s&&e instanceof Blob||o&&e instanceof File}t.isBinary=a,t.hasBinary=function e(t,n){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let n=0,i=t.length;n<i;n++)if(e(t[n]))return!0;return!1}if(a(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return!0;return!1}},9167:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchChatDetailV2=a,t.convertV2ToLegacy=r,t.fetchChatDetail=function(e){return i(this,void 0,void 0,(function*(){return r(yield a(e))}))};const s=n(2597),o=n(3974);function a(e){return i(this,void 0,void 0,(function*(){var t,n,i;if(!e)throw console.warn("[chat-detail-service] ‚ùå fetchChatDetailV2 llamado sin chatId"),new Error("chatId requerido");try{const s=localStorage.getItem("guiders_recent_chats");if(s){const a=JSON.parse(s).find((t=>t&&t.id===e));if(a){const s={id:a.id,status:a.status,priority:a.priority,visitorInfo:a.visitorInfo,assignedCommercialId:a.assignedCommercialId,assignedCommercial:a.assignedCommercial,availableCommercialIds:a.availableCommercialIds,metadata:a.metadata,createdAt:new Date(a.createdAt),assignedAt:a.assignedAt?new Date(a.assignedAt):void 0,closedAt:a.closedAt?new Date(a.closedAt):void 0,lastMessageDate:a.lastMessageDate?new Date(a.lastMessageDate):void 0,totalMessages:null!==(t=a.totalMessages)&&void 0!==t?t:0,unreadMessagesCount:null!==(n=a.unreadMessagesCount)&&void 0!==n?n:0,isActive:null===(i=a.isActive)||void 0===i||i,visitorId:a.visitorId,department:a.department,tags:a.tags,updatedAt:a.updatedAt?new Date(a.updatedAt):void 0,averageResponseTimeMinutes:a.averageResponseTimeMinutes,chatDurationMinutes:a.chatDurationMinutes,resolutionStatus:a.resolutionStatus,satisfactionRating:a.satisfactionRating};return(0,o.debugLog)("[chat-detail-service] üì¶ Usando detalle de chat desde cache local (sin GET):",e),s}}}catch(e){console.warn("[chat-detail-service] ‚ö†Ô∏è Error procesando cache guiders_recent_chats:",e)}const a=localStorage.getItem("accessToken"),r=s.EndpointManager.getInstance(),c=localStorage.getItem("pixelEndpoint")||r.getEndpoint(),d=`${c.endsWith("/api")?c:`${c}/api`}/v2/chats/${e}`,l={"Content-Type":"application/json"},u=sessionStorage.getItem("guiders_backend_session_id");u&&(l["X-Guiders-Sid"]=u),a&&(l.Authorization=`Bearer ${a}`);const h=yield fetch(d,{method:"GET",headers:l});if(!h.ok)throw new Error(`Error al obtener detalles del chat V2 (${h.status})`);return h.json()}))}function r(e){var t,n,i,s,o;const a=[];if(a.push({id:e.visitorInfo.id,name:e.visitorInfo.name,isCommercial:!1,isVisitor:!0,isOnline:!0,assignedAt:e.createdAt.toISOString(),lastSeenAt:(null===(t=e.lastMessageDate)||void 0===t?void 0:t.toISOString())||null,isViewing:e.isActive,isTyping:!1,isAnonymous:!1}),e.assignedCommercialId){const t=(null===(n=e.assignedCommercial)||void 0===n?void 0:n.name)||`Comercial ${e.assignedCommercialId}`;a.push({id:e.assignedCommercialId,name:t,isCommercial:!0,isVisitor:!1,isOnline:e.isActive,assignedAt:(null===(i=e.assignedAt)||void 0===i?void 0:i.toISOString())||e.createdAt.toISOString(),lastSeenAt:(null===(s=e.lastMessageDate)||void 0===s?void 0:s.toISOString())||null,isViewing:e.isActive,isTyping:!1,isAnonymous:!1})}else e.availableCommercialIds&&e.availableCommercialIds.forEach((t=>{a.push({id:t,name:`Comercial ${t}`,isCommercial:!0,isVisitor:!1,isOnline:!1,assignedAt:e.createdAt.toISOString(),lastSeenAt:null,isViewing:!1,isTyping:!1,isAnonymous:!1})}));return{id:e.id,participants:a,status:e.status,lastMessage:null,lastMessageAt:(null===(o=e.lastMessageDate)||void 0===o?void 0:o.toISOString())||null,createdAt:e.createdAt.toISOString()}}},9329:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URLInjectionStage=void 0,t.URLInjectionStage=class{process(e){if(e.metadata&&"object"==typeof e.metadata&&"page"in e.metadata&&"object"==typeof e.metadata.page&&e.metadata.page&&"url"in e.metadata.page)console.log("[URLInjectionStage] ‚úÖ URL ya presente en metadata, omitiendo inyecci√≥n autom√°tica");else if("undefined"!=typeof window&&window.location){e.metadata||(e.metadata={});const t={url:window.location.href,path:window.location.pathname,search:window.location.search,host:window.location.host,protocol:window.location.protocol,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()};e.metadata.page=t,e.data&&(e.data.pageUrl=window.location.href,e.data.pagePath=window.location.pathname),console.log("[URLInjectionStage] üåê URL generada autom√°ticamente para page_view:",{url:t.url,path:t.path,search:t.search})}else console.warn("[URLInjectionStage] ‚ö†Ô∏è No se puede acceder a window.location - entorno no es navegador");return e}}},9419:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transports=void 0;const i=n(2071),s=n(8716),o=n(4480);t.transports={websocket:s.WS,webtransport:o.WT,polling:i.XHR}},9910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=r;for(var i,s=(i=n(7037))&&i.__esModule?i:{default:i},o=[],a=0;a<256;++a)o.push((a+256).toString(16).slice(1));function r(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}t.default=function(e,t=0){var n=r(e,t);if(!(0,s.default)(n))throw TypeError("Stringified UUID is invalid");return n}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=n(8156);return i.default})()));