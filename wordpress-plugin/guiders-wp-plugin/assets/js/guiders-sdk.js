!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GuidersPixel=e():t.GuidersPixel=e()}(this,(()=>(()=>{var t={343:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e,n=(e="string"==typeof t?(0,a.default)(t):t,Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]));return"string"==typeof t?(0,o.unsafeStringify)(n):n};var i,a=(i=n(6792))&&i.__esModule?i:{default:i},o=n(9910)},421:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TokenInjectionStage=void 0;const i=n(1921);e.TokenInjectionStage=class{process(t){return i.TokenManager.attachTokenToEvent(t)}}},744:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=(i=n(2858))&&i.__esModule?i:{default:i},o=n(9910),s=null,r=null,c=0;e.default=function(t,e,n){t=t||{};var i=e&&n||0,l=e||new Uint8Array(16),d=t.random||(t.rng||a.default)(),u=void 0!==t.msecs?t.msecs:Date.now(),h=void 0!==t.seq?t.seq:null,g=r,p=s;return u>c&&void 0===t.msecs&&(c=u,null!==h&&(g=null,p=null)),null!==h&&(h>2147483647&&(h=2147483647),g=h>>>19&4095,p=524287&h),null!==g&&null!==p||(g=(g=127&d[6])<<8|d[7],p=(p=(p=63&d[8])<<8|d[9])<<5|d[10]>>>3),u+1e4>c&&null===h?++p>524287&&(p=0,++g>4095&&(g=0,c++)):c=u,r=g,s=p,l[i++]=c/1099511627776&255,l[i++]=c/4294967296&255,l[i++]=c/16777216&255,l[i++]=c/65536&255,l[i++]=c/256&255,l[i++]=255&c,l[i++]=g>>>4&15|112,l[i++]=255&g,l[i++]=p>>>13&63|128,l[i++]=p>>>5&255,l[i++]=p<<3&255|7&d[10],l[i++]=d[11],l[i++]=d[12],l[i++]=d[13],l[i++]=d[14],l[i++]=d[15],e||(0,o.unsafeStringify)(l)}},1034:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HeuristicElementDetector=void 0;const i=n(6932);e.HeuristicElementDetector=class{constructor(t={}){this.heuristicRules={add_to_cart:[{selector:'button, input[type="submit"], a',confidence:i.ConfidenceLevel.HIGH,textPatterns:["a√±adir","agregar","add to cart","add cart","comprar","buy"],attributePatterns:{class:"cart",id:"cart"},contextSelectors:['[class*="product"]','[class*="item"]','[class*="cart"]']},{selector:'input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,attributePatterns:{value:"carrito"}},{selector:'a[href*="cart"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["add","a√±adir"]}],contact_dealer:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["contactar","contact","concesionario","dealer"],contextSelectors:['[class*="dealer"]','[class*="contact"]','form[class*="contact"]']},{selector:'form input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['form[class*="contact"]','form[id*="contact"]']}],search_submit:[{selector:'button[type="submit"], input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,contextSelectors:['form[class*="search"]','[class*="filter"]','[class*="search"]']},{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["buscar","search","filtrar","filter"]}],schedule_test_drive:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["test drive","prueba","conducir","probar","cita"],contextSelectors:['[class*="vehicle"]','[class*="car"]','[class*="auto"]']}],request_quote:[{selector:'button, a, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["cotizar","quote","presupuesto","precio","solicitar"],contextSelectors:['[class*="vehicle"]','[class*="product"]','[class*="price"]']}],view_product:[{selector:"a, div, article",confidence:i.ConfidenceLevel.MEDIUM,contextSelectors:['[class*="product"]','[class*="item"]','[class*="card"]'],attributePatterns:{href:"product"}}],purchase:[{selector:'button, input[type="submit"]',confidence:i.ConfidenceLevel.HIGH,textPatterns:["comprar","buy","purchase","pagar","pay","checkout"],contextSelectors:['[class*="checkout"]','[class*="payment"]','[class*="buy"]']}],view_cart:[{selector:"a, button, div",confidence:i.ConfidenceLevel.MEDIUM,textPatterns:["carrito","cart","basket"],attributePatterns:{href:"cart",class:"cart"}}],download_brochure:[{selector:"a, button",confidence:i.ConfidenceLevel.HIGH,textPatterns:["descargar","download","brochure","folleto","cat√°logo","pdf"],attributePatterns:{href:".pdf"}}]},this.config=Object.assign({enabled:!0,confidenceThreshold:i.ConfidenceLevel.MEDIUM,fallbackToManual:!0},t),t.customRules&&(this.heuristicRules=Object.assign(Object.assign({},this.heuristicRules),t.customRules))}detectElements(t){if(!this.config.enabled)return[];const e=this.heuristicRules[t];if(!e||0===e.length)return[];const n=[];for(const i of e){const e=this.findElementsByRule(i);for(const a of e){const e=this.calculateConfidence(a,i);e>=this.config.confidenceThreshold&&n.push({element:a,eventType:t,confidence:e,matchedRule:i})}}return this.deduplicateResults(n).sort(((t,e)=>e.confidence-t.confidence))}findElementsByRule(t){return Array.from(document.querySelectorAll(t.selector)).filter((e=>this.elementMatchesRule(e,t)))}elementMatchesRule(t,e){var n,i;if(e.textPatterns){const i=(null===(n=t.textContent)||void 0===n?void 0:n.toLowerCase())||"";if(!e.textPatterns.some((t=>i.includes(t.toLowerCase()))))return!1}if(e.attributePatterns)for(const[n,a]of Object.entries(e.attributePatterns))if(!((null===(i=t.getAttribute(n))||void 0===i?void 0:i.toLowerCase())||"").includes(a.toLowerCase()))return!1;return!(e.contextSelectors&&!e.contextSelectors.some((e=>null!==t.closest(e)||null!==t.querySelector(e))))}calculateConfidence(t,e){var n;let i=e.confidence;if(e.textPatterns){const a=(null===(n=t.textContent)||void 0===n?void 0:n.toLowerCase())||"";i+=.1*e.textPatterns.filter((t=>a===t.toLowerCase())).length}if(e.attributePatterns){const n=Object.entries(e.attributePatterns).filter((([e,n])=>{var i;return((null===(i=t.getAttribute(e))||void 0===i?void 0:i.toLowerCase())||"").includes(n.toLowerCase())})).length;i+=.05*n}return Math.min(i,1)}deduplicateResults(t){const e=new Set;return t.filter((t=>!e.has(t.element)&&(e.add(t.element),!0)))}getConfig(){return Object.assign({},this.config)}updateConfig(t){this.config=Object.assign(Object.assign({},this.config),t)}addCustomRules(t,e){this.heuristicRules[t]||(this.heuristicRules[t]=[]),this.heuristicRules[t].push(...e)}}},1122:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchMessages=function(t,e){return n(this,arguments,void 0,(function*(t,e,n=10){if(!t)throw new Error("chatId requerido para fetchMessages");const i=new URLSearchParams;e&&i.append("cursor",e),i.append("limit",String(n));const a=localStorage.getItem("pixelEndpoint")||"",o=`${a.endsWith("/api")?a:`${a}/api`}/v2/chats/${t}/messages?${i.toString()}`,s={"Content-Type":"application/json"},r=sessionStorage.getItem("guiders_backend_session_id");r&&(s["X-Guiders-Sid"]=r);const c=localStorage.getItem("accessToken");c&&(s.Authorization=`Bearer ${c}`);const l=yield fetch(o,{headers:s});if(!l.ok)throw new Error(`Error al obtener mensajes (${l.status})`);return l.json()}))}},1556:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncSignal=e.Signal=void 0;class i{constructor(t=null){this.subscribers=[],this.state={loading:!1,data:t,error:null}}subscribe(t){return this.subscribers.push(t),()=>{const e=this.subscribers.indexOf(t);e>=0&&this.subscribers.splice(e,1)}}unsubscribe(t){const e=this.subscribers.indexOf(t);e>=0&&this.subscribers.splice(e,1)}getState(){return Object.assign({},this.state)}getValue(){return this.state.data}isLoading(){return this.state.loading}hasError(){return null!==this.state.error}setState(t){const e=Object.assign({},this.state);this.state=Object.assign(Object.assign({},this.state),t),this.hasStateChanged(e,this.state)&&this.notifySubscribers()}notifySubscribers(){this.subscribers.forEach((t=>{try{t(this.getState())}catch(t){console.warn("[Signal] Error en subscriber:",t)}}))}hasStateChanged(t,e){return t.loading!==e.loading||t.data!==e.data||t.error!==e.error}setLoading(){this.setState({loading:!0,error:null})}setSuccess(t){this.setState({loading:!1,data:t,error:null})}setError(t){this.setState({loading:!1,error:t})}reset(){this.setState({loading:!1,data:null,error:null})}dispose(){this.subscribers.length=0}}e.Signal=i,e.AsyncSignal=class extends i{constructor(){super(...arguments),this.currentPromise=null}execute(t){return n(this,void 0,void 0,(function*(){this.setLoading();try{const e=t();this.currentPromise=e;const n=yield e;if(this.currentPromise===e)return this.setSuccess(n),this.currentPromise=null,n;throw new Error("Operation was superseded by a newer one")}catch(t){throw null!==this.currentPromise&&(this.setError(t instanceof Error?t:new Error(String(t))),this.currentPromise=null),t}}))}cancel(){this.currentPromise&&(this.currentPromise=null,this.setState({loading:!1}))}isPending(){return null!==this.currentPromise}}},1688:(t,e)=>{"use strict";function n(t){return t.replace(/\s+/g,"").replace(/\/+$/,"")}Object.defineProperty(e,"__esModule",{value:!0}),e.resolveDefaultEndpoints=function(){const t="undefined"!=typeof window&&window.GUIDERS_CONFIG?window.GUIDERS_CONFIG:{};let e=null;try{if("undefined"!=typeof window&&(e=new URL(window.location.href).searchParams.get("dev"),!e&&"undefined"!=typeof document)){let t=document.currentScript||null;if(t||(t=Array.from(document.getElementsByTagName("script")).find((t=>/index\.js/.test(t.src)))||null),t&&t.src)try{e=new URL(t.src,window.location.origin).searchParams.get("dev")}catch(t){}}}catch(t){}const i=!!e&&!/^0|false$/i.test(e);let a;a="production"===t.environment||"development"!==t.environment&&!i;const o="undefined"!=typeof process?"MISSING_ENV_VAR".GUIDERS_SDK_ENDPOINT||"MISSING_ENV_VAR".VITE_GUIDERS_SDK_ENDPOINT:void 0,s="undefined"!=typeof process?"MISSING_ENV_VAR".GUIDERS_SDK_WS_ENDPOINT||"MISSING_ENV_VAR".VITE_GUIDERS_SDK_WS_ENDPOINT:void 0;let r=t.endpoint||o||(a?"https://guiders.es/api":"http://localhost:3000/api"),c=t.webSocketEndpoint||s||(a?"wss://guiders.es":"ws://localhost:3000");return r=n(r),c=n(c),{endpoint:r,webSocketEndpoint:c,isProd:a}}},1750:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},1921:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TokenManager=void 0;class i{static subscribeToTokenChanges(t){this.tokenChangeSubscribers.push(t)}static unsubscribeFromTokenChanges(t){const e=this.tokenChangeSubscribers.indexOf(t);e>=0&&this.tokenChangeSubscribers.splice(e,1)}static notifyTokenChange(t){this.tokenChangeSubscribers.forEach((e=>e(t)))}static setTokens(t){this.accessToken=t.access_token,this.refreshToken=t.refresh_token,localStorage.setItem("accessToken",t.access_token),localStorage.setItem("refreshToken",t.refresh_token),this.setExpirationTime(t.access_token)}static setAccessToken(t){this.accessToken=t,localStorage.setItem("accessToken",t),this.setExpirationTime(t)}static isTokenExpiring(t=60){if(!this.expirationTime)return!0;const e=Math.floor(Date.now()/1e3);return this.expirationTime-e<t}static getValidAccessToken(){return n(this,void 0,void 0,(function*(){return this.isTokenExpiring()?(console.log("Access token expirando, solicitando nuevos tokens..."),console.log("‚ùå No hay servicio de tokens disponible."),null):this.accessToken}))}static loadTokensFromStorage(){try{const t=localStorage.getItem("accessToken"),e=localStorage.getItem("refreshToken"),n=localStorage.getItem("tokenExpiration");if(!t||!e||!n)return!1;const i=parseInt(n,10);return!(isNaN(i)||i<=0||(this.accessToken=t,this.refreshToken=e,this.expirationTime=i,0))}catch(t){return console.error("Error al cargar tokens desde almacenamiento:",t),!1}}static hasValidTokens(){return!!this.accessToken&&!!this.refreshToken}static attachTokenToEvent(t){return this.accessToken?(console.log("üîí Adjuntando token al evento."),Object.assign(Object.assign({},t),{token:this.accessToken})):(console.error("No hay access token disponible."),t)}static startTokenMonitor(){this.tokenMonitorInterval?console.warn("Token monitor ya est√° corriendo."):(this.tokenMonitorInterval=setInterval((()=>n(this,void 0,void 0,(function*(){if(console.log("‚è≥ Verificando el estado del token..."),this.isTokenExpiring()){console.log("‚ö†Ô∏è Token a punto de expirar, intentando refrescar...");const t=yield this.getValidAccessToken();t?(this.notifyTokenChange(t),console.log("‚úÖ Token refrescado autom√°ticamente.")):console.error("‚ùå No se pudo refrescar el token.")}}))),1e4),console.log("üü¢ Token monitor iniciado."))}static stopTokenMonitor(){this.tokenMonitorInterval&&(clearInterval(this.tokenMonitorInterval),this.tokenMonitorInterval=null,console.log("üõë Token monitor detenido."))}static setExpirationTime(t){try{const e=t.split(".")[1],n=atob(e),i=JSON.parse(n);this.expirationTime=i.exp,localStorage.setItem("tokenExpiration",i.exp.toString())}catch(t){console.error("Error al decodificar el token:",t),this.expirationTime=null}}}e.TokenManager=i,i.accessToken=null,i.refreshToken=null,i.expirationTime=null,i.tokenMonitorInterval=null,i.tokenChangeSubscribers=[]},1999:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ValidationStage=void 0,e.ValidationStage=class{constructor(t="session"){this.authMode=t}process(t){if(!t.type)throw new Error("El evento debe tener un tipo");if(!t.data)throw new Error("El evento debe tener datos");if(!t.timestamp)throw new Error("El evento debe tener una marca de tiempo");if("jwt"===this.authMode&&!t.token)throw new Error("El evento debe tener un token en modo JWT");return t}}},2311:(t,e)=>{"use strict";function n(t){return 14+(t+64>>>9<<4)+1}function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function a(t,e,n,a,o,s){return i((r=i(i(e,t),i(a,s)))<<(c=o)|r>>>32-c,n);var r,c}function o(t,e,n,i,o,s,r){return a(e&n|~e&i,t,e,o,s,r)}function s(t,e,n,i,o,s,r){return a(e&i|n&~i,t,e,o,s,r)}function r(t,e,n,i,o,s,r){return a(e^n^i,t,e,o,s,r)}function c(t,e,n,i,o,s,r){return a(n^(e|~i),t,e,o,s,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=function(t){if("string"==typeof t){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var a=0;a<e.length;++a)t[a]=e.charCodeAt(a)}return function(t){for(var e=[],n=32*t.length,i="0123456789abcdef",a=0;a<n;a+=8){var o=t[a>>5]>>>a%32&255,s=parseInt(i.charAt(o>>>4&15)+i.charAt(15&o),16);e.push(s)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[n(e)-1]=e;for(var a=1732584193,l=-271733879,d=-1732584194,u=271733878,h=0;h<t.length;h+=16){var g=a,p=l,f=d,m=u;a=o(a,l,d,u,t[h],7,-680876936),u=o(u,a,l,d,t[h+1],12,-389564586),d=o(d,u,a,l,t[h+2],17,606105819),l=o(l,d,u,a,t[h+3],22,-1044525330),a=o(a,l,d,u,t[h+4],7,-176418897),u=o(u,a,l,d,t[h+5],12,1200080426),d=o(d,u,a,l,t[h+6],17,-1473231341),l=o(l,d,u,a,t[h+7],22,-45705983),a=o(a,l,d,u,t[h+8],7,1770035416),u=o(u,a,l,d,t[h+9],12,-1958414417),d=o(d,u,a,l,t[h+10],17,-42063),l=o(l,d,u,a,t[h+11],22,-1990404162),a=o(a,l,d,u,t[h+12],7,1804603682),u=o(u,a,l,d,t[h+13],12,-40341101),d=o(d,u,a,l,t[h+14],17,-1502002290),a=s(a,l=o(l,d,u,a,t[h+15],22,1236535329),d,u,t[h+1],5,-165796510),u=s(u,a,l,d,t[h+6],9,-1069501632),d=s(d,u,a,l,t[h+11],14,643717713),l=s(l,d,u,a,t[h],20,-373897302),a=s(a,l,d,u,t[h+5],5,-701558691),u=s(u,a,l,d,t[h+10],9,38016083),d=s(d,u,a,l,t[h+15],14,-660478335),l=s(l,d,u,a,t[h+4],20,-405537848),a=s(a,l,d,u,t[h+9],5,568446438),u=s(u,a,l,d,t[h+14],9,-1019803690),d=s(d,u,a,l,t[h+3],14,-187363961),l=s(l,d,u,a,t[h+8],20,1163531501),a=s(a,l,d,u,t[h+13],5,-1444681467),u=s(u,a,l,d,t[h+2],9,-51403784),d=s(d,u,a,l,t[h+7],14,1735328473),a=r(a,l=s(l,d,u,a,t[h+12],20,-1926607734),d,u,t[h+5],4,-378558),u=r(u,a,l,d,t[h+8],11,-2022574463),d=r(d,u,a,l,t[h+11],16,1839030562),l=r(l,d,u,a,t[h+14],23,-35309556),a=r(a,l,d,u,t[h+1],4,-1530992060),u=r(u,a,l,d,t[h+4],11,1272893353),d=r(d,u,a,l,t[h+7],16,-155497632),l=r(l,d,u,a,t[h+10],23,-1094730640),a=r(a,l,d,u,t[h+13],4,681279174),u=r(u,a,l,d,t[h],11,-358537222),d=r(d,u,a,l,t[h+3],16,-722521979),l=r(l,d,u,a,t[h+6],23,76029189),a=r(a,l,d,u,t[h+9],4,-640364487),u=r(u,a,l,d,t[h+12],11,-421815835),d=r(d,u,a,l,t[h+15],16,530742520),a=c(a,l=r(l,d,u,a,t[h+2],23,-995338651),d,u,t[h],6,-198630844),u=c(u,a,l,d,t[h+7],10,1126891415),d=c(d,u,a,l,t[h+14],15,-1416354905),l=c(l,d,u,a,t[h+5],21,-57434055),a=c(a,l,d,u,t[h+12],6,1700485571),u=c(u,a,l,d,t[h+3],10,-1894986606),d=c(d,u,a,l,t[h+10],15,-1051523),l=c(l,d,u,a,t[h+1],21,-2054922799),a=c(a,l,d,u,t[h+8],6,1873313359),u=c(u,a,l,d,t[h+15],10,-30611744),d=c(d,u,a,l,t[h+6],15,-1560198380),l=c(l,d,u,a,t[h+13],21,1309151649),a=c(a,l,d,u,t[h+4],6,-145523070),u=c(u,a,l,d,t[h+11],10,-1120210379),d=c(d,u,a,l,t[h+2],15,718787259),l=c(l,d,u,a,t[h+9],21,-343485551),a=i(a,g),l=i(l,p),d=i(d,f),u=i(u,m)}return[a,l,d,u]}(function(t){if(0===t.length)return[];for(var e=8*t.length,i=new Uint32Array(n(e)),a=0;a<e;a+=8)i[a>>5]|=(255&t[a/8])<<a%32;return i}(t),8*t.length))}},2588:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PipelineProcessorBuilder=e.PipelineProcessor=void 0;class n{constructor(t=[]){this.stages=t}process(t){let e;for(const n of this.stages)try{e=n.process(t),t=e,console.log(`Procesando evento con ${n.constructor.name}`)}catch(t){console.error(`Error en el pipeline: ${t}`);break}if(!e)throw new Error("No se pudo procesar el evento");return console.log("Evento procesado:",e),e}}e.PipelineProcessor=n,e.PipelineProcessorBuilder=class{constructor(){this.stages=[]}addStage(t){return this.stages.push(t),this}build(){return new n(this.stages)}}},2597:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))},a=this&&this.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.TrackingPixelSDK=e.EndpointManager=void 0;const o=n(9126),s=n(2588),r=n(1921),c=n(4815),l=n(421),d=n(1999),u=n(5861),h=n(9329),g=n(4476),p=n(3735),f=n(2919),m=n(7785),v=n(7686),b=n(1688),y=n(5558),w=n(2969),x=n(9167),C=n(2831),S=n(6808),k=n(2895),I=n(6420),E=n(4412),T=n(5303);class M{constructor(t,e){this.endpoint=t,this.webSocketEndpoint=e}static getInstance(t,e){if(M.instance)(t||e)&&(t&&(M.instance.endpoint=t),e&&(M.instance.webSocketEndpoint=e));else{const n=(0,b.resolveDefaultEndpoints)();M.instance=new M(t||n.endpoint,e||n.webSocketEndpoint)}return M.instance}static setInstance(t,e){M.instance?(M.instance.endpoint=t,M.instance.webSocketEndpoint=e):M.instance=new M(t,e)}getEndpoint(){return this.endpoint}getWebSocketEndpoint(){return this.webSocketEndpoint}setEndpoint(t){this.endpoint=t}setWebSocketEndpoint(t){this.webSocketEndpoint=t}}e.EndpointManager=M,e.TrackingPixelSDK=class{constructor(t){var e,n,i,a,o,r,f,m,v,y,w,x,C;this.pipelineBuilder=new s.PipelineProcessorBuilder,this.eventQueue=[],this.fingerprint=null,this.chatUI=null,this.autoFlush=!1,this.flushInterval=1e4,this.flushTimer=null,this.maxRetries=3,this.listeners=new Map,this.sessionTrackingManager=null,this.visitorHeartbeatTimer=null;const E=(0,b.resolveDefaultEndpoints)(),_=t.endpoint||E.endpoint,D=t.webSocketEndpoint||E.webSocketEndpoint;if(M.setInstance(_,D),this.endpoint=_,this.webSocketEndpoint=D,this.apiKey=t.apiKey,this.authMode=t.authMode||"session",this.autoFlush=null!==(e=t.autoFlush)&&void 0!==e&&e,this.flushInterval=null!==(n=t.flushInterval)&&void 0!==n?n:1e4,this.maxRetries=null!==(i=t.maxRetries)&&void 0!==i?i:3,this.welcomeMessageConfig=t.welcomeMessage||{enabled:!0,style:"friendly",includeEmojis:!0,language:"es",showTips:!0},localStorage.setItem("pixelEndpoint",this.endpoint),localStorage.setItem("guidersApiKey",this.apiKey),this.identitySignal=T.IdentitySignal.getInstance(),this.sessionInjectionStage=new g.SessionInjectionStage,this.pipelineBuilder.addStage(new c.TimeStampStage),"jwt"===this.authMode?this.pipelineBuilder.addStage(new l.TokenInjectionStage):console.log("[TrackingPixelSDK] üîê authMode=session: omitiendo TokenInjectionStage"),this.eventPipeline=this.pipelineBuilder.addStage(new h.URLInjectionStage).addStage(this.sessionInjectionStage).addStage(new u.MetadataInjectionStage).addStage(new p.TrackingEventV2Stage).addStage(new d.ValidationStage(this.authMode)).build(),this.heuristicEnabled=null===(o=null===(a=t.heuristicDetection)||void 0===a?void 0:a.enabled)||void 0===o||o,this.heuristicEnabled?(console.log("[TrackingPixelSDK] üöÄ Initializing with heuristic detection enabled"),this.domTrackingManager=new k.EnhancedDomTrackingManager((t=>this.track(t)),new S.DefaultTrackDataExtractor,(null===(r=t.heuristicDetection)||void 0===r?void 0:r.config)||{})):(console.log("[TrackingPixelSDK] Initializing with legacy DOM tracking"),this.domTrackingManager=new S.DomTrackingManager((t=>this.track(t)))),null===(m=null===(f=t.sessionTracking)||void 0===f?void 0:f.enabled)||void 0===m||m){console.log("[TrackingPixelSDK] üìä Initializing advanced session tracking with Intercom-like features");const e=(null===(v=t.sessionTracking)||void 0===v?void 0:v.config)||{},n=(null===(y=t.sessionTracking)||void 0===y?void 0:y.activityDetection)||{},i=(null===(w=t.sessionTracking)||void 0===w||w.multiTabSupport,Object.assign(Object.assign({},e),{maxInactivityTime:null!==(x=n.inactivityThreshold)&&void 0!==x?x:6e4,heartbeatInterval:null!==(C=e.heartbeatInterval)&&void 0!==C?C:1e4}));this.sessionTrackingManager=new I.SessionTrackingManager((t=>{setTimeout((()=>{this.track(t)}),500)}),i),this.sessionInjectionStage.setSessionManager(this.sessionTrackingManager),console.log("[TrackingPixelSDK] Session tracking configured with enhanced features:",{heartbeatInterval:i.heartbeatInterval,inactivityThreshold:i.maxInactivityTime})}}init(){return i(this,void 0,void 0,(function*(){const t=new o.ClientJS;this.fingerprint=localStorage.getItem("fingerprint")||t.getFingerprint().toString(),localStorage.setItem("fingerprint",this.fingerprint),"jwt"===this.authMode&&r.TokenManager.loadTokensFromStorage(),console.log("‚úÖ SDK inicializado sin servicios de WebSocket."),this.autoFlush&&this.startAutoFlush(),console.log("SDK listo para tracking..."),this.setupTabOpenListener(),this.chatUI=new f.ChatUI({widget:!0,welcomeMessage:this.welcomeMessageConfig});const e=this.chatUI,n=new y.ChatInputUI(e),i=new w.ChatToggleButtonUI(e),a=()=>{console.log("Inicializando componentes del chat r√°pidamente..."),e.init(),e.hide(),n.init(),i.init(),i.show(),console.log("üîò Bot√≥n de chat mostrado inmediatamente"),document.querySelectorAll(".chat-widget, .chat-widget-fixed").forEach((t=>{t.addEventListener("system-message",(t=>{const n=t;e.addSystemMessage(n.detail.message)}))})),console.log("Componentes del chat inicializados. Chat oculto por defecto."),e.onChatInitialized((()=>{console.log("üí¨ Chat inicializado, verificando disponibilidad de comerciales..."),this.checkCommercialAvailability(e,i)})),this.setupParticipantEventsListener(e,i),e.onOpen((()=>{this.captureEvent("visitor:open-chat",{timestamp:(new Date).getTime(),chatId:e.getChatId()})})),e.onClose((()=>{this.captureEvent("visitor:close-chat",{timestamp:(new Date).getTime(),chatId:e.getChatId()})})),e.onActiveInterval((()=>{console.log("Intervalo activo"),this.captureEvent("visitor:chat-active",{timestamp:(new Date).getTime(),chatId:e.getChatId()})}),1e4),i.onToggle((t=>{console.log("Toggle event: chat debe estar "+(t?"visible":"oculto")),t?e.show():e.hide()})),n.onSubmit((t=>{t&&(this.captureEvent("visitor:send-message",{id:(0,C.v4)(),message:t,timestamp:(new Date).getTime(),chatId:e.getChatId()}),this.flush())})),this.on("receive-message",(t=>{console.log("Mensaje recibido via WebSocket:",t),t.data.senderId||console.warn("‚ö†Ô∏è Mensaje WebSocket sin senderId:",t),e.renderChatMessage({text:t.data.message,sender:"other",senderId:t.data.senderId,timestamp:t.data.timestamp})}))};"loading"===document.readyState?(console.log("El DOM a√∫n no est√° completamente cargado. Esperando..."),document.addEventListener("DOMContentLoaded",a),console.log("Esperando a que el DOM est√© completamente cargado...")):(console.log("El DOM ya est√° completamente cargado."),a()),this.sessionTrackingManager&&console.log("üéØ Starting session tracking..."),this.setupPageUnloadHandlers()}))}setupTabOpenListener(){"undefined"!=typeof window&&(console.log("[TrackingPixelSDK] üîç Configurando listener para apertura de pesta√±a (una sola vez)"),"visible"===document.visibilityState&&(console.log("[TrackingPixelSDK] üöÄ Pesta√±a cargada - ejecutando identify una sola vez"),this.executeIdentify()))}executeIdentify(){return i(this,void 0,void 0,(function*(){try{console.log("[TrackingPixelSDK] üîç Ejecutando identify...");const t=yield m.VisitorsV2Service.getInstance().identify(this.fingerprint,this.apiKey);if(null==t?void 0:t.visitorId){this.visitorHeartbeatTimer&&clearInterval(this.visitorHeartbeatTimer),this.visitorHeartbeatTimer=setInterval((()=>{m.VisitorsV2Service.getInstance().heartbeat()}),3e4);try{const e=yield v.ChatV2Service.getInstance().getVisitorChats(t.visitorId,void 0,20);localStorage.setItem("guiders_recent_chats",JSON.stringify(e.chats)),e.chats.length>0&&(E.ChatMemoryStore.getInstance().setChatId(e.chats[0].id),console.log("[TrackingPixelSDK] ‚ôªÔ∏è Chat reutilizable (m√°s reciente) guardado en memoria:",e.chats[0].id))}catch(t){console.warn("[TrackingPixelSDK] ‚ö†Ô∏è No se pudo precargar lista de chats V2:",t)}}}catch(t){console.warn("[TrackingPixelSDK] ‚ùå identify V2 fallido:",t)}}))}setupPageUnloadHandlers(){if("undefined"==typeof window)return;let t=!1;const e=e=>{if(!t){t=!0;try{if(console.log(`[TrackingPixelSDK] üö™ Finalizando sesi√≥n por: ${e}`),this.eventQueue.length>0){const t=[...this.eventQueue];if(this.eventQueue=[],"undefined"!=typeof navigator&&"sendBeacon"in navigator)try{const e=M.getInstance().getEndpoint(),n=`${e.endsWith("/api")?e:`${e}/api`}/tracking/events/batch`,i=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(n,i),console.log(`[TrackingPixelSDK] üì§ ${t.length} eventos enviados via beacon`)}catch(t){console.warn("[TrackingPixelSDK] ‚ùå Error enviando eventos via beacon:",t)}}m.VisitorsV2Service.getInstance().endSession({useBeacon:!0})}catch(t){console.warn(`[TrackingPixelSDK] ‚ùå Error en endSession (${e}):`,t)}}};console.log("[TrackingPixelSDK] üö™ Configurando listeners simplificados para cierre de ventana"),window.addEventListener("beforeunload",(()=>{console.log("[TrackingPixelSDK] üö™ beforeunload detectado"),e("window_close")})),window.addEventListener("pagehide",(()=>{console.log("[TrackingPixelSDK] üö™ pagehide detectado"),e("window_close")}))}configureTypingIndicators(t){console.log("üí¨ Indicadores de escritura desactivados (sin WebSocket)")}on(t,e){var n;this.listeners.has(t)||this.listeners.set(t,new Set),null===(n=this.listeners.get(t))||void 0===n||n.add(e)}off(t,e){var n;null===(n=this.listeners.get(t))||void 0===n||n.delete(e)}once(t,e){const n=i=>{e(i),this.off(t,n)};this.on(t,n)}addPipelineStage(t){this.eventPipeline=this.pipelineBuilder.addStage(t).build()}enableDOMTracking(){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?(console.log("[TrackingPixelSDK] üéØ Enabling automatic heuristic tracking"),this.domTrackingManager.enableAutomaticTracking()):(console.log("[TrackingPixelSDK] Enabling legacy DOM tracking"),this.domTrackingManager.enableDOMTracking())}enableAutomaticTracking(){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.enableAutomaticTracking():(console.warn("[TrackingPixelSDK] Heuristic detection not available. Use enableDOMTracking() instead."),this.domTrackingManager.enableDOMTracking())}getHeuristicConfig(){return this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.getHeuristicConfig():null}updateHeuristicConfig(t){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.updateHeuristicConfig(t):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}setHeuristicEnabled(t){this.domTrackingManager instanceof k.EnhancedDomTrackingManager?this.domTrackingManager.setHeuristicEnabled(t):console.warn("[TrackingPixelSDK] Heuristic detection not available.")}enableSessionTracking(){this.sessionTrackingManager?console.log("[TrackingPixelSDK] üéØ Session tracking already enabled and initialized"):console.warn("[TrackingPixelSDK] Session tracking not initialized.")}setMetadata(t,e){const n=this.eventQueue.findIndex((e=>e.type===t));-1!==n?this.eventQueue[n].metadata=e:console.warn(`Evento '${t}' no encontrado en la cola.`)}flush(){return i(this,void 0,void 0,(function*(){if(0===this.eventQueue.length)return;const t=[...this.eventQueue];this.eventQueue=[],yield Promise.all(t.map((t=>this.trySendEventWithRetry(t,this.maxRetries))))}))}stopAutoFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null)}track(t){return i(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{const{event:i}=t,o=a(t,["event"]);if("string"!=typeof i)return console.error("El evento debe tener un tipo."),void n(new Error("El evento debe tener un tipo."));try{this.captureEvent("tracking:tracking-event",{trackingEventId:(0,C.v4)(),metadata:Object.assign({},o),eventType:i}),e()}catch(t){console.error("Error al capturar el evento:",t),n(t)}}))}))}captureEvent(t,e){const n={type:t,data:e,timestamp:Date.now()},i=this.eventPipeline.process(n);this.eventQueue.push(i)}trySendEventWithRetry(t,e){return i(this,void 0,void 0,(function*(){try{console.log("üì° Enviando evento via HTTP (sin WebSocket):",t.type)}catch(n){console.error("‚ùå Error al enviar evento:",n),e>0?(console.warn(`Retrying (${this.maxRetries-e+1})...`),setTimeout((()=>{this.trySendEventWithRetry(t,e-1)}),1e3)):console.error("‚ùå No se pudo enviar el evento despu√©s de varios intentos:",t)}}))}startAutoFlush(){this.flushTimer&&clearInterval(this.flushTimer),this.flushTimer=setInterval((()=>{this.flush()}),this.flushInterval)}dispatchMessage(t){const e=this.listeners.get(t.type);if("receive-message"===t.type&&(console.log("üí¨ Mensaje recibido (sin servicio de mensajes no le√≠dos)"),"undefined"!=typeof window&&"Notification"in window)){const e=t.data&&"string"==typeof t.data.message&&t.data.message?t.data.message:"Tienes un nuevo mensaje en el chat";"granted"===Notification.permission?new Notification("Nuevo mensaje",{body:e,icon:"/favicon.ico"}):"denied"!==Notification.permission&&Notification.requestPermission().then((t=>{"granted"===t&&new Notification("Nuevo mensaje",{body:e,icon:"/favicon.ico"})}))}e&&0!==e.size&&e.forEach((e=>{try{e(t)}catch(t){console.error("Error al ejecutar listener:",t)}}))}cleanup(){this.visitorHeartbeatTimer&&(clearInterval(this.visitorHeartbeatTimer),this.visitorHeartbeatTimer=null),m.VisitorsV2Service.getInstance().endSession().catch((()=>{})),this.stopAutoFlush(),this.eventQueue=[],this.listeners.clear(),console.log("[TrackingPixelSDK] Cleanup completed")}setupParticipantEventsListener(t,e){console.log("üí¨ Eventos de participantes desactivados (sin WebSocket)")}checkAndUpdateChatVisibility(t,e,n){return i(this,void 0,void 0,(function*(){try{console.log(`üîç checkAndUpdateChatVisibility - Verificando chat ${t}`);const e=yield this.fetchChatDetail(t);console.log("üìã Detalles del chat obtenidos:",{totalParticipants:e.participants.length,participants:e.participants.map((t=>({name:t.name,isCommercial:t.isCommercial,isOnline:t.isOnline,id:t.id})))});const i=e.participants.filter((t=>t.isCommercial));console.log(`üè™ Comerciales encontrados: ${i.length}`,i.map((t=>({name:t.name,isOnline:t.isOnline,id:t.id}))));const a=i.some((t=>t.isOnline)),o=i.filter((t=>t.isOnline));console.log("üìä Resumen de comerciales:"),console.log(`  - Total comerciales: ${i.length}`),console.log(`  - Comerciales online: ${o.length}`),console.log(`  - ¬øHay al menos un comercial online? ${a}`),console.log(`  - Estado actual del bot√≥n: ${n.isButtonVisible()}`),n.show()}catch(t){console.error("‚ùå Error al verificar y actualizar visibilidad del chat:",t),t instanceof Error&&console.error("‚ùå Stack trace:",t.stack)}}))}checkCommercialAvailability(t,e){return i(this,void 0,void 0,(function*(){try{let n=t.getChatId(),i=0;const a=10;for(;!n&&i<a;)yield new Promise((t=>setTimeout(t,500))),n=t.getChatId(),i++,console.log(`Esperando chat ID... intento ${i}/${a}`);if(!n)return console.error("‚ùå [checkCommercialAvailability] No se pudo obtener el ID del chat despu√©s de varios intentos. Abortando para evitar /v2/chats/undefined",{attempts:i}),console.log("üîò Mostrando bot√≥n de chat sin verificaci√≥n de comerciales"),void e.show();console.log(`Verificando disponibilidad de comerciales para el chat ${n}...`);const o=yield this.fetchChatDetail(n),s=o.participants.filter((t=>t.isCommercial)),r=s.some((t=>t.isOnline));console.log("Participantes del chat:",o.participants),console.log("Comerciales en el chat:",s.length),console.log("Comerciales online:",s.filter((t=>t.isOnline)).length),console.log("¬øHay comerciales online?",r),e.show()}catch(t){console.error("Error al verificar disponibilidad de comerciales:",t),console.log("üîò Mostrando bot√≥n de chat a pesar del error en verificaci√≥n"),e.show()}}))}fetchChatDetail(t){return i(this,void 0,void 0,(function*(){if(!t)throw console.warn("‚ùå fetchChatDetail llamado sin chatId. Abortando."),new Error("chatId requerido");console.log(`üåê fetchChatDetail - Obteniendo detalles para chat ${t} (usando API V2)`);try{const e=yield(0,x.fetchChatDetailV2)(t);console.log("üåê fetchChatDetail - Detalles V2 obtenidos:",{id:e.id,status:e.status,visitorId:e.visitorId,assignedCommercialId:e.assignedCommercialId,availableCommercialIds:e.availableCommercialIds,isActive:e.isActive});const n=this.convertV2ToLegacyDetail(e);return console.log("üåê fetchChatDetail - Convertido a formato legacy:",{id:n.id,participantsCount:n.participants.length,participants:n.participants.map((t=>({id:t.id,name:t.name,isCommercial:t.isCommercial,isOnline:t.isOnline})))}),n}catch(e){return console.warn("üåê fetchChatDetail - Error con API V2, intentando API legacy:",e),yield(0,x.fetchChatDetail)(t)}}))}convertV2ToLegacyDetail(t){var e,n,i,a;const o=[];return o.push({id:t.visitorInfo.id,name:t.visitorInfo.name,isCommercial:!1,isVisitor:!0,isOnline:!0,assignedAt:t.createdAt.toISOString(),lastSeenAt:(null===(e=t.lastMessageDate)||void 0===e?void 0:e.toISOString())||null,isViewing:t.isActive,isTyping:!1,isAnonymous:!1}),t.assignedCommercialId&&o.push({id:t.assignedCommercialId,name:`Comercial ${t.assignedCommercialId}`,isCommercial:!0,isVisitor:!1,isOnline:t.isActive,assignedAt:(null===(n=t.assignedAt)||void 0===n?void 0:n.toISOString())||t.createdAt.toISOString(),lastSeenAt:(null===(i=t.lastMessageDate)||void 0===i?void 0:i.toISOString())||null,isViewing:t.isActive,isTyping:!1,isAnonymous:!1}),t.availableCommercialIds&&t.availableCommercialIds.length>0&&t.availableCommercialIds.forEach((e=>{e!==t.assignedCommercialId&&o.push({id:e,name:`Comercial ${e}`,isCommercial:!0,isVisitor:!1,isOnline:!0,assignedAt:t.createdAt.toISOString(),lastSeenAt:null,isViewing:!1,isTyping:!1,isAnonymous:!1})})),{id:t.id,participants:o,status:t.status,lastMessage:null,lastMessageAt:(null===(a=t.lastMessageDate)||void 0===a?void 0:a.toISOString())||null,createdAt:t.createdAt.toISOString()}}get visitorsService(){return m.VisitorsV2Service.getInstance()}getIdentitySignal(){return this.identitySignal}identifyVisitor(t,e){return i(this,void 0,void 0,(function*(){const n=t||this.fingerprint||this.generateFingerprint(),i=e||this.apiKey;console.log("[TrackingPixelSDK] üîç Identificando visitante con fingerprint:",n);try{const t=yield this.identitySignal.identify(n,i);return console.log("[TrackingPixelSDK] ‚úÖ Visitante identificado exitosamente:",t.identity.visitorId),t}catch(t){throw console.error("[TrackingPixelSDK] ‚ùå Error identificando visitante:",t),t}}))}generateFingerprint(){const t=(new o.ClientJS).getFingerprint().toString();return localStorage.setItem("fingerprint",t),this.fingerprint=t,t}reloadVisitorChats(){return i(this,void 0,void 0,(function*(){return console.log("[TrackingPixelSDK] üîÑ Recargando chats del visitante..."),this.identitySignal.reloadChats()}))}getIdentityState(){return this.identitySignal.getState()}getVisitorId(){return this.identitySignal.getVisitorId()}isVisitorIdentified(){return this.identitySignal.isIdentified()}subscribeToIdentityChanges(t){return this.identitySignal.subscribe(t)}subscribeToChatChanges(t){return this.identitySignal.getChatsSignal().subscribe(t)}showChat(){console.log("[TrackingPixelSDK] üí¨ Mostrando chat..."),this.chatUI?this.chatUI.show():console.warn("[TrackingPixelSDK] ‚ùå Chat UI no est√° inicializado")}hideChat(){console.log("[TrackingPixelSDK] üí¨ Ocultando chat..."),this.chatUI&&this.chatUI.hide()}updateWelcomeMessage(t){console.log("[TrackingPixelSDK] üé® Actualizando mensaje de bienvenida:",t),this.welcomeMessageConfig=t,this.chatUI&&this.chatUI.setWelcomeMessage(t)}getWelcomeMessageConfig(){return this.welcomeMessageConfig||null}isChatVisible(){var t;return(null===(t=this.chatUI)||void 0===t?void 0:t.isVisible())||!1}resetChat(){console.log("[TrackingPixelSDK] üîÑ Reiniciando chat..."),this.chatUI&&(this.chatUI.hide(),setTimeout((()=>{this.chatUI&&this.chatUI.show()}),500))}}},2782:function(t,e){"use strict";var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BotDetector=void 0,e.BotDetector=class{constructor(){this.score=0,this.checks=[]}detect(){return n(this,void 0,void 0,(function*(){this.checkUserAgent(),this.checkBrowserFeatures(),this.checkTiming(),yield this.checkBehavior();const t=this.score/this.checks.length;return{isBot:t>.6,probability:t,details:this.checks}}))}checkUserAgent(){const t=/bot|crawler|spider|scraper/i.test(navigator.userAgent);this.addCheck("userAgent",t,t?1:0)}checkBrowserFeatures(){const t=navigator.webdriver||!navigator.plugins.length||!window.MouseEvent;this.addCheck("browserFeatures",t,t?1:0)}checkTiming(){const t=performance.timing.loadEventEnd-performance.timing.navigationStart<100;this.addCheck("timing",t,t?.8:0)}checkBehavior(){return new Promise((t=>{let e=!1;["click","mousemove","keypress"].forEach((t=>{document.addEventListener(t,(()=>{e=!0}),{once:!0})})),setTimeout((()=>{this.addCheck("behavior",!e,e?0:1),t()}),1e3)}))}addCheck(t,e,n){this.checks.push({name:t,result:e}),this.score+=n}}},2831:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"MAX",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v1ToV6",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"v6",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"v6ToV1",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"v7",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return m.default}});var i=v(n(4213)),a=v(n(4808)),o=v(n(6792)),s=v(n(9910)),r=v(n(3518)),c=v(n(343)),l=v(n(4948)),d=v(n(5073)),u=v(n(7186)),h=v(n(4671)),g=v(n(3507)),p=v(n(744)),f=v(n(7037)),m=v(n(7775));function v(t){return t&&t.__esModule?t:{default:t}}},2858:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)};var i=new Uint8Array(16)},2895:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EnhancedDomTrackingManager=void 0;const i=n(6808),a=n(1034),o=n(7690);class s extends i.DomTrackingManager{constructor(t,e=new i.DefaultTrackDataExtractor,n={}){super(t,e),this.heuristicEnabled=!0,this.registeredListeners=new Map,this.heuristicDetector=new a.HeuristicElementDetector(n),this.urlDetector=new o.URLPageDetector}enableAutomaticTracking(){this.heuristicEnabled?(console.log("[EnhancedDomTrackingManager] üöÄ Enabling automatic heuristic tracking"),this.handlePageViewTracking(),this.setupHeuristicEventListeners(),this.observeDOMChanges()):console.log("[EnhancedDomTrackingManager] Heuristic detection is disabled")}handlePageViewTracking(){const t=()=>{const t=this.urlDetector.detectCurrentPage();console.log("[EnhancedDomTrackingManager] üìÑ Page detected:",t.pageType,"confidence:",t.confidence),this.trackCallback({event:"page_view"})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}setupHeuristicEventListeners(){Object.keys(this.getDomEventMap()).forEach((t=>{"page_view"!==t&&this.setupEventTypeListeners(t)}))}setupEventTypeListeners(t){const e=this.getDomEventMap()[t];if(!e)return;const n=this.heuristicDetector.detectElements(t);console.log(`[EnhancedDomTrackingManager] üéØ Found ${n.length} elements for "${t}"`),n.forEach((n=>{this.attachEventListener(n.element,t,e,n)}))}attachEventListener(t,e,n,i){this.registeredListeners.has(t)||this.registeredListeners.set(t,new Map);const a=this.registeredListeners.get(t),o=`${e}_${n}`;if(a.has(o))return;const s=()=>{console.log(`[EnhancedDomTrackingManager] üìä Tracking "${e}" (confidence: ${i.confidence.toFixed(2)})`);const n=this.createHeuristicEventData(t,e,i);this.trackCallback(n)};t.addEventListener(n,s),a.set(o,s)}createHeuristicEventData(t,e,n){var i;return Object.assign({event:e,detection_method:"heuristic",confidence:n.confidence,matched_selector:n.matchedRule.selector,element_text:(null===(i=t.textContent)||void 0===i?void 0:i.trim())||"",element_tag:t.tagName.toLowerCase(),element_class:t.className||"",element_id:t.id||"",timestamp:Date.now()},this.urlDetector.extractPageMetadata())}addVisualIndicator(t,e,n){const i=document.createElement("div");i.innerHTML=`üéØ ${e} (${Math.round(100*n)}%)`,i.style.cssText="\n            position: absolute;\n            background: rgba(30, 58, 138, 0.9);\n            color: white;\n            padding: 2px 6px;\n            font-size: 10px;\n            border-radius: 3px;\n            z-index: 10000;\n            pointer-events: none;\n            font-family: monospace;\n        ";const a=t.getBoundingClientRect();i.style.top=a.top+window.scrollY-20+"px",i.style.left=a.left+window.scrollX+"px",document.body.appendChild(i),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i)}),3e3)}observeDOMChanges(){new MutationObserver((t=>{let e=!1;t.forEach((t=>{"childList"===t.type&&t.addedNodes.length>0&&t.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&(e=!0)}))})),e&&setTimeout((()=>this.rescanForNewElements()),500)})).observe(document.body,{childList:!0,subtree:!0})}rescanForNewElements(){console.log("[EnhancedDomTrackingManager] üîÑ Rescanning for new elements"),Object.keys(this.getDomEventMap()).forEach((t=>{"page_view"!==t&&this.setupEventTypeListeners(t)}))}setHeuristicEnabled(t){this.heuristicEnabled=t,console.log("[EnhancedDomTrackingManager] Heuristic detection "+(t?"enabled":"disabled"))}getHeuristicConfig(){return this.heuristicDetector.getConfig()}updateHeuristicConfig(t){this.heuristicDetector.updateConfig(t)}getURLDetector(){return this.urlDetector}getHeuristicDetector(){return this.heuristicDetector}getDomEventMap(){return this.domEventMap}enableDOMTracking(){console.warn("[EnhancedDomTrackingManager] enableDOMTracking() is deprecated. Use enableAutomaticTracking() instead."),this.enableAutomaticTracking()}}e.EnhancedDomTrackingManager=s},2919:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatInputUI=e.ChatUI=void 0;const a=n(8334),o=n(1122),s=n(9167),r=n(4412),c=n(4006);e.ChatUI=class{constructor(t={}){if(this.container=null,this.containerMessages=null,this.currentIndex=null,this.chatId=null,this.chatDetail=null,this.lastKnownChatStatus=null,this.lastNotificationType=null,this.messagesLoaded=!1,this.openCallbacks=[],this.closeCallbacks=[],this.initializationCallbacks=[],this.activeIntervals=[],this.titleElement=null,this.subtitleElement=null,this.typingIndicator=null,this.lastMessageDate=null,this.options=Object.assign({widget:!1,widgetWidth:"300px",widgetHeight:"400px",userBgColor:"#007bff",otherBgColor:"#6c757d",textColor:"#fff",maxWidthMessage:"80%"},t),this.welcomeMessageManager=new c.WelcomeMessageManager(t.welcomeMessage),this.options.containerId){const t=document.getElementById(this.options.containerId);if(!t)throw new Error(`No se encontr√≥ el contenedor con ID "${this.options.containerId}"`);this.container=t}}init(){if(!this.container||this.options.widget){const t=document.createElement("div");t.classList.add("chat-widget-host"),document.body.appendChild(t);const e=t.attachShadow({mode:"open"});this.container=document.createElement("div"),this.container.classList.add("chat-widget"),this.options.widget&&this.container.classList.add("chat-widget-fixed"),this.container.style.display="none",this.container.style.opacity="0",this.container.style.transform="translateY(20px)",this.container.setAttribute("data-initial-state","hidden"),console.log("Chat inicializado con estado: oculto"),e.appendChild(this.container);const n=document.createElement("div");n.className="chat-header";const i=document.createElement("div");i.className="chat-header-title",i.textContent="Chat",this.titleElement=i;const a=document.createElement("div");a.className="chat-header-subtitle",a.textContent="Atenci√≥n personalizada",this.subtitleElement=a,i.appendChild(a),n.appendChild(i);const o=document.createElement("div");o.className="chat-header-actions";const s=document.createElement("button");s.className="chat-close-btn",s.setAttribute("aria-label","Cerrar chat"),s.addEventListener("click",(()=>{this.hide()})),o.appendChild(s),n.appendChild(o),this.container.appendChild(n);const r=document.createElement("style");r.textContent="\n\t\t\t\t@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');\n\t\t\t\t:host { all: initial; font-family: 'Inter', sans-serif; }\n\n\t\t\t\t/* Fondo degradado premium para el √°rea de mensajes */\n\t\t\t\t.chat-widget {\n\t\t\t\t\tbox-shadow: 0 8px 48px 0 rgba(0,0,0,0.22), 0 1.5px 8px 0 rgba(0,0,0,0.10);\n\t\t\t\t\tborder-radius: 20px;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\tbackground: linear-gradient(135deg, #f7faff 0%, #e3e9f6 100%);\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\ttransition: box-shadow 0.3s cubic-bezier(0.175,0.885,0.32,1.275);\n\t\t\t\t}\n\n\t\t\t\t.chat-widget:focus-within {\n\t\t\t\t\tbox-shadow: 0 12px 64px 0 rgba(0,0,0,0.28), 0 2px 12px 0 rgba(0,0,0,0.13);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed { \n\t\t\t\t\twidth: 340px; \n\t\t\t\t\theight: 520px; \n\t\t\t\t\tposition: fixed; \n\t\t\t\t\tbottom: 90px; \n\t\t\t\t\tright: 20px; \n\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); \n\t\t\t\t\tz-index: 2147483647; \n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Cabecera del chat */\n\t\t\t\t.chat-header {\n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff 60%, #00c6fb 100%);\n\t\t\t\t\tcolor: #fff;\n\t\t\t\t\tpadding: 18px 20px 14px 20px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\tborder-top-left-radius: 20px;\n\t\t\t\t\tborder-top-right-radius: 20px;\n\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,132,255,0.08);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-title {\n\t\t\t\t\tfont-weight: 700;\n\t\t\t\t\tfont-size: 17px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\talign-items: flex-start;\n\t\t\t\t\tgap: 4px;\n\t\t\t\t\tletter-spacing: 0.01em;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Indicador de estado online del comercial */\n\t\t\t\t.chat-online-indicator {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tgap: 6px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\ttransition: background-color 0.3s ease;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot.online {\n\t\t\t\t\tbackground-color: #00d26a;\n\t\t\t\t\tbox-shadow: 0 0 0 2px rgba(0, 210, 106, 0.3);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-status-dot.offline {\n\t\t\t\t\tbackground-color: #8a9aa9;\n\t\t\t\t\tbox-shadow: 0 0 0 2px rgba(138, 154, 169, 0.3);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-subtitle {\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t\tfont-weight: 400;\n\t\t\t\t\topacity: 0.92;\n\t\t\t\t\tmargin-top: 2px;\n\t\t\t\t\tcolor: #e3f2fd;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-header-actions {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 10px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn {\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t\ttransition: opacity 0.2s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn:hover {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-close-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 16px;\n\t\t\t\t\theight: 16px;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de mensajes */\n\t\t\t\t.chat-messages {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tflex: 1;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tpadding: 18px 16px 12px 16px;\n\t\t\t\t\tbackground: linear-gradient(120deg, #f7faff 60%, #e3e9f6 100%);\n\t\t\t\t\tscroll-behavior: smooth;\n\t\t\t\t\ttransition: background 0.3s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-messages-bottom { \n\t\t\t\t\tmargin-top: auto; \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Estilos de los mensajes */\n\t\t\t\t.chat-message-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message { \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tborder-radius: 18px; \n\t\t\t\t\twhite-space: pre-wrap; \n\t\t\t\t\tword-break: break-word;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tbox-shadow: 0 1px 2px rgba(0,0,0,0.1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-time {\n\t\t\t\t\tfont-size: 11px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\tmargin-top: 4px;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\talign-self: flex-end;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user {\n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff 70%, #00c6fb 100%);\n\t\t\t\t\tcolor: #fff;\n\t\t\t\t\tborder-bottom-right-radius: 8px;\n\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,132,255,0.08);\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t}\n\n\t\t\t\t.chat-message-user:active::after {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\twidth: 120%;\n\t\t\t\t\theight: 120%;\n\t\t\t\t\tbackground: rgba(255,255,255,0.18);\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\ttransform: translate(-50%, -50%) scale(0);\n\t\t\t\t\tanimation: ripple 0.5s linear;\n\t\t\t\t\tpointer-events: none;\n\t\t\t\t}\n\n\t\t\t\t@keyframes ripple {\n\t\t\t\t\tto {\n\t\t\t\t\t\ttransform: translate(-50%, -50%) scale(1);\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user + .chat-message-time {\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar img {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other { \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-bottom-left-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de input */\n\t\t\t\t.chat-input-container { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\talign-items: center; \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tposition: relative;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t\tgap: 8px; /* Espacio consistente entre elementos */\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field {\n\t\t\t\t\tflex: 1; /* Ocupa todo el espacio disponible */\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder: 1.5px solid #e1e9f1;\n\t\t\t\t\tborder-radius: 24px;\n\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\toutline: none;\n\t\t\t\t\ttransition: border-color 0.2s, box-shadow 0.2s;\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t\tbackground: #f7faff;\n\t\t\t\t\tcolor: #222;\n\t\t\t\t\tmin-height: 20px; /* Altura m√≠nima consistente */\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field:focus {\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t\tbox-shadow: 0 0 0 2px #cce6ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tcolor: #000;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\ttransition: transform 0.18s, box-shadow 0.18s;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\toverflow: visible;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\tbox-shadow: none;\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn:active {\n\t\t\t\t\ttransform: scale(0.96);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn:hover {\n\t\t\t\t\ttransform: scale(1.07);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24px' height='24px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg' color='%23666666' stroke-width='1.5'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3.29106 3.3088C3.00745 3.18938 2.67967 3.25533 2.4643 3.47514C2.24894 3.69495 2.1897 4.02401 2.31488 4.30512L5.40752 11.25H13C13.4142 11.25 13.75 11.5858 13.75 12C13.75 12.4142 13.4142 12.75 13 12.75H5.40754L2.31488 19.6949C2.1897 19.976 2.24894 20.3051 2.4643 20.5249C2.67967 20.7447 3.00745 20.8107 3.29106 20.6912L22.2911 12.6913C22.5692 12.5742 22.75 12.3018 22.75 12C22.75 11.6983 22.5692 11.4259 22.2911 11.3088L3.29106 3.3088Z' fill='%23666666'%3E%3C/path%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Animaciones de entrada */\n\t\t\t\t@keyframes slideInUp {\n\t\t\t\t\tfrom { transform: translateY(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateY(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed {\n\t\t\t\t\tanimation: slideInUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de escritura */\n\t\t\t\t.chat-typing-indicator {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 100px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tmargin-right: 8px;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-bubble {\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder-radius: 18px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tbackground-color: #adb5bd;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tmargin: 0 2px;\n\t\t\t\t\tanimation: typingAnimation 1.2s infinite ease-in-out;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot:nth-child(1) { animation-delay: 0s; }\n\t\t\t\t.chat-typing-dot:nth-child(2) { animation-delay: 0.2s; }\n\t\t\t\tchat-typing-dot:nth-child(3) { animation-delay: 0.4s; }\n\t\t\t\t\n\t\t\t\t@keyframes typingAnimation {\n\t\t\t\t\t0%, 60%, 100% { transform: translateY(0); }\n\t\t\t\t\t30% { transform: translateY(-4px); }\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Animaciones para los mensajes */\n\t\t\t\t@keyframes fadeInRight {\n\t\t\t\t\tfrom { transform: translateX(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t@keyframes fadeInLeft {\n\t\t\t\t\tfrom { transform: translateX(-20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\tanimation: fadeInRight 0.3s ease forwards;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\tanimation: fadeInLeft 0.3s ease forwards;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Footer del chat */\n\t\t\t\t.chat-footer {\n\t\t\t\t\tpadding: 10px 18px;\n\t\t\t\t\tbackground: linear-gradient(90deg, #f7faff 80%, #e3e9f6 100%);\n\t\t\t\t\tborder-top: 1.5px solid #e1e9f1;\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tletter-spacing: 0.01em;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-unread-badge {\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: calc(100% - 90px);\n\t\t\t\t\tright: 13px;\n\t\t\t\t\tmin-width: 22px;\n\t\t\t\t\theight: 22px;\n\t\t\t\t\tbackground: linear-gradient(145deg, #ff5146, #e53a30);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tpadding: 0 5px;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tborder: 2px solid white;\n\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\tbox-shadow: 0 2px 8px rgba(255,65,54,0.3);\n\t\t\t\t\tpointer-events: none;\n\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\tanimation: bounceIn 0.5s;\n\t\t\t\t}\n\t\t\t\t.chat-unread-badge.hidden {\n\t\t\t\t\ttransform: scale(0);\n\t\t\t\t\topacity: 0;\n\t\t\t\t\tdisplay: flex !important;\n\t\t\t\t}\n\t\t\t\t@keyframes pulse {\n\t\t\t\t\t0% { transform: scale(0.8); opacity: 0.7; }\n\t\t\t\t\t50% { transform: scale(1.3); opacity: 1; }\n\t\t\t\t\t80% { transform: scale(0.95); opacity: 1; }\n\t\t\t\t\t100% { transform: scale(1); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t@keyframes bounceIn {\n\t\t\t\t\t0% { transform: scale(0.5); opacity: 0.5; }\n\t\t\t\t\t60% { transform: scale(1.2); opacity: 1; }\n\t\t\t\t\t80% { transform: scale(0.95); }\n\t\t\t\t\t100% { transform: scale(1); }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 20px;\n\t\t\t\t\theight: 20px;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23666666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48'/%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t}\n\n\t\t\t\t/* Estilos para mensajes del sistema */\n\t\t\t\t.chat-system-message-wrapper {\n\t\t\t\t\talign-self: center; /* Centrar el mensaje del sistema */\n\t\t\t\t\tmax-width: 90%; /* Un poco m√°s ancho para mensajes informativos */\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 8px;\n\t\t\t\t}\n\n\t\t\t\t.chat-system-message {\n\t\t\t\t\tbackground: #e9ecef; /* Un fondo neutro */\n\t\t\t\t\tcolor: #495057; /* Texto oscuro para legibilidad */\n\t\t\t\t\tborder-radius: 8px; /* Bordes m√°s suaves */\n\t\t\t\t\tfont-size: 13px; /* Ligeramente m√°s peque√±o */\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tfont-style: italic;\n\t\t\t\t\tpadding: 8px 12px; /* A√±adido padding para que no se vea apretado */\n\t\t\t\t}\n\t\t\t\t/* Fin de estilos para mensajes del sistema */\n\t\t\t\t\n\t\t\t\t/* Contenedor de mensajes */\n\t\t\t\t.chat-messages { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\tflex-direction: column; \n\t\t\t\t\tflex: 1; \n\t\t\t\t\toverflow-y: auto; \n\t\t\t\t\tpadding: 16px; \n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tscroll-behavior: smooth;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-messages-bottom { \n\t\t\t\t\tmargin-top: auto; \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Estilos de los mensajes */\n\t\t\t\t.chat-message-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message { \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tborder-radius: 18px; \n\t\t\t\t\twhite-space: pre-wrap; \n\t\t\t\t\tword-break: break-word;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tbox-shadow: 0 1px 2px rgba(0,0,0,0.1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-time {\n\t\t\t\t\tfont-size: 11px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\tmargin-top: 4px;\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\talign-self: flex-end;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user { \n\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\tcolor: #fff; \n\t\t\t\t\tborder-bottom-right-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user + .chat-message-time {\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-avatar img {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other { \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-bottom-left-radius: 4px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Contenedor de input */\n\t\t\t\t.chat-input-container { \n\t\t\t\t\tdisplay: flex; \n\t\t\t\t\talign-items: center; \n\t\t\t\t\tpadding: 12px 16px; \n\t\t\t\t\tbackground: #fff; \n\t\t\t\t\tposition: relative;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t\tgap: 8px; /* Espacio consistente entre elementos */\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field { \n\t\t\t\t\tflex: 1; /* Ocupa todo el espacio disponible */\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder: 1px solid #e1e9f1; \n\t\t\t\t\tborder-radius: 24px; \n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\toutline: none;\n\t\t\t\t\ttransition: border-color 0.2s;\n\t\t\t\t\tfont-family: 'Inter', sans-serif;\n\t\t\t\t\tmin-height: 20px; /* Altura m√≠nima consistente */\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-input-field:focus {\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tcolor: #000;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\ttransition: transform 0.2s;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\toverflow: visible;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn:hover {\n\t\t\t\t\ttransform: scale(1.05);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-send-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24px' height='24px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg' color='%23666666' stroke-width='1.5'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3.29106 3.3088C3.00745 3.18938 2.67967 3.25533 2.4643 3.47514C2.24894 3.69495 2.1897 4.02401 2.31488 4.30512L5.40752 11.25H13C13.4142 11.25 13.75 11.5858 13.75 12C13.75 12.4142 13.4142 12.75 13 12.75H5.40754L2.31488 19.6949C2.1897 19.976 2.24894 20.3051 2.4643 20.5249C2.67967 20.7447 3.00745 20.8107 3.29106 20.6912L22.2911 12.6913C22.5692 12.5742 22.75 12.3018 22.75 12C22.75 11.6983 22.5692 11.4259 22.2911 11.3088L3.29106 3.3088Z' fill='%23666666'%3E%3C/path%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Animaciones de entrada */\n\t\t\t\t@keyframes slideInUp {\n\t\t\t\t\tfrom { transform: translateY(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateY(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-widget-fixed {\n\t\t\t\t\tanimation: slideInUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de escritura */\n\t\t\t\t.chat-typing-indicator {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-top: 8px;\n\t\t\t\t\tmargin-bottom: 16px;\n\t\t\t\t\tmax-width: 100px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-avatar {\n\t\t\t\t\twidth: 28px;\n\t\t\t\t\theight: 28px;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tmargin-right: 8px;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-bubble {\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tpadding: 10px 14px;\n\t\t\t\t\tborder-radius: 18px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot {\n\t\t\t\t\twidth: 8px;\n\t\t\t\t\theight: 8px;\n\t\t\t\t\tbackground-color: #adb5bd;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tmargin: 0 2px;\n\t\t\t\t\tanimation: typingAnimation 1.2s infinite ease-in-out;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-typing-dot:nth-child(1) { animation-delay: 0s; }\n\t\t\t\t.chat-typing-dot:nth-child(2) { animation-delay: 0.2s; }\n\t\t\t\tchat-typing-dot:nth-child(3) { animation-delay: 0.4s; }\n\t\t\t\t\n\t\t\t\t@keyframes typingAnimation {\n\t\t\t\t\t0%, 60%, 100% { transform: translateY(0); }\n\t\t\t\t\t30% { transform: translateY(-4px); }\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Animaciones para los mensajes */\n\t\t\t\t@keyframes fadeInRight {\n\t\t\t\t\tfrom { transform: translateX(20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t@keyframes fadeInLeft {\n\t\t\t\t\tfrom { transform: translateX(-20px); opacity: 0; }\n\t\t\t\t\tto { transform: translateX(0); opacity: 1; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-user-wrapper {\n\t\t\t\t\tanimation: fadeInRight 0.3s ease forwards;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-message-other-wrapper {\n\t\t\t\t\tanimation: fadeInLeft 0.3s ease forwards;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Footer del chat */\n\t\t\t\t.chat-footer {\n\t\t\t\t\tpadding: 8px 16px;\n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tborder-top: 1px solid #e1e9f1;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text {\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-footer-text strong {\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Botones adicionales para el input */\n\t\t\t\t.chat-input-actions {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn {\n\t\t\t\t\tflex-shrink: 0; /* No se encoge */\n\t\t\t\t\twidth: 40px;\n\t\t\t\t\theight: 40px;\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\topacity: 0.6;\n\t\t\t\t\ttransition: opacity 0.2s, transform 0.2s;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn:hover {\n\t\t\t\t\topacity: 1;\n\t\t\t\t\ttransform: scale(1.05);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-attachment-btn::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\twidth: 20px;\n\t\t\t\t\theight: 20px;\n\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23666666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48'/%3E%3C/svg%3E\");\n\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\tbackground-position: center;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/* Indicador de satisfacci√≥n */\n\t\t\t\t.chat-satisfaction {\n\t\t\t\t\tmargin-top: 16px;\n\t\t\t\t\tpadding: 12px 16px;\n\t\t\t\t\tbackground-color: #fff;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tgap: 10px;\n\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,0,0,0.05);\n\t\t\t\t\tmax-width: 85%;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-question {\n\t\t\t\t\tcolor: #5a6877;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-options {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-option {\n\t\t\t\t\tpadding: 6px 12px;\n\t\t\t\t\tbackground-color: #f1f3f5;\n\t\t\t\t\tborder: 1px solid #e1e9f1;\n\t\t\t\t\tborder-radius: 16px;\n\t\t\t\t\tcolor: #5a6877;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\ttransition: all 0.2s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-satisfaction-option:hover {\n\t\t\t\t\tbackground-color: #e7f3ff;\n\t\t\t\t\tborder-color: #0084ff;\n\t\t\t\t\tcolor: #0084ff;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Separador de fecha para mensajes */\n\t\t\t\t.chat-date-separator {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tmargin: 16px 0;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tcolor: #8a9aa9;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-date-separator::before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\theight: 1px;\n\t\t\t\t\tbackground-color: #e1e9f1;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.chat-date-text {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tz-index: 2;\n\t\t\t\t\tbackground-color: #f7f9fc;\n\t\t\t\t\tpadding: 0 10px;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t",e.appendChild(r)}else this.container&&!this.options.widget||(this.container=document.createElement("div"),this.container.classList.add("chat-widget"),document.body.appendChild(this.container),this.options.widget&&this.container.classList.add("chat-widget-fixed"));const t=document.createElement("div");t.className="chat-messages",this.container.appendChild(t),this.containerMessages=t;const e=document.createElement("div");e.className="chat-messages-bottom",this.containerMessages.appendChild(e);const n=document.createElement("div");n.className="chat-footer";const i=document.createElement("div");i.className="chat-footer-text",i.innerHTML="Equipo de atenci√≥n al cliente",n.appendChild(i),this.container.appendChild(n),this.container.style.display="none",this.container.style.flexDirection="column",this.container.style.gap="0",this.container.setAttribute("data-content-ready","true"),this.containerMessages.addEventListener("scroll",(()=>{this.containerMessages&&0===this.containerMessages.scrollTop&&this.currentIndex&&this.loadOlderMessages()})),this.initializeChatContent()}addWelcomeMessage(){console.log("üí¨ [ChatUI] Verificando si agregar mensaje de bienvenida...");const t=this.containerMessages&&Array.from(this.containerMessages.children).some((t=>t.classList&&(t.classList.contains("chat-message-user-wrapper")||t.classList.contains("chat-message-other-wrapper"))));if(console.log("üí¨ [ChatUI] Estado:",{hasMessages:t,containerMessages:!!this.containerMessages,welcomeConfig:this.welcomeMessageManager.getConfig()}),t)console.log("üí¨ [ChatUI] Ya hay mensajes, no se agrega mensaje de bienvenida");else{const t=this.welcomeMessageManager.getWelcomeMessage();if(console.log("üí¨ [ChatUI] Mensaje de bienvenida generado:",t),t){this.addMessage(t,"other"),console.log("üí¨ [ChatUI] ‚úÖ Mensaje de bienvenida agregado");const e=this.welcomeMessageManager.getTips();e.length>0&&(console.log("üí¨ [ChatUI] Agregando",e.length,"tips adicionales"),setTimeout((()=>{e.forEach(((t,e)=>{setTimeout((()=>{this.addMessage(t,"other")}),1e3*e)}))}),2e3))}else console.log("üí¨ [ChatUI] ‚ùå No se gener√≥ mensaje de bienvenida")}}setChatId(t){if(!this.container)throw new Error("No se ha inicializado el chat");this.chatId!==t&&(this.messagesLoaded=!1,this.lastKnownChatStatus=null,this.lastNotificationType=null),this.chatId=t,this.container.setAttribute("data-chat-id",t),a.ChatSessionStore.getInstance().setCurrent(t),r.ChatMemoryStore.getInstance().setChatId(t)}getChatId(){if(!this.container)throw new Error("No se ha inicializado el chat");return this.chatId||(this.chatId=r.ChatMemoryStore.getInstance().getChatId()),this.chatId}renderChatMessage(t){const{text:e,sender:n,timestamp:i,senderId:a}=t;this.addMessage(e,n,i,a),this.rebuildDateSeparators()}loadInitialMessages(){return i(this,arguments,void 0,(function*(t=20){if(!this.containerMessages)return;if(!this.chatId)throw new Error("No se ha establecido un chatId");const e=this.chatId,n=(0,o.fetchMessages)(e,null,t);let i="";try{const t=localStorage.getItem("accessToken")||"";if(t){const e=JSON.parse(atob(t.split(".")[1]));i=e.sub}}catch(t){console.warn("Error al procesar el token de acceso:",t)}try{const t=yield n;if(this.currentIndex=t.cursor||null,t.messages&&t.messages.length>0){[...t.messages].reverse().map((t=>{const e=i&&t.senderId.includes(i)?"user":"other";return{text:t.content,sender:e,timestamp:t.createdAt,senderId:t.senderId}})).forEach((t=>this.renderChatMessage(t))),this.rebuildDateSeparators(),this.containerMessages.scrollTop=this.containerMessages.scrollHeight}}catch(t){console.error("Error cargando mensajes iniciales:",t)}}))}scrollToBottom(t){this.containerMessages&&(this.containerMessages.scrollTop=t?this.containerMessages.scrollHeight:0)}loadOlderMessages(){return i(this,void 0,void 0,(function*(){if(!this.containerMessages||!this.currentIndex)return;const t=this.containerMessages.scrollHeight,e=this.containerMessages.scrollTop;try{const n=this.getChatId();if(!n)throw new Error("No se ha establecido un chatId");const i=yield(0,o.fetchMessages)(n,this.currentIndex,20);this.currentIndex=i.cursor||null;let a="";try{const t=localStorage.getItem("accessToken")||"";t&&(a=JSON.parse(atob(t.split(".")[1])).sub)}catch(t){console.warn("Error al procesar el token de acceso para mensajes antiguos:",t)}for(const t of i.messages){const e=a&&t.senderId.includes(a)?"user":"other";this.prependMessage(t.content,e,t.createdAt,t.senderId)}this.rebuildDateSeparators();const s=this.containerMessages.scrollHeight;this.containerMessages.scrollTop=e+(s-t)}catch(t){console.error("Error cargando mensajes antiguos:",t)}}))}addMessage(t,e,n,i){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");const a=n?new Date(n):new Date;this.addDateSeparatorIfNeeded(a);const o=this.createMessageDiv(t,e,n,i);this.containerMessages.appendChild(o),this.scrollToBottom(!0)}sendOfflineNotificationMessage(t,e=!1){let n;n=e?`${t} no est√° disponible en este momento. Te responder√° tan pronto como est√© online.`:`${t} se ha desconectado temporalmente. Te responder√° tan pronto como est√© disponible nuevamente.`,console.log("Enviando mensaje autom√°tico de desconexi√≥n:",n),this.addSystemMessage(n)}sendOnlineNotificationMessage(t){const e=`${t} se ha reconectado y est√° disponible para responder tus preguntas.`;console.log("Enviando mensaje autom√°tico de reconexi√≥n:",e),this.addSystemMessage(e)}addSystemMessage(t){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");this.addDateSeparatorIfNeeded(new Date);const e=document.createElement("div");e.classList.add("chat-message-wrapper","chat-system-message-wrapper");const n=document.createElement("div");n.classList.add("chat-message","chat-system-message"),n.textContent=t,e.appendChild(n),this.containerMessages.appendChild(e),this.scrollToBottom(!0)}prependMessage(t,e,n,i){if(!this.container||!this.containerMessages)throw new Error("No se ha inicializado el chat");const a=this.createMessageDiv(t,e,n,i);this.containerMessages.firstChild?this.containerMessages.insertBefore(a,this.containerMessages.firstChild):this.containerMessages.appendChild(a)}createMessageDiv(t,e,n,i){const a=document.createElement("div");if(a.classList.add("chat-message-wrapper"),n&&a.setAttribute("data-timestamp",n.toString()),"user"===e){a.classList.add("chat-message-user-wrapper");const e=document.createElement("div");e.classList.add("chat-message","chat-message-user"),e.textContent=t,a.appendChild(e);const i=document.createElement("div");i.classList.add("chat-message-time"),i.textContent=this.formatTime(n?new Date(n):new Date),a.appendChild(i)}else{a.classList.add("chat-message-other-wrapper");const e=document.createElement("div");e.classList.add("chat-avatar");const o=this.getParticipantInitials(i||"");e.textContent=o,e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.color="#0062cc",e.style.fontWeight="600",e.style.fontSize="10px",a.appendChild(e);const s=document.createElement("div"),r=document.createElement("div");r.classList.add("chat-message-name");const c=this.getParticipantName(i||"");r.textContent=c,r.style.fontSize="11px",r.style.color="#5a6877",r.style.marginBottom="3px",r.style.fontWeight="500",s.appendChild(r);const l=document.createElement("div");l.classList.add("chat-message","chat-message-other"),l.textContent=t,s.appendChild(l);const d=document.createElement("div");d.classList.add("chat-message-time"),d.textContent=this.formatTime(n?new Date(n):new Date),s.appendChild(d),a.appendChild(s)}return a}formatTime(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}hide(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"!==this.container.style.display&&(this.container.style.transform="translateY(20px)",this.container.style.opacity="0",setTimeout((()=>{this.container.style.display="none",this.activeIntervals.forEach((t=>{null!==t.id&&(clearInterval(t.id),t.id=null)})),this.closeCallbacks.forEach((t=>t()))}),300))}show(){if(!this.container)throw new Error("No se ha inicializado el chat");this.container.style.display="flex",this.container.offsetHeight,this.container.style.opacity="1",this.container.style.transform="translateY(0)",this.loadChatContent(),this.refreshChatDetails(),this.scrollToBottom(!0),this.activeIntervals.forEach((t=>{null===t.id&&(t.id=window.setInterval(t.callback,t.intervalMs))})),this.openCallbacks.forEach((t=>t()))}toggle(){if(!this.container)throw new Error("No se ha inicializado el chat");"none"===this.container.style.display?this.show():this.hide()}getOptions(){return this.options}isVisible(){return!!this.container&&"none"!==this.container.style.display}onOpen(t){this.openCallbacks.push(t)}onClose(t){this.closeCallbacks.push(t)}setWelcomeMessage(t){this.welcomeMessageManager.updateConfig(t)}setCustomWelcomeMessage(t){this.welcomeMessageManager.updateConfig({style:"custom",customMessage:t})}getWelcomeMessageConfig(){return this.welcomeMessageManager.getConfig()}onChatInitialized(t){this.initializationCallbacks.push(t)}onActiveInterval(t,e=5e3){this.activeIntervals.push({id:null,callback:t,intervalMs:e})}updateParticipant(t,e){if(!this.chatDetail)return;const n=this.chatDetail.participants.find((e=>e.id===t));n&&(Object.assign(n,e),this.updateChatHeader(),console.log(`Participante ${t} actualizado:`,e))}getChatDetail(){return this.chatDetail}refreshChatDetails(){return i(this,void 0,void 0,(function*(){yield this.loadChatDetails()}))}showTypingIndicator(t){if(!this.containerMessages)return;if(this.typingIndicator)return;const e=document.createElement("div");e.className="chat-typing-indicator";const n=document.createElement("div");n.className="chat-typing-avatar";const i=this.getParticipantInitials(t||"");n.textContent=i,n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.color="#0062cc",n.style.fontWeight="600",n.style.fontSize="10px",e.appendChild(n);const a=document.createElement("div");a.className="chat-typing-bubble";for(let t=0;t<3;t++){const t=document.createElement("div");t.className="chat-typing-dot",a.appendChild(t)}e.appendChild(a),this.containerMessages.appendChild(e),this.typingIndicator=e,this.scrollToBottom(!0)}hideTypingIndicator(){this.typingIndicator&&this.typingIndicator.parentNode&&(this.typingIndicator.parentNode.removeChild(this.typingIndicator),this.typingIndicator=null)}updateTypingIndicator(t){if(!this.typingIndicator)return;const e=this.typingIndicator.querySelector(".chat-typing-avatar");if(e){const n=this.getParticipantInitials(t);e.textContent=n}}showSatisfactionIndicator(){if(!this.containerMessages)return;const t=document.createElement("div");t.className="chat-satisfaction";const e=document.createElement("div");e.className="chat-satisfaction-question",e.textContent="¬øTe ha sido √∫til la ayuda de nuestro asesor humano?",t.appendChild(e);const n=document.createElement("div");n.className="chat-satisfaction-options";const i=document.createElement("div");i.className="chat-satisfaction-option",i.textContent="S√≠, gracias",i.addEventListener("click",(()=>{t.innerHTML='<div class="chat-satisfaction-question">¬°Gracias por tu feedback! Nos alegra haber podido ayudarte.</div>',setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),2e3)}));const a=document.createElement("div");a.className="chat-satisfaction-option",a.textContent="No",a.addEventListener("click",(()=>{t.innerHTML='<div class="chat-satisfaction-question">Lamentamos no haber podido resolver tu consulta. Transmitiremos tu feedback al equipo.</div>',setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),2e3)})),n.appendChild(i),n.appendChild(a),t.appendChild(n),this.containerMessages.appendChild(t),this.scrollToBottom(!0)}initializeChatContent(){return i(this,void 0,void 0,(function*(){try{return void console.log("‚ùå Chat no disponible (servicio eliminado)")}catch(t){console.error("Error iniciando chat:",t)}}))}loadChatDetails(){return i(this,void 0,void 0,(function*(){if(this.chatId)try{console.log("Cargando detalles del chat..."),this.chatDetail=yield(0,s.fetchChatDetail)(this.chatId),console.log("Detalles del chat:",this.chatDetail),this.lastKnownChatStatus=this.chatDetail.status,console.log(`Estado actual del chat: ${this.lastKnownChatStatus}`),this.updateChatHeader()}catch(t){console.warn("Error al cargar detalles del chat:",t)}}))}checkInitialCommercialStatus(){this.chatDetail&&this.chatDetail.participants.filter((t=>t.isCommercial)).forEach((t=>{t.isOnline||"offline"===this.lastNotificationType||(console.log(`Comercial ${t.name} est√° offline en la carga inicial`),setTimeout((()=>{this.sendOfflineNotificationMessage(t.name,!0),this.lastNotificationType="offline"}),100))}))}updateChatHeader(){if(!this.chatDetail||!this.titleElement||!this.subtitleElement)return;const t=this.chatDetail.participants.filter((t=>t.isCommercial)),e=this.chatDetail.participants.filter((t=>t.isVisitor));if("pending"===this.chatDetail.status&&t.length>1)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con asesor (${t.length} disponibles)...`;else if("pending"===this.chatDetail.status&&1===t.length)this.titleElement.textContent="Chat",this.subtitleElement.textContent=`Conectando con ${t[0].name}...`;else if(t.length>0){const e=t[0];if("active"===this.chatDetail.status){const t=document.createElement("div");t.className="chat-online-indicator";const n=document.createElement("span");n.className="chat-status-dot "+(e.isOnline?"online":"offline");const i=document.createElement("span");i.textContent=`Chat con ${e.name}`,t.appendChild(n),t.appendChild(i),this.titleElement.innerHTML="",this.titleElement.appendChild(t);const a=e.isOnline?"En l√≠nea":"Desconectado",o=e.isTyping?" ‚Ä¢ Escribiendo...":"";this.subtitleElement.textContent=`${a}${o}`}else{this.titleElement.textContent=`Chat con ${e.name}`;const t="inactive"===this.chatDetail.status?"Inactivo":"closed"===this.chatDetail.status?"Cerrado":"archived"===this.chatDetail.status?"Archivado":"Conectando...";this.subtitleElement.textContent=t}}else this.titleElement.textContent="Chat",this.subtitleElement.textContent="Buscando asesor disponible...";console.log(`Chat ${this.chatDetail.id} - Participantes:`,{comerciales:t.length,visitantes:e.length,total:this.chatDetail.participants.length,estado:this.chatDetail.status,comercialOnline:t.length>0?t[0].isOnline:null})}loadChatContent(){return i(this,void 0,void 0,(function*(){var t;if(null===(t=this.container)||void 0===t?void 0:t.getAttribute("data-chat-initialized"))if(this.messagesLoaded)console.log("Los mensajes ya fueron cargados previamente, omitiendo fetch...");else{console.log("Cargando contenido del chat...");try{yield this.loadInitialMessages(20),this.messagesLoaded=!0,this.addWelcomeMessage(),this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}catch(t){console.error("Error al cargar el contenido del chat:",t),this.addWelcomeMessage(),this.chatDetail&&"active"===this.chatDetail.status&&this.checkInitialCommercialStatus()}}else console.log("Chat no inicializado a√∫n, esperando...")}))}forceReloadMessages(){return i(this,arguments,void 0,(function*(t=20){this.messagesLoaded=!1,this.isVisible()&&(yield this.loadChatContent())}))}registerWebSocketListeners(){console.log("üí¨ Listeners WebSocket desactivados (servicio eliminado)")}addDateSeparatorIfNeeded(t){if(!this.containerMessages)return;const e=this.formatDate(t);if(!this.lastMessageDate||this.lastMessageDate!==e){const t=document.createElement("div");t.className="chat-date-separator",t.setAttribute("data-date",e);const n=document.createElement("span");n.className="chat-date-text",n.textContent=e,t.appendChild(n),this.containerMessages.appendChild(t),this.lastMessageDate=e}}formatDate(t){const e=new Date,n=new Date;n.setDate(n.getDate()-1);const i=t.toDateString()===e.toDateString(),a=t.toDateString()===n.toDateString();if(i)return"Hoy";if(a)return"Ayer";{const e={day:"numeric",month:"long",year:"numeric"};return t.toLocaleDateString("es-ES",e)}}rebuildDateSeparators(){if(!this.containerMessages)return;this.lastMessageDate=null,this.containerMessages.querySelectorAll(".chat-date-separator").forEach((t=>{var e;return null===(e=t.parentNode)||void 0===e?void 0:e.removeChild(t)}));const t=Array.from(this.containerMessages.querySelectorAll(".chat-message-wrapper"));if(0===t.length)return;let e=null;t.forEach((t=>{if(!t.querySelector(".chat-message-time"))return;const n=new Date,i=this.formatDate(n);if(i!==e){e=i;const n=document.createElement("div");n.className="chat-date-separator",n.setAttribute("data-date",i);const a=document.createElement("span");a.className="chat-date-text",a.textContent=i,n.appendChild(a),this.containerMessages&&this.containerMessages.insertBefore(n,t)}})),e&&(this.lastMessageDate=e)}isBot(t){const e=t.toLowerCase();return["bot","chatbot","assistant","asistente","ia","ai","autom√°tico","virtual"].some((t=>e.includes(t)))}getParticipantInitials(t){if(!t)return"BOT";if(!this.chatDetail)return console.warn("No se ha cargado el chat o no se proporcion√≥ un ID de remitente v√°lido",t),"BOT";const e=this.chatDetail.participants.find((e=>e.id===t));if(!e)return console.warn(`No se encontr√≥ el participante con ID ${t}`),"BOT";if(this.isBot(e.name))return"BOT";const n=e.name.trim().split(" ");return n.length>=2?(n[0][0]+n[1][0]).toUpperCase():1===n.length?n[0].substring(0,2).toUpperCase():"AH"}getParticipantName(t){if(!t)return"Asistente Virtual";if(!this.chatDetail)return"Asistente Virtual";const e=this.chatDetail.participants.find((e=>e.id===t));return e?this.isBot(e.name)?"Asistente Virtual":e.name:"Asistente Virtual"}},e.ChatInputUI=class{constructor(t){this.inputContainer=null,this.submitCallbacks=[],this.chat=t}init(){this.inputContainer=document.createElement("div"),this.inputContainer.style.display="flex",this.inputContainer.style.padding="5px";const t=document.createElement("input");t.type="text",t.style.flex="1",t.placeholder="Escribe un mensaje...";const e=document.createElement("button");e.textContent="Enviar",e.addEventListener("click",(()=>{const e=t.value.trim();e&&(this.submitCallbacks.forEach((t=>t(e))),this.chat.renderChatMessage({text:e,sender:"user"}),t.value="")})),t.addEventListener("keydown",(t=>{"Enter"===t.key&&e.click()})),this.inputContainer.appendChild(t),this.inputContainer.appendChild(e),document.body.appendChild(this.inputContainer)}onSubmit(t){this.submitCallbacks.push(t)}}},2969:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatToggleButtonUI=void 0,e.ChatToggleButtonUI=class{constructor(t,e={}){this.badgeElement=null,this.isVisible=!1,this.toggleCallback=[],this.chatUI=t;const n=this.chatUI.getOptions().widgetWidth||"300px";parseInt(n.replace("px","")),this.options=Object.assign({label:"Chat",buttonSize:"50px",backgroundColor:"#007bff",textColor:"#ffffff",positionRight:"20px",positionBottom:"20px",borderRadius:"50%"},e),this.button=document.createElement("button"),this.button.className="chat-toggle-btn",this.isVisible=!1}init(){this.button||(this.button=document.createElement("button"),this.button.className="chat-toggle-btn"),this.isVisible=!1,this.button.classList.remove("open");const t=document.querySelector(".chat-widget-host");if(t&&t.shadowRoot){if(t.shadowRoot.insertBefore(this.button,t.shadowRoot.firstChild),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),t.shadowRoot.appendChild(this.badgeElement),this.hideBadge(),console.log("üí¨ Badge inicializado y oculto (0 mensajes no le√≠dos)"),!t.shadowRoot.querySelector("style[data-chat-toggle-btn]")){const e=document.createElement("style");e.setAttribute("data-chat-toggle-btn","true"),e.textContent="\n\t\t\t\t\t.chat-toggle-btn {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\tright: 20px;\n\t\t\t\t\t\tbottom: 20px;\n\t\t\t\t\t\twidth: 56px;\n\t\t\t\t\t\theight: 56px;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0084ff, #0062cc);\n\t\t\t\t\t\tcolor: #fff !important;\n\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbox-shadow: 0 4px 10px rgba(0,123,255,0.3), 0 0 0 rgba(0,123,255,0);\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t\tposition: relative; /* Asegurar que el badge se posicione correctamente */\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn::before {\n\t\t\t\t\t\tcontent: '';\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\twidth: 24px;\n\t\t\t\t\t\theight: 24px;\n\t\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 3C6.5 3 2 6.58 2 11C2.05 13.15 3.06 15.17 4.75 16.5C4.75 17.1 4.33 18.67 2 21C4.37 20.89 6.64 20 8.47 18.5C9.61 18.83 10.81 19 12 19C17.5 19 22 15.42 22 11C22 6.58 17.5 3 12 3ZM12 17C7.58 17 4 14.31 4 11C4 7.69 7.58 5 12 5C16.42 5 20 7.69 20 11C20 14.31 16.42 17 12 17Z' fill='white'/%3E%3C/svg%3E\");\n\t\t\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\t\t\tbackground-position: center;\n\t\t\t\t\t\ttransition: transform 0.3s ease;\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn.open::before {\n\t\t\t\t\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z' fill='white'/%3E%3C/svg%3E\");\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:hover {\n\t\t\t\t\t\ttransform: translateY(-3px);\n\t\t\t\t\t\tbox-shadow: 0 6px 16px rgba(0,123,255,0.4);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0090ff, #0070e0);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-toggle-btn:active {\n\t\t\t\t\t\ttransform: translateY(0) scale(0.95);\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(0,123,255,0.3);\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #0062cc, #0084ff);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\ttop: calc(100% - 90px); /* Posici√≥n calculada basada en la posici√≥n del bot√≥n */\n\t\t\t\t\t\tright: 13px; /* Posici√≥n calculada para alinearse con el bot√≥n */\n\t\t\t\t\t\tmin-width: 22px;\n\t\t\t\t\t\theight: 22px;\n\t\t\t\t\t\tbackground: linear-gradient(145deg, #ff5146, #e53a30);\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tpadding: 0 5px;\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tborder: 2px solid white;\n\t\t\t\t\t\tz-index: 2147483647;\n\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(255,65,54,0.3);\n\t\t\t\t\t\tpointer-events: none; /* Evitar que el badge interfiera con el bot√≥n */\n\t\t\t\t\t\ttransition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\t\t\t\t\t}\n\t\t\t\t\t.chat-unread-badge.hidden {\n\t\t\t\t\t\ttransform: scale(0);\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\tdisplay: flex !important;\n\t\t\t\t\t}\n\t\t\t\t\t@keyframes pulse {\n\t\t\t\t\t\t0% { transform: scale(0.8); opacity: 0.7; }\n\t\t\t\t\t\t50% { transform: scale(1.3); opacity: 1; }\n\t\t\t\t\t\t80% { transform: scale(0.95); opacity: 1; }\n\t\t\t\t\t\t100% { transform: scale(1); opacity: 1; }\n\t\t\t\t\t}\n\t\t\t\t",t.shadowRoot.appendChild(e)}}else document.body.appendChild(this.button),this.badgeElement=document.createElement("div"),this.badgeElement.className="chat-unread-badge",this.badgeElement.setAttribute("id","chat-unread-badge"),document.body.appendChild(this.badgeElement),this.hideBadge(),console.log("üí¨ Badge inicializado y oculto (sin shadow DOM)");this.applyStyles(),this.addEventListeners(),this.initializeStyles(),console.log("üí¨ Eventos de contador desactivados (servicio eliminado)")}onToggle(t){this.toggleCallback.push(t)}applyStyles(){Array.from(this.button.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE&&"SPAN"!==t.tagName||this.button.removeChild(t)}));const t=this.options.backgroundColor||"#0084ff";this.button.style.background=`linear-gradient(145deg, ${t}, #0062cc)`,this.button.style.color=this.options.textColor||"#ffffff"}addEventListeners(){this.button.addEventListener("click",(()=>{this.isVisible=!this.isVisible,console.log("Toggle button clicked, new state:",this.isVisible?"visible":"hidden"),this.isVisible?this.button.classList.add("open"):this.button.classList.remove("open"),this.toggleCallback.forEach((t=>{t(this.isVisible)}))}))}hideBadge(){this.badgeElement&&(this.badgeElement.classList.add("hidden"),this.badgeElement.style.opacity="0",this.badgeElement.style.transform="scale(0)",this.badgeElement.style.display="none",this.badgeElement.textContent="",console.log("üö´ Badge oculto - sin mensajes no le√≠dos"))}updateUnreadBadge(t){this.badgeElement?(console.log(`üì¨ Actualizando badge: ${t} mensajes no le√≠dos`),t<=0?this.hideBadge():(this.badgeElement.classList.remove("hidden"),this.badgeElement.style.opacity="1",this.badgeElement.textContent=t>99?"99+":t.toString(),console.log(`üî¥ Badge visible - ${t} mensajes no le√≠dos`),this.badgeElement.style.display="flex",this.badgeElement.style.opacity="1",this.badgeElement.style.transform="scale(1)",this.badgeElement&&(this.badgeElement.style.animation="none",setTimeout((()=>{this.badgeElement&&(this.badgeElement.style.animation="pulse 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)")}),10)))):console.error("Badge element no encontrado")}initializeStyles(){Object.assign(this.button.style,{position:"fixed",right:"20px",bottom:"20px",width:"56px",height:"56px",borderRadius:"50%",background:`linear-gradient(145deg, ${this.options.backgroundColor||"#0084ff"}, #0062cc)`,color:this.options.textColor||"#ffffff",border:"none",cursor:"pointer",zIndex:"2147483647",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",boxShadow:"0 4px 10px rgba(0,123,255,0.3)",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",overflow:"hidden"}),this.badgeElement&&Object.assign(this.badgeElement.style,{position:"fixed",top:"calc(100% - 90px)",right:"13px",minWidth:"22px",height:"22px",background:"linear-gradient(145deg, #ff5146, #e53a30)",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxSizing:"border-box",border:"2px solid white",zIndex:"2147483647",boxShadow:"0 2px 8px rgba(255,65,54,0.3)",pointerEvents:"none",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)"})}show(){console.log("üîò ChatToggleButton.show() llamado"),console.log("üîò Elemento bot√≥n existe:",!!this.button),this.button?(console.log("üîò Estado antes de mostrar:",this.button.style.display),this.button.style.display="flex",console.log("üîò Estado despu√©s de mostrar:",this.button.style.display),console.log("üîò Bot√≥n en DOM:",document.contains(this.button))):console.error("üîò Error: Elemento bot√≥n no existe")}hide(){console.log("üîò ChatToggleButton.hide() llamado"),console.log("üîò Elemento bot√≥n existe:",!!this.button),this.button?(console.log("üîò Estado antes de ocultar:",this.button.style.display),this.button.style.display="none",console.log("üîò Estado despu√©s de ocultar:",this.button.style.display)):console.error("üîò Error: Elemento bot√≥n no existe")}isButtonVisible(){const t=this.button&&"none"!==this.button.style.display;return console.log("üîò isButtonVisible() - Elemento existe:",!!this.button),this.button&&console.log("üîò isButtonVisible() - Display style:",this.button.style.display),console.log("üîò isButtonVisible() - Resultado:",t),t}hideUnreadBadge(){this.hideBadge()}updateUnreadCount(t){const e=null!=t?t:0;this.updateUnreadBadge(e)}}},3507:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e,n=(e="string"==typeof t?(0,a.default)(t):t,Uint8Array.of((15&e[3])<<4|e[4]>>4&15,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|15&e[6],e[7],(15&e[1])<<4|(240&e[2])>>4,(15&e[2])<<4|(240&e[3])>>4,16|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]));return"string"==typeof t?(0,o.unsafeStringify)(n):n};var i,a=(i=n(6792))&&i.__esModule?i:{default:i},o=n(9910)},3518:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a,o,s=(i=n(2858))&&i.__esModule?i:{default:i},r=n(9910),c=0,l=0;e.default=function(t,e,n){var i=e&&n||0,d=e||new Array(16),u=(t=t||{}).node,h=t.clockseq;if(t._v6||(u||(u=a),null==h&&(h=o)),null==u||null==h){var g=t.random||(t.rng||s.default)();null==u&&(u=[g[0],g[1],g[2],g[3],g[4],g[5]],a||t._v6||(u[0]|=1,a=u)),null==h&&(h=16383&(g[6]<<8|g[7]),void 0!==o||t._v6||(o=h))}var p=void 0!==t.msecs?t.msecs:Date.now(),f=void 0!==t.nsecs?t.nsecs:l+1,m=p-c+(f-l)/1e4;if(m<0&&void 0===t.clockseq&&(h=h+1&16383),(m<0||p>c)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,l=f,o=h;var v=(1e4*(268435455&(p+=122192928e5))+f)%4294967296;d[i++]=v>>>24&255,d[i++]=v>>>16&255,d[i++]=v>>>8&255,d[i++]=255&v;var b=p/4294967296*1e4&268435455;d[i++]=b>>>8&255,d[i++]=255&b,d[i++]=b>>>24&15|16,d[i++]=b>>>16&255,d[i++]=h>>>8|128,d[i++]=255&h;for(var y=0;y<6;++y)d[i+y]=u[y];return e||(0,r.unsafeStringify)(d)}},3574:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TrackingType=e.BUSINESS_WELCOME_TEMPLATES=e.WelcomeMessageManager=e.useIdentitySignal=e.IdentitySignal=e.AsyncSignal=e.Signal=e.ConfidenceLevel=void 0;var i=n(6932);Object.defineProperty(e,"ConfidenceLevel",{enumerable:!0,get:function(){return i.ConfidenceLevel}});var a=n(1556);Object.defineProperty(e,"Signal",{enumerable:!0,get:function(){return a.Signal}}),Object.defineProperty(e,"AsyncSignal",{enumerable:!0,get:function(){return a.AsyncSignal}});var o=n(5303);Object.defineProperty(e,"IdentitySignal",{enumerable:!0,get:function(){return o.IdentitySignal}}),Object.defineProperty(e,"useIdentitySignal",{enumerable:!0,get:function(){return o.useIdentitySignal}});var s,r=n(4006);Object.defineProperty(e,"WelcomeMessageManager",{enumerable:!0,get:function(){return r.WelcomeMessageManager}}),Object.defineProperty(e,"BUSINESS_WELCOME_TEMPLATES",{enumerable:!0,get:function(){return r.BUSINESS_WELCOME_TEMPLATES}}),function(t){t.PAGE_VIEW="page_view",t.CLICK="click",t.HOVER="hover"}(s||(e.TrackingType=s={}))},3735:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TrackingEventV2Stage=void 0;const i=n(2831);e.TrackingEventV2Stage=class{process(t){var e,n;if("tracking:tracking-event"!==t.type)return t;try{const a=t.data||{},o=t.metadata||{},s=localStorage.getItem("guidersApiKey")||(null===(e=window.GUIDERS_CONFIG)||void 0===e?void 0:e.apiKey)||"",r=localStorage.getItem("fingerprint")||null,c=(null===(n=o.session)||void 0===n?void 0:n.sessionId)||null;let l=null;try{const t=localStorage.getItem("accessToken");if(t){const e=JSON.parse(atob(t.split(".")[1]));l=(null==e?void 0:e.sub)||null}}catch(t){}const d=a.eventType||a.type||t.type,u=Object.assign(Object.assign({},a.metadata||{}),o),h={event_id:a.trackingEventId||(0,i.v4)(),ts_client:new Date(t.timestamp).toISOString(),ts_server:null,api_key:s,device_id:r,session_id:c,visitor_id:null,user_id:l,event_name:d,props:u,ua:"undefined"!=typeof navigator?navigator.userAgent:"",ip:null};t.data=h,delete t.metadata}catch(t){console.warn("[TrackingEventV2Stage] ‚ùå Fall√≥ transformaci√≥n a esquema v2, se env√≠a original:",t)}return t}}},4006:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BUSINESS_WELCOME_TEMPLATES=e.WelcomeMessageManager=void 0,e.WelcomeMessageManager=class{constructor(t={}){this.config=Object.assign({enabled:!0,style:"friendly",includeEmojis:!0,language:"es",showTips:!0},t)}getWelcomeMessage(){return this.config.enabled?"custom"===this.config.style&&this.config.customMessage?this.config.customMessage:this.getPresetMessage(this.config.style,this.config.language):""}getPresetMessage(t,e="es"){const n={es:{friendly:this.config.includeEmojis?"¬°Hola! üëã Me alegra que est√©s aqu√≠. Soy tu asistente virtual y estoy listo para ayudarte con cualquier pregunta que tengas. ¬øEn qu√© puedo ayudarte hoy? üòä":"¬°Hola! Me alegra que est√©s aqu√≠. Soy tu asistente virtual y estoy listo para ayudarte con cualquier pregunta que tengas. ¬øEn qu√© puedo ayudarte hoy?",professional:this.config.includeEmojis?"Buenos d√≠as/tardes. üëî Bienvenido a nuestro servicio de atenci√≥n al cliente. Estoy aqu√≠ para proporcionarle asistencia especializada. Por favor, describa su consulta y un agente le atender√° a la brevedad.":"Buenos d√≠as/tardes. Bienvenido a nuestro servicio de atenci√≥n al cliente. Estoy aqu√≠ para proporcionarle asistencia especializada. Por favor, describa su consulta y un agente le atender√° a la brevedad.",casual:this.config.includeEmojis?"¬°Hey! ü§ô ¬øQu√© tal? Soy tu chat de soporte. Si necesitas algo o tienes alguna duda, solo escr√≠beme. Estoy aqu√≠ para echarte una mano. ¬°Dale! üöÄ":"¬°Hey! ¬øQu√© tal? Soy tu chat de soporte. Si necesitas algo o tienes alguna duda, solo escr√≠beme. Estoy aqu√≠ para echarte una mano. ¬°Dale!",helpful:this.config.includeEmojis?"¬°Hola y bienvenido! üåü Estoy aqu√≠ para hacer tu experiencia lo m√°s f√°cil posible. Puedes preguntarme sobre nuestros productos, servicios, o cualquier duda que tengas. ¬°Empezamos! üí¨":"¬°Hola y bienvenido! Estoy aqu√≠ para hacer tu experiencia lo m√°s f√°cil posible. Puedes preguntarme sobre nuestros productos, servicios, o cualquier duda que tengas. ¬°Empezamos!"},en:{friendly:this.config.includeEmojis?"Hello! üëã I'm so glad you're here. I'm your virtual assistant and I'm ready to help you with any questions you might have. How can I help you today? üòä":"Hello! I'm so glad you're here. I'm your virtual assistant and I'm ready to help you with any questions you might have. How can I help you today?",professional:this.config.includeEmojis?"Good day. üëî Welcome to our customer service platform. I'm here to provide you with specialized assistance. Please describe your inquiry and an agent will attend to you shortly.":"Good day. Welcome to our customer service platform. I'm here to provide you with specialized assistance. Please describe your inquiry and an agent will attend to you shortly.",casual:this.config.includeEmojis?"Hey there! ü§ô What's up? I'm your support chat. If you need anything or have questions, just drop me a message. I'm here to help you out. Let's go! üöÄ":"Hey there! What's up? I'm your support chat. If you need anything or have questions, just drop me a message. I'm here to help you out. Let's go!",helpful:this.config.includeEmojis?"Hello and welcome! üåü I'm here to make your experience as smooth as possible. You can ask me about our products, services, or any questions you might have. Let's get started! üí¨":"Hello and welcome! I'm here to make your experience as smooth as possible. You can ask me about our products, services, or any questions you might have. Let's get started!"}};return(n[e]||n.es)[t]||n.es.friendly}getTips(){if(!this.config.showTips)return[];const t={es:["üí° Tip: S√© espec√≠fico en tu consulta para obtener una respuesta m√°s r√°pida","‚è±Ô∏è Tiempo promedio de respuesta: 2-5 minutos","üì± Este chat funciona desde cualquier dispositivo"],en:["üí° Tip: Be specific in your query to get a faster response","‚è±Ô∏è Average response time: 2-5 minutes","üì± This chat works from any device"]};return[...t[this.config.language||"es"]||t.es]}updateConfig(t){this.config=Object.assign(Object.assign({},this.config),t)}getConfig(){return Object.assign({},this.config)}},e.BUSINESS_WELCOME_TEMPLATES={ecommerce:{es:"¬°Hola! üõçÔ∏è Bienvenido a nuestra tienda. Estoy aqu√≠ para ayudarte con tus compras, seguimiento de pedidos, devoluciones o cualquier pregunta sobre nuestros productos. ¬øEn qu√© puedo asistirte?",en:"Hello! üõçÔ∏è Welcome to our store. I'm here to help you with your purchases, order tracking, returns, or any questions about our products. How can I assist you?"},saas:{es:"¬°Hola! üíª Bienvenido al soporte t√©cnico. Estoy aqu√≠ para ayudarte con configuraci√≥n, resoluci√≥n de problemas, facturaci√≥n o cualquier duda sobre nuestro software. ¬°Cu√©ntame qu√© necesitas!",en:"Hello! üíª Welcome to technical support. I'm here to help you with setup, troubleshooting, billing, or any questions about our software. Tell me what you need!"},healthcare:{es:"¬°Hola! üè• Bienvenido a nuestro centro de atenci√≥n. Estoy aqu√≠ para ayudarte con citas, informaci√≥n sobre servicios, seguros m√©dicos o consultas generales. ¬øC√≥mo puedo ayudarte hoy?",en:"Hello! üè• Welcome to our care center. I'm here to help you with appointments, service information, medical insurance, or general inquiries. How can I help you today?"},education:{es:"¬°Hola! üìö Bienvenido a nuestro centro de aprendizaje. Estoy aqu√≠ para ayudarte con cursos, inscripciones, material de estudio o cualquier consulta acad√©mica. ¬øQu√© necesitas saber?",en:"Hello! üìö Welcome to our learning center. I'm here to help you with courses, enrollments, study materials, or any academic inquiries. What do you need to know?"},finance:{es:"¬°Hola! üí∞ Bienvenido a nuestros servicios financieros. Estoy aqu√≠ para ayudarte con consultas sobre cuentas, transacciones, inversiones o servicios bancarios. ¬øEn qu√© puedo asistirte?",en:"Hello! üí∞ Welcome to our financial services. I'm here to help you with account inquiries, transactions, investments, or banking services. How can I assist you?"}}},4213:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},4412:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatMemoryStore=void 0;class n{constructor(){this.currentChatId=null}static getInstance(){return n.instance||(n.instance=new n),n.instance}setChatId(t){this.currentChatId=t,console.log("[ChatMemoryStore] üíæ Chat ID guardado en memoria:",t)}getChatId(){return this.currentChatId}clearChatId(){this.currentChatId=null,console.log("[ChatMemoryStore] üóëÔ∏è Chat ID limpiado de memoria")}hasChatId(){return null!==this.currentChatId}}e.ChatMemoryStore=n},4476:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionInjectionStage=void 0,e.SessionInjectionStage=class{constructor(t=null){this.sessionManager=t}setSessionManager(t){this.sessionManager=t}process(t){var e;if(console.log("SessionInjectionStage: Iniciando inyecci√≥n de sesi√≥n..."),!this.sessionManager)return console.warn("SessionInjectionStage: No session manager set, skipping session injection."),t;const n=this.sessionManager.getCurrentSession();return n&&(t.metadata||(t.metadata={}),t.metadata.session={sessionId:n.sessionId,startTime:n.startTime,lastActiveTime:n.lastActiveTime,totalActiveTime:n.totalActiveTime,isActive:n.isActive,isIdle:n.isIdle},t.data||(t.data={}),t.data.sessionId=n.sessionId),console.log("SessionInjectionStage: Sesi√≥n inyectada en el evento:",null===(e=t.metadata)||void 0===e?void 0:e.session),t}}},4671:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t={},e,n=0){var s=(0,a.default)(c(c({},t),{},{_v6:!0}),new Uint8Array(16));if(s=(0,o.default)(s),e){for(var r=0;r<16;r++)e[n+r]=s[r];return e}return(0,i.unsafeStringify)(s)};var i=n(9910),a=s(n(3518)),o=s(n(343));function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e,n){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},4808:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default="00000000-0000-0000-0000-000000000000"},4815:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeStampStage=void 0,e.TimeStampStage=class{process(t){return t.timestamp=(new Date).getTime(),t}}},4948:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n(9025)),a=o(n(2311));function o(t){return t&&t.__esModule?t:{default:t}}var s=(0,i.default)("v3",48,a.default);e.default=s},5073:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(n(6140)),a=s(n(2858)),o=n(9910);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e,n){if(i.default.randomUUID&&!e&&!t)return i.default.randomUUID();var s=(t=t||{}).random||(t.rng||a.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){n=n||0;for(var r=0;r<16;++r)e[n+r]=s[r];return e}return(0,o.unsafeStringify)(s)}},5303:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.IdentitySignal=void 0,e.useIdentitySignal=function(){const t=c.getInstance();return{signal:t,identify:(e,n)=>t.identify(e,n),reloadChats:()=>t.reloadChats(),getState:()=>t.getState(),getIdentity:()=>t.getIdentity(),getChats:()=>t.getChats(),getVisitorId:()=>t.getVisitorId(),getSessionId:()=>t.getSessionId(),isIdentified:()=>t.isIdentified(),isLoading:()=>t.isLoading(),hasError:()=>t.hasError(),subscribe:e=>t.subscribe(e),subscribeToChats:e=>t.getChatsSignal().subscribe(e),reset:()=>t.reset()}};const a=n(1556),o=n(7785),s=n(7686);class r extends a.Signal{setLoading(){super.setLoading()}setSuccess(t){super.setSuccess(t)}setError(t){super.setError(t)}}class c extends a.AsyncSignal{constructor(){super(),this.chatsSignal=new r}static getInstance(){return c.instance||(c.instance=new c),c.instance}getChatsSignal(){return this.chatsSignal}identify(t,e){return i(this,void 0,void 0,(function*(){return console.log("[IdentitySignal] üöÄ Iniciando identificaci√≥n del visitante..."),this.execute((()=>i(this,void 0,void 0,(function*(){const n=yield o.VisitorsV2Service.getInstance().identify(t,e);if(!n)throw new Error("Failed to identify visitor");console.log("[IdentitySignal] ‚úÖ Visitante identificado:",n.visitorId);let i=null;if(n.visitorId)try{console.log("[IdentitySignal] üí¨ Cargando chats del visitante..."),this.chatsSignal.setLoading(),i=yield s.ChatV2Service.getInstance().getVisitorChats(n.visitorId,void 0,20),this.chatsSignal.setSuccess(i),console.log("[IdentitySignal] ‚úÖ Chats cargados:",i.chats.length,"chats encontrados")}catch(t){console.warn("[IdentitySignal] ‚ö†Ô∏è Error cargando chats:",t),this.chatsSignal.setError(t instanceof Error?t:new Error(String(t)))}else console.warn("[IdentitySignal] ‚ö†Ô∏è No se obtuvo visitorId, saltando carga de chats");return{identity:n,chats:i}}))))}))}reloadChats(){return i(this,void 0,void 0,(function*(){var t,e;const n=this.getState();if(!(null===(e=null===(t=n.data)||void 0===t?void 0:t.identity)||void 0===e?void 0:e.visitorId))return console.warn("[IdentitySignal] ‚ùå No hay visitorId disponible para recargar chats"),null;try{console.log("[IdentitySignal] üîÑ Recargando chats..."),this.chatsSignal.setLoading();const t=yield s.ChatV2Service.getInstance().getVisitorChats(n.data.identity.visitorId,void 0,20);return this.chatsSignal.setSuccess(t),this.setSuccess(Object.assign(Object.assign({},n.data),{chats:t})),console.log("[IdentitySignal] ‚úÖ Chats recargados exitosamente"),t}catch(t){const e=t instanceof Error?t:new Error(String(t));throw console.error("[IdentitySignal] ‚ùå Error recargando chats:",e),this.chatsSignal.setError(e),e}}))}getIdentity(){var t;return(null===(t=this.getState().data)||void 0===t?void 0:t.identity)||null}getChats(){var t;return(null===(t=this.getState().data)||void 0===t?void 0:t.chats)||null}isIdentified(){const t=this.getIdentity();return!!(null==t?void 0:t.visitorId)}getVisitorId(){var t;return(null===(t=this.getIdentity())||void 0===t?void 0:t.visitorId)||null}getSessionId(){var t;return(null===(t=this.getIdentity())||void 0===t?void 0:t.sessionId)||null}reset(){super.reset(),this.chatsSignal.reset()}dispose(){super.dispose(),this.chatsSignal.dispose()}}e.IdentitySignal=c},5558:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatInputUI=void 0,e.ChatInputUI=class{constructor(t,e={}){this.listeners={},this.chatUI=t,this.options=Object.assign({placeholder:"Escribe tu mensaje..."},e),this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container",this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.placeholder=this.options.placeholder,this.inputField.className="chat-input-field",this.inputField.addEventListener("keydown",(t=>{"Enter"===t.key&&this.handleSendMessage()}))}init(){const t=this.getChatContainer();this.inputContainer=document.createElement("div"),this.inputContainer.className="chat-input-container";const e=document.createElement("div");e.className="chat-input-actions";const n=document.createElement("button");n.className="chat-attachment-btn",n.setAttribute("aria-label","Adjuntar archivo"),n.addEventListener("click",(()=>{alert("Funci√≥n de adjuntar archivos no implementada a√∫n")})),e.appendChild(n),this.inputContainer.appendChild(e),this.inputField=document.createElement("input"),this.inputField.type="text",this.inputField.className="chat-input-field",this.inputField.placeholder=this.options.placeholder||"Escribe un mensaje...",this.inputField.setAttribute("aria-label","Mensaje");const i=document.createElement("button");i.className="chat-send-btn",i.setAttribute("aria-label","Enviar mensaje"),i.type="button",i.addEventListener("click",(()=>this.handleSendMessage())),this.inputContainer.appendChild(this.inputField),this.inputContainer.appendChild(i),this.inputField.addEventListener("keydown",(t=>{"Enter"===t.key&&(this.handleSendMessage(),t.preventDefault())})),t.appendChild(this.inputContainer)}onSubmit(t){this.listeners.submit=t}handleSendMessage(){const t=this.inputField.value.trim();t&&(this.chatUI.renderChatMessage({text:t,sender:"user"}),this.inputField.value="",this.listeners.submit&&this.listeners.submit(t))}getChatContainer(){const t=this.chatUI.container;if(!t)throw new Error("ChatUI no est√° inicializado o el contenedor es null");return t}}},5861:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataInjectionStage=void 0,e.MetadataInjectionStage=class{process(t){return t.metadata=Object.assign(Object.assign({},t.metadata),{device:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,screen:{width:screen.width,height:screen.height,pixelRatio:window.devicePixelRatio},hardware:{cores:navigator.hardwareConcurrency},touch:{maxTouchPoints:navigator.maxTouchPoints}}}),t}}},6140:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);e.default={randomUUID:n}},6420:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionTrackingManager=void 0;const i=n(2831);e.SessionTrackingManager=class{constructor(t,e={}){this.sessionData=null,this.heartbeatTimer=null,this._throttleTimeout=null,this.trackCallback=t,this.config=Object.assign({enabled:!0,heartbeatInterval:1e4,maxInactivityTime:6e4},e),this.config.enabled&&(this.startSession(),this.registerActivityListeners())}saveSessionData(){this.sessionData&&sessionStorage.setItem("guiders_session",JSON.stringify(this.sessionData))}startSession(){this.sessionData=sessionStorage.getItem("guiders_session")?JSON.parse(sessionStorage.getItem("guiders_session")):{sessionId:(0,i.v4)(),startTime:Date.now(),lastActiveTime:Date.now(),totalActiveTime:0,isActive:!0,isIdle:!1,isNew:!0},this.sessionData&&this.sessionData.isNew&&(this.trackCallback({event:"session_start",startTime:this.sessionData.startTime,isNew:this.sessionData.isNew}),this.sessionData.isNew=!1),this.saveSessionData(),this.initializeHeartbeat()}endSession(){this.sessionData&&(this.sessionData.isActive&&!this.sessionData.isIdle&&(this.sessionData.totalActiveTime+=Date.now()-this.sessionData.lastActiveTime),this.sessionData.isActive=!1,this.sessionData.isIdle=!1,this.trackCallback({event:"session_end",endTime:Date.now(),startTime:this.sessionData.startTime,totalActiveTime:this.sessionData.totalActiveTime,totalSessionTime:Date.now()-this.sessionData.startTime}),sessionStorage.removeItem("guiders_session"),this.sessionData=null),this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.removeActivityListeners(),this._throttleTimeout&&(clearTimeout(this._throttleTimeout),this._throttleTimeout=null)}updateActivity(t=!1){if(!this.sessionData)return null;const e=Date.now(),n=this.sessionData.isIdle,i=!this.sessionData.isActive,a=this.sessionData.lastActiveTime;if(this.sessionData.isActive&&!this.sessionData.isIdle){const t=e-this.sessionData.lastActiveTime;this.sessionData.totalActiveTime+=t}return this.sessionData.lastActiveTime=e,this.sessionData.isActive=!0,(n||t)&&(this.sessionData.isIdle=!1,this.trackCallback({event:"user_resume",resumeTime:e,previousIdleTime:n?e-a:0,totalActiveTime:this.sessionData.totalActiveTime})),i&&this.trackCallback({event:"session_reactivate",reactivateTime:e,totalActiveTime:this.sessionData.totalActiveTime}),this.saveSessionData(),this.sessionData}getCurrentSession(){return this.sessionData}initializeHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>{this.checkUserActivity()}),this.config.heartbeatInterval)}checkUserActivity(){if(!this.sessionData||!this.sessionData.isActive)return;const t=Date.now();if(t-this.sessionData.lastActiveTime>this.config.maxInactivityTime&&!this.sessionData.isIdle){this.sessionData.isIdle=!0;const e=this.config.maxInactivityTime;this.sessionData.totalActiveTime+=e,this.trackCallback({event:"user_idle",sessionId:this.sessionData.sessionId,idleStartTime:t,lastActiveTime:this.sessionData.lastActiveTime,totalActiveTime:this.sessionData.totalActiveTime}),this.saveSessionData()}}registerActivityListeners(){if("undefined"==typeof window)return;const t=this.handleUserActivity.bind(this);["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach((e=>{window.addEventListener(e,t,{passive:!0})})),document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState?this.updateActivity(!0):this.checkUserActivity()}))}removeActivityListeners(){if("undefined"==typeof window)return;const t=this.handleUserActivity.bind(this);["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach((e=>{window.removeEventListener(e,t)})),document.removeEventListener("visibilitychange",(()=>{}))}handleUserActivity(t){this._throttleTimeout||(this._throttleTimeout=setTimeout((()=>{this._throttleTimeout=null}),1e3),this.updateActivity())}}},6792:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=(i=n(7037))&&i.__esModule?i:{default:i};e.default=function(t){if(!(0,a.default)(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=255&e,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=255&e,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=255&e,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=255&e,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=255&e,n}},6808:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DomTrackingManager=e.DefaultTrackDataExtractor=void 0;class n{extract(t){const e=t.dataset,n={event:e.trackEvent};return Object.keys(e).forEach((t=>{if("trackEvent"===t)return;const i=t.replace(/[A-Z]/g,(t=>`_${t.toLowerCase()}`));n[i]=e[t]})),n}}e.DefaultTrackDataExtractor=n,e.DomTrackingManager=class{constructor(t,e=new n){this.domEventMap={view_product:"mouseenter",add_to_cart:"click",view_cart:"mouseenter",purchase:"click",page_view:"DOMContentLoaded",search_vehicle_type:"change",search_brand:"change",search_model:"change",search_fuel:"change",search_price_type:"change",sort_vehicles:"change",calculate_financing:"click",add_to_favorites:"click",view_vehicle_location:"mouseenter",filter_by_price:"change",filter_by_payment:"change",search_submit:"click",search_input:"input",add_to_comparison:"click",remove_from_comparison:"click",select_comparison_vehicle:"click",view_vehicle_comparison:"mouseenter",save_comparison:"click",export_comparison:"click",share_comparison:"click",clear_comparison:"click",filter_by_year:"change",filter_by_transmission:"change",filter_by_doors:"change",filter_by_mileage:"change",filter_by_condition:"change",toggle_advanced_filters:"click",contact_dealer:"click",schedule_test_drive:"click",request_quote:"click",view_vehicle_details:"click",view_vehicle_gallery:"click",view_vehicle_specs:"click",view_vehicle_history:"click",download_brochure:"click",analytics_dashboard_view:"mouseenter",export_analytics:"click",share_analytics:"click",chat_ask_about_vehicle:"click",chat_request_financing:"click",chat_schedule_viewing:"click"},this.trackCallback=t,this.extractor=e}enableDOMTracking(){const t=document.querySelector('[data-track-event="page_view"]');t&&"DOMContentLoaded"===this.domEventMap.page_view&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.trackCallback(this.extractor.extract(t))})):this.trackCallback(this.extractor.extract(t))),Object.entries(this.domEventMap).forEach((([t,e])=>{"page_view"!==t&&document.querySelectorAll(`[data-track-event="${t}"]`).forEach((n=>{const i=`__track_listener_${t}`;n[i]||(n.addEventListener(e,(()=>{this.trackCallback(this.extractor.extract(n))})),n[i]=!0)}))}))}}},6932:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ConfidenceLevel=void 0,function(t){t[t.EXACT_MATCH=.95]="EXACT_MATCH",t[t.HIGH=.9]="HIGH",t[t.MEDIUM=.7]="MEDIUM",t[t.LOW=.5]="LOW",t[t.FALLBACK=.1]="FALLBACK"}(n||(e.ConfidenceLevel=n={}))},7037:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=(i=n(7656))&&i.__esModule?i:{default:i};e.default=function(t){return"string"==typeof t&&a.default.test(t)}},7186:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n(9025)),a=o(n(9042));function o(t){return t&&t.__esModule?t:{default:t}}var s=(0,i.default)("v5",80,a.default);e.default=s},7656:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},7686:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatV2Service=void 0;const a=n(2597);class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}getAuthHeaders(){const t={"Content-Type":"application/json"},e=sessionStorage.getItem("guiders_backend_session_id");e&&(t["X-Guiders-Sid"]=e);const n=localStorage.getItem("accessToken");return n&&(t.Authorization=`Bearer ${n}`),t}getFetchOptions(t="GET",e){return Object.assign({method:t,headers:this.getAuthHeaders(),credentials:"include"},e&&{body:e})}getBaseUrl(){const t=a.EndpointManager.getInstance(),e=localStorage.getItem("pixelEndpoint")||t.getEndpoint();return`${e.endsWith("/api")?e:`${e}/api`}/v2/chats`}getVisitorChats(t,e){return i(this,arguments,void 0,(function*(t,e,n=20){console.log(`[ChatV2Service] üë§ Obteniendo chats del visitante: ${t}`);const i=new URLSearchParams;e&&i.append("cursor",e),i.append("limit",n.toString());const a=`${this.getBaseUrl()}/visitor/${t}?${i.toString()}`,o=yield fetch(a,this.getFetchOptions("GET"));if(!o.ok){const e=yield o.text();throw console.error(`[ChatV2Service] ‚ùå Error al obtener chats del visitante ${t}:`,e),new Error(`Error al obtener chats del visitante (${o.status}): ${e}`)}const s=yield o.json();return console.log("[ChatV2Service] ‚úÖ Chats del visitante obtenidos:",{count:s.chats.length,total:s.total,hasMore:s.hasMore}),s}))}getLatestVisitorChat(t){return i(this,void 0,void 0,(function*(){try{const e=yield this.getVisitorChats(t,void 0,20);return e.chats&&e.chats.length>0?e.chats[0]:null}catch(t){return console.warn("[ChatV2Service] ‚ùå Error obteniendo √∫ltimo chat del visitante:",t),null}}))}getCommercialChats(t,e){return i(this,arguments,void 0,(function*(t,e,n=20,i){console.log(`[ChatV2Service] üè™ Obteniendo chats del comercial: ${t}`);const a=new URLSearchParams;e&&a.append("cursor",e),a.append("limit",n.toString()),i&&Object.entries(i).forEach((([t,e])=>{Array.isArray(e)?e.forEach((e=>a.append(`filters[${t}][]`,e))):a.append(`filters[${t}]`,e)}));const o=`${this.getBaseUrl()}/commercial/${t}?${a.toString()}`,s=yield fetch(o,this.getFetchOptions("GET"));if(!s.ok){const e=yield s.text();throw console.error(`[ChatV2Service] ‚ùå Error al obtener chats del comercial ${t}:`,e),new Error(`Error al obtener chats del comercial (${s.status}): ${e}`)}const r=yield s.json();return console.log("[ChatV2Service] ‚úÖ Chats del comercial obtenidos:",{count:r.chats.length,total:r.total,hasMore:r.hasMore}),r}))}getPendingQueue(t){return i(this,arguments,void 0,(function*(t,e=50){console.log("[ChatV2Service] üìã Obteniendo cola de chats pendientes");const n=new URLSearchParams;t&&n.append("department",t),n.append("limit",e.toString());const i=`${this.getBaseUrl()}/queue/pending?${n.toString()}`,a=yield fetch(i,this.getFetchOptions("GET"));if(!a.ok){const t=yield a.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener cola pendiente:",t),new Error(`Error al obtener cola pendiente (${a.status}): ${t}`)}const o=yield a.json();return console.log("[ChatV2Service] ‚úÖ Cola de chats pendientes obtenida:",{count:o.length}),o}))}assignChat(t,e){return i(this,void 0,void 0,(function*(){console.log(`[ChatV2Service] üìå Asignando chat ${t} al comercial ${e}`);const n=yield fetch(`${this.getBaseUrl()}/${t}/assign/${e}`,this.getFetchOptions("PUT"));if(!n.ok){const t=yield n.text();throw console.error("[ChatV2Service] ‚ùå Error al asignar chat:",t),new Error(`Error al asignar chat (${n.status}): ${t}`)}const i=yield n.json();return console.log("[ChatV2Service] ‚úÖ Chat asignado exitosamente"),i}))}closeChat(t){return i(this,void 0,void 0,(function*(){console.log(`[ChatV2Service] üîí Cerrando chat ${t}`);const e=yield fetch(`${this.getBaseUrl()}/${t}/close`,this.getFetchOptions("PUT"));if(!e.ok){const t=yield e.text();throw console.error("[ChatV2Service] ‚ùå Error al cerrar chat:",t),new Error(`Error al cerrar chat (${e.status}): ${t}`)}const n=yield e.json();return console.log("[ChatV2Service] ‚úÖ Chat cerrado exitosamente"),n}))}getCommercialMetrics(t,e,n){return i(this,void 0,void 0,(function*(){console.log(`[ChatV2Service] üìä Obteniendo m√©tricas del comercial: ${t}`);const i=new URLSearchParams;e&&i.append("dateFrom",e.toISOString()),n&&i.append("dateTo",n.toISOString());const a=`${this.getBaseUrl()}/metrics/commercial/${t}?${i.toString()}`,o=yield fetch(a,this.getFetchOptions("GET"));if(!o.ok){const t=yield o.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener m√©tricas:",t),new Error(`Error al obtener m√©tricas (${o.status}): ${t}`)}const s=yield o.json();return console.log("[ChatV2Service] ‚úÖ M√©tricas obtenidas"),s}))}getResponseTimeStats(t,e){return i(this,arguments,void 0,(function*(t,e,n="day"){console.log("[ChatV2Service] ‚è±Ô∏è Obteniendo estad√≠sticas de tiempo de respuesta");const i=new URLSearchParams;t&&i.append("dateFrom",t.toISOString()),e&&i.append("dateTo",e.toISOString()),i.append("groupBy",n);const a=`${this.getBaseUrl()}/response-time-stats?${i.toString()}`,o=yield fetch(a,this.getFetchOptions("GET"));if(!o.ok){const t=yield o.text();throw console.error("[ChatV2Service] ‚ùå Error al obtener estad√≠sticas:",t),new Error(`Error al obtener estad√≠sticas (${o.status}): ${t}`)}const s=yield o.json();return console.log("[ChatV2Service] ‚úÖ Estad√≠sticas obtenidas"),s}))}createChatAuto(t){return i(this,void 0,void 0,(function*(){console.log("[ChatV2Service] üÜï Creando chat V2 por POST (auto-id)");const e=yield fetch(`${this.getBaseUrl()}`,this.getFetchOptions("POST",JSON.stringify(t)));if(!e.ok){const t=yield e.text();throw console.error("[ChatV2Service] ‚ùå Error al crear chat V2 (POST):",t),new Error(`Error al crear chat V2 (POST) (${e.status}): ${t}`)}const n=yield e.json();return console.log("[ChatV2Service] ‚úÖ Chat V2 creado (POST):",n.id),n}))}}e.ChatV2Service=o},7690:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.URLPageDetector=void 0;const i=n(6932);e.URLPageDetector=class{constructor(){this.urlPatterns=[{pattern:/^\/?(index\.(php|html?)?)?$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/^\/?(home|inicio)$/i,pageType:"home",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"main"}},{pattern:/\/?(shop|tienda|ecommerce|store)/i,pageType:"ecommerce",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(product|producto)[\/-]?(\d+|[^\/]+)?/i,pageType:"product_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(cart|carrito|basket)/i,pageType:"cart",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(checkout|pago|payment)/i,pageType:"checkout",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"ecommerce"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(search|busqueda|buscar)?/i,pageType:"vehicle_search",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(vehiculos-ocasion|coches-ocasion|vehiculos-segunda-mano|coches-usados)/i,pageType:"used_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"used"}},{pattern:/\/?(vehiculos-nuevos|coches-nuevos)/i,pageType:"new_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"new"}},{pattern:/\/?(coches-km0|vehiculos-km0|km-0)/i,pageType:"km0_vehicles",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive",vehicleType:"km0"}},{pattern:/\/?(ofertas-vehiculos|ofertas-coches|promociones-coches)/i,pageType:"vehicle_offers",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive",vehicleType:"offers"}},{pattern:/\/?(vehicle|vehiculo|car|auto)[\/-]?(detail|detalle)[\/-]?(\d+|[^\/]+)?/i,pageType:"vehicle_detail",confidence:i.ConfidenceLevel.EXACT_MATCH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(comparison|comparar|compare)/i,pageType:"vehicle_comparison",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(financing|financiacion|finance)/i,pageType:"financing",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"automotive"}},{pattern:/\/?(contact|contacto|contact-us)/i,pageType:"contact",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(about|nosotros|acerca|about-us)/i,pageType:"about",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"information"}},{pattern:/\/?(analytics|dashboard|admin)/i,pageType:"analytics_dashboard",confidence:i.ConfidenceLevel.HIGH,metadata:{pageCategory:"analytics"}},{pattern:/\/?(search|buscar|busqueda)/i,pageType:"search_results",confidence:i.ConfidenceLevel.MEDIUM,metadata:{pageCategory:"search"}},{pattern:/.*/,pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,metadata:{pageCategory:"unknown"}}]}detectCurrentPage(){const t=window.location.href,e=window.location.pathname;for(const n of this.urlPatterns)if(this.matchesPattern(e,n.pattern))return{pageType:n.pageType,confidence:n.confidence,url:t,path:e,metadata:Object.assign(Object.assign({},n.metadata),{title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()})};return{pageType:"other",confidence:i.ConfidenceLevel.FALLBACK,url:t,path:e,metadata:{pageCategory:"unknown",title:document.title,host:window.location.host,search:window.location.search,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()}}}matchesPattern(t,e){return e instanceof RegExp?e.test(t):t.toLowerCase().includes(e.toLowerCase())}addURLPattern(t){this.urlPatterns.splice(-1,0,t)}getURLPatterns(){return[...this.urlPatterns]}extractPageMetadata(){var t;const e=this.detectCurrentPage();return Object.assign(Object.assign({},e.metadata),{viewport:{width:window.innerWidth,height:window.innerHeight},userAgent:navigator.userAgent,language:navigator.language,page_url:window.location.href,page_path:window.location.pathname,page_search:window.location.search,page_host:window.location.host,page_protocol:window.location.protocol,page_hash:window.location.hash,page_type:e.pageType,page_confidence:e.confidence,page_category:null===(t=e.metadata)||void 0===t?void 0:t.pageCategory})}}},7775:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=(i=n(7037))&&i.__esModule?i:{default:i};e.default=function(t){if(!(0,a.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}},7785:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.VisitorsV2Service=void 0;const a=n(2597);class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}getBaseUrl(){const t=localStorage.getItem("pixelEndpoint")||a.EndpointManager.getInstance().getEndpoint();return`${t.endsWith("/api")?t:`${t}/api`}/visitors`}identify(t,e){return i(this,void 0,void 0,(function*(){var n,i,a;try{const o=`${this.getBaseUrl()}/identify`,s="undefined"!=typeof window?window.location.hostname:"localhost",r={fingerprint:t,domain:s,apiKey:e||localStorage.getItem("guidersApiKey")||""},c=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"});if(!c.ok){const t=yield c.text();return console.warn("[VisitorsV2Service] ‚ùå Error al identificar visitante:",c.status,t),null}const l=yield c.json(),d={visitorId:l.visitorId||l.id,sessionId:l.sessionId||l.session_id,name:null!==(n=l.name)&&void 0!==n?n:null,email:null!==(i=l.email)&&void 0!==i?i:null,tel:null!==(a=l.tel)&&void 0!==a?a:null};return d.visitorId&&localStorage.setItem("visitorId",d.visitorId),d.sessionId&&sessionStorage.setItem("guiders_backend_session_id",d.sessionId),console.log("[VisitorsV2Service] ‚úÖ identify OK:",d.visitorId,"session:",d.sessionId),d}catch(t){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n en identify:",t),null}}))}heartbeat(){return i(this,void 0,void 0,(function*(){try{const t=sessionStorage.getItem("guiders_backend_session_id");if(!t)return console.warn("[VisitorsV2Service] ‚ùå No sessionId disponible para heartbeat"),!1;const e=`${this.getBaseUrl()}/session/heartbeat`,n=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t}),credentials:"include"});if(!n.ok){const t=yield n.text();return console.warn("[VisitorsV2Service] ‚ùå Heartbeat fallido:",n.status,t),!1}return console.log("[VisitorsV2Service] ‚úÖ Heartbeat exitoso"),!0}catch(t){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n heartbeat:",t),!1}}))}endSession(){return i(this,arguments,void 0,(function*(t={}){const e=sessionStorage.getItem("guiders_backend_session_id");if(!e)return console.warn("[VisitorsV2Service] ‚ùå No sessionId disponible para endSession"),!1;const n=`${this.getBaseUrl()}/session/end`,i={sessionId:e,reason:t.reason||(t.useBeacon?"page_unload":"manual")};if(t.useBeacon&&"undefined"!=typeof navigator&&"sendBeacon"in navigator)try{const t=new Blob([JSON.stringify(i)],{type:"application/json"});if(navigator.sendBeacon(n,t))return console.log("[VisitorsV2Service] ‚úÖ endSession enviado via beacon"),sessionStorage.removeItem("guiders_backend_session_id"),!0;console.warn("[VisitorsV2Service] ‚ö†Ô∏è sendBeacon fall√≥, intentando fetch...")}catch(t){console.warn("[VisitorsV2Service] ‚ùå Error con sendBeacon, fallback a fetch:",t)}if(!t.useBeacon)try{const t=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include",keepalive:!0});if(!t.ok){const e=yield t.text();return console.warn("[VisitorsV2Service] ‚ùå endSession fallido:",t.status,e),!1}return console.log("[VisitorsV2Service] ‚úÖ endSession exitoso via fetch"),sessionStorage.removeItem("guiders_backend_session_id"),!0}catch(t){return console.warn("[VisitorsV2Service] ‚ùå Excepci√≥n endSession:",t),!1}return console.warn("[VisitorsV2Service] ‚ùå No se pudo enviar endSession"),!1}))}}e.VisitorsV2Service=o},8156:function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,a)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),a=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||i(e,t,n)},o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(2597),r=n(2782),c=n(1688);a(n(2597),e),a(n(1921),e),a(n(2782),e),a(n(6808),e),a(n(2895),e),a(n(1034),e),a(n(7690),e),a(n(6420),e),a(n(1750),e),a(n(421),e),a(n(9167),e),a(n(7686),e),a(n(3574),e);const l=c.resolveDefaultEndpoints;function d(){if(window.guiders||window.__GUIDERS_INITIALIZING__)console.warn("[Guiders SDK] ‚ùå Inicializaci√≥n ignorada: instancia existente o en progreso");else{window.__GUIDERS_INITIALIZING__=!0;try{const{apiKey:t}=function(){const t=function(){const t=Array.from(document.getElementsByTagName("script"));for(const e of t)if(e.getAttribute("data-guiders-sdk"))return e;if(document.currentScript&&document.currentScript instanceof HTMLScriptElement){const t=document.currentScript;if(t.getAttribute("data-api-key")||t.getAttribute("data-apikey")||t.src&&(t.src.includes("apiKey=")||t.src.includes("apikey=")||t.src.includes("guiders")))return t}for(const e of t)if(e.getAttribute("data-api-key")||e.getAttribute("data-apikey"))return e;for(const e of t)if(e.src&&(e.src.includes("apiKey=")||e.src.includes("apikey=")))return e;for(const e of t)if(e.src&&e.src.includes("guiders"))return e;for(const e of t)if(e.src&&(e.src.includes("tracking")||e.src.includes("index.js"))&&(e.src.includes("apiKey=")||e.src.includes("apikey=")))return e;const e=t.filter((t=>t.src&&(t.src.includes(".js")||t.src.includes("index"))));for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.src.includes("guiders")||n.src.includes("tracking")||n.src.includes("apiKey=")||n.src.includes("apikey="))return n}return null}();if(!t)throw new Error("No se encontr√≥ el script del SDK Guiders. Aseg√∫rate de incluir el atributo data-api-key.");let e=t.getAttribute("data-api-key")||t.getAttribute("data-apikey");if(!e&&t.src){const n=t.src.split("?")[1];if(n){const t=new URLSearchParams(n);e=t.get("apiKey")||t.get("apikey")}}if(!e&&"undefined"!=typeof window&&window.GUIDERS_CONFIG&&(e=window.GUIDERS_CONFIG.apiKey),!e)throw new Error("No se encontr√≥ la clave API. Usa data-api-key=\"tu-clave\" en el script o configura window.GUIDERS_CONFIG = {apiKey: 'tu-clave'}.");return{apiKey:e}}();window.GUIDERS_API_KEY=t,window.TrackingPixelSDK=s.TrackingPixelSDK;const{endpoint:e,webSocketEndpoint:n,isProd:i}=l();console.log("[Guiders SDK] üåê Endpoints resueltos:",{endpoint:e,webSocketEndpoint:n,isProd:i});const a={apiKey:t,autoFlush:!0,flushInterval:1e3,maxRetries:2,heuristicDetection:{enabled:!0,config:{enabled:!0,confidenceThreshold:.7,fallbackToManual:!0}},sessionTracking:{enabled:!0,config:{enabled:!0,heartbeatInterval:3e4,trackBackgroundTime:!1}},endpoint:e,webSocketEndpoint:n};(new r.BotDetector).detect().then((t=>{if(t.isBot)return console.log("Bot detectado. Probabilidad:",t.probability),console.log("Detalles:",t.details),void(window.__GUIDERS_INITIALIZING__=!1);window.guiders=new window.TrackingPixelSDK(a),(()=>{o(this,void 0,void 0,(function*(){yield window.guiders.init(),window.guiders.enableAutomaticTracking(),window.__GUIDERS_INITIALIZING__=!1}))})()}))}catch(t){console.error("Error inicializando Guiders SDK:",t),window.__GUIDERS_INITIALIZING__=!1}}}"undefined"!=typeof window&&(window.GUIDERS_CONFIG&&window.GUIDERS_CONFIG.preventAutoInit?console.log("[Guiders SDK] ‚è∏Ô∏è Auto-init desactivado por configuraci√≥n (preventAutoInit)"):setTimeout((()=>{if(!window.guiders){const t=()=>{document.addEventListener("rocket-script-loaded",(t=>{const e=t.target;!window.guiders&&e&&e.src&&(e.src.includes("guiders")||e.src.includes("apiKey="))&&setTimeout(d,10)})),document.addEventListener("rocket-loaded",(()=>{window.guiders||setTimeout(d,10)}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),(void 0!==window.RocketLazyLoadScripts||document.querySelector('script[type="rocketlazyloadscript"]'))&&(setTimeout((()=>{window.guiders||d()}),100),setTimeout((()=>{window.guiders||d()}),500))}}),500))},8334:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChatSessionStore=void 0;class n{constructor(){this.openChats=new Set,this.currentChatId=null,this.LS_KEY="guiders_open_chats",this.hydrate()}static getInstance(){return n.instance||(n.instance=new n),n.instance}hydrate(){try{const t=localStorage.getItem(this.LS_KEY);if(!t)return;const e=JSON.parse(t);Array.isArray(e.open)&&e.open.forEach((t=>t&&this.openChats.add(t))),e.current&&(this.currentChatId=e.current)}catch(t){console.warn("[ChatSessionStore] ‚ùå Error al hidratar open chats:",t)}}persist(){try{const t={current:this.currentChatId,open:Array.from(this.openChats),lastUpdated:Date.now()};localStorage.setItem(this.LS_KEY,JSON.stringify(t))}catch(t){console.warn("[ChatSessionStore] ‚ùå Error al persistir open chats:",t)}}setCurrent(t){t&&(this.currentChatId=t,this.openChats.add(t),this.persist())}add(t){t&&(this.openChats.add(t),this.persist())}remove(t){t&&(this.openChats.delete(t),this.currentChatId===t&&(this.currentChatId=null),this.persist())}getCurrent(){return this.currentChatId}getAll(){return Array.from(this.openChats)}}e.ChatSessionStore=n},9025:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0,e.default=function(t,e,n){function i(t,i,s,r){var c;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}(t)),"string"==typeof i&&(i=(0,o.default)(i)),16!==(null===(c=i)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+t.length);if(l.set(i),l.set(t,i.length),(l=n(l))[6]=15&l[6]|e,l[8]=63&l[8]|128,s){r=r||0;for(var d=0;d<16;++d)s[r+d]=l[d];return s}return(0,a.unsafeStringify)(l)}try{i.name=t}catch(t){}return i.DNS=s,i.URL=r,i};var i,a=n(9910),o=(i=n(6792))&&i.__esModule?i:{default:i},s=e.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r=e.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8"},9042:(t,e)=>{"use strict";function n(t,e,n,i){switch(t){case 0:return e&n^~e&i;case 1:case 3:return e^n^i;case 2:return e&n^e&i^n&i}}function i(t,e){return t<<e|t>>>32-e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=function(t){var e=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var o=unescape(encodeURIComponent(t));t=[];for(var s=0;s<o.length;++s)t.push(o.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var r=t.length/4+2,c=Math.ceil(r/16),l=new Array(c),d=0;d<c;++d){for(var u=new Uint32Array(16),h=0;h<16;++h)u[h]=t[64*d+4*h]<<24|t[64*d+4*h+1]<<16|t[64*d+4*h+2]<<8|t[64*d+4*h+3];l[d]=u}l[c-1][14]=8*(t.length-1)/Math.pow(2,32),l[c-1][14]=Math.floor(l[c-1][14]),l[c-1][15]=8*(t.length-1)&4294967295;for(var g=0;g<c;++g){for(var p=new Uint32Array(80),f=0;f<16;++f)p[f]=l[g][f];for(var m=16;m<80;++m)p[m]=i(p[m-3]^p[m-8]^p[m-14]^p[m-16],1);for(var v=a[0],b=a[1],y=a[2],w=a[3],x=a[4],C=0;C<80;++C){var S=Math.floor(C/20),k=i(v,5)+n(S,b,y,w)+x+e[S]+p[C]>>>0;x=w,w=y,y=i(b,30)>>>0,b=v,v=k}a[0]=a[0]+v>>>0,a[1]=a[1]+b>>>0,a[2]=a[2]+y>>>0,a[3]=a[3]+w>>>0,a[4]=a[4]+x>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]}},9126:function(t,e,n){t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i,a,o=n(1)(),s=n(3),r=n(4),c=n(6),l=function(){var t=new r;return i=t.getResult(),a=new c,this};l.prototype={getSoftwareVersion:function(){return"0.1.11"},getBrowserData:function(){return i},getFingerprint:function(){var t="|",e=i.ua,n=this.getScreenPrint(),a=this.getPlugins(),o=this.getFonts(),r=this.isLocalStorage(),c=this.isSessionStorage(),l=this.getTimeZone(),d=this.getLanguage(),u=this.getSystemLanguage(),h=this.isCookie(),g=this.getCanvasPrint();return s(e+t+n+t+a+t+o+t+r+t+c+t+l+t+d+t+u+t+h+t+g,256)},getCustomFingerprint:function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+"|";return s(t,256)},getUserAgent:function(){return i.ua},getUserAgentLowerCase:function(){return i.ua.toLowerCase()},getBrowser:function(){return i.browser.name},getBrowserVersion:function(){return i.browser.version},getBrowserMajorVersion:function(){return i.browser.major},isIE:function(){return/IE/i.test(i.browser.name)},isChrome:function(){return/Chrome/i.test(i.browser.name)},isFirefox:function(){return/Firefox/i.test(i.browser.name)},isSafari:function(){return/Safari/i.test(i.browser.name)},isMobileSafari:function(){return/Mobile\sSafari/i.test(i.browser.name)},isOpera:function(){return/Opera/i.test(i.browser.name)},getEngine:function(){return i.engine.name},getEngineVersion:function(){return i.engine.version},getOS:function(){return i.os.name},getOSVersion:function(){return i.os.version},isWindows:function(){return/Windows/i.test(i.os.name)},isMac:function(){return/Mac/i.test(i.os.name)},isLinux:function(){return/Linux/i.test(i.os.name)},isUbuntu:function(){return/Ubuntu/i.test(i.os.name)},isSolaris:function(){return/Solaris/i.test(i.os.name)},getDevice:function(){return i.device.model},getDeviceType:function(){return i.device.type},getDeviceVendor:function(){return i.device.vendor},getCPU:function(){return i.cpu.architecture},isMobile:function(){var t=i.ua||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))},isMobileMajor:function(){return this.isMobileAndroid()||this.isMobileBlackBerry()||this.isMobileIOS()||this.isMobileOpera()||this.isMobileWindows()},isMobileAndroid:function(){return!!i.ua.match(/Android/i)},isMobileOpera:function(){return!!i.ua.match(/Opera Mini/i)},isMobileWindows:function(){return!!i.ua.match(/IEMobile/i)},isMobileBlackBerry:function(){return!!i.ua.match(/BlackBerry/i)},isMobileIOS:function(){return!!i.ua.match(/iPhone|iPad|iPod/i)},isIphone:function(){return!!i.ua.match(/iPhone/i)},isIpad:function(){return!!i.ua.match(/iPad/i)},isIpod:function(){return!!i.ua.match(/iPod/i)},getScreenPrint:function(){return"Current Resolution: "+this.getCurrentResolution()+", Available Resolution: "+this.getAvailableResolution()+", Color Depth: "+this.getColorDepth()+", Device XDPI: "+this.getDeviceXDPI()+", Device YDPI: "+this.getDeviceYDPI()},getColorDepth:function(){return screen.colorDepth},getCurrentResolution:function(){return screen.width+"x"+screen.height},getAvailableResolution:function(){return screen.availWidth+"x"+screen.availHeight},getDeviceXDPI:function(){return screen.deviceXDPI},getDeviceYDPI:function(){return screen.deviceYDPI},getPlugins:function(){for(var t="",e=0;e<navigator.plugins.length;e++)e==navigator.plugins.length-1?t+=navigator.plugins[e].name:t+=navigator.plugins[e].name+", ";return t},isJava:function(){return navigator.javaEnabled()},getJavaVersion:function(){throw new Error("Please use client.java.js or client.js if you need this functionality!")},isFlash:function(){return!!navigator.plugins["Shockwave Flash"]},getFlashVersion:function(){throw new Error("Please use client.flash.js or client.js if you need this functionality!")},isSilverlight:function(){return!!navigator.plugins["Silverlight Plug-In"]},getSilverlightVersion:function(){return this.isSilverlight()?navigator.plugins["Silverlight Plug-In"].description:""},isMimeTypes:function(){return!(!navigator.mimeTypes||!navigator.mimeTypes.length)},getMimeTypes:function(){var t="";if(navigator.mimeTypes)for(var e=0;e<navigator.mimeTypes.length;e++)e==navigator.mimeTypes.length-1?t+=navigator.mimeTypes[e].description:t+=navigator.mimeTypes[e].description+", ";return t},isFont:function(t){return a.detect(t)},getFonts:function(){for(var t=["Abadi MT Condensed Light","Adobe Fangsong Std","Adobe Hebrew","Adobe Ming Std","Agency FB","Aharoni","Andalus","Angsana New","AngsanaUPC","Aparajita","Arab","Arabic Transparent","Arabic Typesetting","Arial Baltic","Arial Black","Arial CE","Arial CYR","Arial Greek","Arial TUR","Arial","Batang","BatangChe","Bauhaus 93","Bell MT","Bitstream Vera Serif","Bodoni MT","Bookman Old Style","Braggadocio","Broadway","Browallia New","BrowalliaUPC","Calibri Light","Calibri","Californian FB","Cambria Math","Cambria","Candara","Castellar","Casual","Centaur","Century Gothic","Chalkduster","Colonna MT","Comic Sans MS","Consolas","Constantia","Copperplate Gothic Light","Corbel","Cordia New","CordiaUPC","Courier New Baltic","Courier New CE","Courier New CYR","Courier New Greek","Courier New TUR","Courier New","DFKai-SB","DaunPenh","David","DejaVu LGC Sans Mono","Desdemona","DilleniaUPC","DokChampa","Dotum","DotumChe","Ebrima","Engravers MT","Eras Bold ITC","Estrangelo Edessa","EucrosiaUPC","Euphemia","Eurostile","FangSong","Forte","FrankRuehl","Franklin Gothic Heavy","Franklin Gothic Medium","FreesiaUPC","French Script MT","Gabriola","Gautami","Georgia","Gigi","Gisha","Goudy Old Style","Gulim","GulimChe","GungSeo","Gungsuh","GungsuhChe","Haettenschweiler","Harrington","Hei S","HeiT","Heisei Kaku Gothic","Hiragino Sans GB","Impact","Informal Roman","IrisUPC","Iskoola Pota","JasmineUPC","KacstOne","KaiTi","Kalinga","Kartika","Khmer UI","Kino MT","KodchiangUPC","Kokila","Kozuka Gothic Pr6N","Lao UI","Latha","Leelawadee","Levenim MT","LilyUPC","Lohit Gujarati","Loma","Lucida Bright","Lucida Console","Lucida Fax","Lucida Sans Unicode","MS Gothic","MS Mincho","MS PGothic","MS PMincho","MS Reference Sans Serif","MS UI Gothic","MV Boli","Magneto","Malgun Gothic","Mangal","Marlett","Matura MT Script Capitals","Meiryo UI","Meiryo","Menlo","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU-ExtB","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","Miriam Fixed","Miriam","Mongolian Baiti","MoolBoran","NSimSun","Narkisim","News Gothic MT","Niagara Solid","Nyala","PMingLiU","PMingLiU-ExtB","Palace Script MT","Palatino Linotype","Papyrus","Perpetua","Plantagenet Cherokee","Playbill","Prelude Bold","Prelude Condensed Bold","Prelude Condensed Medium","Prelude Medium","PreludeCompressedWGL Black","PreludeCompressedWGL Bold","PreludeCompressedWGL Light","PreludeCompressedWGL Medium","PreludeCondensedWGL Black","PreludeCondensedWGL Bold","PreludeCondensedWGL Light","PreludeCondensedWGL Medium","PreludeWGL Black","PreludeWGL Bold","PreludeWGL Light","PreludeWGL Medium","Raavi","Rachana","Rockwell","Rod","Sakkal Majalla","Sawasdee","Script MT Bold","Segoe Print","Segoe Script","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Segoe UI","Shonar Bangla","Showcard Gothic","Shruti","SimHei","SimSun","SimSun-ExtB","Simplified Arabic Fixed","Simplified Arabic","Snap ITC","Sylfaen","Symbol","Tahoma","Times New Roman Baltic","Times New Roman CE","Times New Roman CYR","Times New Roman Greek","Times New Roman TUR","Times New Roman","TlwgMono","Traditional Arabic","Trebuchet MS","Tunga","Tw Cen MT Condensed Extra Bold","Ubuntu","Umpush","Univers","Utopia","Utsaah","Vani","Verdana","Vijaya","Vladimir Script","Vrinda","Webdings","Wide Latin","Wingdings"],e="",n=0;n<t.length;n++)a.detect(t[n])&&(e+=n==t.length-1?t[n]:t[n]+", ");return e},isLocalStorage:function(){try{return!!o.localStorage}catch(t){return!0}},isSessionStorage:function(){try{return!!o.sessionStorage}catch(t){return!0}},isCookie:function(){return navigator.cookieEnabled},getTimeZone:function(){var t,e;return t=new Date,(e=String(-t.getTimezoneOffset()/60))<0?"-"+("0"+(e*=-1)).slice(-2):"+"+("0"+e).slice(-2)},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language},isCanvas:function(){var t=document.createElement("canvas");try{return!(!t.getContext||!t.getContext("2d"))}catch(t){return!1}},getCanvasPrint:function(){var t,e=document.createElement("canvas");try{t=e.getContext("2d")}catch(t){return""}var n="ClientJS,org <canvas> 1.0";return t.textBaseline="top",t.font="14px 'Arial'",t.textBaseline="alphabetic",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText(n,2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText(n,4,17),e.toDataURL()}},e.ClientJS=l},function(t,e,i){"use strict";var a=i(2);t.exports=function(){return"object"==typeof n.g&&n.g&&n.g.Math===Math&&n.g.Array===Array?n.g:a}},function(t,e,n){"use strict";"undefined"!=typeof self?t.exports=self:"undefined"!=typeof window?t.exports=window:t.exports=Function("return this")()},function(t,e,n){t.exports=function(t,e){var n,i,a,o,s,r,c,l;for(n=3&t.length,i=t.length-n,a=e,s=3432918353,r=461845907,l=0;l<i;)c=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,a=27492+(65535&(o=5*(65535&(a=(a^=c=(65535&(c=(c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&t.charCodeAt(l+2))<<16;case 2:c^=(255&t.charCodeAt(l+1))<<8;case 1:a^=c=(65535&(c=(c=(65535&(c^=255&t.charCodeAt(l)))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}},function(t,e,n){var i;!function(a,o){"use strict";var s="function",r="undefined",c="object",l="string",d="model",u="name",h="type",g="vendor",p="version",f="architecture",m="console",v="mobile",b="tablet",y="smarttv",w="wearable",x="embedded",C="Amazon",S="Apple",k="ASUS",I="BlackBerry",E="Google",T="Huawei",M="LG",_="Microsoft",D="Motorola",P="Samsung",A="Sony",O="Xiaomi",j="Zebra",L="Facebook",U=function(t){var e={};for(var n in t)e[t[n].toUpperCase()]=t[n];return e},N=function(t,e){return typeof t===l&&-1!==V(e).indexOf(V(t))},V=function(t){return t.toLowerCase()},B=function(t,e){if(typeof t===l)return t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof e===r?t:t.substring(0,255)},H=function(t,e){for(var n,i,a,r,l,d,u=0;u<e.length&&!l;){var h=e[u],g=e[u+1];for(n=i=0;n<h.length&&!l;)if(l=h[n++].exec(t))for(a=0;a<g.length;a++)d=l[++i],typeof(r=g[a])===c&&r.length>0?2==r.length?typeof r[1]==s?this[r[0]]=r[1].call(this,d):this[r[0]]=r[1]:3==r.length?typeof r[1]!==s||r[1].exec&&r[1].test?this[r[0]]=d?d.replace(r[1],r[2]):o:this[r[0]]=d?r[1].call(this,d,r[2]):o:4==r.length&&(this[r[0]]=d?r[3].call(this,d.replace(r[1],r[2])):o):this[r]=d||o;u+=2}},R=function(t,e){for(var n in e)if(typeof e[n]===c&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(N(e[n][i],t))return"?"===n?o:n}else if(N(e[n],t))return"?"===n?o:n;return t},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,p],[/opios[\/ ]+([\w\.]+)/i],[p,[u,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[p,[u,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[u,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[p,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure Browser"],p],[/\bfocus\/([\w\.]+)/i],[p,[u,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[p,[u,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[u,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[p,[u,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 Browser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,L],p],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,"Chrome WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,p],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[p,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[p,R,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[u,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,V]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",V]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[g,P],[h,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[g,P],[h,v]],[/\((ip(?:hone|od)[\w ]*);/i],[d,[g,S],[h,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[g,S],[h,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[g,T],[h,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[d,[g,T],[h,v]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[g,O],[h,v]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[g,O],[h,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[d,[g,"OPPO"],[h,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[g,"Vivo"],[h,v]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[g,"Realme"],[h,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[g,D],[h,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[g,D],[h,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[g,M],[h,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[g,M],[h,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[g,"Lenovo"],[h,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[g,"Nokia"],[h,v]],[/(pixel c)\b/i],[d,[g,E],[h,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[g,E],[h,v]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[g,A],[h,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[g,A],[h,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[g,"OnePlus"],[h,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[g,C],[h,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[g,C],[h,v]],[/(playbook);[-\w\),; ]+(rim)/i],[d,g,[h,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[g,I],[h,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[g,k],[h,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[g,k],[h,v]],[/(nexus 9)/i],[d,[g,"HTC"],[h,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[g,[d,/_/g," "],[h,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[g,"Acer"],[h,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[g,"Meizu"],[h,v]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[g,"Sharp"],[h,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,d,[h,v]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,d,[h,b]],[/(surface duo)/i],[d,[g,_],[h,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[g,"Fairphone"],[h,v]],[/(u304aa)/i],[d,[g,"AT&T"],[h,v]],[/\bsie-(\w*)/i],[d,[g,"Siemens"],[h,v]],[/\b(rct\w+) b/i],[d,[g,"RCA"],[h,b]],[/\b(venue[\d ]{2,7}) b/i],[d,[g,"Dell"],[h,b]],[/\b(q(?:mv|ta)\w+) b/i],[d,[g,"Verizon"],[h,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[g,"Barnes & Noble"],[h,b]],[/\b(tm\d{3}\w+) b/i],[d,[g,"NuVision"],[h,b]],[/\b(k88) b/i],[d,[g,"ZTE"],[h,b]],[/\b(nx\d{3}j) b/i],[d,[g,"ZTE"],[h,v]],[/\b(gen\d{3}) b.+49h/i],[d,[g,"Swiss"],[h,v]],[/\b(zur\d{3}) b/i],[d,[g,"Swiss"],[h,b]],[/\b((zeki)?tb.*\b) b/i],[d,[g,"Zeki"],[h,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],d,[h,b]],[/\b(ns-?\w{0,9}) b/i],[d,[g,"Insignia"],[h,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[g,"NextBook"],[h,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],d,[h,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],d,[h,v]],[/\b(ph-1) /i],[d,[g,"Essential"],[h,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[g,"Envizen"],[h,b]],[/\b(trio[-\w\. ]+) b/i],[d,[g,"MachSpeed"],[h,b]],[/\btu_(1491) b/i],[d,[g,"Rotor"],[h,b]],[/(shield[\w ]+) b/i],[d,[g,"Nvidia"],[h,b]],[/(sprint) (\w+)/i],[g,d,[h,v]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[g,_],[h,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[g,j],[h,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[g,j],[h,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,d,[h,m]],[/droid.+; (shield) bui/i],[d,[g,"Nvidia"],[h,m]],[/(playstation [345portablevi]+)/i],[d,[g,A],[h,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[g,_],[h,m]],[/smart-tv.+(samsung)/i],[g,[h,y]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[g,P],[h,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,M],[h,y]],[/(apple) ?tv/i],[g,[d,"Apple TV"],[h,y]],[/crkey/i],[[d,"Chromecast"],[g,E],[h,y]],[/droid.+aft(\w)( bui|\))/i],[d,[g,C],[h,y]],[/\(dtv[\);].+(aquos)/i],[d,[g,"Sharp"],[h,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[g,B],[d,B],[h,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,y]],[/((pebble))app/i],[g,d,[h,w]],[/droid.+; (glass) \d/i],[d,[g,E],[h,w]],[/droid.+; (wt63?0{2,3})\)/i],[d,[g,j],[h,w]],[/(quest( 2)?)/i],[d,[g,L],[h,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[h,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[h,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[h,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,b]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[h,v]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[p,R,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[p,R,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[p,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,p],[/\(bb(10);/i],[p,[u,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[u,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[u,"webOS"]],[/crkey\/([\d\.]+)/i],[p,[u,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[u,"Chromium OS"],p],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,p],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,p]]},G=function(t,e){if(typeof t===c&&(e=t,t=o),!(this instanceof G))return new G(t,e).getResult();var n=t||(typeof a!==r&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),i=e?function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n}($,e):$;return this.getBrowser=function(){var t,e={};return e.name=o,e.version=o,H.call(e,n,i.browser),e.major=typeof(t=e.version)===l?t.replace(/[^\d\.]/g,"").split(".")[0]:o,e},this.getCPU=function(){var t={};return t.architecture=o,H.call(t,n,i.cpu),t},this.getDevice=function(){var t={};return t.vendor=o,t.model=o,t.type=o,H.call(t,n,i.device),t},this.getEngine=function(){var t={};return t.name=o,t.version=o,H.call(t,n,i.engine),t},this.getOS=function(){var t={};return t.name=o,t.version=o,H.call(t,n,i.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=typeof t===l&&t.length>255?B(t,255):t,this},this.setUA(n),this};G.VERSION="0.7.30",G.BROWSER=U([u,p,"major"]),G.CPU=U([f]),G.DEVICE=U([d,g,h,m,v,y,b,w,x]),G.ENGINE=G.OS=U([u,p]),typeof e!==r?(typeof t!==r&&t.exports&&(e=t.exports=G),e.UAParser=G):n(5)?(i=function(){return G}.call(e,n,e,t))===o||(t.exports=i):typeof a!==r&&(a.UAParser=G);var q=typeof a!==r&&(a.jQuery||a.Zepto);if(q&&!q.ua){var F=new G;q.ua=F.getResult(),q.ua.get=function(){return F.getUA()},q.ua.set=function(t){F.setUA(t);var e=F.getResult();for(var n in e)q.ua[n]=e[n]}}}("object"==typeof window?window:this)},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e){t.exports=function(){var t=["monospace","sans-serif","serif"],e=document.getElementsByTagName("body")[0],n=document.createElement("span");n.style.fontSize="72px",n.innerHTML="mmmmmmmmmmlli";var i={},a={};for(var o in t)n.style.fontFamily=t[o],e.appendChild(n),i[t[o]]=n.offsetWidth,a[t[o]]=n.offsetHeight,e.removeChild(n);this.detect=function(o){var s=!1;for(var r in t){n.style.fontFamily=o+","+t[r],e.appendChild(n);var c=n.offsetWidth!=i[t[r]]||n.offsetHeight!=a[t[r]];e.removeChild(n),s=s||c}return s}}}])},9167:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchChatDetailV2=o,e.convertV2ToLegacy=s,e.fetchChatDetail=function(t){return i(this,void 0,void 0,(function*(){return s(yield o(t))}))};const a=n(2597);function o(t){return i(this,void 0,void 0,(function*(){var e,n,i;if(!t)throw console.warn("[chat-detail-service] ‚ùå fetchChatDetailV2 llamado sin chatId"),new Error("chatId requerido");try{const a=localStorage.getItem("guiders_recent_chats");if(a){const o=JSON.parse(a).find((e=>e&&e.id===t));if(o){const a={id:o.id,status:o.status,priority:o.priority,visitorInfo:o.visitorInfo,assignedCommercialId:o.assignedCommercialId,availableCommercialIds:o.availableCommercialIds,metadata:o.metadata,createdAt:new Date(o.createdAt),assignedAt:o.assignedAt?new Date(o.assignedAt):void 0,closedAt:o.closedAt?new Date(o.closedAt):void 0,lastMessageDate:o.lastMessageDate?new Date(o.lastMessageDate):void 0,totalMessages:null!==(e=o.totalMessages)&&void 0!==e?e:0,unreadMessagesCount:null!==(n=o.unreadMessagesCount)&&void 0!==n?n:0,isActive:null===(i=o.isActive)||void 0===i||i,visitorId:o.visitorId,department:o.department,tags:o.tags,updatedAt:o.updatedAt?new Date(o.updatedAt):void 0,averageResponseTimeMinutes:o.averageResponseTimeMinutes,chatDurationMinutes:o.chatDurationMinutes,resolutionStatus:o.resolutionStatus,satisfactionRating:o.satisfactionRating};return console.log("[chat-detail-service] üì¶ Usando detalle de chat desde cache local (sin GET):",t),a}}}catch(t){console.warn("[chat-detail-service] ‚ö†Ô∏è Error procesando cache guiders_recent_chats:",t)}const o=localStorage.getItem("accessToken"),s=a.EndpointManager.getInstance(),r=localStorage.getItem("pixelEndpoint")||s.getEndpoint(),c=`${r.endsWith("/api")?r:`${r}/api`}/v2/chats/${t}`,l={"Content-Type":"application/json"},d=sessionStorage.getItem("guiders_backend_session_id");d&&(l["X-Guiders-Sid"]=d),o&&(l.Authorization=`Bearer ${o}`);const u=yield fetch(c,{method:"GET",headers:l});if(!u.ok)throw new Error(`Error al obtener detalles del chat V2 (${u.status})`);return u.json()}))}function s(t){var e,n,i,a;const o=[];return o.push({id:t.visitorInfo.id,name:t.visitorInfo.name,isCommercial:!1,isVisitor:!0,isOnline:!0,assignedAt:t.createdAt.toISOString(),lastSeenAt:(null===(e=t.lastMessageDate)||void 0===e?void 0:e.toISOString())||null,isViewing:t.isActive,isTyping:!1,isAnonymous:!1}),t.assignedCommercialId?o.push({id:t.assignedCommercialId,name:`Comercial ${t.assignedCommercialId}`,isCommercial:!0,isVisitor:!1,isOnline:t.isActive,assignedAt:(null===(n=t.assignedAt)||void 0===n?void 0:n.toISOString())||t.createdAt.toISOString(),lastSeenAt:(null===(i=t.lastMessageDate)||void 0===i?void 0:i.toISOString())||null,isViewing:t.isActive,isTyping:!1,isAnonymous:!1}):t.availableCommercialIds&&t.availableCommercialIds.forEach((e=>{o.push({id:e,name:`Comercial ${e}`,isCommercial:!0,isVisitor:!1,isOnline:!1,assignedAt:t.createdAt.toISOString(),lastSeenAt:null,isViewing:!1,isTyping:!1,isAnonymous:!1})})),{id:t.id,participants:o,status:t.status,lastMessage:null,lastMessageAt:(null===(a=t.lastMessageDate)||void 0===a?void 0:a.toISOString())||null,createdAt:t.createdAt.toISOString()}}},9329:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.URLInjectionStage=void 0,e.URLInjectionStage=class{process(t){if(t.metadata&&"object"==typeof t.metadata&&"page"in t.metadata&&"object"==typeof t.metadata.page&&t.metadata.page&&"url"in t.metadata.page)console.log("[URLInjectionStage] ‚úÖ URL ya presente en metadata, omitiendo inyecci√≥n autom√°tica");else if("undefined"!=typeof window&&window.location){t.metadata||(t.metadata={});const e={url:window.location.href,path:window.location.pathname,search:window.location.search,host:window.location.host,protocol:window.location.protocol,hash:window.location.hash,referrer:document.referrer||"",timestamp:Date.now()};t.metadata.page=e,t.data&&(t.data.pageUrl=window.location.href,t.data.pagePath=window.location.pathname),console.log("[URLInjectionStage] üåê URL generada autom√°ticamente para page_view:",{url:e.url,path:e.path,search:e.search})}else console.warn("[URLInjectionStage] ‚ö†Ô∏è No se puede acceder a window.location - entorno no es navegador");return t}}},9910:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.unsafeStringify=r;for(var i,a=(i=n(7037))&&i.__esModule?i:{default:i},o=[],s=0;s<256;++s)o.push((s+256).toString(16).slice(1));function r(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}e.default=function(t,e=0){var n=r(t,e);if(!(0,a.default)(n))throw TypeError("Stringified UUID is invalid");return n}}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var i=n(8156);return i.default})()));