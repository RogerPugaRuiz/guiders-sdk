<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Test Mensajes Self vs Other - Guiders SDK</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        .btn-primary {
            background: #0084ff;
            color: white;
        }
        .btn-primary:hover {
            background: #0066cc;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-success:hover {
            background: #059669;
        }
        #chat-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            background: #f9fafb;
            padding: 12px;
        }
        .status {
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: 500;
        }
        .status.loading {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .status.ready {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .message-examples {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .example-messages {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .example-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            color: #374151;
        }
        .conversation-flow {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .msg-preview {
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 13px;
            max-width: 70%;
        }
        .msg-preview.self {
            background: linear-gradient(145deg, #0084ff 60%, #00c6fb 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 3px;
        }
        .msg-preview.other {
            background: white;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="test-section">
        <div class="test-title">üöÄ Test de Mensajes: Self vs Other</div>
        
        <div class="status loading" id="status">
            ‚è≥ Cargando SDK...
        </div>

        <div class="buttons">
            <button class="btn btn-primary" onclick="sendUserMessage()">üì§ Mensaje Usuario (Self)</button>
            <button class="btn btn-secondary" onclick="sendOtherMessage()">üì• Mensaje Otro (Other)</button>
            <button class="btn btn-success" onclick="sendConversation()">üí¨ Conversaci√≥n Completa</button>
            <button class="btn btn-secondary" onclick="clearMessages()">üóëÔ∏è Limpiar</button>
        </div>

        <div id="chat-container"></div>
    </div>

    <div class="test-section">
        <div class="test-title">üëÄ Vista Previa Esperada</div>
        <div class="message-examples">
            <div class="example-messages">
                <div class="example-title">Mensajes Usuario (Self)</div>
                <div class="conversation-flow">
                    <div class="msg-preview self">Hola! üëã</div>
                    <div class="msg-preview self">¬øC√≥mo est√°n?</div>
                    <div class="msg-preview self">Todo bien por aqu√≠</div>
                </div>
            </div>
            <div class="example-messages">
                <div class="example-title">Mensajes Otros (Other)</div>
                <div class="conversation-flow">
                    <div class="msg-preview other">¬°Hola! Muy bien, gracias</div>
                    <div class="msg-preview other">¬øY t√∫ qu√© tal?</div>
                    <div class="msg-preview other">Me alegro de escucharlo üòä</div>
                </div>
            </div>
        </div>
    </div>

    <script src="../dist/index.js"></script>
    <script>
        let chatContainer;
        let messageCount = 0;

        // Mensajes de ejemplo para testing
        const testMessages = {
            user: [
                "Hola! üëã",
                "¬øC√≥mo est√°n?",
                "Todo bien por aqu√≠",
                "Perfecto",
                "Nos vemos luego",
                "Un mensaje un poco m√°s largo para ver c√≥mo se adapta el ancho",
                "ok"
            ],
            other: [
                "¬°Hola! Muy bien, gracias",
                "¬øY t√∫ qu√© tal?",
                "Me alegro de escucharlo üòä",
                "Genial!",
                "¬°Hasta pronto!",
                "Tambi√©n quiero probar con un mensaje m√°s extenso para verificar el comportamiento",
                "üëç"
            ]
        };

        function updateStatus(message, type = 'loading') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function initializeSDK() {
            try {
                if (typeof window.guiders === 'undefined') {
                    throw new Error('SDK no encontrado');
                }

                // Configurar el SDK
                window.GUIDERS_CONFIG = {
                    apiKey: 'test-key-123',
                    endpoint: 'http://localhost:3000/api',
                    wsEndpoint: 'ws://localhost:3000',
                    debug: true
                };

                chatContainer = document.getElementById('chat-container');
                updateStatus('‚úÖ SDK cargado correctamente', 'ready');
                
                console.log('üöÄ SDK inicializado para testing');
                
            } catch (error) {
                console.error('‚ùå Error inicializando SDK:', error);
                updateStatus('‚ùå Error cargando SDK: ' + error.message, 'error');
            }
        }

        function sendUserMessage() {
            const messages = testMessages.user;
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            addMessageToChat({
                id: `user-${++messageCount}`,
                content: message,
                sender: 'user',
                timestamp: Date.now(),
                senderId: 'current-user'
            }, true);
        }

        function sendOtherMessage() {
            const messages = testMessages.other;
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            addMessageToChat({
                id: `other-${++messageCount}`,
                content: message,
                sender: 'other',
                timestamp: Date.now(),
                senderId: 'support-agent'
            }, false);
        }

        function sendConversation() {
            clearMessages();
            
            // Simular una conversaci√≥n natural
            const conversation = [
                { type: 'other', text: 'Hola! ¬øEn qu√© puedo ayudarte?' },
                { type: 'user', text: 'Hola! Tengo una consulta' },
                { type: 'other', text: 'Por supuesto, dime' },
                { type: 'user', text: 'Quer√≠a saber sobre los precios' },
                { type: 'other', text: 'Te puedo ayudar con eso. ¬øQu√© producto te interesa espec√≠ficamente?' },
                { type: 'user', text: 'El plan premium' },
                { type: 'other', text: 'Excelente elecci√≥n! El plan premium incluye todas las funcionalidades avanzadas' },
                { type: 'user', text: 'Perfecto' },
                { type: 'other', text: '¬øTe gustar√≠a que programe una demo?' },
                { type: 'user', text: 'S√≠, por favor' }
            ];

            conversation.forEach((msg, index) => {
                setTimeout(() => {
                    if (msg.type === 'user') {
                        addMessageToChat({
                            id: `conv-user-${index}`,
                            content: msg.text,
                            sender: 'user',
                            timestamp: Date.now(),
                            senderId: 'current-user'
                        }, true);
                    } else {
                        addMessageToChat({
                            id: `conv-other-${index}`,
                            content: msg.text,
                            sender: 'other',
                            timestamp: Date.now(),
                            senderId: 'support-agent'
                        }, false);
                    }
                }, index * 800);
            });
        }

        function addMessageToChat(messageData, isUserMessage) {
            if (!chatContainer) return;

            // Usar el MessageRenderer del SDK
            if (window.guiders && window.guiders.MessageRenderer) {
                const messageElement = window.guiders.MessageRenderer.renderMessage(messageData, isUserMessage);
                chatContainer.appendChild(messageElement);
            } else {
                // Fallback si el MessageRenderer no est√° disponible
                const messageDiv = document.createElement('div');
                messageDiv.innerHTML = `
                    <div style="display: flex; margin-bottom: 8px; ${isUserMessage ? 'justify-content: flex-end;' : 'justify-content: flex-start;'}">
                        <div style="
                            padding: 6px 10px;
                            border-radius: 10px;
                            max-width: 70%;
                            font-size: 13px;
                            line-height: 1.2;
                            white-space: normal;
                            ${isUserMessage ? 
                                'background: linear-gradient(145deg, #0084ff 60%, #00c6fb 100%); color: white; border-bottom-right-radius: 3px;' : 
                                'background: white; color: #1f2937; border-bottom-left-radius: 3px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);'
                            }
                        ">
                            ${messageData.content}
                        </div>
                    </div>
                `;
                chatContainer.appendChild(messageDiv);
            }

            // Scroll al final
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function clearMessages() {
            if (chatContainer) {
                chatContainer.innerHTML = '';
                messageCount = 0;
            }
        }

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            // Dar tiempo a que el SDK se cargue
            setTimeout(initializeSDK, 100);
        });

        // Exponer funciones globalmente para debugging
        window.testChat = {
            sendUserMessage,
            sendOtherMessage,
            sendConversation,
            clearMessages
        };
    </script>
</body>
</html>